"use strict";(self.webpackChunkkeyboard_simul=self.webpackChunkkeyboard_simul||[]).push([[179],{913:()=>{function zt(n){return"function"==typeof n}function $c(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const xh=$c(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Va(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Fi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(zt(i))try{i()}catch(s){e=s instanceof xh?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{CM(s)}catch(o){e=e??[],o instanceof xh?e=[...e,...o.errors]:e.push(o)}}if(e)throw new xh(e)}}add(e){var t;if(e&&e!==this)if(this.closed)CM(e);else{if(e instanceof Fi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Va(t,e)}remove(e){const{_finalizers:t}=this;t&&Va(t,e),e instanceof Fi&&e._removeParent(this)}}Fi.EMPTY=(()=>{const n=new Fi;return n.closed=!0,n})();const TM=Fi.EMPTY;function AM(n){return n instanceof Fi||n&&"closed"in n&&zt(n.remove)&&zt(n.add)&&zt(n.unsubscribe)}function CM(n){zt(n)?n():n.unsubscribe()}const Io={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Mh={setTimeout(n,e,...t){const{delegate:i}=Mh;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Mh;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function DM(n){Mh.setTimeout(()=>{const{onUnhandledError:e}=Io;if(!e)throw n;e(n)})}function Ag(){}const xO=Cg("C",void 0,void 0);function Cg(n,e,t){return{kind:n,value:e,error:t}}let Ro=null;function Eh(n){if(Io.useDeprecatedSynchronousErrorHandling){const e=!Ro;if(e&&(Ro={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=Ro;if(Ro=null,t)throw i}}else n()}class Dg extends Fi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,AM(e)&&e.add(this)):this.destination=CO}static create(e,t,i){return new qc(e,t,i)}next(e){this.isStopped?Rg(function EO(n){return Cg("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Rg(function MO(n){return Cg("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Rg(xO,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const SO=Function.prototype.bind;function Ig(n,e){return SO.call(n,e)}class TO{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){wh(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){wh(i)}else wh(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){wh(t)}}}class qc extends Dg{constructor(e,t,i){let r;if(super(),zt(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Io.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&Ig(e.next,s),error:e.error&&Ig(e.error,s),complete:e.complete&&Ig(e.complete,s)}):r=e}this.destination=new TO(r)}}function wh(n){Io.useDeprecatedSynchronousErrorHandling?function wO(n){Io.useDeprecatedSynchronousErrorHandling&&Ro&&(Ro.errorThrown=!0,Ro.error=n)}(n):DM(n)}function Rg(n,e){const{onStoppedNotification:t}=Io;t&&Mh.setTimeout(()=>t(n,e))}const CO={closed:!0,next:Ag,error:function AO(n){throw n},complete:Ag},Pg="function"==typeof Symbol&&Symbol.observable||"@@observable";function Po(n){return n}function IM(n){return 0===n.length?Po:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let hn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function RO(n){return n&&n instanceof Dg||function IO(n){return n&&zt(n.next)&&zt(n.error)&&zt(n.complete)}(n)&&AM(n)}(t)?t:new qc(t,i,r);return Eh(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=RM(i))((r,s)=>{const o=new qc({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[Pg](){return this}pipe(...t){return IM(t)(this)}toPromise(t){return new(t=RM(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function RM(n){var e;return null!==(e=n??Io.Promise)&&void 0!==e?e:Promise}const PO=$c(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Br=(()=>{class n extends hn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new PM(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new PO}next(t){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?TM:(this.currentObservers=null,s.push(t),new Fi(()=>{this.currentObservers=null,Va(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new hn;return t.source=this,t}}return n.create=(e,t)=>new PM(e,t),n})();class PM extends Br{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:TM}}function FM(n){return zt(n?.lift)}function Mn(n){return e=>{if(FM(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function fn(n,e,t,i,r){return new FO(n,e,t,i,r)}class FO extends Dg{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Mt(n,e){return Mn((t,i)=>{let r=0;t.subscribe(fn(i,s=>{i.next(n.call(e,s,r++))}))})}function Zs(n){return this instanceof Zs?(this.v=n,this):new Zs(n)}function kM(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Ng(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}const UM=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function BM(n){return zt(n?.then)}function VM(n){return zt(n[Pg])}function zM(n){return Symbol.asyncIterator&&zt(n?.[Symbol.asyncIterator])}function HM(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const GM=function QO(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function WM(n){return zt(n?.[GM])}function jM(n){return function NM(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(h){i[h]&&(r[h]=function(f){return new Promise(function(p,_){s.push([h,f,p,_])>1||a(h,f)})})}function a(h,f){try{!function l(h){h.value instanceof Zs?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}(i[h](f))}catch(p){d(s[0][3],p)}}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,f){h(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Zs(t.read());if(r)return yield Zs(void 0);yield yield Zs(i)}}finally{t.releaseLock()}})}function $M(n){return zt(n?.getReader)}function Li(n){if(n instanceof hn)return n;if(null!=n){if(VM(n))return function JO(n){return new hn(e=>{const t=n[Pg]();if(zt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(UM(n))return function eN(n){return new hn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(BM(n))return function tN(n){return new hn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,DM)})}(n);if(zM(n))return qM(n);if(WM(n))return function nN(n){return new hn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if($M(n))return function iN(n){return qM(jM(n))}(n)}throw HM(n)}function qM(n){return new hn(e=>{(function rN(n,e){var t,i,r,s;return function LM(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=kM(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function ps(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Bn(n,e,t=1/0){return zt(e)?Bn((i,r)=>Mt((s,o)=>e(i,s,r,o))(Li(n(i,r))),t):("number"==typeof e&&(t=e),Mn((i,r)=>function sN(n,e,t,i,r,s,o,a){const l=[];let c=0,u=0,d=!1;const h=()=>{d&&!l.length&&!c&&e.complete()},f=_=>c<i?p(_):l.push(_),p=_=>{s&&e.next(_),c++;let m=!1;Li(t(_,u++)).subscribe(fn(e,g=>{r?.(g),s?f(g):e.next(g)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;l.length&&c<i;){const g=l.shift();o?ps(e,o,()=>p(g)):p(g)}h()}catch(g){e.error(g)}}))};return n.subscribe(fn(e,f,()=>{d=!0,h()})),()=>{a?.()}}(i,r,n,t)))}function za(n=1/0){return Bn(Po,n)}const Vr=new hn(n=>n.complete());function kg(n){return n[n.length-1]}function XM(n){return zt(kg(n))?n.pop():void 0}function Xc(n){return function aN(n){return n&&zt(n.schedule)}(kg(n))?n.pop():void 0}function YM(n,e=0){return Mn((t,i)=>{t.subscribe(fn(i,r=>ps(i,n,()=>i.next(r),e),()=>ps(i,n,()=>i.complete(),e),r=>ps(i,n,()=>i.error(r),e)))})}function KM(n,e=0){return Mn((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function ZM(n,e){if(!n)throw new Error("Iterable cannot be null");return new hn(t=>{ps(t,e,()=>{const i=n[Symbol.asyncIterator]();ps(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function En(n,e){return e?function pN(n,e){if(null!=n){if(VM(n))return function cN(n,e){return Li(n).pipe(KM(e),YM(e))}(n,e);if(UM(n))return function dN(n,e){return new hn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(BM(n))return function uN(n,e){return Li(n).pipe(KM(e),YM(e))}(n,e);if(zM(n))return ZM(n,e);if(WM(n))return function hN(n,e){return new hn(t=>{let i;return ps(t,e,()=>{i=n[GM](),ps(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>zt(i?.return)&&i.return()})}(n,e);if($M(n))return function fN(n,e){return ZM(jM(n),e)}(n,e)}throw HM(n)}(n,e):Li(n)}function Ug(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new qc({next:()=>{i.unsubscribe(),n()}});return Li(e(...t)).subscribe(i)}function Bt(n){for(let e in n)if(n[e]===Bt)return e;throw Error("Could not find renamed property on target object.")}function Bg(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Ht(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Ht).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Vg(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const _N=Bt({__forward_ref__:Bt});function Gt(n){return n.__forward_ref__=Gt,n.toString=function(){return Ht(this())},n}function Ze(n){return zg(n)?n():n}function zg(n){return"function"==typeof n&&n.hasOwnProperty(_N)&&n.__forward_ref__===Gt}function Hg(n){return n&&!!n.\u0275providers}class me extends Error{constructor(e,t){super(Sh(e,t)),this.code=e}}function Sh(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}function Rt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():function ot(n){return"string"==typeof n?n:null==n?"":String(n)}(n)}function Th(n,e){throw new me(-201,!1)}function er(n,e){null==n&&function Pt(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function $e(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function On(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ah(n){return JM(n,Ch)||JM(n,tE)}function JM(n,e){return n.hasOwnProperty(e)?n[e]:null}function eE(n){return n&&(n.hasOwnProperty(Gg)||n.hasOwnProperty(SN))?n[Gg]:null}const Ch=Bt({\u0275prov:Bt}),Gg=Bt({\u0275inj:Bt}),tE=Bt({ngInjectableDef:Bt}),SN=Bt({ngInjectorDef:Bt});var Qe=(()=>((Qe=Qe||{})[Qe.Default=0]="Default",Qe[Qe.Host=1]="Host",Qe[Qe.Self=2]="Self",Qe[Qe.SkipSelf=4]="SkipSelf",Qe[Qe.Optional=8]="Optional",Qe))();let Wg;function tr(n){const e=Wg;return Wg=n,e}function nE(n,e,t){const i=Ah(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&Qe.Optional?null:void 0!==e?e:void Th(Ht(n))}const Xt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Yc={},jg="__NG_DI_FLAG__",Dh="ngTempTokenPath",AN="ngTokenPath",CN=/\n/gm,DN="\u0275",iE="__source";let Kc;function Ha(n){const e=Kc;return Kc=n,e}function IN(n,e=Qe.Default){if(void 0===Kc)throw new me(-203,!1);return null===Kc?nE(n,void 0,e):Kc.get(n,e&Qe.Optional?null:void 0,e)}function He(n,e=Qe.Default){return(function TN(){return Wg}()||IN)(Ze(n),e)}function vt(n,e=Qe.Default){return He(n,Ih(e))}function Ih(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function $g(n){const e=[];for(let t=0;t<n.length;t++){const i=Ze(n[t]);if(Array.isArray(i)){if(0===i.length)throw new me(900,!1);let r,s=Qe.Default;for(let o=0;o<i.length;o++){const a=i[o],l=RN(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}e.push(He(r,s))}else e.push(He(i))}return e}function Zc(n,e){return n[jg]=e,n.prototype[jg]=e,n}function RN(n){return n[jg]}function ms(n){return{toString:n}.toString()}var zr=(()=>((zr=zr||{})[zr.OnPush=0]="OnPush",zr[zr.Default=1]="Default",zr))(),_r=(()=>{return(n=_r||(_r={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",_r;var n})();const gs={},It=[],Rh=Bt({\u0275cmp:Bt}),qg=Bt({\u0275dir:Bt}),Xg=Bt({\u0275pipe:Bt}),sE=Bt({\u0275mod:Bt}),_s=Bt({\u0275fac:Bt}),Qc=Bt({__NG_ELEMENT_ID__:Bt});let LN=0;function Jc(n){return ms(()=>{const e=aE(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===zr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,data:n.data||{},encapsulation:n.encapsulation||_r.Emulated,id:"c"+LN++,styles:n.styles||It,_:null,schemas:n.schemas||null,tView:null};lE(t);const i=n.dependencies;return t.directiveDefs=Ph(i,!1),t.pipeDefs=Ph(i,!0),t})}function NN(n){return Ft(n)||Yn(n)}function kN(n){return null!==n}function Vn(n){return ms(()=>({type:n.type,bootstrap:n.bootstrap||It,declarations:n.declarations||It,imports:n.imports||It,exports:n.exports||It,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function oE(n,e){if(null==n)return gs;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}function it(n){return ms(()=>{const e=aE(n);return lE(e),e})}function Ft(n){return n[Rh]||null}function Yn(n){return n[qg]||null}function xi(n){return n[Xg]||null}function Ni(n,e){const t=n[sE]||null;if(!t&&!0===e)throw new Error(`Type ${Ht(n)} does not have '\u0275mod' property.`);return t}function aE(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,exportAs:n.exportAs||null,standalone:!0===n.standalone,selectors:n.selectors||It,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:oE(n.inputs,e),outputs:oE(n.outputs)}}function lE(n){n.features?.forEach(e=>e(n))}function Ph(n,e){if(!n)return null;const t=e?xi:NN;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(kN)}const ys=0,Ge=1,dt=2,sn=3,yr=4,Fo=5,Kn=6,Wa=7,pn=8,Fh=9,Lh=10,mt=11,Yg=12,eu=13,cE=14,ja=15,Zn=16,tu=17,$a=18,Hr=19,nu=20,uE=21,Yt=22,Kg=1,dE=2,Oh=7,Nh=8,qa=9,ci=10;function ki(n){return Array.isArray(n)&&"object"==typeof n[Kg]}function vr(n){return Array.isArray(n)&&!0===n[Kg]}function Zg(n){return 0!=(4&n.flags)}function iu(n){return n.componentOffset>-1}function kh(n){return 1==(1&n.flags)}function br(n){return!!n.template}function BN(n){return 0!=(256&n[dt])}function Lo(n,e){return n.hasOwnProperty(_s)?n[_s]:null}class HN{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function nr(){return pE}function pE(n){return n.type.prototype.ngOnChanges&&(n.setInput=WN),GN}function GN(){const n=gE(this),e=n?.current;if(e){const t=n.previous;if(t===gs)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function WN(n,e,t,i){const r=this.declaredInputs[t],s=gE(n)||function jN(n,e){return n[mE]=e}(n,{previous:gs,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[r];o[r]=new HN(l&&l.currentValue,e,a===gs),n[i]=e}nr.ngInherit=!0;const mE="__ngSimpleChanges__";function gE(n){return n[mE]||null}const ir=function(n,e,t){};function zn(n){for(;Array.isArray(n);)n=n[ys];return n}function Ui(n,e){return zn(e[n.index])}function vE(n,e){return n.data[e]}function Mi(n,e){const t=e[n];return ki(t)?t:t[ys]}function Bh(n){return 64==(64&n[dt])}function Js(n,e){return null==e?null:n[e]}function bE(n){n[$a]=0}function Jg(n,e){n[Fo]+=e;let t=n,i=n[sn];for(;null!==i&&(1===e&&1===t[Fo]||-1===e&&0===t[Fo]);)i[Fo]+=e,t=i,i=i[sn]}const at={lFrame:IE(null),bindingsEnabled:!0};function ME(){return at.bindingsEnabled}function we(){return at.lFrame.lView}function At(){return at.lFrame.tView}function Hn(){let n=EE();for(;null!==n&&64===n.type;)n=n.parent;return n}function EE(){return at.lFrame.currentTNode}function Gr(n,e){const t=at.lFrame;t.currentTNode=n,t.isParent=e}function e_(){return at.lFrame.isParent}function ok(n,e){const t=at.lFrame;t.bindingIndex=t.bindingRootIndex=n,n_(e)}function n_(n){at.lFrame.currentDirectiveIndex=n}function AE(){return at.lFrame.currentQueryIndex}function r_(n){at.lFrame.currentQueryIndex=n}function lk(n){const e=n[Ge];return 2===e.type?e.declTNode:1===e.type?n[Kn]:null}function CE(n,e,t){if(t&Qe.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&Qe.Host||(r=lk(s),null===r||(s=s[ja],10&r.type))););if(null===r)return!1;e=r,n=s}const i=at.lFrame=DE();return i.currentTNode=e,i.lView=n,!0}function s_(n){const e=DE(),t=n[Ge];at.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function DE(){const n=at.lFrame,e=null===n?null:n.child;return null===e?IE(n):e}function IE(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function RE(){const n=at.lFrame;return at.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const PE=RE;function o_(){const n=RE();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function di(){return at.lFrame.selectedIndex}function Oo(n){at.lFrame.selectedIndex=n}function Vh(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks??(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks??(n.contentHooks=[])).push(t,a),(n.contentCheckHooks??(n.contentCheckHooks=[])).push(t,a)),l&&(n.viewHooks??(n.viewHooks=[])).push(-t,l),c&&((n.viewHooks??(n.viewHooks=[])).push(t,c),(n.viewCheckHooks??(n.viewCheckHooks=[])).push(t,c)),null!=u&&(n.destroyHooks??(n.destroyHooks=[])).push(t,u)}}function zh(n,e,t){FE(n,e,3,t)}function Hh(n,e,t,i){(3&n[dt])===t&&FE(n,e,t,i)}function a_(n,e){let t=n[dt];(3&t)===e&&(t&=2047,t+=1,n[dt]=t)}function FE(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let l=void 0!==i?65535&n[$a]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=i&&a>=i)break}else e[l]<0&&(n[$a]+=65536),(a<s||-1==s)&&(_k(n,t,e,l),n[$a]=(4294901760&n[$a])+l+2),l++}function _k(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];if(r){if(n[dt]>>11<n[$a]>>16&&(3&n[dt])===e){n[dt]+=2048,ir(4,a,s);try{s.call(a)}finally{ir(5,a,s)}}}else{ir(4,a,s);try{s.call(a)}finally{ir(5,a,s)}}}const Ka=-1;class su{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function c_(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];OE(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function LE(n){return 3===n||4===n||6===n}function OE(n){return 64===n.charCodeAt(0)}function ou(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||NE(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function NE(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function kE(n){return n!==Ka}function Gh(n){return 32767&n}function Wh(n,e){let t=function xk(n){return n>>16}(n),i=e;for(;t>0;)i=i[ja],t--;return i}let u_=!0;function jh(n){const e=u_;return u_=n,e}const UE=255,BE=5;let Mk=0;const Wr={};function $h(n,e){const t=VE(n,e);if(-1!==t)return t;const i=e[Ge];i.firstCreatePass&&(n.injectorIndex=e.length,d_(i.data,n),d_(e,null),d_(i.blueprint,null));const r=h_(n,e),s=n.injectorIndex;if(kE(r)){const o=Gh(r),a=Wh(r,e),l=a[Ge].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=r,s}function d_(n,e){n.push(0,0,0,0,0,0,0,0,e)}function VE(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function h_(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=qE(r),null===i)return Ka;if(t++,r=r[ja],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return Ka}function f_(n,e,t){!function Ek(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Qc)&&(i=t[Qc]),null==i&&(i=t[Qc]=Mk++);const r=i&UE;e.data[n+(r>>BE)]|=1<<r}(n,e,t)}function zE(n,e,t){if(t&Qe.Optional||void 0!==n)return n;Th()}function HE(n,e,t,i){if(t&Qe.Optional&&void 0===i&&(i=null),!(t&(Qe.Self|Qe.Host))){const r=n[Fh],s=tr(void 0);try{return r?r.get(e,i,t&Qe.Optional):nE(e,i,t&Qe.Optional)}finally{tr(s)}}return zE(i,0,t)}function GE(n,e,t,i=Qe.Default,r){if(null!==n){if(1024&e[dt]){const o=function Ck(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&1024&o[dt]&&!(256&o[dt]);){const a=WE(s,o,t,i|Qe.Self,Wr);if(a!==Wr)return a;let l=s.parent;if(!l){const c=o[uE];if(c){const u=c.get(t,Wr,i);if(u!==Wr)return u}l=qE(o),o=o[ja]}s=l}return r}(n,e,t,i,Wr);if(o!==Wr)return o}const s=WE(n,e,t,i,Wr);if(s!==Wr)return s}return HE(e,t,i,r)}function WE(n,e,t,i,r){const s=function Tk(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Qc)?n[Qc]:void 0;return"number"==typeof e?e>=0?e&UE:Ak:e}(t);if("function"==typeof s){if(!CE(e,n,i))return i&Qe.Host?zE(r,0,i):HE(e,t,i,r);try{const o=s(i);if(null!=o||i&Qe.Optional)return o;Th()}finally{PE()}}else if("number"==typeof s){let o=null,a=VE(n,e),l=Ka,c=i&Qe.Host?e[Zn][Kn]:null;for((-1===a||i&Qe.SkipSelf)&&(l=-1===a?h_(n,e):e[a+8],l!==Ka&&$E(i,!1)?(o=e[Ge],a=Gh(l),e=Wh(l,e)):a=-1);-1!==a;){const u=e[Ge];if(jE(s,a,u.data)){const d=Sk(a,e,t,o,i,c);if(d!==Wr)return d}l=e[a+8],l!==Ka&&$E(i,e[Ge].data[a+8]===c)&&jE(s,a,e)?(o=u,a=Gh(l),e=Wh(l,e)):a=-1}}return r}function Sk(n,e,t,i,r,s){const o=e[Ge],a=o.data[n+8],u=qh(a,o,t,null==i?iu(a)&&u_:i!=o&&0!=(3&a.type),r&Qe.Host&&s===a);return null!==u?No(e,o,u,a):Wr}function qh(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,u=s>>20,h=r?a+u:n.directiveEnd;for(let f=i?a:a+u;f<h;f++){const p=o[f];if(f<l&&t===p||f>=l&&p.type===t)return f}if(r){const f=o[l];if(f&&br(f)&&f.type===t)return l}return null}function No(n,e,t,i){let r=n[t];const s=e.data;if(function yk(n){return n instanceof su}(r)){const o=r;o.resolving&&function yN(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new me(-200,`Circular dependency in DI detected for ${n}${t}`)}(Rt(s[t]));const a=jh(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?tr(o.injectImpl):null;CE(n,i,Qe.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function gk(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=pE(e);(t.preOrderHooks??(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,o)}r&&(t.preOrderHooks??(t.preOrderHooks=[])).push(0-n,r),s&&((t.preOrderHooks??(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==l&&tr(l),jh(a),o.resolving=!1,PE()}}return r}function jE(n,e,t){return!!(t[e+(n>>BE)]&1<<n)}function $E(n,e){return!(n&Qe.Self||n&Qe.Host&&e)}class Za{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return GE(this._tNode,this._lView,e,Ih(i),t)}}function Ak(){return new Za(Hn(),we())}function Gn(n){return ms(()=>{const e=n.prototype.constructor,t=e[_s]||p_(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[_s]||p_(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function p_(n){return zg(n)?()=>{const e=p_(Ze(n));return e&&e()}:Lo(n)}function qE(n){const e=n[Ge],t=e.type;return 2===t?e.declTNode:1===t?n[Kn]:null}const Ja="__parameters__";function tl(n,e,t){return ms(()=>{const i=function m_(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(Ja)?l[Ja]:Object.defineProperty(l,Ja,{value:[]})[Ja];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Be{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=$e({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ko(n,e){n.forEach(t=>Array.isArray(t)?ko(t,e):e(t))}function YE(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Yh(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Bi(n,e,t){let i=nl(n,e);return i>=0?n[1|i]=t:(i=~i,function Pk(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function __(n,e){const t=nl(n,e);if(t>=0)return n[1|t]}function nl(n,e){return function KE(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const s=i+(r-i>>1),o=n[s<<t];if(e===o)return s<<t;o>e?r=s:i=s+1}return~(r<<t)}(n,e,1)}const uu=Zc(tl("Optional"),8),du=Zc(tl("SkipSelf"),4);var Ei=(()=>((Ei=Ei||{})[Ei.Important=1]="Important",Ei[Ei.DashCase=2]="DashCase",Ei))();const E_=new Map;let eU=0;const S_="__ngContext__";function Qn(n,e){ki(e)?(n[S_]=e[nu],function nU(n){E_.set(n[nu],n)}(e)):n[S_]=e}let T_;function A_(n,e){return T_(n,e)}function mu(n){const e=n[sn];return vr(e)?e[sn]:e}function C_(n){return gw(n[eu])}function D_(n){return gw(n[yr])}function gw(n){for(;null!==n&&!vr(n);)n=n[yr];return n}function rl(n,e,t,i,r){if(null!=i){let s,o=!1;vr(i)?s=i:ki(i)&&(o=!0,i=i[ys]);const a=zn(i);0===n&&null!==t?null==r?Mw(e,t,a):Uo(e,t,a,r||null,!0):1===n&&null!==t?Uo(e,t,a,r||null,!0):2===n?function N_(n,e,t){const i=Jh(n,e);i&&function MU(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function SU(n,e,t,i,r){const s=t[Oh];s!==zn(t)&&rl(e,n,i,s,r);for(let a=ci;a<t.length;a++){const l=t[a];gu(l[Ge],l,n,e,i,s)}}(e,n,s,t,r)}}function R_(n,e,t){return n.createElement(e,t)}function yw(n,e){const t=n[qa],i=t.indexOf(e),r=e[sn];512&e[dt]&&(e[dt]&=-513,Jg(r,-1)),t.splice(i,1)}function P_(n,e){if(n.length<=ci)return;const t=ci+e,i=n[t];if(i){const r=i[tu];null!==r&&r!==n&&yw(r,i),e>0&&(n[t-1][yr]=i[yr]);const s=Yh(n,ci+e);!function pU(n,e){gu(n,e,e[mt],2,null,null),e[ys]=null,e[Kn]=null}(i[Ge],i);const o=s[Hr];null!==o&&o.detachView(s[Ge]),i[sn]=null,i[yr]=null,i[dt]&=-65}return i}function vw(n,e){if(!(128&e[dt])){const t=e[mt];t.destroyNode&&gu(n,e,t,3,null,null),function _U(n){let e=n[eu];if(!e)return F_(n[Ge],n);for(;e;){let t=null;if(ki(e))t=e[eu];else{const i=e[ci];i&&(t=i)}if(!t){for(;e&&!e[yr]&&e!==n;)ki(e)&&F_(e[Ge],e),e=e[sn];null===e&&(e=n),ki(e)&&F_(e[Ge],e),t=e&&e[yr]}e=t}}(e)}}function F_(n,e){if(!(128&e[dt])){e[dt]&=-65,e[dt]|=128,function xU(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof su)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];ir(4,a,l);try{l.call(a)}finally{ir(5,a,l)}}else{ir(4,r,s);try{s.call(r)}finally{ir(5,r,s)}}}}}(n,e),function bU(n,e){const t=n.cleanup,i=e[Wa];let r=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[r=o]():i[r=-o].unsubscribe(),s+=2}else{const o=i[r=t[s+1]];t[s].call(o)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();e[Wa]=null}}(n,e),1===e[Ge].type&&e[mt].destroy();const t=e[tu];if(null!==t&&vr(e[sn])){t!==e[sn]&&yw(t,e);const i=e[Hr];null!==i&&i.detachView(n)}!function iU(n){E_.delete(n[nu])}(e)}}function bw(n,e,t){return function xw(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[ys];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===_r.None||s===_r.Emulated)return null}return Ui(i,t)}}(n,e.parent,t)}function Uo(n,e,t,i,r){n.insertBefore(e,t,i,r)}function Mw(n,e,t){n.appendChild(e,t)}function Ew(n,e,t,i,r){null!==i?Uo(n,e,t,i,r):Mw(n,e,t)}function Jh(n,e){return n.parentNode(e)}let L_,B_,Tw=function Sw(n,e,t){return 40&n.type?Ui(n,t):null};function ef(n,e,t,i){const r=bw(n,i,e),s=e[mt],a=function ww(n,e,t){return Tw(n,e,t)}(i.parent||e[Kn],i,e);if(null!=r)if(Array.isArray(t))for(let l=0;l<t.length;l++)Ew(s,r,t[l],a,!1);else Ew(s,r,t,a,!1);void 0!==L_&&L_(s,i,e,t,r)}function tf(n,e){if(null!==e){const t=e.type;if(3&t)return Ui(e,n);if(4&t)return O_(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return tf(n,i);{const r=n[e.index];return vr(r)?O_(-1,r):zn(r)}}if(32&t)return A_(e,n)()||zn(n[e.index]);{const i=Cw(n,e);return null!==i?Array.isArray(i)?i[0]:tf(mu(n[Zn]),i):tf(n,e.next)}}return null}function Cw(n,e){return null!==e?n[Zn][Kn].projection[e.projection]:null}function O_(n,e){const t=ci+n+1;if(t<e.length){const i=e[t],r=i[Ge].firstChild;if(null!==r)return tf(i,r)}return e[Oh]}function k_(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],l=t.type;if(o&&0===e&&(a&&Qn(zn(a),i),t.flags|=2),32!=(32&t.flags))if(8&l)k_(n,e,t.child,i,r,s,!1),rl(e,n,r,a,s);else if(32&l){const c=A_(t,i);let u;for(;u=c();)rl(e,n,r,u,s);rl(e,n,r,a,s)}else 16&l?Dw(n,e,i,t,r,s):rl(e,n,r,a,s);t=o?t.projectionNext:t.next}}function gu(n,e,t,i,r,s){k_(t,i,n.firstChild,e,r,s,!1)}function Dw(n,e,t,i,r,s){const o=t[Zn],l=o[Kn].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)rl(e,n,r,l[c],s);else k_(n,e,l,o[sn],r,s,!0)}function Iw(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function Rw(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&c_(n,e,i),null!==r&&Iw(n,e,r),null!==s&&function AU(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class Nw{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const af=new Be("ENVIRONMENT_INITIALIZER"),$w=new Be("INJECTOR",-1),qw=new Be("INJECTOR_DEF_TYPES");class Xw{get(e,t=Yc){if(t===Yc){const i=new Error(`NullInjectorError: No provider for ${Ht(e)}!`);throw i.name="NullInjectorError",i}return t}}function e3(...n){return{\u0275providers:Yw(0,n),\u0275fromNgModule:!0}}function Yw(n,...e){const t=[],i=new Set;let r;return ko(e,s=>{const o=s;j_(o,t,[],i)&&(r||(r=[]),r.push(o))}),void 0!==r&&Kw(r,t),t}function Kw(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];$_(r,s=>{e.push(s)})}}function j_(n,e,t,i){if(!(n=Ze(n)))return!1;let r=null,s=eE(n);const o=!s&&Ft(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const l=n.ngModule;if(s=eE(l),!s)return!1;r=l}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)j_(c,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;i.add(r);try{ko(s.imports,u=>{j_(u,e,t,i)&&(c||(c=[]),c.push(u))})}finally{}void 0!==c&&Kw(c,e)}if(!a){const c=Lo(r)||(()=>new r);e.push({provide:r,useFactory:c,deps:It},{provide:qw,useValue:r,multi:!0},{provide:af,useValue:()=>He(r),multi:!0})}const l=s.providers;null==l||a||$_(l,u=>{e.push(u)})}}return r!==n&&void 0!==n.providers}function $_(n,e){for(let t of n)Hg(t)&&(t=t.\u0275providers),Array.isArray(t)?$_(t,e):e(t)}const t3=Bt({provide:String,useValue:Bt});function q_(n){return null!==n&&"object"==typeof n&&t3 in n}function Bo(n){return"function"==typeof n}const X_=new Be("Set Injector scope."),lf={},r3={};let Y_;function cf(){return void 0===Y_&&(Y_=new Xw),Y_}class Ms{}class Jw extends Ms{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Z_(e,o=>this.processProvider(o)),this.records.set($w,ol(void 0,this)),r.has("environment")&&this.records.set(Ms,ol(void 0,this));const s=this.records.get(X_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(qw.multi,It,Qe.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Ha(this),i=tr(void 0);try{return e()}finally{Ha(t),tr(i)}}get(e,t=Yc,i=Qe.Default){this.assertNotDestroyed(),i=Ih(i);const r=Ha(this),s=tr(void 0);try{if(!(i&Qe.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function c3(n){return"function"==typeof n||"object"==typeof n&&n instanceof Be}(e)&&Ah(e);a=l&&this.injectableDefInScope(l)?ol(K_(e),lf):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(i&Qe.Self?cf():this.parent).get(e,t=i&Qe.Optional&&t===Yc?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[Dh]=o[Dh]||[]).unshift(Ht(e)),r)throw o;return function PN(n,e,t,i){const r=n[Dh];throw e[iE]&&r.unshift(e[iE]),n.message=function FN(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&n.charAt(1)==DN?n.slice(2):n;let r=Ht(e);if(Array.isArray(e))r=e.map(Ht).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Ht(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(CN,"\n  ")}`}("\n"+n.message,r,t,i),n[AN]=r,n[Dh]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{tr(s),Ha(r)}}resolveInjectorInitializers(){const e=Ha(this),t=tr(void 0);try{const i=this.get(af.multi,It,Qe.Self);for(const r of i)r()}finally{Ha(e),tr(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(Ht(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new me(205,!1)}processProvider(e){let t=Bo(e=Ze(e))?e:Ze(e&&e.provide);const i=function o3(n){return q_(n)?ol(void 0,n.useValue):ol(eS(n),lf)}(e);if(Bo(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=ol(void 0,lf,!0),r.factory=()=>$g(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===lf&&(t.value=r3,t.value=t.factory()),"object"==typeof t.value&&t.value&&function l3(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ze(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function K_(n){const e=Ah(n),t=null!==e?e.factory:Lo(n);if(null!==t)return t;if(n instanceof Be)throw new me(204,!1);if(n instanceof Function)return function s3(n){const e=n.length;if(e>0)throw function cu(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new me(204,!1);const t=function wN(n){return n&&(n[Ch]||n[tE])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new me(204,!1)}function eS(n,e,t){let i;if(Bo(n)){const r=Ze(n);return Lo(r)||K_(r)}if(q_(n))i=()=>Ze(n.useValue);else if(function Qw(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...$g(n.deps||[]));else if(function Zw(n){return!(!n||!n.useExisting)}(n))i=()=>He(Ze(n.useExisting));else{const r=Ze(n&&(n.useClass||n.provide));if(!function a3(n){return!!n.deps}(n))return Lo(r)||K_(r);i=()=>new r(...$g(n.deps))}return i}function ol(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Z_(n,e){for(const t of n)Array.isArray(t)?Z_(t,e):t&&Hg(t)?Z_(t.\u0275providers,e):e(t)}class u3{}class tS{}class h3{resolveComponentFactory(e){throw function d3(n){const e=Error(`No component factory found for ${Ht(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let bu=(()=>{class n{}return n.NULL=new h3,n})();function f3(){return al(Hn(),we())}function al(n,e){return new Si(Ui(n,e))}let Si=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=f3,n})();function p3(n){return n instanceof Si?n.nativeElement:n}class xu{}let Es=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function m3(){const n=we(),t=Mi(Hn().index,n);return(ki(t)?t:n)[mt]}(),n})(),g3=(()=>{class n{}return n.\u0275prov=$e({token:n,providedIn:"root",factory:()=>null}),n})();class Vo{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const _3=new Vo("15.2.9"),Q_={},J_="ngOriginalError";function ey(n){return n[J_]}class ll{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&ey(e);for(;t&&ey(t);)t=ey(t);return t||null}}function jr(n){return n.ownerDocument.defaultView}function ws(n){return n instanceof Function?n():n}function rS(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const sS="ng-template";function A3(n,e,t){let i=0,r=!0;for(;i<n.length;){let s=n[i++];if("string"==typeof s&&r){const o=n[i++];if(t&&"class"===s&&-1!==rS(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function oS(n){return 4===n.type&&n.value!==sS}function C3(n,e,t){return e===(4!==n.type||t?n.value:sS)}function D3(n,e,t){let i=4;const r=n.attrs||[],s=function P3(n){for(let e=0;e<n.length;e++)if(LE(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&i){if(i=2|1&i,""!==l&&!C3(n,l,t)||""===l&&1===e.length){if(xr(i))return!1;o=!0}}else{const c=8&i?l:e[++a];if(8&i&&null!==n.attrs){if(!A3(n.attrs,c,t)){if(xr(i))return!1;o=!0}continue}const d=I3(8&i?"class":l,r,oS(n),t);if(-1===d){if(xr(i))return!1;o=!0;continue}if(""!==c){let h;h=d>s?"":r[d+1].toLowerCase();const f=8&i?h:null;if(f&&-1!==rS(f,c,0)||2&i&&c!==h){if(xr(i))return!1;o=!0}}}}else{if(!o&&!xr(i)&&!xr(l))return!1;if(o&&xr(l))continue;o=!1,i=l|1&i}}return xr(i)||o}function xr(n){return 0==(1&n)}function I3(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function F3(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function aS(n,e,t=!1){for(let i=0;i<e.length;i++)if(D3(n,e[i],t))return!0;return!1}function lS(n,e){return n?":not("+e.trim()+")":e}function O3(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!xr(o)&&(e+=lS(s,r),r=""),i=o,s=s||!xr(i);t++}return""!==r&&(e+=lS(s,r)),e}const lt={};function fS(n,e=null,t=null,i){const r=pS(n,e,t,i);return r.resolveInjectorInitializers(),r}function pS(n,e=null,t=null,i,r=new Set){const s=[t||It,e3(n)];return i=i||("object"==typeof n?void 0:Ht(n)),new Jw(s,e||cf(),i||null,r)}let $r=(()=>{class n{static create(t,i){if(Array.isArray(t))return fS({name:""},i,t,"");{const r=t.name??"";return fS({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=Yc,n.NULL=new Xw,n.\u0275prov=$e({token:n,providedIn:"any",factory:()=>He($w)}),n.__NG_ELEMENT_ID__=-1,n})();function Se(n,e=Qe.Default){const t=we();return null===t?He(n,e):GE(Hn(),t,Ze(n),e)}function MS(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i+1];if(-1!==s){const o=n.data[s];r_(t[i]),o.contentQueries(2,e[s],s)}}}function df(n,e,t,i,r,s,o,a,l,c,u){const d=e.blueprint.slice();return d[ys]=r,d[dt]=76|i,(null!==u||n&&1024&n[dt])&&(d[dt]|=1024),bE(d),d[sn]=d[ja]=n,d[pn]=t,d[Lh]=o||n&&n[Lh],d[mt]=a||n&&n[mt],d[Yg]=l||n&&n[Yg]||null,d[Fh]=c||n&&n[Fh]||null,d[Kn]=s,d[nu]=function tU(){return eU++}(),d[uE]=u,d[Zn]=2==e.type?n[Zn]:d,d}function dl(n,e,t,i,r){let s=n.data[e];if(null===s)s=function sy(n,e,t,i,r){const s=EE(),o=e_(),l=n.data[e]=function lB(n,e,t,i,r,s){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(n,e,t,i,r),function sk(){return at.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function ru(){const n=at.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Gr(s,!0),s}function Mu(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function oy(n,e,t){s_(e);try{const i=n.viewQuery;null!==i&&my(1,i,t);const r=n.template;null!==r&&ES(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&MS(n,e),n.staticViewQueries&&my(2,n.viewQuery,t);const s=n.components;null!==s&&function sB(n,e){for(let t=0;t<e.length;t++)CB(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[dt]&=-5,o_()}}function hf(n,e,t,i){const r=e[dt];if(128!=(128&r)){s_(e);try{bE(e),function SE(n){return at.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&ES(n,e,t,2,i);const o=3==(3&r);if(o){const c=n.preOrderCheckHooks;null!==c&&zh(e,c,null)}else{const c=n.preOrderHooks;null!==c&&Hh(e,c,0,null),a_(e,0)}if(function TB(n){for(let e=C_(n);null!==e;e=D_(e)){if(!e[dE])continue;const t=e[qa];for(let i=0;i<t.length;i++){const r=t[i];512&r[dt]||Jg(r[sn],1),r[dt]|=512}}}(e),function SB(n){for(let e=C_(n);null!==e;e=D_(e))for(let t=ci;t<e.length;t++){const i=e[t],r=i[Ge];Bh(i)&&hf(r,i,r.template,i[pn])}}(e),null!==n.contentQueries&&MS(n,e),o){const c=n.contentCheckHooks;null!==c&&zh(e,c)}else{const c=n.contentHooks;null!==c&&Hh(e,c,1),a_(e,1)}!function iB(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)Oo(~r);else{const s=r,o=t[++i],a=t[++i];ok(o,s),a(2,e[s])}}}finally{Oo(-1)}}(n,e);const a=n.components;null!==a&&function rB(n,e){for(let t=0;t<e.length;t++)AB(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&my(2,l,i),o){const c=n.viewCheckHooks;null!==c&&zh(e,c)}else{const c=n.viewHooks;null!==c&&Hh(e,c,2),a_(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[dt]&=-41,512&e[dt]&&(e[dt]&=-513,Jg(e[sn],-1))}finally{o_()}}}function ES(n,e,t,i,r){const s=di(),o=2&i;try{Oo(-1),o&&e.length>Yt&&function cS(n,e,t,i){if(!i)if(3==(3&e[dt])){const s=n.preOrderCheckHooks;null!==s&&zh(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Hh(e,s,0,t)}Oo(t)}(n,e,Yt,!1),ir(o?2:0,r),t(i,r)}finally{Oo(s),ir(o?3:1,r)}}function ay(n,e,t){if(Zg(e)){const r=e.directiveEnd;for(let s=e.directiveStart;s<r;s++){const o=n.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function wS(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=uy(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function uy(n,e,t,i,r,s,o,a,l,c){const u=Yt+i,d=u+r,h=function oB(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:lt);return t}(u,d),f="function"==typeof c?c():c;return h[Ge]={type:n,blueprint:h,template:t,queries:null,viewQuery:a,declTNode:e,data:h.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function SS(n,e,t,i){const r=RS(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&PS(n).push(i,r.length-1))}function TS(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?AS(t,e,r,s):i.hasOwnProperty(r)&&AS(t,e,i[r],s)}return t}function AS(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function CS(n,e,t,i,r,s){for(let c=0;c<i.length;c++)f_($h(t,e),n,i[c].type);!function bB(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let c=0;c<i.length;c++){const u=i[c];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,l=Mu(n,e,i.length,null);for(let c=0;c<i.length;c++){const u=i[c];t.mergedAttrs=ou(t.mergedAttrs,u.hostAttrs),xB(n,t,e,l,u),vB(l,u,r),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??(n.preOrderHooks=[])).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(t.index),a=!0),l++}!function cB(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let l=null,c=null;for(let u=e.directiveStart;u<r;u++){const d=s[u],h=t?t.get(d):null,p=h?h.outputs:null;l=TS(d.inputs,u,l,h?h.inputs:null),c=TS(d.outputs,u,c,p);const _=null===l||null===o||oS(e)?null:wB(l,u,o);a.push(_)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}(n,t,s)}function DS(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function ak(){return at.lFrame.currentDirectiveIndex}();try{Oo(s);for(let a=i;a<r;a++){const l=n.data[a],c=e[a];n_(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&gB(l,c)}}finally{Oo(-1),n_(o)}}function gB(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function hy(n,e,t){e.componentOffset=t,(n.components??(n.components=[])).push(e.index)}function vB(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;br(e)&&(t[""]=n)}}function xB(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=Lo(r.type)),o=new su(s,br(r),Se);n.blueprint[i]=o,t[i]=o,function fB(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function pB(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,Mu(n,t,r.hostVars,lt),r)}function EB(n,e,t,i,r,s){const o=s[e];if(null!==o){const a=i.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],d=o[l++];null!==a?i.setInput(t,d,c,u):t[u]=d}}}function wB(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function AB(n,e){const t=Mi(e,n);if(Bh(t)){const i=t[Ge];48&t[dt]?hf(i,t,i.template,t[pn]):t[Fo]>0&&py(t)}}function py(n){for(let i=C_(n);null!==i;i=D_(i))for(let r=ci;r<i.length;r++){const s=i[r];if(Bh(s))if(512&s[dt]){const o=s[Ge];hf(o,s,o.template,s[pn])}else s[Fo]>0&&py(s)}const t=n[Ge].components;if(null!==t)for(let i=0;i<t.length;i++){const r=Mi(t[i],n);Bh(r)&&r[Fo]>0&&py(r)}}function CB(n,e){const t=Mi(e,n),i=t[Ge];(function DB(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),oy(i,t,t[pn])}function ff(n,e){return n[eu]?n[cE][yr]=e:n[eu]=e,n[cE]=e,e}function pf(n){for(;n;){n[dt]|=32;const e=mu(n);if(BN(n)&&!e)return n;n=e}return null}function mf(n,e,t,i=!0){const r=e[Lh];r.begin&&r.begin();try{hf(n,e,n.template,t)}catch(o){throw i&&LS(e,o),o}finally{r.end&&r.end()}}function my(n,e,t){r_(0),e(n,t)}function RS(n){return n[Wa]||(n[Wa]=[])}function PS(n){return n.cleanup||(n.cleanup=[])}function LS(n,e){const t=n[Fh],i=t?t.get(ll,null):null;i&&i.handleError(e)}function gy(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],l=e[o],c=n.data[o];null!==c.setInput?c.setInput(l,r,i,a):l[a]=r}}function gf(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=Vg(r,a):2==s&&(i=Vg(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function _f(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(zn(s)),vr(s))for(let a=ci;a<s.length;a++){const l=s[a],c=l[Ge].firstChild;null!==c&&_f(l[Ge],l,c,i)}const o=t.type;if(8&o)_f(n,e,t.child,i);else if(32&o){const a=A_(t,e);let l;for(;l=a();)i.push(l)}else if(16&o){const a=Cw(e,t);if(Array.isArray(a))i.push(...a);else{const l=mu(e[Zn]);_f(l[Ge],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}class Eu{get rootNodes(){const e=this._lView,t=e[Ge];return _f(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[pn]}set context(e){this._lView[pn]=e}get destroyed(){return 128==(128&this._lView[dt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[sn];if(vr(e)){const t=e[Nh],i=t?t.indexOf(this):-1;i>-1&&(P_(e,i),Yh(t,i))}this._attachedToViewContainer=!1}vw(this._lView[Ge],this._lView)}onDestroy(e){SS(this._lView[Ge],this._lView,null,e)}markForCheck(){pf(this._cdRefInjectingView||this._lView)}detach(){this._lView[dt]&=-65}reattach(){this._lView[dt]|=64}detectChanges(){mf(this._lView[Ge],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new me(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function gU(n,e){gu(n,e,e[mt],2,null,null)}(this._lView[Ge],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new me(902,!1);this._appRef=e}}class IB extends Eu{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;mf(e[Ge],e,e[pn],!1)}checkNoChanges(){}get context(){return null}}class OS extends bu{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Ft(e);return new wu(t,this.ngModule)}}function NS(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class PB{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=Ih(i);const r=this.injector.get(e,Q_,i);return r!==Q_||t===Q_?r:this.parentInjector.get(e,t,i)}}class wu extends tS{get inputs(){return NS(this.componentDef.inputs)}get outputs(){return NS(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function N3(n){return n.map(O3).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Ms?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new PB(e,s):e,a=o.get(xu,null);if(null===a)throw new me(407,!1);const l=o.get(g3,null),c=a.createRenderer(null,this.componentDef),u=this.componentDef.selectors[0][0]||"div",d=i?function aB(n,e,t){return n.selectRootElement(e,t===_r.ShadowDom)}(c,i,this.componentDef.encapsulation):R_(c,u,function RB(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(u)),h=this.componentDef.onPush?288:272,f=uy(0,null,null,1,0,null,null,null,null,null),p=df(null,f,null,h,null,null,a,c,l,o,null);let _,m;s_(p);try{const g=this.componentDef;let v,y=null;g.findHostDirectiveDefs?(v=[],y=new Map,g.findHostDirectiveDefs(g,v,y),v.push(g)):v=[g];const b=function LB(n,e){const t=n[Ge],i=Yt;return n[i]=e,dl(t,i,2,"#host",null)}(p,d),x=function OB(n,e,t,i,r,s,o,a){const l=r[Ge];!function NB(n,e,t,i){for(const r of n)e.mergedAttrs=ou(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(gf(e,e.mergedAttrs,!0),null!==t&&Rw(i,t,e))}(i,n,e,o);const c=s.createRenderer(e,t),u=df(r,wS(t),null,t.onPush?32:16,r[n.index],n,s,c,a||null,null,null);return l.firstCreatePass&&hy(l,n,i.length-1),ff(r,u),r[n.index]=u}(b,d,g,v,p,a,c);m=vE(f,Yt),d&&function UB(n,e,t,i){if(i)c_(n,t,["ng-version",_3.full]);else{const{attrs:r,classes:s}=function k3(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!xr(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&c_(n,t,r),s&&s.length>0&&Iw(n,t,s.join(" "))}}(c,g,d,i),void 0!==t&&function BB(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(m,this.ngContentSelectors,t),_=function kB(n,e,t,i,r,s){const o=Hn(),a=r[Ge],l=Ui(o,r);CS(a,r,o,t,null,i);for(let u=0;u<t.length;u++)Qn(No(r,a,o.directiveStart+u,o),r);DS(a,r,o),l&&Qn(l,r);const c=No(r,a,o.directiveStart+o.componentOffset,o);if(n[pn]=r[pn]=c,null!==s)for(const u of s)u(c,e);return ay(a,o,n),c}(x,g,v,y,p,[VB]),oy(f,p,null)}finally{o_()}return new FB(this.componentType,_,al(m,p),p,m)}}class FB extends u3{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new IB(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const s=this._rootLView;gy(s[Ge],s,r,e,t),pf(Mi(this._tNode.index,s))}}get injector(){return new Za(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function VB(){const n=Hn();Vh(we()[Ge],n)}function Nt(n){let e=function kS(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let r;if(br(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new me(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);const o=n;o.inputs=_y(n.inputs),o.declaredInputs=_y(n.declaredInputs),o.outputs=_y(n.outputs);const a=r.hostBindings;a&&WB(n,a);const l=r.viewQuery,c=r.contentQueries;if(l&&HB(n,l),c&&GB(n,c),Bg(n.inputs,r.inputs),Bg(n.declaredInputs,r.declaredInputs),Bg(n.outputs,r.outputs),br(r)&&r.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===Nt&&(t=!1)}}e=Object.getPrototypeOf(e)}!function zB(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=ou(r.hostAttrs,t=ou(t,r.hostAttrs))}}(i)}function _y(n){return n===gs?{}:n===It?[]:n}function HB(n,e){const t=n.viewQuery;n.viewQuery=t?(i,r)=>{e(i,r),t(i,r)}:e}function GB(n,e){const t=n.contentQueries;n.contentQueries=t?(i,r,s)=>{e(i,r,s),t(i,r,s)}:e}function WB(n,e){const t=n.hostBindings;n.hostBindings=t?(i,r)=>{e(i,r),t(i,r)}:e}function Jn(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function bf(n,e,t){const i=we();return Jn(i,function Ya(){return at.lFrame.bindingIndex++}(),e)&&function Vi(n,e,t,i,r,s,o,a){const l=Ui(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[i])?(gy(n,t,u,i,r),iu(e)&&function dB(n,e){const t=Mi(e,n);16&t[dt]||(t[dt]|=32)}(t,e.index)):3&e.type&&(i=function uB(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(l,i,r))}(At(),function en(){const n=at.lFrame;return vE(n.tView,n.selectedIndex)}(),i,n,e,i[mt],t,!1),bf}function vy(n,e,t,i,r){const o=r?"class":"style";gy(n,t,e.inputs[o],o,i)}function Tu(n,e,t,i){const r=we(),s=At(),o=Yt+n,a=r[mt],l=s.firstCreatePass?function rV(n,e,t,i,r,s){const o=e.consts,l=dl(e,n,2,i,Js(o,r));return function dy(n,e,t,i){if(ME()){const r=null===i?null:{"":-1},s=function _B(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(aS(e,o.selectors,!1))if(i||(i=[]),br(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),hy(n,e,a.length)}else i.unshift(o),hy(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&CS(n,e,t,o,r,a),r&&function yB(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new me(-301,!1);i.push(e[r],s)}}}(t,i,r)}t.mergedAttrs=ou(t.mergedAttrs,t.attrs)}(e,t,l,Js(o,s)),null!==l.attrs&&gf(l,l.attrs,!1),null!==l.mergedAttrs&&gf(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(o,s,r,e,t,i):s.data[o],c=r[o]=R_(a,e,function mk(){return at.lFrame.currentNamespace}()),u=kh(l);return Gr(l,!0),Rw(a,c,l),32!=(32&l.flags)&&ef(s,r,c,l),0===function ZN(){return at.lFrame.elementDepthCount}()&&Qn(c,r),function QN(){at.lFrame.elementDepthCount++}(),u&&(function ly(n,e,t){ME()&&(function mB(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;iu(t)&&function MB(n,e,t){const i=Ui(e,n),r=wS(t),s=n[Lh],o=ff(n,df(n,r,null,t.onPush?32:16,i,e,s,s.createRenderer(i,t),null,null,null));n[e.index]=o}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||$h(t,e),Qn(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const l=n.data[a],c=No(e,n,a,t);Qn(c,e),null!==o&&EB(0,a-r,c,l,0,o),br(l)&&(Mi(t.index,e)[pn]=No(e,n,a,t))}}(n,e,t,Ui(t,e)),64==(64&t.flags)&&DS(n,e,t))}(s,r,l),ay(s,l,r)),null!==i&&function cy(n,e,t=Ui){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}(r,l),Tu}function Au(){let n=Hn();e_()?function t_(){at.lFrame.isParent=!1}():(n=n.parent,Gr(n,!1));const e=n;!function JN(){at.lFrame.elementDepthCount--}();const t=At();return t.firstCreatePass&&(Vh(t,n),Zg(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function vk(n){return 0!=(8&n.flags)}(e)&&vy(t,e,we(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function bk(n){return 0!=(16&n.flags)}(e)&&vy(t,e,we(),e.stylesWithoutHost,!1),Au}function xl(n,e,t,i){return Tu(n,e,t,i),Au(),xl}function Cu(n){return!!n&&"function"==typeof n.then}const My=function ZS(n){return!!n&&"function"==typeof n.subscribe};function Ti(n,e,t,i){const r=we(),s=At(),o=Hn();return function JS(n,e,t,i,r,s,o){const a=kh(i),c=n.firstCreatePass&&PS(n),u=e[pn],d=RS(e);let h=!0;if(3&i.type||o){const _=Ui(i,e),m=o?o(_):_,g=d.length,v=o?b=>o(zn(b[i.index])):i.index;let y=null;if(!o&&a&&(y=function aV(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[Wa],l=r[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,e,r,i.index)),null!==y)(y.__ngLastListenerFn__||y).__ngNextListenerFn__=s,y.__ngLastListenerFn__=s,h=!1;else{s=tT(i,e,u,s,!1);const b=t.listen(m,r,s);d.push(s,b),c&&c.push(r,v,g,g+1)}}else s=tT(i,e,u,s,!1);const f=i.outputs;let p;if(h&&null!==f&&(p=f[r])){const _=p.length;if(_)for(let m=0;m<_;m+=2){const x=e[p[m]][p[m+1]].subscribe(s),M=d.length;d.push(s,x),c&&c.push(r,i.index,M,-(M+1))}}}(s,r,r[mt],o,n,e,i),Ti}function eT(n,e,t,i){try{return ir(6,e,t),!1!==t(i)}catch(r){return LS(n,r),!1}finally{ir(7,e,t)}}function tT(n,e,t,i,r){return function s(o){if(o===Function)return i;pf(n.componentOffset>-1?Mi(n.index,e):e);let l=eT(e,t,i,o),c=s.__ngNextListenerFn__;for(;c;)l=eT(e,t,c,o)&&l,c=c.__ngNextListenerFn__;return r&&!1===l&&(o.preventDefault(),o.returnValue=!1),l}}function xf(n,e){return n<<17|e<<2}function to(n){return n>>17&32767}function wy(n){return 2|n}function Ho(n){return(131068&n)>>2}function Sy(n,e){return-131069&n|e<<2}function Ty(n){return 1|n}function dT(n,e,t,i,r){const s=n[t+1],o=null===e;let a=i?to(s):Ho(s),l=!1;for(;0!==a&&(!1===l||o);){const u=n[a+1];_V(n[a],e)&&(l=!0,n[a+1]=i?Ty(u):wy(u)),a=i?to(u):Ho(u)}l&&(n[t+1]=i?wy(s):Ty(s))}function _V(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&nl(n,e)>=0}function Mf(n,e){return function Mr(n,e,t,i){const r=we(),s=At(),o=function bs(n){const e=at.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function bT(n,e,t,i){const r=n.data;if(null===r[t+1]){const s=r[di()],o=function vT(n,e){return e>=n.expandoStartIndex}(n,t);(function wT(n,e){return 0!=(n.flags&(e?8:16))})(s,i)&&null===e&&!o&&(e=!1),e=function TV(n,e,t,i){const r=function i_(n){const e=at.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=Du(t=Ay(null,n,e,t,i),e.attrs,i),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==r)if(t=Ay(r,n,e,t,i),null===s){let l=function AV(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==Ho(i))return n[to(i)]}(n,e,i);void 0!==l&&Array.isArray(l)&&(l=Ay(null,n,e,l[1],i),l=Du(l,e.attrs,i),function CV(n,e,t,i){n[to(t?e.classBindings:e.styleBindings)]=i}(n,e,i,l))}else s=function DV(n,e,t){let i;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)i=Du(i,n[s].hostAttrs,t);return Du(i,e.attrs,t)}(n,e,i)}return void 0!==s&&(i?e.residualClasses=s:e.residualStyles=s),t}(r,s,e,i),function mV(n,e,t,i,r,s){let o=s?e.classBindings:e.styleBindings,a=to(o),l=Ho(o);n[i]=t;let u,c=!1;if(Array.isArray(t)?(u=t[1],(null===u||nl(t,u)>0)&&(c=!0)):u=t,r)if(0!==l){const h=to(n[a+1]);n[i+1]=xf(h,a),0!==h&&(n[h+1]=Sy(n[h+1],i)),n[a+1]=function fV(n,e){return 131071&n|e<<17}(n[a+1],i)}else n[i+1]=xf(a,0),0!==a&&(n[a+1]=Sy(n[a+1],i)),a=i;else n[i+1]=xf(l,0),0===a?a=i:n[l+1]=Sy(n[l+1],i),l=i;c&&(n[i+1]=wy(n[i+1])),dT(n,u,i,!0),dT(n,u,i,!1),function gV(n,e,t,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&nl(s,e)>=0&&(t[i+1]=Ty(t[i+1]))}(e,u,n,i,s),o=xf(a,l),s?e.classBindings=o:e.styleBindings=o}(r,s,e,t,o,i)}}(s,n,o,i),e!==lt&&Jn(r,o,e)&&function MT(n,e,t,i,r,s,o,a){if(!(3&e.type))return;const l=n.data,c=l[a+1],u=function pV(n){return 1==(1&n)}(c)?ET(l,e,t,r,Ho(c),o):void 0;Ef(u)||(Ef(s)||function hV(n){return 2==(2&n)}(c)&&(s=ET(l,null,t,r,a,o)),function TU(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=-1===i.indexOf("-")?void 0:Ei.DashCase;null==r?n.removeStyle(t,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ei.Important),n.setStyle(t,i,r,s))}}(i,o,function Uh(n,e){return zn(e[n])}(di(),t),r,s))}(s,s.data[di()],r,r[mt],n,r[o+1]=function FV(n,e){return null==n||""===n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Ht(function eo(n){return n instanceof Nw?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(e,t),i,o)}(n,e,null,!0),Mf}function Ay(n,e,t,i,r){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],i=Du(i,s.hostAttrs,r),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),i}function Du(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?r=o:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Bi(n,o,!!t||e[++s]))}return void 0===n?null:n}function ET(n,e,t,i,r,s){const o=null===e;let a;for(;r>0;){const l=n[r],c=Array.isArray(l),u=c?l[1]:l,d=null===u;let h=t[r+1];h===lt&&(h=d?It:void 0);let f=d?__(h,i):u===i?h:void 0;if(c&&!Ef(f)&&(f=__(l,i)),Ef(f)&&(a=f,o))return a;const p=n[r+1];r=o?to(p):Ho(p)}if(null!==e){let l=s?e.residualClasses:e.residualStyles;null!=l&&(a=__(l,i))}return a}function Ef(n){return void 0!==n}const wl="en-US";let qT=wl;function Ry(n,e,t,i,r){if(n=Ze(n),Array.isArray(n))for(let s=0;s<n.length;s++)Ry(n[s],e,t,i,r);else{const s=At(),o=we();let a=Bo(n)?n:Ze(n.provide),l=eS(n);const c=Hn(),u=1048575&c.providerIndexes,d=c.directiveStart,h=c.providerIndexes>>20;if(Bo(n)||!n.multi){const f=new su(l,r,Se),p=Fy(a,e,r?u:u+h,d);-1===p?(f_($h(c,o),s,a),Py(s,n,e.length),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),t.push(f),o.push(f)):(t[p]=f,o[p]=f)}else{const f=Fy(a,e,u+h,d),p=Fy(a,e,u,u+h),m=p>=0&&t[p];if(r&&!m||!r&&!(f>=0&&t[f])){f_($h(c,o),s,a);const g=function Qz(n,e,t,i,r){const s=new su(n,t,Se);return s.multi=[],s.index=e,s.componentProviders=0,yA(s,r,i&&!t),s}(r?Zz:Kz,t.length,r,i,l);!r&&m&&(t[p].providerFactory=g),Py(s,n,e.length,0),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),t.push(g),o.push(g)}else Py(s,n,f>-1?f:p,yA(t[r?p:f],l,!r&&i));!r&&i&&m&&t[p].componentProviders++}}}function Py(n,e,t,i){const r=Bo(e),s=function n3(n){return!!n.useClass}(e);if(r||s){const l=(s?Ze(e.useClass):e).prototype.ngOnDestroy;if(l){const c=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){const u=c.indexOf(t);-1===u?c.push(t,[i,l]):c[u+1].push(i,l)}else c.push(t,l)}}}function yA(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function Fy(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function Kz(n,e,t,i){return Ly(this.multi,[])}function Zz(n,e,t,i){const r=this.multi;let s;if(this.providerFactory){const o=this.providerFactory.componentProviders,a=No(t,t[Ge],this.providerFactory.index,i);s=a.slice(0,o),Ly(r,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],Ly(r,s);return s}function Ly(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Zt(n,e=[]){return t=>{t.providersResolver=(i,r)=>function Yz(n,e,t){const i=At();if(i.firstCreatePass){const r=br(n);Ry(t,i.data,i.blueprint,r,!0),Ry(e,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,e)}}class Sl{}class vA{}class bA extends Sl{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new OS(this);const i=Ni(e);this._bootstrapComponents=ws(i.bootstrap),this._r3Injector=pS(e,t,[{provide:Sl,useValue:this},{provide:bu,useValue:this.componentFactoryResolver}],Ht(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Oy extends vA{constructor(e){super(),this.moduleType=e}create(e){return new bA(this.moduleType,e)}}class eH extends Sl{constructor(e,t,i){super(),this.componentFactoryResolver=new OS(this),this.instance=null;const r=new Jw([...e,{provide:Sl,useValue:this},{provide:bu,useValue:this.componentFactoryResolver}],t||cf(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function Cf(n,e,t=null){return new eH(n,e,t).injector}let tH=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const i=Yw(0,t.type),r=i.length>0?Cf([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,r)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=$e({token:n,providedIn:"environment",factory:()=>new n(He(Ms))}),n})();function xA(n){n.getStandaloneInjector=e=>e.get(tH).getOrCreateStandaloneInjector(n)}function ky(n){return e=>{setTimeout(n,void 0,e)}}const an=class AH extends Br{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=ky(s),r&&(r=ky(r)),o&&(o=ky(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof Fi&&e.add(a),a}};function CH(){return this._results[Symbol.iterator]()}class Uy{get changes(){return this._changes||(this._changes=new an)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Uy.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=CH)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function rr(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function Ik(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Ts=(()=>{class n{}return n.__NG_ELEMENT_ID__=RH,n})();const DH=Ts,IH=class extends DH{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e,t){const i=this._declarationTContainer.tView,r=df(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,t||null);r[tu]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[Hr];return null!==o&&(r[Hr]=o.createEmbeddedView(i)),oy(i,r,e),new Eu(r)}};function RH(){return Df(Hn(),we())}function Df(n,e){return 4&n.type?new IH(e,n,al(n,e)):null}let wr=(()=>{class n{}return n.__NG_ELEMENT_ID__=PH,n})();function PH(){return OA(Hn(),we())}const FH=wr,FA=class extends FH{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return al(this._hostTNode,this._hostLView)}get injector(){return new Za(this._hostTNode,this._hostLView)}get parentInjector(){const e=h_(this._hostTNode,this._hostLView);if(kE(e)){const t=Wh(e,this._hostLView),i=Gh(e);return new Za(t[Ge].data[i+8],t)}return new Za(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=LA(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-ci}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const o=e.createEmbeddedView(t||{},s);return this.insert(o,r),o}createComponent(e,t,i,r,s){const o=e&&!function lu(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const d=t||{};a=d.index,i=d.injector,r=d.projectableNodes,s=d.environmentInjector||d.ngModuleRef}const l=o?e:new wu(Ft(e)),c=i||this.parentInjector;if(!s&&null==l.ngModule){const h=(o?c:this.parentInjector).get(Ms,null);h&&(s=h)}const u=l.create(c,r,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const i=e._lView,r=i[Ge];if(function KN(n){return vr(n[sn])}(i)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=i[sn],h=new FA(d,d[Kn],d[sn]);h.detach(h.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function yU(n,e,t,i){const r=ci+i,s=t.length;i>0&&(t[r-1][yr]=e),i<s-ci?(e[yr]=t[r],YE(t,ci+i,e)):(t.push(e),e[yr]=null),e[sn]=t;const o=e[tu];null!==o&&t!==o&&function vU(n,e){const t=n[qa];e[Zn]!==e[sn][sn][Zn]&&(n[dE]=!0),null===t?n[qa]=[e]:t.push(e)}(o,e);const a=e[Hr];null!==a&&a.insertView(n),e[dt]|=64}(r,i,o,s);const a=O_(s,o),l=i[mt],c=Jh(l,o[Oh]);return null!==c&&function mU(n,e,t,i,r,s){i[ys]=r,i[Kn]=e,gu(n,i,t,1,r,s)}(r,o[Kn],l,i,c,a),e.attachToViewContainerRef(),YE(By(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=LA(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=P_(this._lContainer,t);i&&(Yh(By(this._lContainer),t),vw(i[Ge],i))}detach(e){const t=this._adjustIndex(e,-1),i=P_(this._lContainer,t);return i&&null!=Yh(By(this._lContainer),t)?new Eu(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function LA(n){return n[Nh]}function By(n){return n[Nh]||(n[Nh]=[])}function OA(n,e){let t;const i=e[n.index];if(vr(i))t=i;else{let r;if(8&n.type)r=zn(i);else{const s=e[mt];r=s.createComment("");const o=Ui(n,e);Uo(s,Jh(s,o),r,function EU(n,e){return n.nextSibling(e)}(s,o),!1)}e[n.index]=t=function IS(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null]}(i,e,r,n),ff(e,t)}return new FA(t,n,e)}class Vy{constructor(e){this.queryList=e,this.matches=null}clone(){return new Vy(this.queryList)}setDirty(){this.queryList.setDirty()}}class zy{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new zy(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==zA(e,t).matches&&this.queries[t].setDirty()}}class NA{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class Hy{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new Hy(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Gy{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Gy(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,LH(t,s)),this.matchTNodeWithReadOption(e,t,qh(t,e,s,!1,!1))}else i===Ts?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,qh(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Si||r===wr||r===Ts&&4&t.type)this.addMatch(t.index,-2);else{const s=qh(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function LH(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function NH(n,e,t,i){return-1===t?function OH(n,e){return 11&n.type?al(n,e):4&n.type?Df(n,e):null}(e,n):-2===t?function kH(n,e,t){return t===Si?al(e,n):t===Ts?Df(e,n):t===wr?OA(e,n):void 0}(n,e,i):No(n,n[Ge],t,e)}function kA(n,e,t,i){const r=e[Hr].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:NH(e,s[c],o[l+1],t.metadata.read))}r.matches=a}return r.matches}function Wy(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=kA(n,e,r,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)i.push(o[a/2]);else{const c=s[a+1],u=e[-l];for(let d=ci;d<u.length;d++){const h=u[d];h[tu]===h[sn]&&Wy(h[Ge],h,c,i)}if(null!==u[qa]){const d=u[qa];for(let h=0;h<d.length;h++){const f=d[h];Wy(f[Ge],f,c,i)}}}}}return i}function ku(n){const e=we(),t=At(),i=AE();r_(i+1);const r=zA(t,i);if(n.dirty&&function YN(n){return 4==(4&n[dt])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?Wy(t,e,i,[]):kA(t,e,r,i);n.reset(s,p3),n.notifyOnChanges()}return!0}return!1}function If(n,e,t){const i=At();i.firstCreatePass&&(function VA(n,e,t){null===n.queries&&(n.queries=new Hy),n.queries.track(new Gy(e,t))}(i,new NA(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function BA(n,e,t){const i=new Uy(4==(4&t));SS(n,e,i,i.destroy),null===e[Hr]&&(e[Hr]=new zy),e[Hr].queries.push(new Vy(i))}(i,we(),e)}function Uu(){return function UH(n,e){return n[Hr].queries[e].queryList}(we(),AE())}function zA(n,e){return n.queries.getByIndex(e)}function Pf(...n){}const Ff=new Be("Application Initializer");let Lf=(()=>{class n{constructor(t){this.appInits=t,this.resolve=Pf,this.reject=Pf,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(Cu(s))t.push(s);else if(My(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(He(Ff,8))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Vu=new Be("AppId",{providedIn:"root",factory:function sC(){return`${Ky()}${Ky()}${Ky()}`}});function Ky(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const oC=new Be("Platform Initializer"),Zy=new Be("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),aC=new Be("AnimationModuleType");let oG=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Qr=new Be("LocaleId",{providedIn:"root",factory:()=>vt(Qr,Qe.Optional|Qe.SkipSelf)||function aG(){return typeof $localize<"u"&&$localize.locale||wl}()});class cG{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let lC=(()=>{class n{compileModuleSync(t){return new Oy(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),s=ws(Ni(t).declarations).reduce((o,a)=>{const l=Ft(a);return l&&o.push(new wu(l)),o},[]);return new cG(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const hG=(()=>Promise.resolve(0))();function Qy(n){typeof Zone>"u"?hG.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Qt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new an(!1),this.onMicrotaskEmpty=new an(!1),this.onStable=new an(!1),this.onError=new an(!1),typeof Zone>"u")throw new me(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function fG(){let n=Xt.requestAnimationFrame,e=Xt.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function gG(n){const e=()=>{!function mG(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Xt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,ev(n),n.isCheckStableRunning=!0,Jy(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),ev(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{try{return dC(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),hC(n)}},onInvoke:(t,i,r,s,o,a,l)=>{try{return dC(n),t.invoke(r,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),hC(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,ev(n),Jy(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Qt.isInAngularZone())throw new me(909,!1)}static assertNotInAngularZone(){if(Qt.isInAngularZone())throw new me(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,pG,Pf,Pf);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const pG={};function Jy(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function ev(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function dC(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function hC(n){n._nesting--,Jy(n)}class _G{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new an,this.onMicrotaskEmpty=new an,this.onStable=new an,this.onError=new an}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const fC=new Be(""),Of=new Be("");let iv,tv=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,iv||(function yG(n){iv=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Qt.assertNotInAngularZone(),Qy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Qy(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(He(Qt),He(nv),He(Of))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})(),nv=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return iv?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const As=!1;let no=null;const pC=new Be("AllowMultipleToken"),rv=new Be("PlatformDestroyListeners"),mC=new Be("appBootstrapListener");class gC{constructor(e,t){this.name=e,this.token=t}}function yC(n,e,t=[]){const i=`Platform: ${e}`,r=new Be(i);return(s=[])=>{let o=sv();if(!o||o.injector.get(pC,!1)){const a=[...t,...s,{provide:r,useValue:!0}];n?n(a):function xG(n){if(no&&!no.get(pC,!1))throw new me(400,!1);no=n;const e=n.get(bC);(function _C(n){const e=n.get(oC,null);e&&e.forEach(t=>t())})(n)}(function vC(n=[],e){return $r.create({name:e,providers:[{provide:X_,useValue:"platform"},{provide:rv,useValue:new Set([()=>no=null])},...n]})}(a,i))}return function EG(n){const e=sv();if(!e)throw new me(401,!1);return e}()}}function sv(){return no?.get(bC)??null}let bC=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function MC(n,e){let t;return t="noop"===n?new _G:("zone.js"===n?void 0:n)||new Qt(e),t}(i?.ngZone,function xC(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:Qt,useValue:r}];return r.run(()=>{const o=$r.create({providers:s,parent:this.injector,name:t.moduleType.name}),a=t.create(o),l=a.injector.get(ll,null);if(!l)throw new me(402,!1);return r.runOutsideAngular(()=>{const c=r.onError.subscribe({next:u=>{l.handleError(u)}});a.onDestroy(()=>{Nf(this._modules,a),c.unsubscribe()})}),function EC(n,e,t){try{const i=t();return Cu(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(l,r,()=>{const c=a.injector.get(Lf);return c.runInitializers(),c.donePromise.then(()=>(function XT(n){er(n,"Expected localeId to be defined"),"string"==typeof n&&(qT=n.toLowerCase().replace(/_/g,"-"))}(a.injector.get(Qr,wl)||wl),this._moduleDoBootstrap(a),a))})})}bootstrapModule(t,i=[]){const r=wC({},i);return function vG(n,e,t){const i=new Oy(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(zu);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new me(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new me(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(rv,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(He($r))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function wC(n,e){return Array.isArray(e)?e.reduce(wC,n):{...n,...e}}let zu=(()=>{class n{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(t,i,r){this._zone=t,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new hn(a=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{a.next(this._stable),a.complete()})}),o=new hn(a=>{let l;this._zone.runOutsideAngular(()=>{l=this._zone.onStable.subscribe(()=>{Qt.assertNotInAngularZone(),Qy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,a.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Qt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{a.next(!1)}))});return()=>{l.unsubscribe(),c.unsubscribe()}});this.isStable=function mN(...n){const e=Xc(n),t=function lN(n,e){return"number"==typeof kg(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?Li(i[0]):za(t)(En(i,e)):Vr}(s,o.pipe(function gN(n={}){const{connector:e=(()=>new Br),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,l,c=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=l=void 0,u=d=!1},p=()=>{const _=o;f(),_?.unsubscribe()};return Mn((_,m)=>{c++,!d&&!u&&h();const g=l=l??e();m.add(()=>{c--,0===c&&!d&&!u&&(a=Ug(p,r))}),g.subscribe(m),!o&&c>0&&(o=new qc({next:v=>g.next(v),error:v=>{d=!0,h(),a=Ug(f,t,v),g.error(v)},complete:()=>{u=!0,h(),a=Ug(f,i),g.complete()}}),Li(_).subscribe(o))})(s)}}()))}bootstrap(t,i){const r=t instanceof tS;if(!this._injector.get(Lf).done){!r&&function Ga(n){const e=Ft(n)||Yn(n)||xi(n);return null!==e&&e.standalone}(t);throw new me(405,As)}let o;o=r?t:this._injector.get(bu).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function bG(n){return n.isBoundToModule}(o)?void 0:this._injector.get(Sl),c=o.create($r.NULL,[],i||o.selector,a),u=c.location.nativeElement,d=c.injector.get(fC,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),Nf(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new me(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;Nf(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(mC,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Nf(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new me(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(He(Qt),He(Ms),He(ll))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Nf(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let kf=(()=>{class n{}return n.__NG_ELEMENT_ID__=SG,n})();function SG(n){return function TG(n,e,t){if(iu(n)&&!t){const i=Mi(n.index,e);return new Eu(i,i)}return 47&n.type?new Eu(e[Zn],e):null}(Hn(),we(),16==(16&n))}const BG=yC(null,"core",[]);let VG=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(He(zu))},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({}),n})();let uv=null;function Cs(){return uv}class GG{}const In=new Be("DocumentToken");let dv=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return function WG(){return He(OC)}()},providedIn:"platform"}),n})();const jG=new Be("Location Initialized");let OC=(()=>{class n extends dv{constructor(t){super(),this._doc=t,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Cs().getBaseHref(this._doc)}onPopState(t){const i=Cs().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=Cs().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){NC()?this._history.pushState(t,i,r):this._location.hash=r}replaceState(t,i,r){NC()?this._history.replaceState(t,i,r):this._location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(He(In))},n.\u0275prov=$e({token:n,factory:function(){return function $G(){return new OC(He(In))}()},providedIn:"platform"}),n})();function NC(){return!!window.history.pushState}function hv(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function kC(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Ds(n){return n&&"?"!==n[0]?"?"+n:n}let jo=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return vt(BC)},providedIn:"root"}),n})();const UC=new Be("appBaseHref");let BC=(()=>{class n extends jo{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??vt(In).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return hv(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Ds(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const o=this.prepareExternalUrl(r+Ds(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){const o=this.prepareExternalUrl(r+Ds(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(He(dv),He(UC,8))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qG=(()=>{class n extends jo{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=hv(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+Ds(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+Ds(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(He(dv),He(UC,8))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})(),fv=(()=>{class n{constructor(t){this._subject=new an,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function KG(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(kC(VC(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Ds(i))}normalize(t){return n.stripTrailingSlash(function YG(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,VC(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ds(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ds(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}}return n.normalizeQueryParams=Ds,n.joinWithSlash=hv,n.stripTrailingSlash=kC,n.\u0275fac=function(t){return new(t||n)(He(jo))},n.\u0275prov=$e({token:n,factory:function(){return function XG(){return new fv(He(jo))}()},providedIn:"root"}),n})();function VC(n){return n.replace(/\/index.html$/,"")}let n1=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({}),n})();const r1="browser";let g5=(()=>{class n{}return n.\u0275prov=$e({token:n,providedIn:"root",factory:()=>new _5(He(In),window)}),n})();class _5{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function y5(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=s1(this.window.history)||s1(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function s1(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class $5 extends GG{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Iv extends $5{static makeCurrent(){!function HG(n){uv||(uv=n)}(new Iv)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function q5(){return $u=$u||document.querySelector("base"),$u?$u.getAttribute("href"):null}();return null==t?null:function X5(n){Qf=Qf||document.createElement("a"),Qf.setAttribute("href",n);const e=Qf.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){$u=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function L4(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Qf,$u=null;const u1=new Be("TRANSITION_ID"),K5=[{provide:Ff,useFactory:function Y5(n,e,t){return()=>{t.get(Lf).donePromise.then(()=>{const i=Cs(),r=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[u1,In,$r],multi:!0}];let Q5=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();const Jf=new Be("EventManagerPlugins");let ep=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const o=r[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(He(Jf),He(Qt))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();class d1{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=Cs().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let h1=(()=>{class n{constructor(){this.usageCount=new Map}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)0===this.changeUsageCount(i,-1)&&this.onStyleRemoved(i)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,i){const r=this.usageCount;let s=r.get(t)??0;return s+=i,s>0?r.set(t,s):r.delete(t),s}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})(),qu=(()=>{class n extends h1{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.forEach(s=>s.remove()),i.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,i){const r=this.doc.createElement("style");r.textContent=i,t.appendChild(r);const s=this.styleRef.get(i);s?s.push(r):this.styleRef.set(i,[r])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(He(In))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();const Rv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Pv=/%COMP%/g,m1=new Be("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function g1(n,e){return e.flat(100).map(t=>t.replace(Pv,n))}function _1(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let tp=(()=>{class n{constructor(t,i,r,s){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestory=s,this.rendererByCompId=new Map,this.defaultRenderer=new Fv(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;const r=this.getOrCreateRenderer(t,i);return r instanceof b1?r.applyToHost(t):r instanceof Lv&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.eventManager,a=this.sharedStylesHost,l=this.removeStylesOnCompDestory;switch(i.encapsulation){case _r.Emulated:s=new b1(o,a,i,this.appId,l);break;case _r.ShadowDom:return new sW(o,a,t,i);default:s=new Lv(o,a,i,l)}s.onDestroy=()=>r.delete(i.id),r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(He(ep),He(qu),He(Vu),He(m1))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();class Fv{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(Rv[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(v1(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(v1(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=Rv[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=Rv[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Ei.DashCase|Ei.Important)?e.style.setProperty(t,i,r&Ei.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Ei.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,_1(i)):this.eventManager.addEventListener(e,t,_1(i))}}function v1(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class sW extends Fv{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=g1(r.id,r.styles);for(const o of s){const a=document.createElement("style");a.textContent=o,this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Lv extends Fv{constructor(e,t,i,r,s=i.id){super(e),this.sharedStylesHost=t,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=g1(s,i.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class b1 extends Lv{constructor(e,t,i,r,s){const o=r+"-"+i.id;super(e,t,i,s,o),this.contentAttr=function nW(n){return"_ngcontent-%COMP%".replace(Pv,n)}(o),this.hostAttr=function iW(n){return"_nghost-%COMP%".replace(Pv,n)}(o)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}let oW=(()=>{class n extends d1{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(He(In))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();const x1=["alt","control","meta","shift"],aW={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},lW={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let cW=(()=>{class n extends d1{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cs().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),x1.forEach(c=>{const u=i.indexOf(c);u>-1&&(i.splice(u,1),o+=c+".")}),o+=s,0!=i.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=aW[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),x1.forEach(o=>{o!==r&&(0,lW[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(He(In))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();const E1=[{provide:Zy,useValue:r1},{provide:oC,useValue:function uW(){Iv.makeCurrent()},multi:!0},{provide:In,useFactory:function hW(){return function RU(n){B_=n}(document),document},deps:[]}],fW=yC(BG,"browser",E1),w1=new Be(""),S1=[{provide:Of,useClass:class Z5{addToWindow(e){Xt.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Xt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Xt.getAllAngularRootElements=()=>e.getAllRootElements(),Xt.frameworkStabilizers||(Xt.frameworkStabilizers=[]),Xt.frameworkStabilizers.push(i=>{const r=Xt.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(l){o=o||l,s--,0==s&&i(o)};r.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?Cs().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:fC,useClass:tv,deps:[Qt,nv,Of]},{provide:tv,useClass:tv,deps:[Qt,nv,Of]}],T1=[{provide:X_,useValue:"root"},{provide:ll,useFactory:function dW(){return new ll},deps:[]},{provide:Jf,useClass:oW,multi:!0,deps:[In,Qt,Zy]},{provide:Jf,useClass:cW,multi:!0,deps:[In]},{provide:tp,useClass:tp,deps:[ep,qu,Vu,m1]},{provide:xu,useExisting:tp},{provide:h1,useExisting:qu},{provide:qu,useClass:qu,deps:[In]},{provide:ep,useClass:ep,deps:[Jf,Qt]},{provide:class v5{},useClass:Q5,deps:[]},[]];let A1=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:Vu,useValue:t.appId},{provide:u1,useExisting:Vu},K5]}}}return n.\u0275fac=function(t){return new(t||n)(He(w1,12))},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({providers:[...T1,...S1],imports:[n1,VG]}),n})(),C1=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(He(In))},n.\u0275prov=$e({token:n,factory:function(t){let i=null;return i=t?new t:function mW(){return new C1(He(In))}(),i},providedIn:"root"}),n})();function Ke(...n){return En(n,Xc(n))}typeof window<"u"&&window;class Cr extends Br{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}const np=$c(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:xW}=Array,{getPrototypeOf:MW,prototype:EW,keys:wW}=Object;function R1(n){if(1===n.length){const e=n[0];if(xW(e))return{args:e,keys:null};if(function SW(n){return n&&"object"==typeof n&&MW(n)===EW}(e)){const t=wW(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}const{isArray:TW}=Array;function P1(n){return Mt(e=>function AW(n,e){return TW(e)?n(...e):n(e)}(n,e))}function F1(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function kv(...n){const e=Xc(n),t=XM(n),{args:i,keys:r}=R1(n);if(0===i.length)return En([],e);const s=new hn(function CW(n,e,t=Po){return i=>{L1(e,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let l=0;l<r;l++)L1(e,()=>{const c=En(n[l],e);let u=!1;c.subscribe(fn(i,d=>{s[l]=d,u||(u=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,e,r?o=>F1(r,o):Po));return t?s.pipe(P1(t)):s}function L1(n,e,t){n?ps(t,n,e):e()}function ip(...n){return function DW(){return za(1)}()(En(n,Xc(n)))}function O1(n){return new hn(e=>{Li(n()).subscribe(e)})}function Xu(n,e){const t=zt(n)?n:()=>n,i=r=>r.error(t());return new hn(e?r=>e.schedule(i,0,r):i)}function Uv(){return Mn((n,e)=>{let t=null;n._refCount++;const i=fn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class N1 extends hn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,FM(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Fi;const t=this.getSubject();e.add(this.source.subscribe(fn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Fi.EMPTY)}return e}refCount(){return Uv()(this)}}function Jr(n,e){return Mn((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(fn(i,l=>{r?.unsubscribe();let c=0;const u=s++;Li(n(l,u)).subscribe(r=fn(i,d=>i.next(e?e(l,d,u,c++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function $o(n){return n<=0?()=>Vr:Mn((e,t)=>{let i=0;e.subscribe(fn(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function k1(...n){const e=Xc(n);return Mn((t,i)=>{(e?ip(n,t,e):ip(n,t)).subscribe(i)})}function Rs(n,e){return Mn((t,i)=>{let r=0;t.subscribe(fn(i,s=>n.call(e,s,r++)&&i.next(s)))})}function rp(n){return Mn((e,t)=>{let i=!1;e.subscribe(fn(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function U1(n=IW){return Mn((e,t)=>{let i=!1;e.subscribe(fn(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function IW(){return new np}function ro(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Rs((r,s)=>n(r,s,i)):Po,$o(1),t?rp(e):U1(()=>new np))}function qo(n,e){return zt(e)?Bn(n,e,1):Bn(n,1)}function ei(n,e,t){const i=zt(n)||e||t?{next:n,error:e,complete:t}:n;return i?Mn((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(fn(s,l=>{var c;null===(c=i.next)||void 0===c||c.call(i,l),s.next(l)},()=>{var l;a=!1,null===(l=i.complete)||void 0===l||l.call(i),s.complete()},l=>{var c;a=!1,null===(c=i.error)||void 0===c||c.call(i,l),s.error(l)},()=>{var l,c;a&&(null===(l=i.unsubscribe)||void 0===l||l.call(i)),null===(c=i.finalize)||void 0===c||c.call(i)}))}):Po}function so(n){return Mn((e,t)=>{let s,i=null,r=!1;i=e.subscribe(fn(t,void 0,void 0,o=>{s=Li(n(o,so(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function B1(n,e){return Mn(function RW(n,e,t,i,r){return(s,o)=>{let a=t,l=e,c=0;s.subscribe(fn(o,u=>{const d=c++;l=a?n(l,u,d):(a=!0,u),i&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}(n,e,arguments.length>=2,!0))}function Bv(n){return n<=0?()=>Vr:Mn((e,t)=>{let i=[];e.subscribe(fn(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function V1(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Rs((r,s)=>n(r,s,i)):Po,Bv(1),t?rp(e):U1(()=>new np))}function Vv(n){return Mn((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const ct="primary",Yu=Symbol("RouteTitle");class LW{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Dl(n){return new LW(n)}function OW(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const o=i[s],a=n[s];if(o.startsWith(":"))r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function es(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!z1(n[r],e[r]))return!1;return!0}function z1(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}return n===e}function H1(n){return Array.prototype.concat.apply([],n)}function G1(n){return n.length>0?n[n.length-1]:null}function Wn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function oo(n){return My(n)?n:Cu(n)?En(Promise.resolve(n)):Ke(n)}const sp=!1,kW={exact:function $1(n,e,t){if(!Xo(n.segments,e.segments)||!op(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!$1(n.children[i],e.children[i],t))return!1;return!0},subset:q1},W1={exact:function UW(n,e){return es(n,e)},subset:function BW(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>z1(n[t],e[t]))},ignored:()=>!0};function j1(n,e,t){return kW[t.paths](n.root,e.root,t.matrixParams)&&W1[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function q1(n,e,t){return X1(n,e,e.segments,t)}function X1(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!Xo(r,t)||e.hasChildren()||!op(r,t,i))}if(n.segments.length===t.length){if(!Xo(n.segments,t)||!op(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!q1(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(Xo(n.segments,r)&&op(n.segments,r,i)&&n.children[ct])&&X1(n.children[ct],e,s,i)}}function op(n,e,t){return e.every((i,r)=>W1[t](n[r].parameters,i.parameters))}class ao{constructor(e=new bt([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dl(this.queryParams)),this._queryParamMap}toString(){return HW.serialize(this)}}class bt{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Wn(t,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ap(this)}}class Ku{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Dl(this.parameters)),this._parameterMap}toString(){return Z1(this)}}function Xo(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let Zu=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return new zv},providedIn:"root"}),n})();class zv{parse(e){const t=new ZW(e);return new ao(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${Qu(e.root,!0)}`,i=function jW(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${lp(t)}=${lp(r)}`).join("&"):`${lp(t)}=${lp(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function GW(n){return encodeURI(n)}(e.fragment)}`:""}`}}const HW=new zv;function ap(n){return n.segments.map(e=>Z1(e)).join("/")}function Qu(n,e){if(!n.hasChildren())return ap(n);if(e){const t=n.children[ct]?Qu(n.children[ct],!1):"",i=[];return Wn(n.children,(r,s)=>{s!==ct&&i.push(`${s}:${Qu(r,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function zW(n,e){let t=[];return Wn(n.children,(i,r)=>{r===ct&&(t=t.concat(e(i,r)))}),Wn(n.children,(i,r)=>{r!==ct&&(t=t.concat(e(i,r)))}),t}(n,(i,r)=>r===ct?[Qu(n.children[ct],!1)]:[`${r}:${Qu(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[ct]?`${ap(n)}/${t[0]}`:`${ap(n)}/(${t.join("//")})`}}function Y1(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function lp(n){return Y1(n).replace(/%3B/gi,";")}function Hv(n){return Y1(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function cp(n){return decodeURIComponent(n)}function K1(n){return cp(n.replace(/\+/g,"%20"))}function Z1(n){return`${Hv(n.path)}${function WW(n){return Object.keys(n).map(e=>`;${Hv(e)}=${Hv(n[e])}`).join("")}(n.parameters)}`}const $W=/^[^\/()?;=#]+/;function up(n){const e=n.match($W);return e?e[0]:""}const qW=/^[^=?&#]+/,YW=/^[^&#]+/;class ZW{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new bt([],{}):new bt([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[ct]=new bt(e,t)),i}parseSegment(){const e=up(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new me(4009,sp);return this.capture(e),new Ku(cp(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=up(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=up(this.remaining);r&&(i=r,this.capture(i))}e[cp(t)]=cp(i)}parseQueryParam(e){const t=function XW(n){const e=n.match(qW);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const o=function KW(n){const e=n.match(YW);return e?e[0]:""}(this.remaining);o&&(i=o,this.capture(i))}const r=K1(t),s=K1(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=up(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new me(4010,sp);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ct);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[ct]:new bt([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new me(4011,sp)}}function Gv(n){return n.segments.length>0?new bt([],{[ct]:n}):n}function dp(n){const e={};for(const i of Object.keys(n.children)){const s=dp(n.children[i]);(s.segments.length>0||s.hasChildren())&&(e[i]=s)}return function QW(n){if(1===n.numberOfChildren&&n.children[ct]){const e=n.children[ct];return new bt(n.segments.concat(e.segments),e.children)}return n}(new bt(n.segments,e))}function Yo(n){return n instanceof ao}const Wv=!1;function JW(n,e,t,i,r){if(0===t.length)return Il(e.root,e.root,e.root,i,r);const s=function nD(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new tD(!0,0,n);let e=0,t=!1;const i=n.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Wn(s.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new tD(t,e,i)}(t);return s.toRoot()?Il(e.root,e.root,new bt([],{}),i,r):function o(l){const c=function t8(n,e,t,i){if(n.isAbsolute)return new Rl(e.root,!0,0);if(-1===i)return new Rl(t,t===e.root,0);return function iD(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new me(4005,Wv&&"Invalid number of '../'");r=i.segments.length}return new Rl(i,!1,r-s)}(t,i+(Ju(n.commands[0])?0:1),n.numberOfDoubleDots)}(s,e,n.snapshot?._urlSegment,l),u=c.processChildren?Pl(c.segmentGroup,c.index,s.commands):jv(c.segmentGroup,c.index,s.commands);return Il(e.root,c.segmentGroup,u,i,r)}(n.snapshot?._lastPathIndex)}function Ju(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function ed(n){return"object"==typeof n&&null!=n&&n.outlets}function Il(n,e,t,i,r){let o,s={};i&&Wn(i,(l,c)=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:eD(n,e,t);const a=Gv(dp(o));return new ao(a,s,r)}function eD(n,e,t){const i={};return Wn(n.children,(r,s)=>{i[s]=r===e?t:eD(r,e,t)}),new bt(n.segments,i)}class tD{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&Ju(i[0]))throw new me(4003,Wv&&"Root segment cannot have matrix parameters");const r=i.find(ed);if(r&&r!==G1(i))throw new me(4004,Wv&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Rl{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function jv(n,e,t){if(n||(n=new bt([],{})),0===n.segments.length&&n.hasChildren())return Pl(n,e,t);const i=function i8(n,e,t){let i=0,r=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;const o=n.segments[r],a=t[i];if(ed(a))break;const l=`${a}`,c=i<t.length-1?t[i+1]:null;if(r>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!sD(l,c,o))return s;i+=2}else{if(!sD(l,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new bt(n.segments.slice(0,i.pathIndex),{});return s.children[ct]=new bt(n.segments.slice(i.pathIndex),n.children),Pl(s,0,r)}return i.match&&0===r.length?new bt(n.segments,{}):i.match&&!n.hasChildren()?$v(n,e,t):i.match?Pl(n,0,r):$v(n,e,t)}function Pl(n,e,t){if(0===t.length)return new bt(n.segments,{});{const i=function n8(n){return ed(n[0])?n[0].outlets:{[ct]:n}}(t),r={};if(!i[ct]&&n.children[ct]&&1===n.numberOfChildren&&0===n.children[ct].segments.length){const s=Pl(n.children[ct],e,t);return new bt(n.segments,s.children)}return Wn(i,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[o]=jv(n.children[o],e,s))}),Wn(n.children,(s,o)=>{void 0===i[o]&&(r[o]=s)}),new bt(n.segments,r)}}function $v(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const s=t[r];if(ed(s)){const l=r8(s.outlets);return new bt(i,l)}if(0===r&&Ju(t[0])){i.push(new Ku(n.segments[e].path,rD(t[0]))),r++;continue}const o=ed(s)?s.outlets[ct]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&Ju(a)?(i.push(new Ku(o,rD(a))),r+=2):(i.push(new Ku(o,{})),r++)}return new bt(i,{})}function r8(n){const e={};return Wn(n,(t,i)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[i]=$v(new bt([],{}),0,t))}),e}function rD(n){const e={};return Wn(n,(t,i)=>e[i]=`${t}`),e}function sD(n,e,t){return n==t.path&&es(e,t.parameters)}const td="imperative";class ts{constructor(e,t){this.id=e,this.url=t}}class qv extends ts{constructor(e,t,i="imperative",r=null){super(e,t),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ko extends ts{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class hp extends ts{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class fp extends ts{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=16}}class Xv extends ts{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class s8 extends ts{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class o8 extends ts{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class a8 extends ts{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class l8 extends ts{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c8 extends ts{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class u8{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class d8{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class h8{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class f8{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class p8{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class m8{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class oD{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let y8=(()=>{class n{createUrlTree(t,i,r,s,o,a){return JW(t||i.root,r,s,o,a)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})(),b8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(e){return y8.\u0275fac(e)},providedIn:"root"}),n})();class aD{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Yv(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=Yv(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Kv(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return Kv(e,this._root).map(t=>t.value)}}function Yv(n,e){if(n===e.value)return e;for(const t of e.children){const i=Yv(n,t);if(i)return i}return null}function Kv(n,e){if(n===e.value)return[e];for(const t of e.children){const i=Kv(n,t);if(i.length)return i.unshift(e),i}return[]}class Ps{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Fl(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class lD extends aD{constructor(e,t){super(e),this.snapshot=t,Zv(this,e)}toString(){return this.snapshot.toString()}}function cD(n,e){const t=function x8(n,e){const o=new pp([],{},{},"",{},ct,e,null,n.root,-1,{});return new dD("",new Ps(o,[]))}(n,e),i=new Cr([new Ku("",{})]),r=new Cr({}),s=new Cr({}),o=new Cr({}),a=new Cr(""),l=new Ll(i,r,o,a,s,ct,e,t.root);return l.snapshot=t.root,new lD(new Ps(l,[]),t)}class Ll{constructor(e,t,i,r,s,o,a,l){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.title=this.data?.pipe(Mt(c=>c[Yu]))??Ke(void 0),this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Mt(e=>Dl(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Mt(e=>Dl(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function uD(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],s=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function M8(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class pp{get title(){return this.data?.[Yu]}constructor(e,t,i,r,s,o,a,l,c,u,d){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=u,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Dl(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dl(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class dD extends aD{constructor(e,t){super(t),this.url=e,Zv(this,t)}toString(){return hD(this._root)}}function Zv(n,e){e.value._routerState=n,e.children.forEach(t=>Zv(n,t))}function hD(n){const e=n.children.length>0?` { ${n.children.map(hD).join(", ")} } `:"";return`${n.value}${e}`}function Qv(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,es(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),es(e.params,t.params)||n.params.next(t.params),function NW(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!es(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),es(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Jv(n,e){const t=es(n.params,e.params)&&function VW(n,e){return Xo(n,e)&&n.every((t,i)=>es(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||Jv(n.parent,e.parent))}function nd(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function w8(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return nd(n,i,r);return nd(n,i)})}(n,e,t);return new Ps(i,r)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>nd(n,a)),o}}const i=function S8(n){return new Ll(new Cr(n.url),new Cr(n.params),new Cr(n.queryParams),new Cr(n.fragment),new Cr(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(s=>nd(n,s));return new Ps(i,r)}}const e0="ngNavigationCancelingError";function fD(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=Yo(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=pD(!1,0,e);return r.url=t,r.navigationBehaviorOptions=i,r}function pD(n,e,t){const i=new Error("NavigationCancelingError: "+(n||""));return i[e0]=!0,i.cancellationCode=e,t&&(i.url=t),i}function mD(n){return gD(n)&&Yo(n.url)}function gD(n){return n&&n[e0]}class T8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new id,this.attachRef=null}}let id=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new T8,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const mp=!1;let t0=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=ct,this.activateEvents=new an,this.deactivateEvents=new an,this.attachEvents=new an,this.detachEvents=new an,this.parentContexts=vt(id),this.location=vt(wr),this.changeDetector=vt(kf),this.environmentInjector=vt(Ms)}ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new me(4012,mp);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new me(4012,mp);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new me(4012,mp);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new me(4013,mp);this._activatedRoute=t;const r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new A8(t,a,r.injector);if(i&&function C8(n){return!!n.resolveComponentFactory}(i)){const c=i.resolveComponentFactory(o);this.activated=r.createComponent(c,r.length,l)}else this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=it({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[nr]}),n})();class A8{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===Ll?this.route:e===id?this.childContexts:this.parent.get(e,t)}}let n0=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Jc({type:n,selectors:[["ng-component"]],standalone:!0,features:[xA],decls:1,vars:0,template:function(t,i){1&t&&xl(0,"router-outlet")},dependencies:[t0],encapsulation:2}),n})();function _D(n,e){return n.providers&&!n._injector&&(n._injector=Cf(n.providers,e,`Route: ${n.path}`)),n._injector??e}function s0(n){const e=n.children&&n.children.map(s0),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ct&&(t.component=n0),t}function lr(n){return n.outlet||ct}function yD(n,e){const t=n.filter(i=>lr(i)===e);return t.push(...n.filter(i=>lr(i)!==e)),t}function rd(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class F8{constructor(e,t,i,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),Qv(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=Fl(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),Wn(r,(s,o)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(r===s)if(r.component){const o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Fl(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);if(i&&i.outlet){const o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Fl(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,t,i){const r=Fl(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new m8(s.value.snapshot))}),e.children.length&&this.forwardEvent(new f8(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(Qv(r),r===s)if(r.component){const o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Qv(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=rd(r.snapshot),l=a?.get(bu)??null;o.attachRef=null,o.route=r,o.resolver=l,o.injector=a,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,i)}}class vD{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class gp{constructor(e,t){this.component=e,this.route=t}}function L8(n,e,t){const i=n._root;return sd(i,e?e._root:null,t,[i.value])}function Ol(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function EN(n){return null!==Ah(n)}(n)?e.get(n):n:i}function sd(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Fl(e);return n.children.forEach(o=>{(function N8(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function k8(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!Xo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Xo(n.url,e.url)||!es(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Jv(n,e)||!es(n.queryParams,e.queryParams);default:return!Jv(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new vD(i)):(s.data=o.data,s._resolvedData=o._resolvedData),sd(n,e,s.component?a?a.children:null:t,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new gp(a.outlet.component,o))}else o&&od(e,a,r),r.canActivateChecks.push(new vD(i)),sd(n,null,s.component?a?a.children:null:t,i,r)})(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),Wn(s,(o,a)=>od(o,t.getContext(a),r)),r}function od(n,e,t){const i=Fl(n),r=n.value;Wn(i,(s,o)=>{od(s,r.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new gp(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function ad(n){return"function"==typeof n}function o0(n){return n instanceof np||"EmptyError"===n?.name}const _p=Symbol("INITIAL_VALUE");function Nl(){return Jr(n=>kv(n.map(e=>e.pipe($o(1),k1(_p)))).pipe(Mt(e=>{for(const t of e)if(!0!==t){if(t===_p)return _p;if(!1===t||t instanceof ao)return t}return!0}),Rs(e=>e!==_p),$o(1)))}function bD(n){return function DO(...n){return IM(n)}(ei(e=>{if(Yo(e))throw fD(0,e)}),Mt(e=>!0===e))}const a0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function xD(n,e,t,i,r){const s=l0(n,e,t);return s.matched?function e6(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?Ke(r.map(o=>{const a=Ol(o,n);return oo(function G8(n){return n&&ad(n.canMatch)}(a)?a.canMatch(e,t):n.runInContext(()=>a(e,t)))})).pipe(Nl(),bD()):Ke(!0)}(i=_D(e,i),e,t).pipe(Mt(o=>!0===o?s:{...a0})):Ke(s)}function l0(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...a0}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||OW)(t,n,e);if(!r)return{...a0};const s={};Wn(r.posParams,(a,l)=>{s[l]=a.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function yp(n,e,t,i){if(t.length>0&&function i6(n,e,t){return t.some(i=>vp(n,e,i)&&lr(i)!==ct)}(n,t,i)){const s=new bt(e,function n6(n,e,t,i){const r={};r[ct]=i,i._sourceSegment=n,i._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&lr(s)!==ct){const o=new bt([],{});o._sourceSegment=n,o._segmentIndexShift=e.length,r[lr(s)]=o}return r}(n,e,i,new bt(t,n.children)));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:[]}}if(0===t.length&&function r6(n,e,t){return t.some(i=>vp(n,e,i))}(n,t,i)){const s=new bt(n.segments,function t6(n,e,t,i,r){const s={};for(const o of i)if(vp(n,t,o)&&!r[lr(o)]){const a=new bt([],{});a._sourceSegment=n,a._segmentIndexShift=e.length,s[lr(o)]=a}return{...r,...s}}(n,e,t,i,n.children));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}const r=new bt(n.segments,n.children);return r._sourceSegment=n,r._segmentIndexShift=e.length,{segmentGroup:r,slicedSegments:t}}function vp(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function MD(n,e,t,i){return!!(lr(n)===i||i!==ct&&vp(e,t,n))&&("**"===n.path||l0(e,n,t).matched)}function ED(n,e,t){return 0===e.length&&!n.children[t]}const bp=!1;class xp{constructor(e){this.segmentGroup=e||null}}class wD{constructor(e){this.urlTree=e}}function ld(n){return Xu(new xp(n))}function SD(n){return Xu(new wD(n))}class l6{constructor(e,t,i,r,s){this.injector=e,this.configLoader=t,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const e=yp(this.urlTree.root,[],[],this.config).segmentGroup,t=new bt(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,ct).pipe(Mt(s=>this.createUrlTree(dp(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(so(s=>{if(s instanceof wD)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof xp?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,ct).pipe(Mt(r=>this.createUrlTree(dp(r),e.queryParams,e.fragment))).pipe(so(r=>{throw r instanceof xp?this.noMatchError(r):r}))}noMatchError(e){return new me(4002,bp)}createUrlTree(e,t,i){const r=Gv(e);return new ao(r,t,i)}expandSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,t,i).pipe(Mt(s=>new bt([],s))):this.expandSegment(e,i,t,i.segments,r,!0)}expandChildren(e,t,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return En(r).pipe(qo(s=>{const o=i.children[s],a=yD(t,s);return this.expandSegmentGroup(e,a,o,s).pipe(Mt(l=>({segment:l,outlet:s})))}),B1((s,o)=>(s[o.outlet]=o.segment,s),{}),V1())}expandSegment(e,t,i,r,s,o){return En(i).pipe(qo(a=>this.expandSegmentAgainstRoute(e,t,i,a,r,s,o).pipe(so(c=>{if(c instanceof xp)return Ke(null);throw c}))),ro(a=>!!a),so((a,l)=>{if(o0(a))return ED(t,r,s)?Ke(new bt([],{})):ld(t);throw a}))}expandSegmentAgainstRoute(e,t,i,r,s,o,a){return MD(r,t,s,o)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,s,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o):ld(t):ld(t)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?SD(s):this.lineralizeSegments(i,s).pipe(Bn(o=>{const a=new bt(o,{});return this.expandSegment(e,a,t,o,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:u}=l0(t,r,s);if(!a)return ld(t);const d=this.applyRedirectCommands(l,r.redirectTo,u);return r.redirectTo.startsWith("/")?SD(d):this.lineralizeSegments(r,d).pipe(Bn(h=>this.expandSegment(e,t,i,h.concat(c),o,!1)))}matchSegmentAgainstRoute(e,t,i,r,s){return"**"===i.path?(e=_D(i,e),i.loadChildren?(i._loadedRoutes?Ke({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(e,i)).pipe(Mt(a=>(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,new bt(r,{})))):Ke(new bt(r,{}))):xD(t,i,r,e).pipe(Jr(({matched:o,consumedSegments:a,remainingSegments:l})=>o?this.getChildConfig(e=i._injector??e,i,r).pipe(Bn(u=>{const d=u.injector??e,h=u.routes,{segmentGroup:f,slicedSegments:p}=yp(t,a,l,h),_=new bt(f.segments,f.children);if(0===p.length&&_.hasChildren())return this.expandChildren(d,h,_).pipe(Mt(y=>new bt(a,y)));if(0===h.length&&0===p.length)return Ke(new bt(a,{}));const m=lr(i)===s;return this.expandSegment(d,_,h,p,m?ct:s,!0).pipe(Mt(v=>new bt(a.concat(v.segments),v.children)))})):ld(t)))}getChildConfig(e,t,i){return t.children?Ke({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?Ke({routes:t._loadedRoutes,injector:t._loadedInjector}):function J8(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?Ke(!0):Ke(r.map(o=>{const a=Ol(o,n);return oo(function B8(n){return n&&ad(n.canLoad)}(a)?a.canLoad(e,t):n.runInContext(()=>a(e,t)))})).pipe(Nl(),bD())}(e,t,i).pipe(Bn(r=>r?this.configLoader.loadChildren(e,t).pipe(ei(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function o6(n){return Xu(pD(bp,3))}())):Ke({routes:[],injector:e})}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Ke(i);if(r.numberOfChildren>1||!r.children[ct])return e.redirectTo,Xu(new me(4e3,bp));r=r.children[ct]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreateUrlTree(e,t,i,r){const s=this.createSegmentGroup(e,t.root,i,r);return new ao(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Wn(e,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const a=r.substring(1);i[s]=t[a]}else i[s]=r}),i}createSegmentGroup(e,t,i,r){const s=this.createSegments(e,t.segments,i,r);let o={};return Wn(t.children,(a,l)=>{o[l]=this.createSegmentGroup(e,a,i,r)}),new bt(s,o)}createSegments(e,t,i,r){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new me(4001,bp);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}class u6{}class f6{constructor(e,t,i,r,s,o,a){this.injector=e,this.rootComponentType=t,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a}recognize(){const e=yp(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,ct).pipe(Mt(t=>{if(null===t)return null;const i=new pp([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ct,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Ps(i,t),s=new dD(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const t=e.value,i=uD(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i):this.processSegment(e,t,i,i.segments,r)}processChildren(e,t,i){return En(Object.keys(i.children)).pipe(qo(r=>{const s=i.children[r],o=yD(t,r);return this.processSegmentGroup(e,o,s,r)}),B1((r,s)=>r&&s?(r.push(...s),r):null),function PW(n,e=!1){return Mn((t,i)=>{let r=0;t.subscribe(fn(i,s=>{const o=n(s,r++);(o||e)&&i.next(s),!o&&i.complete()}))})}(r=>null!==r),rp(null),V1(),Mt(r=>{if(null===r)return null;const s=AD(r);return function p6(n){n.sort((e,t)=>e.value.outlet===ct?-1:t.value.outlet===ct?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}))}processSegment(e,t,i,r,s){return En(t).pipe(qo(o=>this.processSegmentAgainstRoute(o._injector??e,o,i,r,s)),ro(o=>!!o),so(o=>{if(o0(o))return ED(i,r,s)?Ke([]):Ke(null);throw o}))}processSegmentAgainstRoute(e,t,i,r,s){if(t.redirectTo||!MD(t,i,r,s))return Ke(null);let o;if("**"===t.path){const a=r.length>0?G1(r).parameters:{},l=DD(i)+r.length;o=Ke({snapshot:new pp(r,a,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,ID(t),lr(t),t.component??t._loadedComponent??null,t,CD(i),l,RD(t)),consumedSegments:[],remainingSegments:[]})}else o=xD(i,t,r,e).pipe(Mt(({matched:a,consumedSegments:l,remainingSegments:c,parameters:u})=>{if(!a)return null;const d=DD(i)+l.length;return{snapshot:new pp(l,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,ID(t),lr(t),t.component??t._loadedComponent??null,t,CD(i),d,RD(t)),consumedSegments:l,remainingSegments:c}}));return o.pipe(Jr(a=>{if(null===a)return Ke(null);const{snapshot:l,consumedSegments:c,remainingSegments:u}=a;e=t._injector??e;const d=t._loadedInjector??e,h=function m6(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:f,slicedSegments:p}=yp(i,c,u,h.filter(m=>void 0===m.redirectTo));if(0===p.length&&f.hasChildren())return this.processChildren(d,h,f).pipe(Mt(m=>null===m?null:[new Ps(l,m)]));if(0===h.length&&0===p.length)return Ke([new Ps(l,[])]);const _=lr(t)===s;return this.processSegment(d,h,f,p,_?ct:s).pipe(Mt(m=>null===m?null:[new Ps(l,m)]))}))}}function g6(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function AD(n){const e=[],t=new Set;for(const i of n){if(!g6(i)){e.push(i);continue}const r=e.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=AD(i.children);e.push(new Ps(i.value,r))}return e.filter(i=>!t.has(i))}function CD(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function DD(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function ID(n){return n.data||{}}function RD(n){return n.resolve||{}}function PD(n){return"string"==typeof n.title||null===n.title}function c0(n){return Jr(e=>{const t=n(e);return t?En(t).pipe(Mt(()=>e)):Ke(e)})}const kl=new Be("ROUTES");let u0=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=vt(lC)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Ke(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=oo(t.loadComponent()).pipe(Mt(LD),ei(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Vv(()=>{this.componentLoaders.delete(t)})),r=new N1(i,()=>new Br).pipe(Uv());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Ke({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(Mt(a=>{this.onLoadEndListener&&this.onLoadEndListener(i);let l,c,u=!1;Array.isArray(a)?c=a:(l=a.create(t).injector,c=H1(l.get(kl,[],Qe.Self|Qe.Optional)));return{routes:c.map(s0),injector:l}}),Vv(()=>{this.childrenLoaders.delete(i)})),o=new N1(s,()=>new Br).pipe(Uv());return this.childrenLoaders.set(i,o),o}loadModuleFactoryOrRoutes(t){return oo(t()).pipe(Mt(LD),Bn(i=>i instanceof vA||Array.isArray(i)?Ke(i):En(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function LD(n){return function w6(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let Ep=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Br,this.configLoader=vt(u0),this.environmentInjector=vt(Ms),this.urlSerializer=vt(Zu),this.rootContexts=vt(id),this.navigationId=0,this.afterPreactivation=()=>Ke(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new d8(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new u8(r))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:i})}setupNavigations(t){return this.transitions=new Cr({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:td,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Rs(i=>0!==i.id),Mt(i=>({...i,extractedUrl:t.urlHandlingStrategy.extract(i.rawUrl)})),Jr(i=>{let r=!1,s=!1;return Ke(i).pipe(ei(o=>{this.currentNavigation={id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Jr(o=>{const a=t.browserUrlTree.toString(),l=!t.navigated||o.extractedUrl.toString()!==a||a!==t.currentUrlTree.toString();if(!l&&"reload"!==(o.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const u="";return this.events.next(new fp(o.id,t.serializeUrl(i.rawUrl),u,0)),t.rawUrlTree=o.rawUrl,o.resolve(null),Vr}if(t.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return OD(o.source)&&(t.browserUrlTree=o.extractedUrl),Ke(o).pipe(Jr(u=>{const d=this.transitions?.getValue();return this.events.next(new qv(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),d!==this.transitions?.getValue()?Vr:Promise.resolve(u)}),function c6(n,e,t,i){return Jr(r=>function a6(n,e,t,i,r){return new l6(n,e,t,i,r).apply()}(n,e,t,r.extractedUrl,i).pipe(Mt(s=>({...r,urlAfterRedirects:s}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),ei(u=>{this.currentNavigation={...this.currentNavigation,finalUrl:u.urlAfterRedirects},i.urlAfterRedirects=u.urlAfterRedirects}),function y6(n,e,t,i,r){return Bn(s=>function h6(n,e,t,i,r,s,o="emptyOnly"){return new f6(n,e,t,i,r,o,s).recognize().pipe(Jr(a=>null===a?function d6(n){return new hn(e=>e.error(n))}(new u6):Ke(a)))}(n,e,t,s.urlAfterRedirects,i.serialize(s.urlAfterRedirects),i,r).pipe(Mt(o=>({...s,targetSnapshot:o}))))}(this.environmentInjector,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),ei(u=>{if(i.targetSnapshot=u.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!u.extras.skipLocationChange){const h=t.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);t.setBrowserUrl(h,u)}t.browserUrlTree=u.urlAfterRedirects}const d=new s8(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}));if(l&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:u,extractedUrl:d,source:h,restoredState:f,extras:p}=o,_=new qv(u,this.urlSerializer.serialize(d),h,f);this.events.next(_);const m=cD(d,this.rootComponentType).snapshot;return Ke(i={...o,targetSnapshot:m,urlAfterRedirects:d,extras:{...p,skipLocationChange:!1,replaceUrl:!1}})}{const u="";return this.events.next(new fp(o.id,t.serializeUrl(i.extractedUrl),u,1)),t.rawUrlTree=o.rawUrl,o.resolve(null),Vr}}),ei(o=>{const a=new o8(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),Mt(o=>i={...o,guards:L8(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),function j8(n,e){return Bn(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?Ke({...t,guardsResult:!0}):function $8(n,e,t,i){return En(n).pipe(Bn(r=>function Q8(n,e,t,i,r){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?Ke(s.map(a=>{const l=rd(e)??r,c=Ol(a,l);return oo(function H8(n){return n&&ad(n.canDeactivate)}(c)?c.canDeactivate(n,e,t,i):l.runInContext(()=>c(n,e,t,i))).pipe(ro())})).pipe(Nl()):Ke(!0)}(r.component,r.route,t,e,i)),ro(r=>!0!==r,!0))}(o,i,r,n).pipe(Bn(a=>a&&function U8(n){return"boolean"==typeof n}(a)?function q8(n,e,t,i){return En(e).pipe(qo(r=>ip(function Y8(n,e){return null!==n&&e&&e(new h8(n)),Ke(!0)}(r.route.parent,i),function X8(n,e){return null!==n&&e&&e(new p8(n)),Ke(!0)}(r.route,i),function Z8(n,e,t){const i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function O8(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>O1(()=>Ke(o.guards.map(l=>{const c=rd(o.node)??t,u=Ol(l,c);return oo(function z8(n){return n&&ad(n.canActivateChild)}(u)?u.canActivateChild(i,n):c.runInContext(()=>u(i,n))).pipe(ro())})).pipe(Nl())));return Ke(s).pipe(Nl())}(n,r.path,t),function K8(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return Ke(!0);const r=i.map(s=>O1(()=>{const o=rd(e)??t,a=Ol(s,o);return oo(function V8(n){return n&&ad(n.canActivate)}(a)?a.canActivate(e,n):o.runInContext(()=>a(e,n))).pipe(ro())}));return Ke(r).pipe(Nl())}(n,r.route,t))),ro(r=>!0!==r,!0))}(i,s,n,e):Ke(a)),Mt(a=>({...t,guardsResult:a})))})}(this.environmentInjector,o=>this.events.next(o)),ei(o=>{if(i.guardsResult=o.guardsResult,Yo(o.guardsResult))throw fD(0,o.guardsResult);const a=new a8(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),Rs(o=>!!o.guardsResult||(t.restoreHistory(o),this.cancelNavigationTransition(o,"",3),!1)),c0(o=>{if(o.guards.canActivateChecks.length)return Ke(o).pipe(ei(a=>{const l=new l8(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),Jr(a=>{let l=!1;return Ke(a).pipe(function v6(n,e){return Bn(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return Ke(t);let s=0;return En(r).pipe(qo(o=>function b6(n,e,t,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!PD(r)&&(s[Yu]=r.title),function x6(n,e,t,i){const r=function M6(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Ke({});const s={};return En(r).pipe(Bn(o=>function E6(n,e,t,i){const r=rd(e)??i,s=Ol(n,r);return oo(s.resolve?s.resolve(e,t):r.runInContext(()=>s(e,t)))}(n[o],e,t,i).pipe(ro(),ei(a=>{s[o]=a}))),Bv(1),function FW(n){return Mt(()=>n)}(s),so(o=>o0(o)?Vr:Xu(o)))}(s,n,e,i).pipe(Mt(o=>(n._resolvedData=o,n.data=uD(n,t).resolve,r&&PD(r)&&(n.data[Yu]=r.title),null)))}(o.route,i,n,e)),ei(()=>s++),Bv(1),Bn(o=>s===r.length?Ke(t):Vr))})}(t.paramsInheritanceStrategy,this.environmentInjector),ei({next:()=>l=!0,complete:()=>{l||(t.restoreHistory(a),this.cancelNavigationTransition(a,"",2))}}))}),ei(a=>{const l=new c8(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),c0(o=>{const a=l=>{const c=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(l.routeConfig).pipe(ei(u=>{l.component=u}),Mt(()=>{})));for(const u of l.children)c.push(...a(u));return c};return kv(a(o.targetSnapshot.root)).pipe(rp(),$o(1))}),c0(()=>this.afterPreactivation()),Mt(o=>{const a=function E8(n,e,t){const i=nd(n,e._root,t?t._root:void 0);return new lD(i,e)}(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return i={...o,targetRouterState:a}}),ei(o=>{t.currentUrlTree=o.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl),t.routerState=o.targetRouterState,"deferred"===t.urlUpdateStrategy&&(o.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,o),t.browserUrlTree=o.urlAfterRedirects)}),((n,e,t)=>Mt(i=>(new F8(e,i.targetRouterState,i.currentRouterState,t).activate(n),i)))(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o)),$o(1),ei({next:o=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new Ko(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),Vv(()=>{r||s||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),so(o=>{if(s=!0,gD(o)){mD(o)||(t.navigated=!0,t.restoreHistory(i,!0));const a=new hp(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode);if(this.events.next(a),mD(o)){const l=t.urlHandlingStrategy.merge(o.url,t.rawUrlTree),c={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||OD(i.source)};t.scheduleNavigation(l,td,null,c,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{t.restoreHistory(i,!0);const a=new Xv(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);this.events.next(a);try{i.resolve(t.errorHandler(o))}catch(l){i.reject(l)}}return Vr}))}))}cancelNavigationTransition(t,i,r){const s=new hp(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(s),t.resolve(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function OD(n){return n!==td}let ND=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===ct);return i}getResolvedTitleForRoute(t){return t.data[Yu]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return vt(S6)},providedIn:"root"}),n})(),S6=(()=>{class n extends ND{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(t){return new(t||n)(He(C1))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),T6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return vt(C6)},providedIn:"root"}),n})();class A6{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let C6=(()=>{class n extends A6{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=Gn(n)))(i||n)}}(),n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wp=new Be("",{providedIn:"root",factory:()=>({})});let I6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:function(){return vt(R6)},providedIn:"root"}),n})(),R6=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function P6(n){throw n}function F6(n,e,t){return e.parse("/")}const L6={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},O6={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let zi=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=vt(oG),this.isNgZoneEnabled=!1,this.options=vt(wp,{optional:!0})||{},this.errorHandler=this.options.errorHandler||P6,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||F6,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=vt(I6),this.routeReuseStrategy=vt(T6),this.urlCreationStrategy=vt(b8),this.titleStrategy=vt(ND),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=H1(vt(kl,{optional:!0})??[]),this.navigationTransitions=vt(Ep),this.urlSerializer=vt(Zu),this.location=vt(fv),this.isNgZoneEnabled=vt(Qt)instanceof Qt&&Qt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new ao,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=cD(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),td,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,i,t.state)},0)}))}navigateToSyncWithBrowser(t,i,r){const s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){const l={...r};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(t);this.scheduleNavigation(a,i,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map(s0),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,i={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=i,c=l?this.currentUrlTree.fragment:o;let u=null;switch(a){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}return null!==u&&(u=this.removeEmptyProps(u)),this.urlCreationStrategy.createUrlTree(r,this.routerState,this.currentUrlTree,t,u,c??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=Yo(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,td,null,i)}navigate(t,i={skipLocationChange:!1}){return function N6(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new me(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?{...L6}:!1===i?{...O6}:i,Yo(t))return j1(this.currentUrlTree,t,r);const s=this.parseUrl(t);return j1(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const s=t[r];return null!=s&&(i[r]=s),i},{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c,u;return o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((d,h)=>{a=d,l=h}),u="computed"===this.canceledNavigationResolution?r&&r.\u0275routerPageId?r.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:u,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const o={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",o)}else{const s={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.go(r,"",s)}}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-(this.browserPageId??this.currentPageId);0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class kD{}let B6=(()=>{class n{constructor(t,i,r,s,o){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(Rs(t=>t instanceof Ko),qo(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=Cf(s.providers,t,`Route: ${s.path}`));const o=s._injector??t,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return En(r).pipe(za())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):Ke(null);const s=r.pipe(Bn(o=>null===o?Ke(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));return i.loadComponent&&!i._loadedComponent?En([s,this.loader.loadComponent(i)]).pipe(za()):s})}}return n.\u0275fac=function(t){return new(t||n)(He(zi),He(lC),He(Ms),He(kD),He(u0))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const f0=new Be("");let UD=(()=>{class n{constructor(t,i,r,s,o={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof qv?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Ko&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof oD&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new oD(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return n.\u0275fac=function(t){!function xS(){throw new Error("invalid")}()},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();var Hi=(()=>((Hi=Hi||{})[Hi.COMPLETE=0]="COMPLETE",Hi[Hi.FAILED=1]="FAILED",Hi[Hi.REDIRECTING=2]="REDIRECTING",Hi))();const Ul=!1;function lo(n,e){return{\u0275kind:n,\u0275providers:e}}const p0=new Be("",{providedIn:"root",factory:()=>!1});function VD(){const n=vt($r);return e=>{const t=n.get(zu);if(e!==t.components[0])return;const i=n.get(zi),r=n.get(zD);1===n.get(m0)&&i.initialNavigation(),n.get(HD,null,Qe.Optional)?.setUpPreloading(),n.get(f0,null,Qe.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const zD=new Be(Ul?"bootstrap done indicator":"",{factory:()=>new Br}),m0=new Be(Ul?"initial navigation":"",{providedIn:"root",factory:()=>1});function W6(){let n=[];return n=Ul?[{provide:af,multi:!0,useFactory:()=>{const e=vt(zi);return()=>e.events.subscribe(t=>{console.group?.(`Router Event: ${t.constructor.name}`),console.log(function g8(n){if(!("type"in n))return`Unknown Router Event: ${n.constructor.name}`;switch(n.type){case 14:return`ActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${n.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${n.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state}, shouldActivate: ${n.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 2:return`NavigationCancel(id: ${n.id}, url: '${n.url}')`;case 16:return`NavigationSkipped(id: ${n.id}, url: '${n.url}')`;case 1:return`NavigationEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${n.id}, url: '${n.url}', error: ${n.error})`;case 0:return`NavigationStart(id: ${n.id}, url: '${n.url}')`;case 6:return`ResolveEnd(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 5:return`ResolveStart(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 10:return`RouteConfigLoadEnd(path: ${n.route.path})`;case 9:return`RouteConfigLoadStart(path: ${n.route.path})`;case 4:return`RoutesRecognized(id: ${n.id}, url: '${n.url}', urlAfterRedirects: '${n.urlAfterRedirects}', state: ${n.state})`;case 15:return`Scroll(anchor: '${n.anchor}', position: '${n.position?`${n.position[0]}, ${n.position[1]}`:null}')`}}(t)),console.log(t),console.groupEnd?.()})}}]:[],lo(1,n)}const HD=new Be(Ul?"router preloader":"");function j6(n){return lo(0,[{provide:HD,useExisting:B6},{provide:kD,useExisting:n}])}const cd=!1,GD=new Be(cd?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),$6=[fv,{provide:Zu,useClass:zv},zi,id,{provide:Ll,useFactory:function BD(n){return n.routerState.root},deps:[zi]},u0,cd?{provide:p0,useValue:!0}:[]];function q6(){return new gC("Router",zi)}let WD=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[$6,cd&&i?.enableTracing?W6().\u0275providers:[],{provide:kl,multi:!0,useValue:t},{provide:GD,useFactory:Z6,deps:[[zi,new uu,new du]]},{provide:wp,useValue:i||{}},i?.useHash?{provide:jo,useClass:qG}:{provide:jo,useClass:BC},{provide:f0,useFactory:()=>{const n=vt(g5),e=vt(Qt),t=vt(wp),i=vt(Ep),r=vt(Zu);return t.scrollOffset&&n.setOffset(t.scrollOffset),new UD(r,i,n,e,t)}},i?.preloadingStrategy?j6(i.preloadingStrategy).\u0275providers:[],{provide:gC,multi:!0,useFactory:q6},i?.initialNavigation?Q6(i):[],[{provide:jD,useFactory:VD},{provide:mC,multi:!0,useExisting:jD}]]}}static forChild(t){return{ngModule:n,providers:[{provide:kl,multi:!0,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)(He(GD,8))},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[n0]}),n})();function Z6(n){if(cd&&n)throw new me(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Q6(n){return["disabled"===n.initialNavigation?lo(3,[{provide:Ff,multi:!0,useFactory:()=>{const e=vt(zi);return()=>{e.setUpLocationChangeListener()}}},{provide:m0,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?lo(2,[{provide:m0,useValue:0},{provide:Ff,multi:!0,deps:[$r],useFactory:e=>{const t=e.get(jG,Promise.resolve());return()=>t.then(()=>new Promise(i=>{const r=e.get(zi),s=e.get(zD);(function V6(n,e){n.events.pipe(Rs(t=>t instanceof Ko||t instanceof hp||t instanceof Xv||t instanceof fp),Mt(t=>t instanceof Ko||t instanceof fp?Hi.COMPLETE:t instanceof hp&&(0===t.code||1===t.code)?Hi.REDIRECTING:Hi.FAILED),Rs(t=>t!==Hi.REDIRECTING),$o(1)).subscribe(()=>{e()})})(r,()=>{i(!0)}),e.get(Ep).afterPreactivation=()=>(i(!0),s.closed?Ke(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const jD=new Be(cd?"Router Initializer":""),ej=[];let tj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[WD.forRoot(ej),WD]}),n})();var Dr=(()=>{return(n=Dr||(Dr={}))[n.createdViewportDiv=0]="createdViewportDiv",n[n.resizedClientSize=1]="resizedClientSize",Dr;var n})();let ud=(()=>{class n{constructor(){this.isEnabled=!1,this._handlers=[]}notify(t,i,r){this.isEnabled&&this._handlers.forEach(s=>{s.isEnabled&&s.callback(t,i,r)})}add(t){this._handlers.push(t)}remove(t){this._handlers.splice(this._handlers.indexOf(t),1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Fs{constructor(e,t,i){this.isEnabled=void 0===i||i,this.callback=t,this._notification=e,this._notification.add(this)}onDispose(){this._notification.remove(this)}notify(e,t,i){this._notification.notify(e,t,i)}}var jt=(()=>{return(n=jt||(jt={}))[n.OnWindowResize=0]="OnWindowResize",n[n.OnMouseWheel=1]="OnMouseWheel",n[n.OnMouseMove=2]="OnMouseMove",n[n.OnMouseDown=3]="OnMouseDown",n[n.OnMouseUp=4]="OnMouseUp",n[n.OnKeyDown=5]="OnKeyDown",n[n.OnKeyUp=6]="OnKeyUp",n[n.OnInput=7]="OnInput",n[n.length=8]="length",jt;var n})();let g0=(()=>{class n{constructor(){this.isEnabled=!1,this._handlers=[]}emit(t,i){if(this.isEnabled||t===jt.OnWindowResize){let r;this._handlers.forEach(s=>{s.isEnabled&&(r=s.events[t],void 0!==r&&r(i))})}}add(t){this._handlers.push(t)}remove(t){this._handlers.splice(this._handlers.indexOf(t),1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Bl{constructor(e,t=!0){this.isEnabled=t,this.events=new Array(jt.length);for(let i=0;i<this.events.length;++i)this.events[i]=void 0;this._eventService=e,this._eventService.add(this)}onDispose(){this._eventService.remove(this)}set(e,t){this.events[e]=t}}function $D(n,e,t,i,r,s,o){try{var a=n[s](o),l=a.value}catch(c){return void t(c)}a.done?e(l):Promise.resolve(l).then(i,r)}const Vl={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},zl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ij=0,qD=1,rj=2,XD=1,sj=2,Ls=3,ns=0,ti=1,Gi=2,co=0,Hl=1,YD=2,KD=3,ZD=4,oj=5,Gl=100,aj=101,lj=102,QD=103,JD=104,cj=200,uj=201,dj=202,hj=203,eI=204,tI=205,fj=206,pj=207,mj=208,gj=209,_j=210,yj=0,vj=1,bj=2,y0=3,xj=4,Mj=5,Ej=6,wj=7,Sp=0,Sj=1,Tj=2,Os=0,Aj=1,Cj=2,Dj=3,Ij=4,Rj=5,Zo=301,Qo=302,Tp=303,Ap=304,dd=306,Jo=1e3,ni=1001,hd=1002,_n=1003,Cp=1004,fd=1005,Jt=1006,b0=1007,Ns=1008,uo=1009,Pj=1010,Fj=1011,x0=1012,nI=1013,ho=1014,ks=1015,pd=1016,iI=1017,rI=1018,ea=1020,Lj=1021,cr=1023,Oj=1024,Nj=1025,ta=1026,Wl=1027,kj=1028,sI=1029,Uj=1030,oI=1031,aI=1033,M0=33776,E0=33777,w0=33778,S0=33779,lI=35840,cI=35841,uI=35842,dI=35843,Bj=36196,hI=37492,fI=37496,pI=37808,mI=37809,gI=37810,_I=37811,yI=37812,vI=37813,bI=37814,xI=37815,MI=37816,EI=37817,wI=37818,SI=37819,TI=37820,AI=37821,T0=36492,Vj=36283,CI=36284,DI=36285,II=36286,md=2300,jl=2301,Wj=0,PI=1,D0=2,na=3001,LI=3201,ia=0,$j=1,ra="",rt="srgb",is="srgb-linear",OI="display-p3",Xj=512,Yj=513,Kj=514,Zj=515,Qj=516,Jj=517,e9=518,t9=519,NI="300 es",R0=1035,Us=2e3;class sa{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const ii=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const oa=Math.PI/180,Xl=180/Math.PI;function Wi(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ii[255&n]+ii[n>>8&255]+ii[n>>16&255]+ii[n>>24&255]+"-"+ii[255&e]+ii[e>>8&255]+"-"+ii[e>>16&15|64]+ii[e>>24&255]+"-"+ii[63&t|128]+ii[t>>8&255]+"-"+ii[t>>16&255]+ii[t>>24&255]+ii[255&i]+ii[i>>8&255]+ii[i>>16&255]+ii[i>>24&255]).toLowerCase()}function ln(n,e,t){return Math.max(e,Math.min(t,n))}function P0(n,e){return(n%e+e)%e}function gd(n,e,t){return(1-t)*n+t*e}function F0(n){return 0==(n&n-1)&&0!==n}function UI(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Pp(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ji(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function gt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const m9_radToDeg=function f9(n){return n*Xl};class ve{constructor(e=0,t=0){ve.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ln(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class _t{constructor(e,t,i,r,s,o,a,l,c){_t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],h=i[2],f=i[5],p=i[8],_=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],M=r[5],w=r[8];return s[0]=o*_+a*v+l*x,s[3]=o*m+a*y+l*M,s[6]=o*g+a*b+l*w,s[1]=c*_+u*v+d*x,s[4]=c*m+u*y+d*M,s[7]=c*g+u*b+d*w,s[2]=h*_+f*v+p*x,s[5]=h*m+f*y+p*M,s[8]=h*g+f*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,h=a*l-u*s,f=c*s-o*l,p=t*d+i*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=d*_,e[1]=(r*c-u*i)*_,e[2]=(a*i-r*o)*_,e[3]=h*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(i*l-c*t)*_,e[8]=(o*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(L0.makeScale(e,t)),this}rotate(e){return this.premultiply(L0.makeRotation(-e)),this}translate(e,t){return this.premultiply(L0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const L0=new _t;function BI(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function _d(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const VI={};function yd(n){n in VI||(VI[n]=!0,console.warn(n))}function Kl(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function O0(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const _9=(new _t).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),y9=(new _t).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),x9={[is]:n=>n,[rt]:n=>n.convertSRGBToLinear(),[OI]:function v9(n){return n.convertSRGBToLinear().applyMatrix3(y9)}},M9={[is]:n=>n,[rt]:n=>n.convertLinearToSRGB(),[OI]:function b9(n){return n.applyMatrix3(_9).convertLinearToSRGB()}},Ir={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return is},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(!1===this.enabled||e===t||!e||!t)return n;const i=x9[e],r=M9[t];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let Zl;class zI{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Zl&&(Zl=_d("canvas")),Zl.width=e.width,Zl.height=e.height;const i=Zl.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Zl}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=_d("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*Kl(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Kl(t[i]/255)):Kl(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let E9=0;class Ql{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:E9++}),this.uuid=Wi(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(N0(r[o].isDataTexture?r[o].image:r[o]))}else s=N0(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function N0(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?zI.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let w9=0,ur=(()=>{class n extends sa{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=ni,s=ni,o=Jt,a=Ns,l=cr,c=uo,u=n.DEFAULT_ANISOTROPY,d=ra){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:w9++}),this.uuid=Wi(),this.name="",this.source=new Ql(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.center=new ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _t,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof d?this.colorSpace=d:(yd("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=d===na?rt:ra),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Jo:t.x=t.x-Math.floor(t.x);break;case ni:t.x=t.x<0?0:1;break;case hd:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Jo:t.y=t.y-Math.floor(t.y);break;case ni:t.y=t.y<0?0:1;break;case hd:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return yd("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===rt?na:3e3}set encoding(t){yd("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===na?rt:ra}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class Lt{constructor(e=0,t=0,i=0,r=1){Lt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],_=l[2],m=l[6],g=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-_)<.01&&Math.abs(p-m)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+_)<.1&&Math.abs(p+m)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(c+1)/2,b=(f+1)/2,x=(g+1)/2,M=(u+h)/4,w=(d+_)/4,S=(p+m)/4;return y>b&&y>x?y<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(y),r=M/i,s=w/i):b>x?b<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(b),i=M/r,s=S/r):x<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(x),i=w/s,r=S/s),this.set(i,r,s,t),this}let v=Math.sqrt((m-p)*(m-p)+(d-_)*(d-_)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(d-_)/v,this.z=(h-u)/v,this.w=Math.acos((c+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class aa extends sa{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Lt(0,0,e,t),this.scissorTest=!1,this.viewport=new Lt(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==i.encoding&&(yd("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===na?rt:ra),this.texture=new ur(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Jt,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Ql(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class k0 extends ur{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_n,this.minFilter=_n,this.wrapR=ni,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class HI extends ur{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_n,this.minFilter=_n,this.wrapR=ni,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jn{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],p=s[o+2],_=s[o+3];if(0===a)return e[t+0]=l,e[t+1]=c,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=_);if(d!==_||l!==h||c!==f||u!==p){let m=1-a;const g=l*h+c*f+u*p+d*_,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){const x=Math.sqrt(y),M=Math.atan2(x,g*v);m=Math.sin(m*M)/x,a=Math.sin(a*M)/x}const b=a*v;if(l=l*m+h*b,c=c*m+f*b,u=u*m+p*b,d=d*m+_*b,m===1-a){const x=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=x,c*=x,u*=x,d*=x}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),d=a(s/2),h=l(i/2),f=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ln(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class R{constructor(e=0,t=0,i=0){R.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(GI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(GI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*i,u=l*i+a*t-s*r,d=l*r+s*i-o*t,h=-s*t-o*i-a*r;return this.x=c*l+h*-s+u*-a-d*-o,this.y=u*l+h*-o+d*-s-c*-a,this.z=d*l+h*-a+c*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return U0.copy(this).projectOnVector(e),this.sub(U0)}reflect(e){return this.sub(U0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ln(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const U0=new R,GI=new jn;class Rr{constructor(e=new R(1/0,1/0,1/0),t=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Vs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Vs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Vs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Jl.copy(e.boundingBox),Jl.applyMatrix4(e.matrixWorld),this.union(Jl);else{const r=e.geometry;if(void 0!==r)if(t&&void 0!==r.attributes&&void 0!==r.attributes.position){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)Vs.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Vs)}else null===r.boundingBox&&r.computeBoundingBox(),Jl.copy(r.boundingBox),Jl.applyMatrix4(e.matrixWorld),this.union(Jl)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Vs),Vs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(vd),Fp.subVectors(this.max,vd),ec.subVectors(e.a,vd),tc.subVectors(e.b,vd),nc.subVectors(e.c,vd),fo.subVectors(tc,ec),po.subVectors(nc,tc),la.subVectors(ec,nc);let t=[0,-fo.z,fo.y,0,-po.z,po.y,0,-la.z,la.y,fo.z,0,-fo.x,po.z,0,-po.x,la.z,0,-la.x,-fo.y,fo.x,0,-po.y,po.x,0,-la.y,la.x,0];return!(!B0(t,ec,tc,nc,Fp)||(t=[1,0,0,0,1,0,0,0,1],!B0(t,ec,tc,nc,Fp)))&&(Lp.crossVectors(fo,po),t=[Lp.x,Lp.y,Lp.z],B0(t,ec,tc,nc,Fp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Vs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Vs).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Bs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bs)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Bs=[new R,new R,new R,new R,new R,new R,new R,new R],Vs=new R,Jl=new Rr,ec=new R,tc=new R,nc=new R,fo=new R,po=new R,la=new R,vd=new R,Fp=new R,Lp=new R,ca=new R;function B0(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){ca.fromArray(n,s);const a=r.x*Math.abs(ca.x)+r.y*Math.abs(ca.y)+r.z*Math.abs(ca.z),l=e.dot(ca),c=t.dot(ca),u=i.dot(ca);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const S9=new Rr,bd=new R,V0=new R;class dr{constructor(e=new R,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):S9.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;bd.subVectors(e,this.center);const t=bd.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(bd,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(V0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(bd.copy(e.center).add(V0)),this.expandByPoint(bd.copy(e.center).sub(V0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const zs=new R,z0=new R,Op=new R,mo=new R,H0=new R,Np=new R,G0=new R;class xd{constructor(e=new R,t=new R(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=zs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zs.copy(this.origin).addScaledVector(this.direction,t),zs.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){z0.copy(e).add(t).multiplyScalar(.5),Op.copy(t).sub(e).normalize(),mo.copy(this.origin).sub(z0);const s=.5*e.distanceTo(t),o=-this.direction.dot(Op),a=mo.dot(this.direction),l=-mo.dot(Op),c=mo.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*l-a,h=o*a-l,p=s*u,d>=0)if(h>=-p)if(h<=p){const _=1/u;d*=_,h*=_,f=d*(d+o*h+2*a)+h*(o*d+h+2*l)+c}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-s,-l),s),f=h*(h+2*l)+c):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(z0).addScaledVector(Op,h),f}intersectSphere(e,t){zs.subVectors(e.center,this.origin);const i=zs.dot(this.direction),r=zs.dot(zs)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:this.at(a<0?l:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),i>l||a>r)||((a>i||i!=i)&&(i=a),(l<r||r!=r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,zs)}intersectTriangle(e,t,i,r,s){H0.subVectors(t,e),Np.subVectors(i,e),G0.crossVectors(H0,Np);let a,o=this.direction.dot(G0);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}mo.subVectors(this.origin,e);const l=a*this.direction.dot(Np.crossVectors(mo,Np));if(l<0)return null;const c=a*this.direction.dot(H0.cross(mo));if(c<0||l+c>o)return null;const u=-a*mo.dot(G0);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class tt{constructor(e,t,i,r,s,o,a,l,c,u,d,h,f,p,_,m){tt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,c,u,d,h,f,p,_,m)}set(e,t,i,r,s,o,a,l,c,u,d,h,f,p,_,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=s,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=d,g[14]=h,g[3]=f,g[7]=p,g[11]=_,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new tt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/ic.setFromMatrixColumn(e,0).length(),s=1/ic.setFromMatrixColumn(e,1).length(),o=1/ic.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,_=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-_*c,t[9]=-a*l,t[2]=_-h*c,t[6]=p+f*c,t[10]=o*l}else if("YXZ"===e.order){const h=l*u,f=l*d,p=c*u,_=c*d;t[0]=h+_*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=_+h*a,t[10]=o*l}else if("ZXY"===e.order){const h=l*u,f=l*d,p=c*u,_=c*d;t[0]=h-_*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=_-h*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,_=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+_,t[1]=l*d,t[5]=_*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if("YZX"===e.order){const h=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=_-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-_*d}else if("XZY"===e.order){const h=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+_,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=_*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(T9,e,A9)}lookAt(e,t,i){const r=this.elements;return $i.subVectors(e,t),0===$i.lengthSq()&&($i.z=1),$i.normalize(),go.crossVectors(i,$i),0===go.lengthSq()&&(1===Math.abs(i.z)?$i.x+=1e-4:$i.z+=1e-4,$i.normalize(),go.crossVectors(i,$i)),go.normalize(),kp.crossVectors($i,go),r[0]=go.x,r[4]=kp.x,r[8]=$i.x,r[1]=go.y,r[5]=kp.y,r[9]=$i.y,r[2]=go.z,r[6]=kp.z,r[10]=$i.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],h=i[9],f=i[13],p=i[2],_=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],M=r[0],w=r[4],S=r[8],E=r[12],C=r[1],W=r[5],N=r[9],L=r[13],O=r[2],z=r[6],U=r[10],G=r[14],$=r[3],V=r[7],q=r[11],B=r[15];return s[0]=o*M+a*C+l*O+c*$,s[4]=o*w+a*W+l*z+c*V,s[8]=o*S+a*N+l*U+c*q,s[12]=o*E+a*L+l*G+c*B,s[1]=u*M+d*C+h*O+f*$,s[5]=u*w+d*W+h*z+f*V,s[9]=u*S+d*N+h*U+f*q,s[13]=u*E+d*L+h*G+f*B,s[2]=p*M+_*C+m*O+g*$,s[6]=p*w+_*W+m*z+g*V,s[10]=p*S+_*N+m*U+g*q,s[14]=p*E+_*L+m*G+g*B,s[3]=v*M+y*C+b*O+x*$,s[7]=v*w+y*W+b*z+x*V,s[11]=v*S+y*N+b*U+x*q,s[15]=v*E+y*L+b*G+x*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*l*d-r*c*d-s*a*h+i*c*h+r*a*f-i*l*f)+e[7]*(+t*l*f-t*c*h+s*o*h-r*o*f+r*c*u-s*l*u)+e[11]*(+t*c*d-t*a*f-s*o*d+i*o*f+s*a*u-i*c*u)+e[15]*(-r*a*u-t*l*d+t*a*h+r*o*d-i*o*h+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],_=e[13],m=e[14],g=e[15],v=d*m*c-_*h*c+_*l*f-a*m*f-d*l*g+a*h*g,y=p*h*c-u*m*c-p*l*f+o*m*f+u*l*g-o*h*g,b=u*_*c-p*d*c+p*a*f-o*_*f-u*a*g+o*d*g,x=p*d*l-u*_*l-p*a*h+o*_*h+u*a*m-o*d*m,M=t*v+i*y+r*b+s*x;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/M;return e[0]=v*w,e[1]=(_*h*s-d*m*s-_*r*f+i*m*f+d*r*g-i*h*g)*w,e[2]=(a*m*s-_*l*s+_*r*c-i*m*c-a*r*g+i*l*g)*w,e[3]=(d*l*s-a*h*s-d*r*c+i*h*c+a*r*f-i*l*f)*w,e[4]=y*w,e[5]=(u*m*s-p*h*s+p*r*f-t*m*f-u*r*g+t*h*g)*w,e[6]=(p*l*s-o*m*s-p*r*c+t*m*c+o*r*g-t*l*g)*w,e[7]=(o*h*s-u*l*s+u*r*c-t*h*c-o*r*f+t*l*f)*w,e[8]=b*w,e[9]=(p*d*s-u*_*s-p*i*f+t*_*f+u*i*g-t*d*g)*w,e[10]=(o*_*s-p*a*s+p*i*c-t*_*c-o*i*g+t*a*g)*w,e[11]=(u*a*s-o*d*s-u*i*c+t*d*c+o*i*f-t*a*f)*w,e[12]=x*w,e[13]=(u*_*r-p*d*r+p*i*h-t*_*h-u*i*m+t*d*m)*w,e[14]=(p*a*r-o*_*r-p*i*l+t*_*l+o*i*m-t*a*m)*w,e[15]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*h+t*a*h)*w,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,h=s*c,f=s*u,p=s*d,_=o*u,m=o*d,g=a*d,v=l*c,y=l*u,b=l*d,x=i.x,M=i.y,w=i.z;return r[0]=(1-(_+g))*x,r[1]=(f+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(f-b)*M,r[5]=(1-(h+g))*M,r[6]=(m+v)*M,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+_))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=ic.set(r[0],r[1],r[2]).length();const o=ic.set(r[4],r[5],r[6]).length(),a=ic.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Pr.copy(this);const c=1/s,u=1/o,d=1/a;return Pr.elements[0]*=c,Pr.elements[1]*=c,Pr.elements[2]*=c,Pr.elements[4]*=u,Pr.elements[5]*=u,Pr.elements[6]*=u,Pr.elements[8]*=d,Pr.elements[9]*=d,Pr.elements[10]*=d,t.setFromRotationMatrix(Pr),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Us){const l=this.elements,c=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),h=(i+r)/(i-r);let f,p;if(a===Us)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-o/(o-s),p=-o*s/(o-s)}return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Us){const l=this.elements,c=1/(t-e),u=1/(i-r),d=1/(o-s),h=(t+e)*c,f=(i+r)*u;let p,_;if(a===Us)p=(o+s)*d,_=-2*d;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=s*d,_=-1*d}return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-h,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const ic=new R,Pr=new tt,T9=new R(0,0,0),A9=new R(1,1,1),go=new R,kp=new R,$i=new R,WI=new tt,jI=new jn;let C9=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],d=s[9],h=s[2],f=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(ln(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ln(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(ln(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-ln(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(ln(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-ln(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return WI.makeRotationFromQuaternion(t),this.setFromRotationMatrix(WI,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return jI.setFromEuler(this),this.setFromQuaternion(jI,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class W0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let D9=0;const $I=new R,rc=new jn,Hs=new tt,Up=new R,Md=new R,I9=new R,R9=new jn,qI=new R(1,0,0),XI=new R(0,1,0),YI=new R(0,0,1),P9={type:"added"},KI={type:"removed"};let Nn=(()=>{class n extends sa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:D9++}),this.uuid=Wi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new R,i=new C9,r=new jn,s=new R(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new tt},normalMatrix:{value:new _t}}),this.matrix=new tt,this.matrixWorld=new tt,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new W0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return rc.setFromAxisAngle(t,i),this.quaternion.multiply(rc),this}rotateOnWorldAxis(t,i){return rc.setFromAxisAngle(t,i),this.quaternion.premultiply(rc),this}rotateX(t){return this.rotateOnAxis(qI,t)}rotateY(t){return this.rotateOnAxis(XI,t)}rotateZ(t){return this.rotateOnAxis(YI,t)}translateOnAxis(t,i){return $I.copy(t).applyQuaternion(this.quaternion),this.position.add($I.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(qI,t)}translateY(t){return this.translateOnAxis(XI,t)}translateZ(t){return this.translateOnAxis(YI,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Hs.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?Up.copy(t):Up.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Md.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Hs.lookAt(Md,Up,this.up):Hs.lookAt(Up,Md,this.up),this.quaternion.setFromRotationMatrix(Hs),s&&(Hs.extractRotation(s.matrixWorld),rc.setFromRotationMatrix(Hs),this.quaternion.premultiply(rc.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(P9)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(KI)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(KI)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Hs.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Hs.multiply(t.parent.matrixWorld)),t.applyMatrix4(Hs),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Md,t,I9),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Md,R9,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(l,c){return void 0===l[c.uuid]&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const c=l.shapes;if(Array.isArray(c))for(let u=0,d=c.length;u<d;u++)o(t.shapes,c[u]);else o(t.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(o(t.materials,this.material[c]));s.material=l}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++)s.animations.push(o(t.animations,this.animations[l]))}if(i){const l=a(t.geometries),c=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),p=a(t.animations),_=a(t.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),_.length>0&&(r.nodes=_)}return r.object=s,r;function a(l){const c=[];for(const u in l){const d=l[u];delete d.metadata,c.push(d)}return c}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new R(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const Fr=new R,Gs=new R,j0=new R,Ws=new R,sc=new R,oc=new R,ZI=new R,$0=new R,q0=new R,X0=new R;let Bp=!1;class qi{constructor(e=new R,t=new R,i=new R){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Fr.subVectors(e,t),r.cross(Fr);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Fr.subVectors(r,t),Gs.subVectors(i,t),j0.subVectors(e,t);const o=Fr.dot(Fr),a=Fr.dot(Gs),l=Fr.dot(j0),c=Gs.dot(Gs),u=Gs.dot(j0),d=o*c-a*a;if(0===d)return s.set(-2,-1,-1);const h=1/d,f=(c*l-a*u)*h,p=(o*u-a*l)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Ws),Ws.x>=0&&Ws.y>=0&&Ws.x+Ws.y<=1}static getUV(e,t,i,r,s,o,a,l){return!1===Bp&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Bp=!0),this.getInterpolation(e,t,i,r,s,o,a,l)}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Ws),l.setScalar(0),l.addScaledVector(s,Ws.x),l.addScaledVector(o,Ws.y),l.addScaledVector(a,Ws.z),l}static isFrontFacing(e,t,i,r){return Fr.subVectors(i,t),Gs.subVectors(e,t),Fr.cross(Gs).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fr.subVectors(this.c,this.b),Gs.subVectors(this.a,this.b),.5*Fr.cross(Gs).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return qi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return!1===Bp&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Bp=!0),qi.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}getInterpolation(e,t,i,r,s){return qi.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return qi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;sc.subVectors(r,i),oc.subVectors(s,i),$0.subVectors(e,i);const l=sc.dot($0),c=oc.dot($0);if(l<=0&&c<=0)return t.copy(i);q0.subVectors(e,r);const u=sc.dot(q0),d=oc.dot(q0);if(u>=0&&d<=u)return t.copy(r);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(sc,o);X0.subVectors(e,s);const f=sc.dot(X0),p=oc.dot(X0);if(p>=0&&f<=p)return t.copy(s);const _=f*c-l*p;if(_<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(i).addScaledVector(oc,a);const m=u*p-f*d;if(m<=0&&d-u>=0&&f-p>=0)return ZI.subVectors(s,r),a=(d-u)/(d-u+(f-p)),t.copy(r).addScaledVector(ZI,a);const g=1/(m+_+h);return o=_*g,a=h*g,t.copy(i).addScaledVector(sc,o).addScaledVector(oc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let F9=0;class Lr extends sa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:F9++}),this.uuid=Wi(),this.name="",this.type="Material",this.blending=Hl,this.side=ns,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=eI,this.blendDst=tI,this.blendEquation=Gl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=y0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Hl&&(i.blending=this.blending),this.side!==ns&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const QI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Or={h:0,s:0,l:0},Vp={h:0,s:0,l:0};function Y0(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class Ne{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=rt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ir.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ir.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ir.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ir.workingColorSpace){if(e=P0(e,1),t=ln(t,0,1),i=ln(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Y0(o,s,e+1/3),this.g=Y0(o,s,e),this.b=Y0(o,s,e-1/3)}return Ir.toWorkingColorSpace(this,r),this}setStyle(e,t=rt){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=rt){const i=QI[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Kl(e.r),this.g=Kl(e.g),this.b=Kl(e.b),this}copyLinearToSRGB(e){return this.r=O0(e.r),this.g=O0(e.g),this.b=O0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=rt){return Ir.fromWorkingColorSpace(ri.copy(this),e),65536*Math.round(ln(255*ri.r,0,255))+256*Math.round(ln(255*ri.g,0,255))+Math.round(ln(255*ri.b,0,255))}getHexString(e=rt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ir.workingColorSpace){Ir.fromWorkingColorSpace(ri.copy(this),t);const i=ri.r,r=ri.g,s=ri.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case i:l=(r-s)/d+(r<s?6:0);break;case r:l=(s-i)/d+2;break;case s:l=(i-r)/d+4}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Ir.workingColorSpace){return Ir.fromWorkingColorSpace(ri.copy(this),t),e.r=ri.r,e.g=ri.g,e.b=ri.b,e}getStyle(e=rt){Ir.fromWorkingColorSpace(ri.copy(this),e);const t=ri.r,i=ri.g,r=ri.b;return e!==rt?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(Or),Or.h+=e,Or.s+=t,Or.l+=i,this.setHSL(Or.h,Or.s,Or.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Or),e.getHSL(Vp);const i=gd(Or.h,Vp.h,t),r=gd(Or.s,Vp.s,t),s=gd(Or.l,Vp.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ri=new Ne;Ne.NAMES=QI;class pi extends Lr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ne(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Sp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const An=new R,zp=new ve;class cn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=ks,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)zp.fromBufferAttribute(this,t),zp.applyMatrix3(e),this.setXY(t,zp.x,zp.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyMatrix3(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyMatrix4(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyNormalMatrix(e),this.setXYZ(t,An.x,An.y,An.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.transformDirection(e),this.setXYZ(t,An.x,An.y,An.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ji(t,this.array)),t}setX(e,t){return this.normalized&&(t=gt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ji(t,this.array)),t}setY(e,t){return this.normalized&&(t=gt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ji(t,this.array)),t}setZ(e,t){return this.normalized&&(t=gt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ji(t,this.array)),t}setW(e,t){return this.normalized&&(t=gt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array),r=gt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array),r=gt(r,this.array),s=gt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class JI extends cn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class eR extends cn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class je extends cn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let O9=0;const hr=new tt,K0=new Nn,ac=new R,Xi=new Rr,wd=new Rr,kn=new R;class ut extends sa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:O9++}),this.uuid=Wi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(BI(e)?eR:JI)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new _t).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return hr.makeRotationFromQuaternion(e),this.applyMatrix4(hr),this}rotateX(e){return hr.makeRotationX(e),this.applyMatrix4(hr),this}rotateY(e){return hr.makeRotationY(e),this.applyMatrix4(hr),this}rotateZ(e){return hr.makeRotationZ(e),this.applyMatrix4(hr),this}translate(e,t,i){return hr.makeTranslation(e,t,i),this.applyMatrix4(hr),this}scale(e,t,i){return hr.makeScale(e,t,i),this.applyMatrix4(hr),this}lookAt(e){return K0.lookAt(e),K0.updateMatrix(),this.applyMatrix4(K0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ac).negate(),this.translate(ac.x,ac.y,ac.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new je(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Rr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new R(-1/0,-1/0,-1/0),new R(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)Xi.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,Xi.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,Xi.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(Xi.min),this.boundingBox.expandByPoint(Xi.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new R,1/0);if(e){const i=this.boundingSphere.center;if(Xi.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)wd.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(kn.addVectors(Xi.min,wd.min),Xi.expandByPoint(kn),kn.addVectors(Xi.max,wd.max),Xi.expandByPoint(kn)):(Xi.expandByPoint(wd.min),Xi.expandByPoint(wd.max));Xi.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)kn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(kn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)kn.fromBufferAttribute(a,c),l&&(ac.fromBufferAttribute(e,c),kn.add(ac)),r=Math.max(r,i.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new cn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<a;C++)c[C]=new R,u[C]=new R;const d=new R,h=new R,f=new R,p=new ve,_=new ve,m=new ve,g=new R,v=new R;function y(C,W,N){d.fromArray(r,3*C),h.fromArray(r,3*W),f.fromArray(r,3*N),p.fromArray(o,2*C),_.fromArray(o,2*W),m.fromArray(o,2*N),h.sub(d),f.sub(d),_.sub(p),m.sub(p);const L=1/(_.x*m.y-m.x*_.y);isFinite(L)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(f,-_.y).multiplyScalar(L),v.copy(f).multiplyScalar(_.x).addScaledVector(h,-m.x).multiplyScalar(L),c[C].add(g),c[W].add(g),c[N].add(g),u[C].add(v),u[W].add(v),u[N].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let C=0,W=b.length;C<W;++C){const N=b[C],L=N.start;for(let z=L,U=L+N.count;z<U;z+=3)y(i[z+0],i[z+1],i[z+2])}const x=new R,M=new R,w=new R,S=new R;function E(C){w.fromArray(s,3*C),S.copy(w);const W=c[C];x.copy(W),x.sub(w.multiplyScalar(w.dot(W))).normalize(),M.crossVectors(S,W);const L=M.dot(u[C])<0?-1:1;l[4*C]=x.x,l[4*C+1]=x.y,l[4*C+2]=x.z,l[4*C+3]=L}for(let C=0,W=b.length;C<W;++C){const N=b[C],L=N.start;for(let z=L,U=L+N.count;z<U;z+=3)E(i[z+0]),E(i[z+1]),E(i[z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new cn(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new R,s=new R,o=new R,a=new R,l=new R,c=new R,u=new R,d=new R;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),_=e.getX(h+1),m=e.getX(h+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,m),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,m),a.add(u),l.add(u),c.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)kn.fromBufferAttribute(e,t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let f=0,p=0;for(let _=0,m=l.length;_<m;_++){f=a.isInterleavedBufferAttribute?l[_]*a.data.stride+a.offset:l[_]*u;for(let g=0;g<u;g++)h[p++]=c[f++]}return new cn(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ut,i=this.index.array,r=this.attributes;for(const a in r){const c=e(r[a],i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const f=e(c[u],i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const c in l)void 0!==l[c]&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i)e.data.attributes[l]=i[l].toJSON(e.data);const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++)u.push(c[d].toJSON(e.data));u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r)this.setAttribute(c,r[c].clone(t));const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const tR=new tt,ua=new xd,Hp=new dr,nR=new R,lc=new R,cc=new R,uc=new R,Z0=new R,Gp=new R,Wp=new ve,jp=new ve,$p=new ve,iR=new R,rR=new R,sR=new R,qp=new R,Xp=new R;class yn extends Nn{constructor(e=new ut,t=new pi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){Gp.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l];0!==u&&(Z0.fromBufferAttribute(s[l],e),Gp.addScaledVector(o?Z0:Z0.sub(t),u))}t.add(Gp)}return t}raycast(e,t){const i=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),Hp.copy(i.boundingSphere),Hp.applyMatrix4(s),ua.copy(e.ray).recast(e.near),(!1!==Hp.containsPoint(ua.origin)||!(null===ua.intersectSphere(Hp,nR)||ua.origin.distanceToSquared(nR)>(e.far-e.near)**2))&&(tR.copy(s).invert(),ua.copy(e.ray).applyMatrix4(tR),(null===i.boundingBox||!1!==ua.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,ua)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let p=0,_=h.length;p<_;p++){const m=h[p],g=o[m.materialIndex];for(let b=Math.max(m.start,f.start),x=Math.min(a.count,Math.min(m.start+m.count,f.start+f.count));b<x;b+=3)r=Yp(this,g,e,i,c,u,d,a.getX(b),a.getX(b+1),a.getX(b+2)),r&&(r.faceIndex=Math.floor(b/3),r.face.materialIndex=m.materialIndex,t.push(r))}else for(let m=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);m<g;m+=3)r=Yp(this,o,e,i,c,u,d,a.getX(m),a.getX(m+1),a.getX(m+2)),r&&(r.faceIndex=Math.floor(m/3),t.push(r));else if(void 0!==l)if(Array.isArray(o))for(let p=0,_=h.length;p<_;p++){const m=h[p],g=o[m.materialIndex];for(let b=Math.max(m.start,f.start),x=Math.min(l.count,Math.min(m.start+m.count,f.start+f.count));b<x;b+=3)r=Yp(this,g,e,i,c,u,d,b,b+1,b+2),r&&(r.faceIndex=Math.floor(b/3),r.face.materialIndex=m.materialIndex,t.push(r))}else for(let m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);m<g;m+=3)r=Yp(this,o,e,i,c,u,d,m,m+1,m+2),r&&(r.faceIndex=Math.floor(m/3),t.push(r))}}function Yp(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,lc),n.getVertexPosition(l,cc),n.getVertexPosition(c,uc);const u=function N9(n,e,t,i,r,s,o,a){let l;if(l=e.side===ti?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side===ns,a),null===l)return null;Xp.copy(a),Xp.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Xp);return c<t.near||c>t.far?null:{distance:c,point:Xp.clone(),object:n}}(n,e,t,i,lc,cc,uc,qp);if(u){r&&(Wp.fromBufferAttribute(r,a),jp.fromBufferAttribute(r,l),$p.fromBufferAttribute(r,c),u.uv=qi.getInterpolation(qp,lc,cc,uc,Wp,jp,$p,new ve)),s&&(Wp.fromBufferAttribute(s,a),jp.fromBufferAttribute(s,l),$p.fromBufferAttribute(s,c),u.uv1=qi.getInterpolation(qp,lc,cc,uc,Wp,jp,$p,new ve),u.uv2=u.uv1),o&&(iR.fromBufferAttribute(o,a),rR.fromBufferAttribute(o,l),sR.fromBufferAttribute(o,c),u.normal=qi.getInterpolation(qp,lc,cc,uc,iR,rR,sR,new R),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new R,materialIndex:0};qi.getNormal(lc,cc,uc,d.normal),u.face=d}return u}class dc extends ut{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let h=0,f=0;function p(_,m,g,v,y,b,x,M,w,S,E){const C=b/w,W=x/S,N=b/2,L=x/2,O=M/2,z=w+1,U=S+1;let G=0,$=0;const V=new R;for(let q=0;q<U;q++){const B=q*W-L;for(let k=0;k<z;k++)V[_]=(k*C-N)*v,V[m]=B*y,V[g]=O,c.push(V.x,V.y,V.z),V[_]=0,V[m]=0,V[g]=M>0?1:-1,u.push(V.x,V.y,V.z),d.push(k/w),d.push(1-q/S),G+=1}for(let q=0;q<S;q++)for(let B=0;B<w;B++){const X=h+B+z*(q+1),j=h+(B+1)+z*(q+1),Q=h+(B+1)+z*q;l.push(h+B+z*q,X,Q),l.push(X,j,Q),$+=6}a.addGroup(f,$,E),f+=$,h+=G}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new je(c,3)),this.setAttribute("normal",new je(u,3)),this.setAttribute("uv",new je(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function hc(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function mi(n){const e={};for(let t=0;t<n.length;t++){const i=hc(n[t]);for(const r in i)e[r]=i[r]}return e}function oR(n){return null===n.getRenderTarget()?n.outputColorSpace:is}const aR={clone:hc,merge:mi};class _o extends Lr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=hc(e.uniforms),this.uniformsGroups=function k9(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Q0 extends Nn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new tt,this.projectionMatrix=new tt,this.projectionMatrixInverse=new tt,this.coordinateSystem=Us}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Un extends Q0{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Xl*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*oa*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Xl*Math.atan(Math.tan(.5*oa*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*oa*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class V9 extends Nn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const r=new Un(-90,1,e,t);r.layers=this.layers,this.add(r);const s=new Un(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Un(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Un(-90,1,e,t);a.layers=this.layers,this.add(a);const l=new Un(-90,1,e,t);l.layers=this.layers,this.add(l);const c=new Un(-90,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Us)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,h=e.xr.enabled;e.toneMapping=Os,e.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}}class Kp extends ur{constructor(e,t,i,r,s,o,a,l,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:Zo,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class z9 extends aa{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];void 0!==t.encoding&&(yd("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===na?rt:ra),this.texture=new Kp(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Jt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new dc(5,5,5),s=new _o({name:"CubemapFromEquirect",uniforms:hc(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:ti,blending:co});s.uniforms.tEquirect.value=t;const o=new yn(r,s),a=t.minFilter;return t.minFilter===Ns&&(t.minFilter=Jt),new V9(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const J0=new R,H9=new R,G9=new _t;class da{constructor(e=new R(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=J0.subVectors(i,t).cross(H9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(J0),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||G9.getNormalMatrix(e),r=this.coplanarPoint(J0).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ha=new dr,Zp=new R;class eb{constructor(e=new da,t=new da,i=new da,r=new da,s=new da,o=new da){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Us){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],f=r[8],p=r[9],_=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15];if(i[0].setComponents(l-s,h-c,m-f,b-g).normalize(),i[1].setComponents(l+s,h+c,m+f,b+g).normalize(),i[2].setComponents(l+o,h+u,m+p,b+v).normalize(),i[3].setComponents(l-o,h-u,m-p,b-v).normalize(),i[4].setComponents(l-a,h-d,m-_,b-y).normalize(),t===Us)i[5].setComponents(l+a,h+d,m+_,b+y).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(a,d,_,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),ha.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),ha.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ha)}intersectsSprite(e){return ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(e.matrixWorld),this.intersectsSphere(ha)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Zp.x=r.normal.x>0?e.max.x:e.min.x,Zp.y=r.normal.y>0?e.max.y:e.min.y,Zp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Zp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function lR(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function W9(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u&&(n.deleteBuffer(u.buffer),i.delete(c))},update:function l(c,u){if(c.isGLBufferAttribute){const h=i.get(c);return void((!h||h.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);void 0===d?i.set(c,function r(c,u){const d=c.array,h=c.usage,f=n.createBuffer();let p;if(n.bindBuffer(u,f),n.bufferData(u,d,h),c.onUploadCallback(),d instanceof Float32Array)p=n.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=n.HALF_FLOAT}else p=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)p=n.SHORT;else if(d instanceof Uint32Array)p=n.UNSIGNED_INT;else if(d instanceof Int32Array)p=n.INT;else if(d instanceof Int8Array)p=n.BYTE;else if(d instanceof Uint8Array)p=n.UNSIGNED_BYTE;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);p=n.UNSIGNED_BYTE}return{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}(c,u)):d.version<c.version&&(function s(c,u,d){const h=u.array,f=u.updateRange;n.bindBuffer(d,c),-1===f.count?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}(d.buffer,c,u),d.version=c.version)}}}class fa extends ut{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],_=[],m=[];for(let g=0;g<u;g++){const v=g*h-o;for(let y=0;y<c;y++)p.push(y*d-s,-v,0),_.push(0,0,1),m.push(y/a),m.push(1-g/l)}for(let g=0;g<l;g++)for(let v=0;v<a;v++){const b=v+c*(g+1),x=v+1+c*(g+1),M=v+1+c*g;f.push(v+c*g,b,M),f.push(b,x,M)}this.setIndex(f),this.setAttribute("position",new je(p,3)),this.setAttribute("normal",new je(_,3)),this.setAttribute("uv",new je(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fa(e.width,e.height,e.widthSegments,e.heightSegments)}}const yt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ke={common:{diffuse:{value:new Ne(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new _t},alphaMap:{value:null},alphaMapTransform:{value:new _t},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new _t}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new _t}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new _t}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new _t},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new _t},normalScale:{value:new ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new _t},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new _t}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new _t}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new _t}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ne(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ne(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new _t},alphaTest:{value:0},uvTransform:{value:new _t}},sprite:{diffuse:{value:new Ne(16777215)},opacity:{value:1},center:{value:new ve(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new _t},alphaMap:{value:null},alphaMapTransform:{value:new _t},alphaTest:{value:0}}},rs={basic:{uniforms:mi([ke.common,ke.specularmap,ke.envmap,ke.aomap,ke.lightmap,ke.fog]),vertexShader:yt.meshbasic_vert,fragmentShader:yt.meshbasic_frag},lambert:{uniforms:mi([ke.common,ke.specularmap,ke.envmap,ke.aomap,ke.lightmap,ke.emissivemap,ke.bumpmap,ke.normalmap,ke.displacementmap,ke.fog,ke.lights,{emissive:{value:new Ne(0)}}]),vertexShader:yt.meshlambert_vert,fragmentShader:yt.meshlambert_frag},phong:{uniforms:mi([ke.common,ke.specularmap,ke.envmap,ke.aomap,ke.lightmap,ke.emissivemap,ke.bumpmap,ke.normalmap,ke.displacementmap,ke.fog,ke.lights,{emissive:{value:new Ne(0)},specular:{value:new Ne(1118481)},shininess:{value:30}}]),vertexShader:yt.meshphong_vert,fragmentShader:yt.meshphong_frag},standard:{uniforms:mi([ke.common,ke.envmap,ke.aomap,ke.lightmap,ke.emissivemap,ke.bumpmap,ke.normalmap,ke.displacementmap,ke.roughnessmap,ke.metalnessmap,ke.fog,ke.lights,{emissive:{value:new Ne(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag},toon:{uniforms:mi([ke.common,ke.aomap,ke.lightmap,ke.emissivemap,ke.bumpmap,ke.normalmap,ke.displacementmap,ke.gradientmap,ke.fog,ke.lights,{emissive:{value:new Ne(0)}}]),vertexShader:yt.meshtoon_vert,fragmentShader:yt.meshtoon_frag},matcap:{uniforms:mi([ke.common,ke.bumpmap,ke.normalmap,ke.displacementmap,ke.fog,{matcap:{value:null}}]),vertexShader:yt.meshmatcap_vert,fragmentShader:yt.meshmatcap_frag},points:{uniforms:mi([ke.points,ke.fog]),vertexShader:yt.points_vert,fragmentShader:yt.points_frag},dashed:{uniforms:mi([ke.common,ke.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yt.linedashed_vert,fragmentShader:yt.linedashed_frag},depth:{uniforms:mi([ke.common,ke.displacementmap]),vertexShader:yt.depth_vert,fragmentShader:yt.depth_frag},normal:{uniforms:mi([ke.common,ke.bumpmap,ke.normalmap,ke.displacementmap,{opacity:{value:1}}]),vertexShader:yt.meshnormal_vert,fragmentShader:yt.meshnormal_frag},sprite:{uniforms:mi([ke.sprite,ke.fog]),vertexShader:yt.sprite_vert,fragmentShader:yt.sprite_frag},background:{uniforms:{uvTransform:{value:new _t},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yt.background_vert,fragmentShader:yt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:yt.backgroundCube_vert,fragmentShader:yt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yt.cube_vert,fragmentShader:yt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yt.equirect_vert,fragmentShader:yt.equirect_frag},distanceRGBA:{uniforms:mi([ke.common,ke.displacementmap,{referencePosition:{value:new R},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yt.distanceRGBA_vert,fragmentShader:yt.distanceRGBA_frag},shadow:{uniforms:mi([ke.lights,ke.fog,{color:{value:new Ne(0)},opacity:{value:1}}]),vertexShader:yt.shadow_vert,fragmentShader:yt.shadow_frag}};rs.physical={uniforms:mi([rs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new _t},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new _t},clearcoatNormalScale:{value:new ve(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new _t},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new _t},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new _t},sheen:{value:0},sheenColor:{value:new Ne(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new _t},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new _t},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new _t},transmissionSamplerSize:{value:new ve},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new _t},attenuationDistance:{value:0},attenuationColor:{value:new Ne(0)},specularColor:{value:new Ne(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new _t},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new _t},anisotropyVector:{value:new ve},anisotropyMap:{value:null},anisotropyMapTransform:{value:new _t}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag};const Qp={r:0,b:0,g:0};function V7(n,e,t,i,r,s,o){const a=new Ne(0);let c,u,l=!0===s?0:1,d=null,h=0,f=null;function _(m,g){m.getRGB(Qp,oR(n)),i.buffers.color.setClear(Qp.r,Qp.g,Qp.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(m,g=1){a.set(m),l=g,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,_(a,l)},render:function p(m,g){let v=!1,y=!0===g.isScene?g.background:null;switch(y&&y.isTexture&&(y=(g.backgroundBlurriness>0?t:e).get(y)),null===y?_(a,l):y&&y.isColor&&(_(y,1),v=!0),n.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,o),v=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,o),v=!0}(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||y.mapping===dd)?(void 0===u&&(u=new yn(new dc(1,1,1),new _o({name:"BackgroundCubeMaterial",uniforms:hc(rs.backgroundCube.uniforms),vertexShader:rs.backgroundCube.vertexShader,fragmentShader:rs.backgroundCube.fragmentShader,side:ti,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,w,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=y,u.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=y.colorSpace!==rt,(d!==y||h!==y.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=y,h=y.version,f=n.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):y&&y.isTexture&&(void 0===c&&(c=new yn(new fa(2,2),new _o({name:"BackgroundMaterial",uniforms:hc(rs.background.uniforms),vertexShader:rs.background.vertexShader,fragmentShader:rs.background.fragmentShader,side:ns,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=y,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=y.colorSpace!==rt,!0===y.matrixAutoUpdate&&y.updateMatrix(),c.material.uniforms.uvTransform.value.copy(y.matrix),(d!==y||h!==y.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,d=y,h=y.version,f=n.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}}}function z7(n,e,t,i){const r=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=m(null);let c=l,u=!1;function f(O){return i.isWebGL2?n.bindVertexArray(O):s.bindVertexArrayOES(O)}function p(O){return i.isWebGL2?n.deleteVertexArray(O):s.deleteVertexArrayOES(O)}function m(O){const z=[],U=[],G=[];for(let $=0;$<r;$++)z[$]=0,U[$]=0,G[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:U,attributeDivisors:G,object:O,attributes:{},index:null}}function y(){const O=c.newAttributes;for(let z=0,U=O.length;z<U;z++)O[z]=0}function b(O){x(O,0)}function x(O,z){const G=c.enabledAttributes,$=c.attributeDivisors;c.newAttributes[O]=1,0===G[O]&&(n.enableVertexAttribArray(O),G[O]=1),$[O]!==z&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,z),$[O]=z)}function M(){const O=c.newAttributes,z=c.enabledAttributes;for(let U=0,G=z.length;U<G;U++)z[U]!==O[U]&&(n.disableVertexAttribArray(U),z[U]=0)}function w(O,z,U,G,$,V,q){!0===q?n.vertexAttribIPointer(O,z,U,$,V):n.vertexAttribPointer(O,z,U,G,$,V)}function N(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function d(O,z,U,G,$){let V=!1;if(o){const q=function _(O,z,U){const G=!0===U.wireframe;let $=a[O.id];void 0===$&&($={},a[O.id]=$);let V=$[z.id];void 0===V&&(V={},$[z.id]=V);let q=V[G];return void 0===q&&(q=m(function h(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),V[G]=q),q}(G,U,z);c!==q&&(c=q,f(c.object)),V=function g(O,z,U,G){const $=c.attributes,V=z.attributes;let q=0;const B=U.getAttributes();for(const k in B)if(B[k].location>=0){const j=$[k];let Q=V[k];if(void 0===Q&&("instanceMatrix"===k&&O.instanceMatrix&&(Q=O.instanceMatrix),"instanceColor"===k&&O.instanceColor&&(Q=O.instanceColor)),void 0===j||j.attribute!==Q||Q&&j.data!==Q.data)return!0;q++}return c.attributesNum!==q||c.index!==G}(O,G,U,$),V&&function v(O,z,U,G){const $={},V=z.attributes;let q=0;const B=U.getAttributes();for(const k in B)if(B[k].location>=0){let j=V[k];void 0===j&&("instanceMatrix"===k&&O.instanceMatrix&&(j=O.instanceMatrix),"instanceColor"===k&&O.instanceColor&&(j=O.instanceColor));const Q={};Q.attribute=j,j&&j.data&&(Q.data=j.data),$[k]=Q,q++}c.attributes=$,c.attributesNum=q,c.index=G}(O,G,U,$)}else{const q=!0===z.wireframe;(c.geometry!==G.id||c.program!==U.id||c.wireframe!==q)&&(c.geometry=G.id,c.program=U.id,c.wireframe=q,V=!0)}null!==$&&t.update($,n.ELEMENT_ARRAY_BUFFER),(V||u)&&(u=!1,function S(O,z,U,G){if(!1===i.isWebGL2&&(O.isInstancedMesh||G.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;y();const $=G.attributes,V=U.getAttributes(),q=z.defaultAttributeValues;for(const B in V){const k=V[B];if(k.location>=0){let X=$[B];if(void 0===X&&("instanceMatrix"===B&&O.instanceMatrix&&(X=O.instanceMatrix),"instanceColor"===B&&O.instanceColor&&(X=O.instanceColor)),void 0!==X){const j=X.normalized,Q=X.itemSize,te=t.get(X);if(void 0===te)continue;const K=te.buffer,ae=te.type,ue=te.bytesPerElement,Ce=!0===i.isWebGL2&&(ae===n.INT||ae===n.UNSIGNED_INT||X.gpuType===nI);if(X.isInterleavedBufferAttribute){const he=X.data,D=he.stride,ye=X.offset;if(he.isInstancedInterleavedBuffer){for(let re=0;re<k.locationSize;re++)x(k.location+re,he.meshPerAttribute);!0!==O.isInstancedMesh&&void 0===G._maxInstanceCount&&(G._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let re=0;re<k.locationSize;re++)b(k.location+re);n.bindBuffer(n.ARRAY_BUFFER,K);for(let re=0;re<k.locationSize;re++)w(k.location+re,Q/k.locationSize,ae,j,D*ue,(ye+Q/k.locationSize*re)*ue,Ce)}else{if(X.isInstancedBufferAttribute){for(let he=0;he<k.locationSize;he++)x(k.location+he,X.meshPerAttribute);!0!==O.isInstancedMesh&&void 0===G._maxInstanceCount&&(G._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let he=0;he<k.locationSize;he++)b(k.location+he);n.bindBuffer(n.ARRAY_BUFFER,K);for(let he=0;he<k.locationSize;he++)w(k.location+he,Q/k.locationSize,ae,j,Q*ue,Q/k.locationSize*he*ue,Ce)}}else if(void 0!==q){const j=q[B];if(void 0!==j)switch(j.length){case 2:n.vertexAttrib2fv(k.location,j);break;case 3:n.vertexAttrib3fv(k.location,j);break;case 4:n.vertexAttrib4fv(k.location,j);break;default:n.vertexAttrib1fv(k.location,j)}}}}M()}(O,z,U,G),null!==$&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get($).buffer))},reset:N,resetDefaultState:L,dispose:function E(){N();for(const O in a){const z=a[O];for(const U in z){const G=z[U];for(const $ in G)p(G[$].object),delete G[$];delete z[U]}delete a[O]}},releaseStatesOfGeometry:function C(O){if(void 0===a[O.id])return;const z=a[O.id];for(const U in z){const G=z[U];for(const $ in G)p(G[$].object),delete G[$];delete z[U]}delete a[O.id]},releaseStatesOfProgram:function W(O){for(const z in a){const U=a[z];if(void 0===U[O.id])continue;const G=U[O.id];for(const $ in G)p(G[$].object),delete G[$];delete U[O.id]}},initAttributes:y,enableAttribute:b,disableUnusedAttributes:M}}function H7(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function o(c){s=c},this.render=function a(c,u){n.drawArrays(s,c,u),t.update(u,s,1)},this.renderInstances=function l(c,u,d){if(0===d)return;let h,f;if(r)h=n,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===h)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](s,c,u,d),t.update(u,s,d)}}function G7(n,e,t){let i;function s(w){if("highp"===w){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return"mediump"===w&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&"WebGL2RenderingContext"===n.constructor.name;let a=void 0!==t.precision?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),h=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_TEXTURE_SIZE),p=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),_=n.getParameter(n.MAX_VERTEX_ATTRIBS),m=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),g=n.getParameter(n.MAX_VARYING_VECTORS),v=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),y=h>0,b=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const w=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:_,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function W7(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new da,a=new _t,l={value:null,needsUpdate:!1};function u(d,h,f,p){const _=null!==d?d.length:0;let m=null;if(0!==_){if(m=l.value,!0!==p||null===m){const g=f+4*_,v=h.matrixWorldInverse;a.getNormalMatrix(v),(null===m||m.length<g)&&(m=new Float32Array(g));for(let y=0,b=f;y!==_;++y,b+=4)o.copy(d[y]).applyMatrix4(v,a),o.normal.toArray(m,b),m[b+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,m}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=0!==d.length||h||0!==i||r;return r=h,i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,_=d.clipIntersection,m=d.clipShadows,g=n.get(d);if(!r||null===p||0===p.length||s&&!m)s?u(null):function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const v=s?0:i,y=4*v;let b=g.clippingState||null;l.value=b,b=u(p,h,y,f);for(let x=0;x!==y;++x)b[x]=t[x];g.clippingState=b,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=v}}}function j7(n){let e=new WeakMap;function t(o,a){return a===Tp?o.mapping=Zo:a===Ap&&(o.mapping=Qo),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);void 0!==l&&(e.delete(a),l.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(a===Tp||a===Ap){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const c=new z9(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class Jp extends Q0{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(null!==this.view&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const cR=[.125,.215,.35,.446,.526,.582],tb=new Jp,uR=new Ne;let nb=null;const ma=(1+Math.sqrt(5))/2,gc=1/ma,dR=[new R(1,1,1),new R(-1,1,1),new R(1,1,-1),new R(-1,1,-1),new R(0,ma,gc),new R(0,ma,-gc),new R(gc,0,ma),new R(-gc,0,ma),new R(ma,gc,0),new R(-ma,gc,0)];class hR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){nb=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=mR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=pR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(nb),e.scissorTest=!1,em(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Zo||e.mapping===Qo?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),nb=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Jt,minFilter:Jt,generateMipmaps:!1,type:pd,format:cr,colorSpace:is,depthBuffer:!1},r=fR(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=fR(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function $7(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+cR.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-4?l=cR[o-n+4-1]:0===o&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,_=3,m=2,g=1,v=new Float32Array(_*p*f),y=new Float32Array(m*p*f),b=new Float32Array(g*p*f);for(let M=0;M<f;M++){const w=M%3*2/3-1,S=M>2?0:-1;v.set([w,S,0,w+2/3,S,0,w+2/3,S+1,0,w,S,0,w+2/3,S+1,0,w,S+1,0],_*p*M),y.set(h,m*p*M),b.set([M,M,M,M,M,M],g*p*M)}const x=new ut;x.setAttribute("position",new cn(v,_)),x.setAttribute("uv",new cn(y,m)),x.setAttribute("faceIndex",new cn(b,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function q7(n,e,t){const i=new Float32Array(20),r=new R(0,1,0);return new _o({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:co,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new yn(this._lodPlanes[0],e);this._renderer.compile(t,tb)}_sceneToCubeUV(e,t,i,r){const a=new Un(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(uR),u.toneMapping=Os,u.autoClear=!1;const f=new pi({name:"PMREM.Background",side:ti,depthWrite:!1,depthTest:!1}),p=new yn(new dc,f);let _=!1;const m=e.background;m?m.isColor&&(f.color.copy(m),e.background=null,_=!0):(f.color.copy(uR),_=!0);for(let g=0;g<6;g++){const v=g%3;0===v?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):1===v?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const y=this._cubeSize;em(r,v*y,g>2?y:0,y,y),u.setRenderTarget(r),_&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=m}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Zo||e.mapping===Qo;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=mR()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=pR());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new yn(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const l=this._cubeSize;em(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,tb)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,dR[(r-1)%dR.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new yn(this._lodPlanes[r],c),h=c.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,_=s/p,m=isFinite(s)?1+Math.floor(3*_):20;m>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const g=[];let v=0;for(let w=0;w<20;++w){const S=w/_,E=Math.exp(-S*S/2);g.push(E),0===w?v+=E:w<m&&(v+=2*E)}for(let w=0;w<g.length;w++)g[w]=g[w]/v;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=g,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:y}=this;h.dTheta.value=p,h.mipInt.value=y-i;const b=this._sizeLods[r];em(t,3*b*(r>y-4?r-y+4:0),4*(this._cubeSize-b),3*b,2*b),l.setRenderTarget(t),l.render(d,tb)}}function fR(n,e,t){const i=new aa(n,e,t);return i.texture.mapping=dd,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function em(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function pR(){return new _o({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:co,depthTest:!1,depthWrite:!1})}function mR(){return new _o({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:co,depthTest:!1,depthWrite:!1})}function X7(n){let e=new WeakMap,t=null;function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);void 0!==c&&(e.delete(l),c.dispose())}return{get:function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Tp||l===Ap,u=l===Zo||l===Qo;if(c||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new hR(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&function r(a){let l=0;for(let u=0;u<6;u++)void 0!==a[u]&&l++;return 6===l}(d)){null===t&&(t=new hR(n));const h=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",s),h.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Y7(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function K7(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);for(const p in h.morphAttributes){const _=h.morphAttributes[p];for(let m=0,g=_.length;m<g;m++)e.remove(_[m])}h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function c(d){const h=[],f=d.index,p=d.attributes.position;let _=0;if(null!==f){const v=f.array;_=f.version;for(let y=0,b=v.length;y<b;y+=3){const x=v[y+0],M=v[y+1],w=v[y+2];h.push(x,M,M,w,w,x)}}else{_=p.version;for(let y=0,b=p.array.length/3-1;y<b;y+=3){const x=y+0,M=y+1,w=y+2;h.push(x,M,M,w,w,x)}}const m=new(BI(h)?eR:JI)(h,1);m.version=_;const g=s.get(d);g&&e.remove(g),s.set(d,m)}return{get:function a(d,h){return!0===r[h.id]||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h},update:function l(d){const h=d.attributes;for(const p in h)e.update(h[p],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const p in f){const _=f[p];for(let m=0,g=_.length;m<g;m++)e.update(_[m],n.ARRAY_BUFFER)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&c(d)}else c(d);return s.get(d)}}}function Z7(n,e,t,i){const r=i.isWebGL2;let s,a,l;this.setMode=function o(h){s=h},this.setIndex=function c(h){a=h.type,l=h.bytesPerElement},this.render=function u(h,f){n.drawElements(s,f,a,h*l),t.update(f,s,1)},this.renderInstances=function d(h,f,p){if(0===p)return;let _,m;if(r)_=n,m="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",null===_)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");_[m](s,f,a,h*l,p),t.update(f,s,p)}}function Q7(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function J7(n,e){return n[0]-e[0]}function eq(n,e){return Math.abs(e[1])-Math.abs(n[1])}function tq(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new Lt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,u,d){const h=c.morphTargetInfluences;if(!0===e.isWebGL2){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==f?f.length:0;let _=s.get(u);if(void 0===_||_.count!==p){let O=function(){N.dispose(),s.delete(u),u.removeEventListener("dispose",O)};void 0!==_&&_.texture.dispose();const v=void 0!==u.morphAttributes.position,y=void 0!==u.morphAttributes.normal,b=void 0!==u.morphAttributes.color,x=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],w=u.morphAttributes.color||[];let S=0;!0===v&&(S=1),!0===y&&(S=2),!0===b&&(S=3);let E=u.attributes.position.count*S,C=1;E>e.maxTextureSize&&(C=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const W=new Float32Array(E*C*4*p),N=new k0(W,E,C,p);N.type=ks,N.needsUpdate=!0;const L=4*S;for(let z=0;z<p;z++){const U=x[z],G=M[z],$=w[z],V=E*C*4*z;for(let q=0;q<U.count;q++){const B=q*L;!0===v&&(o.fromBufferAttribute(U,q),W[V+B+0]=o.x,W[V+B+1]=o.y,W[V+B+2]=o.z,W[V+B+3]=0),!0===y&&(o.fromBufferAttribute(G,q),W[V+B+4]=o.x,W[V+B+5]=o.y,W[V+B+6]=o.z,W[V+B+7]=0),!0===b&&(o.fromBufferAttribute($,q),W[V+B+8]=o.x,W[V+B+9]=o.y,W[V+B+10]=o.z,W[V+B+11]=4===$.itemSize?o.w:1)}}_={count:p,texture:N,size:new ve(E,C)},s.set(u,_),u.addEventListener("dispose",O)}let m=0;for(let v=0;v<h.length;v++)m+=h[v];const g=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(n,"morphTargetBaseInfluence",g),d.getUniforms().setValue(n,"morphTargetInfluences",h),d.getUniforms().setValue(n,"morphTargetsTexture",_.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",_.size)}else{const f=void 0===h?0:h.length;let p=i[u.id];if(void 0===p||p.length!==f){p=[];for(let y=0;y<f;y++)p[y]=[y,0];i[u.id]=p}for(let y=0;y<f;y++){const b=p[y];b[0]=y,b[1]=h[y]}p.sort(eq);for(let y=0;y<8;y++)y<f&&p[y][1]?(a[y][0]=p[y][0],a[y][1]=p[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(J7);const _=u.morphAttributes.position,m=u.morphAttributes.normal;let g=0;for(let y=0;y<8;y++){const b=a[y],x=b[0],M=b[1];x!==Number.MAX_SAFE_INTEGER&&M?(_&&u.getAttribute("morphTarget"+y)!==_[x]&&u.setAttribute("morphTarget"+y,_[x]),m&&u.getAttribute("morphNormal"+y)!==m[x]&&u.setAttribute("morphNormal"+y,m[x]),r[y]=M,g+=M):(_&&!0===u.hasAttribute("morphTarget"+y)&&u.deleteAttribute("morphTarget"+y),m&&!0===u.hasAttribute("morphNormal"+y)&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const v=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(n,"morphTargetBaseInfluence",v),d.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function nq(n,e,t,i){let r=new WeakMap;function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),null!==c.instanceColor&&t.remove(c.instanceColor)}return{update:function s(l){const c=i.render.frame,d=e.get(l,l.geometry);return r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,n.ARRAY_BUFFER),null!==l.instanceColor&&t.update(l.instanceColor,n.ARRAY_BUFFER)),d},dispose:function o(){r=new WeakMap}}}const gR=new ur,_R=new k0,yR=new HI,vR=new Kp,bR=[],xR=[],MR=new Float32Array(16),ER=new Float32Array(9),wR=new Float32Array(4);function _c(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=bR[r];if(void 0===s&&(s=new Float32Array(r),bR[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Pn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Fn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function tm(n,e){let t=xR[e];void 0===t&&(t=new Int32Array(e),xR[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function iq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function rq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Pn(t,e))return;n.uniform2fv(this.addr,e),Fn(t,e)}}function sq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Pn(t,e))return;n.uniform3fv(this.addr,e),Fn(t,e)}}function oq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Pn(t,e))return;n.uniform4fv(this.addr,e),Fn(t,e)}}function aq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Pn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Fn(t,e)}else{if(Pn(t,i))return;wR.set(i),n.uniformMatrix2fv(this.addr,!1,wR),Fn(t,i)}}function lq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Pn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Fn(t,e)}else{if(Pn(t,i))return;ER.set(i),n.uniformMatrix3fv(this.addr,!1,ER),Fn(t,i)}}function cq(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Pn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Fn(t,e)}else{if(Pn(t,i))return;MR.set(i),n.uniformMatrix4fv(this.addr,!1,MR),Fn(t,i)}}function uq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function dq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Pn(t,e))return;n.uniform2iv(this.addr,e),Fn(t,e)}}function hq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Pn(t,e))return;n.uniform3iv(this.addr,e),Fn(t,e)}}function fq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Pn(t,e))return;n.uniform4iv(this.addr,e),Fn(t,e)}}function pq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function mq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Pn(t,e))return;n.uniform2uiv(this.addr,e),Fn(t,e)}}function gq(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Pn(t,e))return;n.uniform3uiv(this.addr,e),Fn(t,e)}}function _q(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Pn(t,e))return;n.uniform4uiv(this.addr,e),Fn(t,e)}}function yq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||gR,r)}function vq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||yR,r)}function bq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||vR,r)}function xq(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||_R,r)}function Eq(n,e){n.uniform1fv(this.addr,e)}function wq(n,e){const t=_c(e,this.size,2);n.uniform2fv(this.addr,t)}function Sq(n,e){const t=_c(e,this.size,3);n.uniform3fv(this.addr,t)}function Tq(n,e){const t=_c(e,this.size,4);n.uniform4fv(this.addr,t)}function Aq(n,e){const t=_c(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Cq(n,e){const t=_c(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Dq(n,e){const t=_c(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Iq(n,e){n.uniform1iv(this.addr,e)}function Rq(n,e){n.uniform2iv(this.addr,e)}function Pq(n,e){n.uniform3iv(this.addr,e)}function Fq(n,e){n.uniform4iv(this.addr,e)}function Lq(n,e){n.uniform1uiv(this.addr,e)}function Oq(n,e){n.uniform2uiv(this.addr,e)}function Nq(n,e){n.uniform3uiv(this.addr,e)}function kq(n,e){n.uniform4uiv(this.addr,e)}function Uq(n,e,t){const i=this.cache,r=e.length,s=tm(t,r);Pn(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||gR,s[o])}function Bq(n,e,t){const i=this.cache,r=e.length,s=tm(t,r);Pn(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||yR,s[o])}function Vq(n,e,t){const i=this.cache,r=e.length,s=tm(t,r);Pn(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||vR,s[o])}function zq(n,e,t){const i=this.cache,r=e.length,s=tm(t,r);Pn(i,s)||(n.uniform1iv(this.addr,s),Fn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||_R,s[o])}class Gq{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function Mq(n){switch(n){case 5126:return iq;case 35664:return rq;case 35665:return sq;case 35666:return oq;case 35674:return aq;case 35675:return lq;case 35676:return cq;case 5124:case 35670:return uq;case 35667:case 35671:return dq;case 35668:case 35672:return hq;case 35669:case 35673:return fq;case 5125:return pq;case 36294:return mq;case 36295:return gq;case 36296:return _q;case 35678:case 36198:case 36298:case 36306:case 35682:return yq;case 35679:case 36299:case 36307:return vq;case 35680:case 36300:case 36308:case 36293:return bq;case 36289:case 36303:case 36311:case 36292:return xq}}(t.type)}}class Wq{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function Hq(n){switch(n){case 5126:return Eq;case 35664:return wq;case 35665:return Sq;case 35666:return Tq;case 35674:return Aq;case 35675:return Cq;case 35676:return Dq;case 5124:case 35670:return Iq;case 35667:case 35671:return Rq;case 35668:case 35672:return Pq;case 35669:case 35673:return Fq;case 5125:return Lq;case 36294:return Oq;case 36295:return Nq;case 36296:return kq;case 35678:case 36198:case 36298:case 36306:case 35682:return Uq;case 35679:case 36299:case 36307:return Bq;case 35680:case 36300:case 36308:case 36293:return Vq;case 36289:case 36303:case 36311:case 36292:return zq}}(t.type)}}class jq{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const rb=/(\w+)(\])?(\[|\.)?/g;function SR(n,e){n.seq.push(e),n.map[e.id]=e}function $q(n,e,t){const i=n.name,r=i.length;for(rb.lastIndex=0;;){const s=rb.exec(i);let a=s[1];const c=s[3];if("]"===s[2]&&(a|=0),void 0===c||"["===c&&rb.lastIndex+2===r){SR(t,void 0===c?new Gq(a,n,e):new Wq(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new jq(a),SR(t,d)),t=d}}}class nm{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);$q(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];!1!==l.needsUpdate&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function TR(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let qq=0;function AR(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function Xq(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function Kq(n,e){const t=function Yq(n){switch(n){case is:return["Linear","( value )"];case rt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Zq(n,e){let t;switch(e){case Aj:t="Linear";break;case Cj:t="Reinhard";break;case Dj:t="OptimizedCineon";break;case Ij:t="ACESFilmic";break;case Rj:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Sd(n){return""!==n}function CR(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function DR(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const tX=/^[ \t]*#include +<([\w\d./]+)>/gm;function sb(n){return n.replace(tX,nX)}function nX(n,e){const t=yt[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return sb(t)}const iX=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function IR(n){return n.replace(iX,rX)}function rX(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function RR(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function uX(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=function sX(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===XD?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===sj?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Ls&&(e="SHADOWMAP_TYPE_VSM"),e}(t),c=function oX(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Zo:case Qo:e="ENVMAP_TYPE_CUBE";break;case dd:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function aX(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===Qo&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function lX(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Sp:e="ENVMAP_BLENDING_MULTIPLY";break;case Sj:e="ENVMAP_BLENDING_MIX";break;case Tj:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function cX(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),f=t.isWebGL2?"":function Qq(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Sd).join("\n")}(t),p=function Jq(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),_=r.createProgram();let m,g,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Sd).join("\n"),m.length>0&&(m+="\n"),g=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Sd).join("\n"),g.length>0&&(g+="\n")):(m=[RR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Sd).join("\n"),g=[f,RR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Os?"#define TONE_MAPPING":"",t.toneMapping!==Os?yt.tonemapping_pars_fragment:"",t.toneMapping!==Os?Zq("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",yt.encodings_pars_fragment,Kq("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Sd).join("\n")),o=sb(o),o=CR(o,t),o=DR(o,t),a=sb(a),a=CR(a,t),a=DR(a,t),o=IR(o),a=IR(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",t.glslVersion===NI?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===NI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const b=v+g+a,x=TR(r,r.VERTEX_SHADER,v+m+o),M=TR(r,r.FRAGMENT_SHADER,b);if(r.attachShader(_,x),r.attachShader(_,M),void 0!==t.index0AttributeName?r.bindAttribLocation(_,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_),n.debug.checkShaderErrors){const E=r.getProgramInfoLog(_).trim(),C=r.getShaderInfoLog(x).trim(),W=r.getShaderInfoLog(M).trim();let N=!0,L=!0;if(!1===r.getProgramParameter(_,r.LINK_STATUS))if(N=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,_,x,M);else{const O=AR(r,x,"vertex"),z=AR(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+E+"\n"+O+"\n"+z)}else""!==E?console.warn("THREE.WebGLProgram: Program Info Log:",E):(""===C||""===W)&&(L=!1);L&&(this.diagnostics={runnable:N,programLog:E,vertexShader:{log:C,prefix:m},fragmentShader:{log:W,prefix:g}})}let w,S;return r.deleteShader(x),r.deleteShader(M),this.getUniforms=function(){return void 0===w&&(w=new nm(r,_)),w},this.getAttributes=function(){return void 0===S&&(S=function eX(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,_)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=qq++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=x,this.fragmentShader=M,this}let dX=0;class hX{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new fX(e),t.set(e,i)),i}}class fX{constructor(e){this.id=dX++,this.code=e,this.usedTimes=0}}function pX(n,e,t,i,r,s,o){const a=new W0,l=new hX,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return 0===E?"uv":`uv${E}`}return{getParameters:function m(E,C,W,N,L){const O=N.fog,z=L.geometry,G=(E.isMeshStandardMaterial?t:e).get(E.envMap||(E.isMeshStandardMaterial?N.environment:null)),$=G&&G.mapping===dd?G.image.height:null,V=p[E.type];null!==E.precision&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const q=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,B=void 0!==q?q.length:0;let X,j,Q,te,k=0;if(void 0!==z.morphAttributes.position&&(k=1),void 0!==z.morphAttributes.normal&&(k=2),void 0!==z.morphAttributes.color&&(k=3),V){const Ct=rs[V];X=Ct.vertexShader,j=Ct.fragmentShader}else X=E.vertexShader,j=E.fragmentShader,l.update(E),Q=l.getVertexShaderID(E),te=l.getFragmentShaderID(E);const K=n.getRenderTarget(),ae=!0===L.isInstancedMesh,ue=!!E.map,he=!!G,D=!!E.aoMap,ye=!!E.lightMap,re=!!E.bumpMap,ie=!!E.normalMap,J=!!E.displacementMap,Ae=!!E.emissiveMap,se=!!E.metalnessMap,be=!!E.roughnessMap,Me=E.anisotropy>0,de=E.clearcoat>0,Ve=E.iridescence>0,I=E.sheen>0,T=E.transmission>0,Y=Me&&!!E.anisotropyMap,xe=de&&!!E.clearcoatMap,_e=de&&!!E.clearcoatNormalMap,P=de&&!!E.clearcoatRoughnessMap,ce=Ve&&!!E.iridescenceMap,fe=Ve&&!!E.iridescenceThicknessMap,ne=I&&!!E.sheenColorMap,Te=I&&!!E.sheenRoughnessMap,Le=!!E.specularMap,Re=!!E.specularColorMap,Ee=!!E.specularIntensityMap,Pe=T&&!!E.transmissionMap,Ue=T&&!!E.thicknessMap,H=!!E.alphaMap,oe=!!E.extensions,Fe=!!z.attributes.uv1,Oe=!!z.attributes.uv2,ft=!!z.attributes.uv3;return{isWebGL2:u,shaderID:V,shaderType:E.type,shaderName:E.name,vertexShader:X,fragmentShader:j,defines:E.defines,customVertexShaderID:Q,customFragmentShaderID:te,isRawShaderMaterial:!0===E.isRawShaderMaterial,glslVersion:E.glslVersion,precision:f,instancing:ae,instancingColor:ae&&null!==L.instanceColor,supportsVertexTextures:h,outputColorSpace:null===K?n.outputColorSpace:!0===K.isXRRenderTarget?K.texture.colorSpace:is,map:ue,matcap:!!E.matcap,envMap:he,envMapMode:he&&G.mapping,envMapCubeUVHeight:$,aoMap:D,lightMap:ye,bumpMap:re,normalMap:ie,displacementMap:h&&J,emissiveMap:Ae,normalMapObjectSpace:ie&&E.normalMapType===$j,normalMapTangentSpace:ie&&E.normalMapType===ia,metalnessMap:se,roughnessMap:be,anisotropy:Me,anisotropyMap:Y,clearcoat:de,clearcoatMap:xe,clearcoatNormalMap:_e,clearcoatRoughnessMap:P,iridescence:Ve,iridescenceMap:ce,iridescenceThicknessMap:fe,sheen:I,sheenColorMap:ne,sheenRoughnessMap:Te,specularMap:Le,specularColorMap:Re,specularIntensityMap:Ee,transmission:T,transmissionMap:Pe,thicknessMap:Ue,gradientMap:!!E.gradientMap,opaque:!1===E.transparent&&E.blending===Hl,alphaMap:H,alphaTest:E.alphaTest>0,combine:E.combine,mapUv:ue&&_(E.map.channel),aoMapUv:D&&_(E.aoMap.channel),lightMapUv:ye&&_(E.lightMap.channel),bumpMapUv:re&&_(E.bumpMap.channel),normalMapUv:ie&&_(E.normalMap.channel),displacementMapUv:J&&_(E.displacementMap.channel),emissiveMapUv:Ae&&_(E.emissiveMap.channel),metalnessMapUv:se&&_(E.metalnessMap.channel),roughnessMapUv:be&&_(E.roughnessMap.channel),anisotropyMapUv:Y&&_(E.anisotropyMap.channel),clearcoatMapUv:xe&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:_e&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:P&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:ce&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:fe&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:Te&&_(E.sheenRoughnessMap.channel),specularMapUv:Le&&_(E.specularMap.channel),specularColorMapUv:Re&&_(E.specularColorMap.channel),specularIntensityMapUv:Ee&&_(E.specularIntensityMap.channel),transmissionMapUv:Pe&&_(E.transmissionMap.channel),thicknessMapUv:Ue&&_(E.thicknessMap.channel),alphaMapUv:H&&_(E.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(ie||Me),vertexColors:E.vertexColors,vertexAlphas:!0===E.vertexColors&&!!z.attributes.color&&4===z.attributes.color.itemSize,vertexUv1s:Fe,vertexUv2s:Oe,vertexUv3s:ft,pointsUvs:!0===L.isPoints&&!!z.attributes.uv&&(ue||H),fog:!!O,useFog:!0===E.fog,fogExp2:O&&O.isFogExp2,flatShading:!0===E.flatShading,sizeAttenuation:!0===E.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===L.isSkinnedMesh,morphTargets:void 0!==z.morphAttributes.position,morphNormals:void 0!==z.morphAttributes.normal,morphColors:void 0!==z.morphAttributes.color,morphTargetsCount:B,morphTextureStride:k,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:n.shadowMap.enabled&&W.length>0,shadowMapType:n.shadowMap.type,toneMapping:E.toneMapped?n.toneMapping:Os,useLegacyLights:n.useLegacyLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Gi,flipSided:E.side===ti,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:oe&&!0===E.extensions.derivatives,extensionFragDepth:oe&&!0===E.extensions.fragDepth,extensionDrawBuffers:oe&&!0===E.extensions.drawBuffers,extensionShaderTextureLOD:oe&&!0===E.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}},getProgramCacheKey:function g(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),void 0!==E.defines)for(const W in E.defines)C.push(W),C.push(E.defines[W]);return!1===E.isRawShaderMaterial&&(function v(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}(C,E),function y(E,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),E.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),E.push(a.mask)}(C,E),C.push(n.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()},getUniforms:function b(E){const C=p[E.type];let W;return W=C?aR.clone(rs[C].uniforms):E.uniforms,W},acquireProgram:function x(E,C){let W;for(let N=0,L=c.length;N<L;N++){const O=c[N];if(O.cacheKey===C){W=O,++W.usedTimes;break}}return void 0===W&&(W=new uX(n,C,E,s),c.push(W)),W},releaseProgram:function M(E){if(0==--E.usedTimes){const C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}},releaseShaderCache:function w(E){l.remove(E)},programs:c,dispose:function S(){l.dispose()}}}function mX(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function i(s,o,a){n.get(s)[o]=a},dispose:function r(){n=new WeakMap}}}function gX(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function PR(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function FR(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,h,f,p,_,m){let g=n[e];return void 0===g?(g={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:_,group:m},n[e]=g):(g.id=d.id,g.object=d,g.geometry=h,g.material=f,g.groupOrder=p,g.renderOrder=d.renderOrder,g.z=_,g.group=m),e++,g}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,h,f,p,_,m){const g=o(d,h,f,p,_,m);f.transmission>0?i.push(g):!0===f.transparent?r.push(g):t.push(g)},unshift:function l(d,h,f,p,_,m){const g=o(d,h,f,p,_,m);f.transmission>0?i.unshift(g):!0===f.transparent?r.unshift(g):t.unshift(g)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function c(d,h){t.length>1&&t.sort(d||gX),i.length>1&&i.sort(h||PR),r.length>1&&r.sort(h||PR)}}}function _X(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new FR,n.set(i,[o])):r>=s.length?(o=new FR,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function yX(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new R,color:new Ne};break;case"SpotLight":t={position:new R,direction:new R,color:new Ne,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new R,color:new Ne,distance:0,decay:0};break;case"HemisphereLight":t={direction:new R,skyColor:new Ne,groundColor:new Ne};break;case"RectAreaLight":t={color:new Ne,position:new R,halfWidth:new R,halfHeight:new R}}return n[e.id]=t,t}}}let bX=0;function xX(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function MX(n,e){const t=new yX,i=function vX(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new R);const s=new R,o=new tt,a=new tt;return{setup:function l(u,d){let h=0,f=0,p=0;for(let W=0;W<9;W++)r.probe[W].set(0,0,0);let _=0,m=0,g=0,v=0,y=0,b=0,x=0,M=0,w=0,S=0;u.sort(xX);const E=!0===d?Math.PI:1;for(let W=0,N=u.length;W<N;W++){const L=u[W],O=L.color,z=L.intensity,U=L.distance,G=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)h+=O.r*z*E,f+=O.g*z*E,p+=O.b*z*E;else if(L.isLightProbe)for(let $=0;$<9;$++)r.probe[$].addScaledVector(L.sh.coefficients[$],z);else if(L.isDirectionalLight){const $=t.get(L);if($.color.copy(L.color).multiplyScalar(L.intensity*E),L.castShadow){const V=L.shadow,q=i.get(L);q.shadowBias=V.bias,q.shadowNormalBias=V.normalBias,q.shadowRadius=V.radius,q.shadowMapSize=V.mapSize,r.directionalShadow[_]=q,r.directionalShadowMap[_]=G,r.directionalShadowMatrix[_]=L.shadow.matrix,b++}r.directional[_]=$,_++}else if(L.isSpotLight){const $=t.get(L);$.position.setFromMatrixPosition(L.matrixWorld),$.color.copy(O).multiplyScalar(z*E),$.distance=U,$.coneCos=Math.cos(L.angle),$.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),$.decay=L.decay,r.spot[g]=$;const V=L.shadow;if(L.map&&(r.spotLightMap[w]=L.map,w++,V.updateMatrices(L),L.castShadow&&S++),r.spotLightMatrix[g]=V.matrix,L.castShadow){const q=i.get(L);q.shadowBias=V.bias,q.shadowNormalBias=V.normalBias,q.shadowRadius=V.radius,q.shadowMapSize=V.mapSize,r.spotShadow[g]=q,r.spotShadowMap[g]=G,M++}g++}else if(L.isRectAreaLight){const $=t.get(L);$.color.copy(O).multiplyScalar(z),$.halfWidth.set(.5*L.width,0,0),$.halfHeight.set(0,.5*L.height,0),r.rectArea[v]=$,v++}else if(L.isPointLight){const $=t.get(L);if($.color.copy(L.color).multiplyScalar(L.intensity*E),$.distance=L.distance,$.decay=L.decay,L.castShadow){const V=L.shadow,q=i.get(L);q.shadowBias=V.bias,q.shadowNormalBias=V.normalBias,q.shadowRadius=V.radius,q.shadowMapSize=V.mapSize,q.shadowCameraNear=V.camera.near,q.shadowCameraFar=V.camera.far,r.pointShadow[m]=q,r.pointShadowMap[m]=G,r.pointShadowMatrix[m]=L.shadow.matrix,x++}r.point[m]=$,m++}else if(L.isHemisphereLight){const $=t.get(L);$.skyColor.copy(L.color).multiplyScalar(z*E),$.groundColor.copy(L.groundColor).multiplyScalar(z*E),r.hemi[y]=$,y++}}v>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=ke.LTC_FLOAT_1,r.rectAreaLTC2=ke.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=ke.LTC_HALF_1,r.rectAreaLTC2=ke.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=h,r.ambient[1]=f,r.ambient[2]=p;const C=r.hash;(C.directionalLength!==_||C.pointLength!==m||C.spotLength!==g||C.rectAreaLength!==v||C.hemiLength!==y||C.numDirectionalShadows!==b||C.numPointShadows!==x||C.numSpotShadows!==M||C.numSpotMaps!==w)&&(r.directional.length=_,r.spot.length=g,r.rectArea.length=v,r.point.length=m,r.hemi.length=y,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=x,r.pointShadowMap.length=x,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=x,r.spotLightMatrix.length=M+w-S,r.spotLightMap.length=w,r.numSpotLightShadowsWithMaps=S,C.directionalLength=_,C.pointLength=m,C.spotLength=g,C.rectAreaLength=v,C.hemiLength=y,C.numDirectionalShadows=b,C.numPointShadows=x,C.numSpotShadows=M,C.numSpotMaps=w,r.version=bX++)},setupView:function c(u,d){let h=0,f=0,p=0,_=0,m=0;const g=d.matrixWorldInverse;for(let v=0,y=u.length;v<y;v++){const b=u[v];if(b.isDirectionalLight){const x=r.directional[h];x.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(s),x.direction.transformDirection(g),h++}else if(b.isSpotLight){const x=r.spot[p];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(s),x.direction.transformDirection(g),p++}else if(b.isRectAreaLight){const x=r.rectArea[_];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(g),a.identity(),o.copy(b.matrixWorld),o.premultiply(g),a.extractRotation(o),x.halfWidth.set(.5*b.width,0,0),x.halfHeight.set(0,.5*b.height,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),_++}else if(b.isPointLight){const x=r.point[f];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(g),f++}else if(b.isHemisphereLight){const x=r.hemi[m];x.direction.setFromMatrixPosition(b.matrixWorld),x.direction.transformDirection(g),m++}}},state:r}}function LR(n,e){const t=new MX(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function l(d){t.setup(i,d)},setupLightsView:function c(d){t.setupView(i,d)},pushLight:function o(d){i.push(d)},pushShadow:function a(d){r.push(d)}}}function EX(n,e){let t=new WeakMap;return{get:function i(s,o=0){const a=t.get(s);let l;return void 0===a?(l=new LR(n,e),t.set(s,[l])):o>=a.length?(l=new LR(n,e),a.push(l)):l=a[o],l},dispose:function r(){t=new WeakMap}}}class ob extends Lr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ab extends Lr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const wX="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",SX="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function TX(n,e,t){let i=new eb;const r=new ve,s=new ve,o=new Lt,a=new ob({depthPacking:LI}),l=new ab,c={},u=t.maxTextureSize,d={[ns]:ti,[ti]:ns,[Gi]:Gi},h=new _o({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ve},radius:{value:4}},vertexShader:wX,fragmentShader:SX}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new ut;p.setAttribute("position",new cn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new yn(p,h),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=XD;let g=this.type;function v(x,M){const w=e.update(_);h.defines.VSM_SAMPLES!==x.blurSamples&&(h.defines.VSM_SAMPLES=x.blurSamples,f.defines.VSM_SAMPLES=x.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===x.mapPass&&(x.mapPass=new aa(r.x,r.y)),h.uniforms.shadow_pass.value=x.map.texture,h.uniforms.resolution.value=x.mapSize,h.uniforms.radius.value=x.radius,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(M,null,w,h,_,null),f.uniforms.shadow_pass.value=x.mapPass.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(M,null,w,f,_,null)}function y(x,M,w,S){let E=null;const C=!0===w.isPointLight?x.customDistanceMaterial:x.customDepthMaterial;if(void 0!==C)E=C;else if(E=!0===w.isPointLight?l:a,n.localClippingEnabled&&!0===M.clipShadows&&Array.isArray(M.clippingPlanes)&&0!==M.clippingPlanes.length||M.displacementMap&&0!==M.displacementScale||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const W=E.uuid,N=M.uuid;let L=c[W];void 0===L&&(L={},c[W]=L);let O=L[N];void 0===O&&(O=E.clone(),L[N]=O),E=O}return E.visible=M.visible,E.wireframe=M.wireframe,E.side=S===Ls?null!==M.shadowSide?M.shadowSide:M.side:null!==M.shadowSide?M.shadowSide:d[M.side],E.alphaMap=M.alphaMap,E.alphaTest=M.alphaTest,E.map=M.map,E.clipShadows=M.clipShadows,E.clippingPlanes=M.clippingPlanes,E.clipIntersection=M.clipIntersection,E.displacementMap=M.displacementMap,E.displacementScale=M.displacementScale,E.displacementBias=M.displacementBias,E.wireframeLinewidth=M.wireframeLinewidth,E.linewidth=M.linewidth,!0===w.isPointLight&&!0===E.isMeshDistanceMaterial&&(n.properties.get(E).light=w),E}function b(x,M,w,S,E){if(!1===x.visible)return;if(x.layers.test(M.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&E===Ls)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,x.matrixWorld);const N=e.update(x),L=x.material;if(Array.isArray(L)){const O=N.groups;for(let z=0,U=O.length;z<U;z++){const G=O[z],$=L[G.materialIndex];if($&&$.visible){const V=y(x,$,S,E);n.renderBufferDirect(w,null,N,V,x,G)}}}else if(L.visible){const O=y(x,L,S,E);n.renderBufferDirect(w,null,N,O,x,null)}}const W=x.children;for(let N=0,L=W.length;N<L;N++)b(W[N],M,w,S,E)}this.render=function(x,M,w){if(!1===m.enabled||!1===m.autoUpdate&&!1===m.needsUpdate||0===x.length)return;const S=n.getRenderTarget(),E=n.getActiveCubeFace(),C=n.getActiveMipmapLevel(),W=n.state;W.setBlending(co),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);const N=g!==Ls&&this.type===Ls,L=g===Ls&&this.type!==Ls;for(let O=0,z=x.length;O<z;O++){const U=x[O],G=U.shadow;if(void 0===G){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(!1===G.autoUpdate&&!1===G.needsUpdate)continue;r.copy(G.mapSize);const $=G.getFrameExtents();if(r.multiply($),s.copy(G.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/$.x),r.x=s.x*$.x,G.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/$.y),r.y=s.y*$.y,G.mapSize.y=s.y)),null===G.map||!0===N||!0===L){const q=this.type!==Ls?{minFilter:_n,magFilter:_n}:{};null!==G.map&&G.map.dispose(),G.map=new aa(r.x,r.y,q),G.map.texture.name=U.name+".shadowMap",G.camera.updateProjectionMatrix()}n.setRenderTarget(G.map),n.clear();const V=G.getViewportCount();for(let q=0;q<V;q++){const B=G.getViewport(q);o.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),W.viewport(o),G.updateMatrices(U,q),i=G.getFrustum(),b(M,w,G.camera,U,this.type)}!0!==G.isPointLightShadow&&this.type===Ls&&v(G,w),G.needsUpdate=!1}g=this.type,m.needsUpdate=!1,n.setRenderTarget(S,E,C)}}function AX(n,e,t){const i=t.isWebGL2,a=new function r(){let H=!1;const Ie=new Lt;let oe=null;const Fe=new Lt(0,0,0,0);return{setMask:function(Oe){oe!==Oe&&!H&&(n.colorMask(Oe,Oe,Oe,Oe),oe=Oe)},setLocked:function(Oe){H=Oe},setClear:function(Oe,ft,Tt,Ct,Ot){!0===Ot&&(Oe*=Ct,ft*=Ct,Tt*=Ct),Ie.set(Oe,ft,Tt,Ct),!1===Fe.equals(Ie)&&(n.clearColor(Oe,ft,Tt,Ct),Fe.copy(Ie))},reset:function(){H=!1,oe=null,Fe.set(-1,0,0,0)}}},l=new function s(){let H=!1,Ie=null,oe=null,Fe=null;return{setTest:function(Oe){Oe?K(n.DEPTH_TEST):ae(n.DEPTH_TEST)},setMask:function(Oe){Ie!==Oe&&!H&&(n.depthMask(Oe),Ie=Oe)},setFunc:function(Oe){if(oe!==Oe){switch(Oe){case yj:n.depthFunc(n.NEVER);break;case vj:n.depthFunc(n.ALWAYS);break;case bj:n.depthFunc(n.LESS);break;case y0:n.depthFunc(n.LEQUAL);break;case xj:n.depthFunc(n.EQUAL);break;case Mj:n.depthFunc(n.GEQUAL);break;case Ej:n.depthFunc(n.GREATER);break;case wj:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}oe=Oe}},setLocked:function(Oe){H=Oe},setClear:function(Oe){Fe!==Oe&&(n.clearDepth(Oe),Fe=Oe)},reset:function(){H=!1,Ie=null,oe=null,Fe=null}}},c=new function o(){let H=!1,Ie=null,oe=null,Fe=null,Oe=null,ft=null,Tt=null,Ct=null,Ot=null;return{setTest:function(Ut){H||(Ut?K(n.STENCIL_TEST):ae(n.STENCIL_TEST))},setMask:function(Ut){Ie!==Ut&&!H&&(n.stencilMask(Ut),Ie=Ut)},setFunc:function(Ut,Dt,Et){(oe!==Ut||Fe!==Dt||Oe!==Et)&&(n.stencilFunc(Ut,Dt,Et),oe=Ut,Fe=Dt,Oe=Et)},setOp:function(Ut,Dt,Et){(ft!==Ut||Tt!==Dt||Ct!==Et)&&(n.stencilOp(Ut,Dt,Et),ft=Ut,Tt=Dt,Ct=Et)},setLocked:function(Ut){H=Ut},setClear:function(Ut){Ot!==Ut&&(n.clearStencil(Ut),Ot=Ut)},reset:function(){H=!1,Ie=null,oe=null,Fe=null,Oe=null,ft=null,Tt=null,Ct=null,Ot=null}}},u=new WeakMap,d=new WeakMap;let h={},f={},p=new WeakMap,_=[],m=null,g=!1,v=null,y=null,b=null,x=null,M=null,w=null,S=null,E=!1,C=null,W=null,N=null,L=null,O=null;const z=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,G=0;const $=n.getParameter(n.VERSION);-1!==$.indexOf("WebGL")?(G=parseFloat(/^WebGL (\d)/.exec($)[1]),U=G>=1):-1!==$.indexOf("OpenGL ES")&&(G=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),U=G>=2);let V=null,q={};const B=n.getParameter(n.SCISSOR_BOX),k=n.getParameter(n.VIEWPORT),X=(new Lt).fromArray(B),j=(new Lt).fromArray(k);function Q(H,Ie,oe,Fe){const Oe=new Uint8Array(4),ft=n.createTexture();n.bindTexture(H,ft),n.texParameteri(H,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(H,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Tt=0;Tt<oe;Tt++)!i||H!==n.TEXTURE_3D&&H!==n.TEXTURE_2D_ARRAY?n.texImage2D(Ie+Tt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Oe):n.texImage3D(Ie,0,n.RGBA,1,1,Fe,0,n.RGBA,n.UNSIGNED_BYTE,Oe);return ft}const te={};function K(H){!0!==h[H]&&(n.enable(H),h[H]=!0)}function ae(H){!1!==h[H]&&(n.disable(H),h[H]=!1)}te[n.TEXTURE_2D]=Q(n.TEXTURE_2D,n.TEXTURE_2D,1),te[n.TEXTURE_CUBE_MAP]=Q(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(te[n.TEXTURE_2D_ARRAY]=Q(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),te[n.TEXTURE_3D]=Q(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),K(n.DEPTH_TEST),l.setFunc(y0),J(!1),Ae(qD),K(n.CULL_FACE),re(co);const D={[Gl]:n.FUNC_ADD,[aj]:n.FUNC_SUBTRACT,[lj]:n.FUNC_REVERSE_SUBTRACT};if(i)D[QD]=n.MIN,D[JD]=n.MAX;else{const H=e.get("EXT_blend_minmax");null!==H&&(D[QD]=H.MIN_EXT,D[JD]=H.MAX_EXT)}const ye={[cj]:n.ZERO,[uj]:n.ONE,[dj]:n.SRC_COLOR,[eI]:n.SRC_ALPHA,[_j]:n.SRC_ALPHA_SATURATE,[mj]:n.DST_COLOR,[fj]:n.DST_ALPHA,[hj]:n.ONE_MINUS_SRC_COLOR,[tI]:n.ONE_MINUS_SRC_ALPHA,[gj]:n.ONE_MINUS_DST_COLOR,[pj]:n.ONE_MINUS_DST_ALPHA};function re(H,Ie,oe,Fe,Oe,ft,Tt,Ct){if(H!==co){if(!1===g&&(K(n.BLEND),g=!0),H===oj)Oe=Oe||Ie,ft=ft||oe,Tt=Tt||Fe,(Ie!==y||Oe!==M)&&(n.blendEquationSeparate(D[Ie],D[Oe]),y=Ie,M=Oe),(oe!==b||Fe!==x||ft!==w||Tt!==S)&&(n.blendFuncSeparate(ye[oe],ye[Fe],ye[ft],ye[Tt]),b=oe,x=Fe,w=ft,S=Tt),v=H,E=!1;else if(H!==v||Ct!==E){if((y!==Gl||M!==Gl)&&(n.blendEquation(n.FUNC_ADD),y=Gl,M=Gl),Ct)switch(H){case Hl:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case YD:n.blendFunc(n.ONE,n.ONE);break;case KD:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ZD:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",H)}else switch(H){case Hl:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case YD:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case KD:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ZD:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",H)}b=null,x=null,w=null,S=null,v=H,E=Ct}}else!0===g&&(ae(n.BLEND),g=!1)}function J(H){C!==H&&(n.frontFace(H?n.CW:n.CCW),C=H)}function Ae(H){H!==ij?(K(n.CULL_FACE),H!==W&&n.cullFace(H===qD?n.BACK:H===rj?n.FRONT:n.FRONT_AND_BACK)):ae(n.CULL_FACE),W=H}function be(H,Ie,oe){H?(K(n.POLYGON_OFFSET_FILL),(L!==Ie||O!==oe)&&(n.polygonOffset(Ie,oe),L=Ie,O=oe)):ae(n.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:l,stencil:c},enable:K,disable:ae,bindFramebuffer:function ue(H,Ie){return f[H]!==Ie&&(n.bindFramebuffer(H,Ie),f[H]=Ie,i&&(H===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=Ie),H===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=Ie)),!0)},drawBuffers:function Ce(H,Ie){let oe=_,Fe=!1;if(H)if(oe=p.get(Ie),void 0===oe&&(oe=[],p.set(Ie,oe)),H.isWebGLMultipleRenderTargets){const Oe=H.texture;if(oe.length!==Oe.length||oe[0]!==n.COLOR_ATTACHMENT0){for(let ft=0,Tt=Oe.length;ft<Tt;ft++)oe[ft]=n.COLOR_ATTACHMENT0+ft;oe.length=Oe.length,Fe=!0}}else oe[0]!==n.COLOR_ATTACHMENT0&&(oe[0]=n.COLOR_ATTACHMENT0,Fe=!0);else oe[0]!==n.BACK&&(oe[0]=n.BACK,Fe=!0);Fe&&(t.isWebGL2?n.drawBuffers(oe):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(oe))},useProgram:function he(H){return m!==H&&(n.useProgram(H),m=H,!0)},setBlending:re,setMaterial:function ie(H,Ie){H.side===Gi?ae(n.CULL_FACE):K(n.CULL_FACE);let oe=H.side===ti;Ie&&(oe=!oe),J(oe),H.blending===Hl&&!1===H.transparent?re(co):re(H.blending,H.blendEquation,H.blendSrc,H.blendDst,H.blendEquationAlpha,H.blendSrcAlpha,H.blendDstAlpha,H.premultipliedAlpha),l.setFunc(H.depthFunc),l.setTest(H.depthTest),l.setMask(H.depthWrite),a.setMask(H.colorWrite);const Fe=H.stencilWrite;c.setTest(Fe),Fe&&(c.setMask(H.stencilWriteMask),c.setFunc(H.stencilFunc,H.stencilRef,H.stencilFuncMask),c.setOp(H.stencilFail,H.stencilZFail,H.stencilZPass)),be(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),!0===H.alphaToCoverage?K(n.SAMPLE_ALPHA_TO_COVERAGE):ae(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:J,setCullFace:Ae,setLineWidth:function se(H){H!==N&&(U&&n.lineWidth(H),N=H)},setPolygonOffset:be,setScissorTest:function Me(H){H?K(n.SCISSOR_TEST):ae(n.SCISSOR_TEST)},activeTexture:function de(H){void 0===H&&(H=n.TEXTURE0+z-1),V!==H&&(n.activeTexture(H),V=H)},bindTexture:function Ve(H,Ie,oe){void 0===oe&&(oe=null===V?n.TEXTURE0+z-1:V);let Fe=q[oe];void 0===Fe&&(Fe={type:void 0,texture:void 0},q[oe]=Fe),(Fe.type!==H||Fe.texture!==Ie)&&(V!==oe&&(n.activeTexture(oe),V=oe),n.bindTexture(H,Ie||te[H]),Fe.type=H,Fe.texture=Ie)},unbindTexture:function I(){const H=q[V];void 0!==H&&void 0!==H.type&&(n.bindTexture(H.type,null),H.type=void 0,H.texture=void 0)},compressedTexImage2D:function T(){try{n.compressedTexImage2D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},compressedTexImage3D:function Y(){try{n.compressedTexImage3D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texImage2D:function Te(){try{n.texImage2D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texImage3D:function Le(){try{n.texImage3D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},updateUBOMapping:function Pe(H,Ie){let oe=d.get(Ie);void 0===oe&&(oe=new WeakMap,d.set(Ie,oe));let Fe=oe.get(H);void 0===Fe&&(Fe=n.getUniformBlockIndex(Ie,H.name),oe.set(H,Fe))},uniformBlockBinding:function Ue(H,Ie){const Fe=d.get(Ie).get(H);u.get(Ie)!==Fe&&(n.uniformBlockBinding(Ie,Fe,H.__bindingPointIndex),u.set(Ie,Fe))},texStorage2D:function fe(){try{n.texStorage2D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texStorage3D:function ne(){try{n.texStorage3D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texSubImage2D:function xe(){try{n.texSubImage2D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},texSubImage3D:function _e(){try{n.texSubImage3D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},compressedTexSubImage2D:function P(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},compressedTexSubImage3D:function ce(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(H){console.error("THREE.WebGLState:",H)}},scissor:function Re(H){!1===X.equals(H)&&(n.scissor(H.x,H.y,H.z,H.w),X.copy(H))},viewport:function Ee(H){!1===j.equals(H)&&(n.viewport(H.x,H.y,H.z,H.w),j.copy(H))},reset:function qe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),!0===i&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},V=null,q={},f={},p=new WeakMap,_=[],m=null,g=!1,v=null,y=null,b=null,x=null,M=null,w=null,S=null,E=!1,C=null,W=null,N=null,L=null,O=null,X.set(0,0,n.canvas.width,n.canvas.height),j.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}}}function CX(n,e,t,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let _;const m=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(I,T){return g?new OffscreenCanvas(I,T):_d("canvas")}function y(I,T,Y,xe){let _e=1;if((I.width>xe||I.height>xe)&&(_e=xe/Math.max(I.width,I.height)),_e<1||!0===T){if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap){const P=T?Pp:Math.floor,ce=P(_e*I.width),fe=P(_e*I.height);void 0===_&&(_=v(ce,fe));const ne=Y?v(ce,fe):_;return ne.width=ce,ne.height=fe,ne.getContext("2d").drawImage(I,0,0,ce,fe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+ce+"x"+fe+")."),ne}return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I}return I}function b(I){return F0(I.width)&&F0(I.height)}function M(I,T){return I.generateMipmaps&&T&&I.minFilter!==_n&&I.minFilter!==Jt}function w(I){n.generateMipmap(I)}function S(I,T,Y,xe,_e=!1){if(!1===a)return T;if(null!==I){if(void 0!==n[I])return n[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let P=T;return T===n.RED&&(Y===n.FLOAT&&(P=n.R32F),Y===n.HALF_FLOAT&&(P=n.R16F),Y===n.UNSIGNED_BYTE&&(P=n.R8)),T===n.RG&&(Y===n.FLOAT&&(P=n.RG32F),Y===n.HALF_FLOAT&&(P=n.RG16F),Y===n.UNSIGNED_BYTE&&(P=n.RG8)),T===n.RGBA&&(Y===n.FLOAT&&(P=n.RGBA32F),Y===n.HALF_FLOAT&&(P=n.RGBA16F),Y===n.UNSIGNED_BYTE&&(P=xe===rt&&!1===_e?n.SRGB8_ALPHA8:n.RGBA8),Y===n.UNSIGNED_SHORT_4_4_4_4&&(P=n.RGBA4),Y===n.UNSIGNED_SHORT_5_5_5_1&&(P=n.RGB5_A1)),(P===n.R16F||P===n.R32F||P===n.RG16F||P===n.RG32F||P===n.RGBA16F||P===n.RGBA32F)&&e.get("EXT_color_buffer_float"),P}function E(I,T,Y){return!0===M(I,Y)||I.isFramebufferTexture&&I.minFilter!==_n&&I.minFilter!==Jt?Math.log2(Math.max(T.width,T.height))+1:void 0!==I.mipmaps&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?T.mipmaps.length:1}function C(I){return I===_n||I===Cp||I===fd?n.NEAREST:n.LINEAR}function W(I){const T=I.target;T.removeEventListener("dispose",W),function L(I){const T=i.get(I);if(void 0===T.__webglInit)return;const Y=I.source,xe=m.get(Y);if(xe){const _e=xe[T.__cacheKey];_e.usedTimes--,0===_e.usedTimes&&O(I),0===Object.keys(xe).length&&m.delete(Y)}i.remove(I)}(T),T.isVideoTexture&&p.delete(T)}function N(I){const T=I.target;T.removeEventListener("dispose",N),function z(I){const T=I.texture,Y=i.get(I),xe=i.get(T);if(void 0!==xe.__webglTexture&&(n.deleteTexture(xe.__webglTexture),o.memory.textures--),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let _e=0;_e<6;_e++)n.deleteFramebuffer(Y.__webglFramebuffer[_e]),Y.__webglDepthbuffer&&n.deleteRenderbuffer(Y.__webglDepthbuffer[_e]);else{if(n.deleteFramebuffer(Y.__webglFramebuffer),Y.__webglDepthbuffer&&n.deleteRenderbuffer(Y.__webglDepthbuffer),Y.__webglMultisampledFramebuffer&&n.deleteFramebuffer(Y.__webglMultisampledFramebuffer),Y.__webglColorRenderbuffer)for(let _e=0;_e<Y.__webglColorRenderbuffer.length;_e++)Y.__webglColorRenderbuffer[_e]&&n.deleteRenderbuffer(Y.__webglColorRenderbuffer[_e]);Y.__webglDepthRenderbuffer&&n.deleteRenderbuffer(Y.__webglDepthRenderbuffer)}if(I.isWebGLMultipleRenderTargets)for(let _e=0,P=T.length;_e<P;_e++){const ce=i.get(T[_e]);ce.__webglTexture&&(n.deleteTexture(ce.__webglTexture),o.memory.textures--),i.remove(T[_e])}i.remove(T),i.remove(I)}(T)}function O(I){const T=i.get(I);n.deleteTexture(T.__webglTexture),delete m.get(I.source)[T.__cacheKey],o.memory.textures--}let U=0;function q(I,T){const Y=i.get(I);if(I.isVideoTexture&&function de(I){const T=o.render.frame;p.get(I)!==T&&(p.set(I,T),I.update())}(I),!1===I.isRenderTargetTexture&&I.version>0&&Y.__version!==I.version){const xe=I.image;if(null===xe)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==xe.complete)return void ue(Y,I,T);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,Y.__webglTexture,n.TEXTURE0+T)}const j={[Jo]:n.REPEAT,[ni]:n.CLAMP_TO_EDGE,[hd]:n.MIRRORED_REPEAT},Q={[_n]:n.NEAREST,[Cp]:n.NEAREST_MIPMAP_NEAREST,[fd]:n.NEAREST_MIPMAP_LINEAR,[Jt]:n.LINEAR,[b0]:n.LINEAR_MIPMAP_NEAREST,[Ns]:n.LINEAR_MIPMAP_LINEAR},te={[Xj]:n.NEVER,[t9]:n.ALWAYS,[Yj]:n.LESS,[Zj]:n.LEQUAL,[Kj]:n.EQUAL,[e9]:n.GEQUAL,[Qj]:n.GREATER,[Jj]:n.NOTEQUAL};function K(I,T,Y){if(Y?(n.texParameteri(I,n.TEXTURE_WRAP_S,j[T.wrapS]),n.texParameteri(I,n.TEXTURE_WRAP_T,j[T.wrapT]),(I===n.TEXTURE_3D||I===n.TEXTURE_2D_ARRAY)&&n.texParameteri(I,n.TEXTURE_WRAP_R,j[T.wrapR]),n.texParameteri(I,n.TEXTURE_MAG_FILTER,Q[T.magFilter]),n.texParameteri(I,n.TEXTURE_MIN_FILTER,Q[T.minFilter])):(n.texParameteri(I,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(I===n.TEXTURE_3D||I===n.TEXTURE_2D_ARRAY)&&n.texParameteri(I,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(T.wrapS!==ni||T.wrapT!==ni)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(I,n.TEXTURE_MAG_FILTER,C(T.magFilter)),n.texParameteri(I,n.TEXTURE_MIN_FILTER,C(T.minFilter)),T.minFilter!==_n&&T.minFilter!==Jt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),T.compareFunction&&(n.texParameteri(I,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(I,n.TEXTURE_COMPARE_FUNC,te[T.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const xe=e.get("EXT_texture_filter_anisotropic");if(T.magFilter===_n||T.minFilter!==fd&&T.minFilter!==Ns||T.type===ks&&!1===e.has("OES_texture_float_linear")||!1===a&&T.type===pd&&!1===e.has("OES_texture_half_float_linear"))return;(T.anisotropy>1||i.get(T).__currentAnisotropy)&&(n.texParameterf(I,xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,r.getMaxAnisotropy())),i.get(T).__currentAnisotropy=T.anisotropy)}}function ae(I,T){let Y=!1;void 0===I.__webglInit&&(I.__webglInit=!0,T.addEventListener("dispose",W));const xe=T.source;let _e=m.get(xe);void 0===_e&&(_e={},m.set(xe,_e));const P=function V(I){const T=[];return T.push(I.wrapS),T.push(I.wrapT),T.push(I.wrapR||0),T.push(I.magFilter),T.push(I.minFilter),T.push(I.anisotropy),T.push(I.internalFormat),T.push(I.format),T.push(I.type),T.push(I.generateMipmaps),T.push(I.premultiplyAlpha),T.push(I.flipY),T.push(I.unpackAlignment),T.push(I.colorSpace),T.join()}(T);if(P!==I.__cacheKey){void 0===_e[P]&&(_e[P]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,Y=!0),_e[P].usedTimes++;const ce=_e[I.__cacheKey];void 0!==ce&&(_e[I.__cacheKey].usedTimes--,0===ce.usedTimes&&O(T)),I.__cacheKey=P,I.__webglTexture=_e[P].texture}return Y}function ue(I,T,Y){let xe=n.TEXTURE_2D;(T.isDataArrayTexture||T.isCompressedArrayTexture)&&(xe=n.TEXTURE_2D_ARRAY),T.isData3DTexture&&(xe=n.TEXTURE_3D);const _e=ae(I,T),P=T.source;t.bindTexture(xe,I.__webglTexture,n.TEXTURE0+Y);const ce=i.get(P);if(P.version!==ce.__version||!0===_e){t.activeTexture(n.TEXTURE0+Y),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,T.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,T.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const fe=function x(I){return!a&&(I.wrapS!==ni||I.wrapT!==ni||I.minFilter!==_n&&I.minFilter!==Jt)}(T)&&!1===b(T.image);let ne=y(T.image,fe,!1,u);ne=Ve(T,ne);const Te=b(ne)||a,Le=s.convert(T.format,T.colorSpace);let Pe,Re=s.convert(T.type),Ee=S(T.internalFormat,Le,Re,T.colorSpace);K(xe,T,Te);const Ue=T.mipmaps,qe=a&&!0!==T.isVideoTexture,H=void 0===ce.__version||!0===_e,Ie=E(T,ne,Te);if(T.isDepthTexture)Ee=n.DEPTH_COMPONENT,a?Ee=T.type===ks?n.DEPTH_COMPONENT32F:T.type===ho?n.DEPTH_COMPONENT24:T.type===ea?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT16:T.type===ks&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),T.format===ta&&Ee===n.DEPTH_COMPONENT&&T.type!==x0&&T.type!==ho&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),T.type=ho,Re=s.convert(T.type)),T.format===Wl&&Ee===n.DEPTH_COMPONENT&&(Ee=n.DEPTH_STENCIL,T.type!==ea&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),T.type=ea,Re=s.convert(T.type))),H&&(qe?t.texStorage2D(n.TEXTURE_2D,1,Ee,ne.width,ne.height):t.texImage2D(n.TEXTURE_2D,0,Ee,ne.width,ne.height,0,Le,Re,null));else if(T.isDataTexture)if(Ue.length>0&&Te){qe&&H&&t.texStorage2D(n.TEXTURE_2D,Ie,Ee,Ue[0].width,Ue[0].height);for(let oe=0,Fe=Ue.length;oe<Fe;oe++)Pe=Ue[oe],qe?t.texSubImage2D(n.TEXTURE_2D,oe,0,0,Pe.width,Pe.height,Le,Re,Pe.data):t.texImage2D(n.TEXTURE_2D,oe,Ee,Pe.width,Pe.height,0,Le,Re,Pe.data);T.generateMipmaps=!1}else qe?(H&&t.texStorage2D(n.TEXTURE_2D,Ie,Ee,ne.width,ne.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,ne.width,ne.height,Le,Re,ne.data)):t.texImage2D(n.TEXTURE_2D,0,Ee,ne.width,ne.height,0,Le,Re,ne.data);else if(T.isCompressedTexture)if(T.isCompressedArrayTexture){qe&&H&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,Ee,Ue[0].width,Ue[0].height,ne.depth);for(let oe=0,Fe=Ue.length;oe<Fe;oe++)Pe=Ue[oe],T.format!==cr?null!==Le?qe?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,oe,0,0,0,Pe.width,Pe.height,ne.depth,Le,Pe.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,oe,Ee,Pe.width,Pe.height,ne.depth,0,Pe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage3D(n.TEXTURE_2D_ARRAY,oe,0,0,0,Pe.width,Pe.height,ne.depth,Le,Re,Pe.data):t.texImage3D(n.TEXTURE_2D_ARRAY,oe,Ee,Pe.width,Pe.height,ne.depth,0,Le,Re,Pe.data)}else{qe&&H&&t.texStorage2D(n.TEXTURE_2D,Ie,Ee,Ue[0].width,Ue[0].height);for(let oe=0,Fe=Ue.length;oe<Fe;oe++)Pe=Ue[oe],T.format!==cr?null!==Le?qe?t.compressedTexSubImage2D(n.TEXTURE_2D,oe,0,0,Pe.width,Pe.height,Le,Pe.data):t.compressedTexImage2D(n.TEXTURE_2D,oe,Ee,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage2D(n.TEXTURE_2D,oe,0,0,Pe.width,Pe.height,Le,Re,Pe.data):t.texImage2D(n.TEXTURE_2D,oe,Ee,Pe.width,Pe.height,0,Le,Re,Pe.data)}else if(T.isDataArrayTexture)qe?(H&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ie,Ee,ne.width,ne.height,ne.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ne.width,ne.height,ne.depth,Le,Re,ne.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ee,ne.width,ne.height,ne.depth,0,Le,Re,ne.data);else if(T.isData3DTexture)qe?(H&&t.texStorage3D(n.TEXTURE_3D,Ie,Ee,ne.width,ne.height,ne.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ne.width,ne.height,ne.depth,Le,Re,ne.data)):t.texImage3D(n.TEXTURE_3D,0,Ee,ne.width,ne.height,ne.depth,0,Le,Re,ne.data);else if(T.isFramebufferTexture){if(H)if(qe)t.texStorage2D(n.TEXTURE_2D,Ie,Ee,ne.width,ne.height);else{let oe=ne.width,Fe=ne.height;for(let Oe=0;Oe<Ie;Oe++)t.texImage2D(n.TEXTURE_2D,Oe,Ee,oe,Fe,0,Le,Re,null),oe>>=1,Fe>>=1}}else if(Ue.length>0&&Te){qe&&H&&t.texStorage2D(n.TEXTURE_2D,Ie,Ee,Ue[0].width,Ue[0].height);for(let oe=0,Fe=Ue.length;oe<Fe;oe++)Pe=Ue[oe],qe?t.texSubImage2D(n.TEXTURE_2D,oe,0,0,Le,Re,Pe):t.texImage2D(n.TEXTURE_2D,oe,Ee,Le,Re,Pe);T.generateMipmaps=!1}else qe?(H&&t.texStorage2D(n.TEXTURE_2D,Ie,Ee,ne.width,ne.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Le,Re,ne)):t.texImage2D(n.TEXTURE_2D,0,Ee,Le,Re,ne);M(T,Te)&&w(xe),ce.__version=P.version,T.onUpdate&&T.onUpdate(T)}I.__version=T.version}function he(I,T,Y,xe,_e){const P=s.convert(Y.format,Y.colorSpace),ce=s.convert(Y.type),fe=S(Y.internalFormat,P,ce,Y.colorSpace);i.get(T).__hasExternalTextures||(_e===n.TEXTURE_3D||_e===n.TEXTURE_2D_ARRAY?t.texImage3D(_e,0,fe,T.width,T.height,T.depth,0,P,ce,null):t.texImage2D(_e,0,fe,T.width,T.height,0,P,ce,null)),t.bindFramebuffer(n.FRAMEBUFFER,I),Me(T)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,xe,_e,i.get(Y).__webglTexture,0,be(T)):(_e===n.TEXTURE_2D||_e>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&_e<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,xe,_e,i.get(Y).__webglTexture,0),t.bindFramebuffer(n.FRAMEBUFFER,null)}function D(I,T,Y){if(n.bindRenderbuffer(n.RENDERBUFFER,I),T.depthBuffer&&!T.stencilBuffer){let xe=n.DEPTH_COMPONENT16;if(Y||Me(T)){const _e=T.depthTexture;_e&&_e.isDepthTexture&&(_e.type===ks?xe=n.DEPTH_COMPONENT32F:_e.type===ho&&(xe=n.DEPTH_COMPONENT24));const P=be(T);Me(T)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,P,xe,T.width,T.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,P,xe,T.width,T.height)}else n.renderbufferStorage(n.RENDERBUFFER,xe,T.width,T.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,I)}else if(T.depthBuffer&&T.stencilBuffer){const xe=be(T);Y&&!1===Me(T)?n.renderbufferStorageMultisample(n.RENDERBUFFER,xe,n.DEPTH24_STENCIL8,T.width,T.height):Me(T)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,xe,n.DEPTH24_STENCIL8,T.width,T.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,T.width,T.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,I)}else{const xe=!0===T.isWebGLMultipleRenderTargets?T.texture:[T.texture];for(let _e=0;_e<xe.length;_e++){const P=xe[_e],ce=s.convert(P.format,P.colorSpace),fe=s.convert(P.type),ne=S(P.internalFormat,ce,fe,P.colorSpace),Te=be(T);Y&&!1===Me(T)?n.renderbufferStorageMultisample(n.RENDERBUFFER,Te,ne,T.width,T.height):Me(T)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Te,ne,T.width,T.height):n.renderbufferStorage(n.RENDERBUFFER,ne,T.width,T.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function re(I){const T=i.get(I),Y=!0===I.isWebGLCubeRenderTarget;if(I.depthTexture&&!T.__autoAllocateDepthBuffer){if(Y)throw new Error("target.depthTexture not supported in Cube render targets");!function ye(I,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,I),!T.depthTexture||!T.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(T.depthTexture).__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),q(T.depthTexture,0);const xe=i.get(T.depthTexture).__webglTexture,_e=be(T);if(T.depthTexture.format===ta)Me(T)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,xe,0,_e):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,xe,0);else{if(T.depthTexture.format!==Wl)throw new Error("Unknown depthTexture format");Me(T)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,xe,0,_e):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,xe,0)}}(T.__webglFramebuffer,I)}else if(Y){T.__webglDepthbuffer=[];for(let xe=0;xe<6;xe++)t.bindFramebuffer(n.FRAMEBUFFER,T.__webglFramebuffer[xe]),T.__webglDepthbuffer[xe]=n.createRenderbuffer(),D(T.__webglDepthbuffer[xe],I,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,T.__webglFramebuffer),T.__webglDepthbuffer=n.createRenderbuffer(),D(T.__webglDepthbuffer,I,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function be(I){return Math.min(d,I.samples)}function Me(I){const T=i.get(I);return a&&I.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==T.__useRenderToTexture}function Ve(I,T){const Y=I.colorSpace,xe=I.format,_e=I.type;return!0===I.isCompressedTexture||I.format===R0||Y!==is&&Y!==ra&&(Y===rt?!1===a?!0===e.has("EXT_sRGB")&&xe===cr?(I.format=R0,I.minFilter=Jt,I.generateMipmaps=!1):T=zI.sRGBToLinear(T):(xe!==cr||_e!==uo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Y)),T}this.allocateTextureUnit=function $(){const I=U;return I>=l&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+l),U+=1,I},this.resetTextureUnits=function G(){U=0},this.setTexture2D=q,this.setTexture2DArray=function B(I,T){const Y=i.get(I);I.version>0&&Y.__version!==I.version?ue(Y,I,T):t.bindTexture(n.TEXTURE_2D_ARRAY,Y.__webglTexture,n.TEXTURE0+T)},this.setTexture3D=function k(I,T){const Y=i.get(I);I.version>0&&Y.__version!==I.version?ue(Y,I,T):t.bindTexture(n.TEXTURE_3D,Y.__webglTexture,n.TEXTURE0+T)},this.setTextureCube=function X(I,T){const Y=i.get(I);I.version>0&&Y.__version!==I.version?function Ce(I,T,Y){if(6!==T.image.length)return;const xe=ae(I,T),_e=T.source;t.bindTexture(n.TEXTURE_CUBE_MAP,I.__webglTexture,n.TEXTURE0+Y);const P=i.get(_e);if(_e.version!==P.__version||!0===xe){t.activeTexture(n.TEXTURE0+Y),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,T.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,T.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const ce=T.isCompressedTexture||T.image[0].isCompressedTexture,fe=T.image[0]&&T.image[0].isDataTexture,ne=[];for(let oe=0;oe<6;oe++)ne[oe]=ce||fe?fe?T.image[oe].image:T.image[oe]:y(T.image[oe],!1,!0,c),ne[oe]=Ve(T,ne[oe]);const Te=ne[0],Le=b(Te)||a,Re=s.convert(T.format,T.colorSpace),Ee=s.convert(T.type),Pe=S(T.internalFormat,Re,Ee,T.colorSpace),Ue=a&&!0!==T.isVideoTexture,qe=void 0===P.__version||!0===xe;let Ie,H=E(T,Te,Le);if(K(n.TEXTURE_CUBE_MAP,T,Le),ce){Ue&&qe&&t.texStorage2D(n.TEXTURE_CUBE_MAP,H,Pe,Te.width,Te.height);for(let oe=0;oe<6;oe++){Ie=ne[oe].mipmaps;for(let Fe=0;Fe<Ie.length;Fe++){const Oe=Ie[Fe];T.format!==cr?null!==Re?Ue?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe,0,0,Oe.width,Oe.height,Re,Oe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe,Pe,Oe.width,Oe.height,0,Oe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ue?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe,0,0,Oe.width,Oe.height,Re,Ee,Oe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe,Pe,Oe.width,Oe.height,0,Re,Ee,Oe.data)}}}else{Ie=T.mipmaps,Ue&&qe&&(Ie.length>0&&H++,t.texStorage2D(n.TEXTURE_CUBE_MAP,H,Pe,ne[0].width,ne[0].height));for(let oe=0;oe<6;oe++)if(fe){Ue?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,0,0,ne[oe].width,ne[oe].height,Re,Ee,ne[oe].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Pe,ne[oe].width,ne[oe].height,0,Re,Ee,ne[oe].data);for(let Fe=0;Fe<Ie.length;Fe++){const ft=Ie[Fe].image[oe].image;Ue?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe+1,0,0,ft.width,ft.height,Re,Ee,ft.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe+1,Pe,ft.width,ft.height,0,Re,Ee,ft.data)}}else{Ue?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,0,0,Re,Ee,ne[oe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Pe,Re,Ee,ne[oe]);for(let Fe=0;Fe<Ie.length;Fe++){const Oe=Ie[Fe];Ue?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe+1,0,0,Re,Ee,Oe.image[oe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,Fe+1,Pe,Re,Ee,Oe.image[oe])}}}M(T,Le)&&w(n.TEXTURE_CUBE_MAP),P.__version=_e.version,T.onUpdate&&T.onUpdate(T)}I.__version=T.version}(Y,I,T):t.bindTexture(n.TEXTURE_CUBE_MAP,Y.__webglTexture,n.TEXTURE0+T)},this.rebindTextures=function ie(I,T,Y){const xe=i.get(I);void 0!==T&&he(xe.__webglFramebuffer,I,I.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D),void 0!==Y&&re(I)},this.setupRenderTarget=function J(I){const T=I.texture,Y=i.get(I),xe=i.get(T);I.addEventListener("dispose",N),!0!==I.isWebGLMultipleRenderTargets&&(void 0===xe.__webglTexture&&(xe.__webglTexture=n.createTexture()),xe.__version=T.version,o.memory.textures++);const _e=!0===I.isWebGLCubeRenderTarget,P=!0===I.isWebGLMultipleRenderTargets,ce=b(I)||a;if(_e){Y.__webglFramebuffer=[];for(let fe=0;fe<6;fe++)Y.__webglFramebuffer[fe]=n.createFramebuffer()}else{if(Y.__webglFramebuffer=n.createFramebuffer(),P)if(r.drawBuffers){const fe=I.texture;for(let ne=0,Te=fe.length;ne<Te;ne++){const Le=i.get(fe[ne]);void 0===Le.__webglTexture&&(Le.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&I.samples>0&&!1===Me(I)){const fe=P?T:[T];Y.__webglMultisampledFramebuffer=n.createFramebuffer(),Y.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,Y.__webglMultisampledFramebuffer);for(let ne=0;ne<fe.length;ne++){const Te=fe[ne];Y.__webglColorRenderbuffer[ne]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Y.__webglColorRenderbuffer[ne]);const Le=s.convert(Te.format,Te.colorSpace),Re=s.convert(Te.type),Ee=S(Te.internalFormat,Le,Re,Te.colorSpace,!0===I.isXRRenderTarget),Pe=be(I);n.renderbufferStorageMultisample(n.RENDERBUFFER,Pe,Ee,I.width,I.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ne,n.RENDERBUFFER,Y.__webglColorRenderbuffer[ne])}n.bindRenderbuffer(n.RENDERBUFFER,null),I.depthBuffer&&(Y.__webglDepthRenderbuffer=n.createRenderbuffer(),D(Y.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(_e){t.bindTexture(n.TEXTURE_CUBE_MAP,xe.__webglTexture),K(n.TEXTURE_CUBE_MAP,T,ce);for(let fe=0;fe<6;fe++)he(Y.__webglFramebuffer[fe],I,T,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+fe);M(T,ce)&&w(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(P){const fe=I.texture;for(let ne=0,Te=fe.length;ne<Te;ne++){const Le=fe[ne],Re=i.get(Le);t.bindTexture(n.TEXTURE_2D,Re.__webglTexture),K(n.TEXTURE_2D,Le,ce),he(Y.__webglFramebuffer,I,Le,n.COLOR_ATTACHMENT0+ne,n.TEXTURE_2D),M(Le,ce)&&w(n.TEXTURE_2D)}t.unbindTexture()}else{let fe=n.TEXTURE_2D;(I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(a?fe=I.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(fe,xe.__webglTexture),K(fe,T,ce),he(Y.__webglFramebuffer,I,T,n.COLOR_ATTACHMENT0,fe),M(T,ce)&&w(fe),t.unbindTexture()}I.depthBuffer&&re(I)},this.updateRenderTargetMipmap=function Ae(I){const T=b(I)||a,Y=!0===I.isWebGLMultipleRenderTargets?I.texture:[I.texture];for(let xe=0,_e=Y.length;xe<_e;xe++){const P=Y[xe];if(M(P,T)){const ce=I.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,fe=i.get(P).__webglTexture;t.bindTexture(ce,fe),w(ce),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function se(I){if(a&&I.samples>0&&!1===Me(I)){const T=I.isWebGLMultipleRenderTargets?I.texture:[I.texture],Y=I.width,xe=I.height;let _e=n.COLOR_BUFFER_BIT;const P=[],ce=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,fe=i.get(I),ne=!0===I.isWebGLMultipleRenderTargets;if(ne)for(let Te=0;Te<T.length;Te++)t.bindFramebuffer(n.FRAMEBUFFER,fe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Te,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,fe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Te,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,fe.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,fe.__webglFramebuffer);for(let Te=0;Te<T.length;Te++){P.push(n.COLOR_ATTACHMENT0+Te),I.depthBuffer&&P.push(ce);const Le=void 0!==fe.__ignoreDepthValues&&fe.__ignoreDepthValues;if(!1===Le&&(I.depthBuffer&&(_e|=n.DEPTH_BUFFER_BIT),I.stencilBuffer&&(_e|=n.STENCIL_BUFFER_BIT)),ne&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,fe.__webglColorRenderbuffer[Te]),!0===Le&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[ce]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[ce])),ne){const Re=i.get(T[Te]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Re,0)}n.blitFramebuffer(0,0,Y,xe,0,0,Y,xe,_e,n.NEAREST),f&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,P)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ne)for(let Te=0;Te<T.length;Te++){t.bindFramebuffer(n.FRAMEBUFFER,fe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Te,n.RENDERBUFFER,fe.__webglColorRenderbuffer[Te]);const Le=i.get(T[Te]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,fe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Te,n.TEXTURE_2D,Le,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,fe.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=re,this.setupFrameBufferTexture=he,this.useMultisampledRTT=Me}function DX(n,e,t){const i=t.isWebGL2;return{convert:function r(s,o=ra){let a;if(s===uo)return n.UNSIGNED_BYTE;if(s===iI)return n.UNSIGNED_SHORT_4_4_4_4;if(s===rI)return n.UNSIGNED_SHORT_5_5_5_1;if(s===Pj)return n.BYTE;if(s===Fj)return n.SHORT;if(s===x0)return n.UNSIGNED_SHORT;if(s===nI)return n.INT;if(s===ho)return n.UNSIGNED_INT;if(s===ks)return n.FLOAT;if(s===pd)return i?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(s===Lj)return n.ALPHA;if(s===cr)return n.RGBA;if(s===Oj)return n.LUMINANCE;if(s===Nj)return n.LUMINANCE_ALPHA;if(s===ta)return n.DEPTH_COMPONENT;if(s===Wl)return n.DEPTH_STENCIL;if(s===R0)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(s===kj)return n.RED;if(s===sI)return n.RED_INTEGER;if(s===Uj)return n.RG;if(s===oI)return n.RG_INTEGER;if(s===aI)return n.RGBA_INTEGER;if(s===M0||s===E0||s===w0||s===S0)if(o===rt){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(s===M0)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===E0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===w0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===S0)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(s===M0)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===E0)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===w0)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===S0)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s===lI||s===cI||s===uI||s===dI){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(s===lI)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===cI)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===uI)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===dI)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s===Bj)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===hI||s===fI){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(s===hI)return o===rt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===fI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(s===pI||s===mI||s===gI||s===_I||s===yI||s===vI||s===bI||s===xI||s===MI||s===EI||s===wI||s===SI||s===TI||s===AI){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(s===pI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===mI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===gI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===_I)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===yI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===vI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===bI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===xI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===MI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===EI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===wI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===SI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===TI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===AI)return o===rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(s===T0){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(s===T0)return o===rt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(s===Vj||s===CI||s===DI||s===II){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(s===T0)return a.COMPRESSED_RED_RGTC1_EXT;if(s===CI)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===DI)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===II)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===ea?i?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class IX extends Un{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ss extends Nn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const RX={type:"move"};class lb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ss,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ss,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new R,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new R),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ss,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new R,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new R),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const m=t.getJointPose(_,i),g=this._getHandJoint(c,_);null!==m&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=m.radius),g.visible=null!==m}const h=c.joints["index-finger-tip"].position.distanceTo(c.joints["thumb-tip"].position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(RX)))}return null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),null!==c&&(c.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new ss;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class PX extends ur{constructor(e,t,i,r,s,o,a,l,c,u){if((u=void 0!==u?u:ta)!==ta&&u!==Wl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===ta&&(i=ho),void 0===i&&u===Wl&&(i=ea),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:_n,this.minFilter=void 0!==l?l:_n,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class FX extends sa{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,d=null,h=null,f=null,p=null;const _=t.getContextAttributes();let m=null,g=null;const v=[],y=[];let b=null;const x=new Un;x.layers.enable(1),x.viewport=new Lt;const M=new Un;M.layers.enable(2),M.viewport=new Lt;const w=[x,M],S=new IX;S.layers.enable(1),S.layers.enable(2);let E=null,C=null;function W(k){const X=y.indexOf(k.inputSource);if(-1===X)return;const j=v[X];void 0!==j&&(j.update(k.inputSource,k.frame,c||o),j.dispatchEvent({type:k.type,data:k.inputSource}))}function N(){r.removeEventListener("select",W),r.removeEventListener("selectstart",W),r.removeEventListener("selectend",W),r.removeEventListener("squeeze",W),r.removeEventListener("squeezestart",W),r.removeEventListener("squeezeend",W),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",L);for(let k=0;k<v.length;k++){const X=y[k];null!==X&&(y[k]=null,v[k].disconnect(X))}E=null,C=null,e.setRenderTarget(m),f=null,h=null,d=null,r=null,g=null,B.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function L(k){for(let X=0;X<k.removed.length;X++){const j=k.removed[X],Q=y.indexOf(j);Q>=0&&(y[Q]=null,v[Q].disconnect(j))}for(let X=0;X<k.added.length;X++){const j=k.added[X];let Q=y.indexOf(j);if(-1===Q){for(let K=0;K<v.length;K++){if(K>=y.length){y.push(j),Q=K;break}if(null===y[K]){y[K]=j,Q=K;break}}if(-1===Q)break}const te=v[Q];te&&te.connect(j)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(k){b=k},this.getController=function(k){let X=v[k];return void 0===X&&(X=new lb,v[k]=X),X.getTargetRaySpace()},this.getControllerGrip=function(k){let X=v[k];return void 0===X&&(X=new lb,v[k]=X),X.getGripSpace()},this.getHand=function(k){let X=v[k];return void 0===X&&(X=new lb,v[k]=X),X.getHandSpace()},this.setFramebufferScaleFactor=function(k){s=k,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(k){a=k,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(k){c=k},this.getBaseLayer=function(){return null!==h?h:f},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(){var k=function nj(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(l){$D(s,i,r,o,a,"next",l)}function a(l){$D(s,i,r,o,a,"throw",l)}o(void 0)})}}(function*(X){if(r=X,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",W),r.addEventListener("selectstart",W),r.addEventListener("selectend",W),r.addEventListener("squeeze",W),r.addEventListener("squeezestart",W),r.addEventListener("squeezeend",W),r.addEventListener("end",N),r.addEventListener("inputsourceschange",L),!0!==_.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)f=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:f}),g=new aa(f.framebufferWidth,f.framebufferHeight,{format:cr,type:uo,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil});else{let j=null,Q=null,te=null;_.depth&&(te=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,j=_.stencil?Wl:ta,Q=_.stencil?ea:ho);const K={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:s};d=new XRWebGLBinding(r,t),h=d.createProjectionLayer(K),r.updateRenderState({layers:[h]}),g=new aa(h.textureWidth,h.textureHeight,{format:cr,type:uo,depthTexture:new PX(h.textureWidth,h.textureHeight,Q,void 0,void 0,void 0,void 0,void 0,void 0,j),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=yield r.requestReferenceSpace(a),B.setContext(r),B.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(X){return k.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const O=new R,z=new R;function G(k,X){null===X?k.matrixWorld.copy(k.matrix):k.matrixWorld.multiplyMatrices(X.matrixWorld,k.matrix),k.matrixWorldInverse.copy(k.matrixWorld).invert()}this.updateCameraXR=function(k){if(null===r)return k;b&&(k=b),S.near=M.near=x.near=k.near,S.far=M.far=x.far=k.far,(E!==S.near||C!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),E=S.near,C=S.far);const X=k.parent,j=S.cameras;G(S,X);for(let Q=0;Q<j.length;Q++)G(j[Q],X);return 2===j.length?function U(k,X,j){O.setFromMatrixPosition(X.matrixWorld),z.setFromMatrixPosition(j.matrixWorld);const Q=O.distanceTo(z),te=X.projectionMatrix.elements,K=j.projectionMatrix.elements,ae=te[14]/(te[10]-1),ue=te[14]/(te[10]+1),Ce=(te[9]+1)/te[5],he=(te[9]-1)/te[5],D=(te[8]-1)/te[0],ye=(K[8]+1)/K[0],re=ae*D,ie=ae*ye,J=Q/(-D+ye),Ae=J*-D;X.matrixWorld.decompose(k.position,k.quaternion,k.scale),k.translateX(Ae),k.translateZ(J),k.matrixWorld.compose(k.position,k.quaternion,k.scale),k.matrixWorldInverse.copy(k.matrixWorld).invert();const se=ae+J,be=ue+J;k.projectionMatrix.makePerspective(re-Ae,ie+(Q-Ae),Ce*ue/be*se,he*ue/be*se,se,be),k.projectionMatrixInverse.copy(k.projectionMatrix).invert()}(S,x,M):S.projectionMatrix.copy(x.projectionMatrix),b&&function $(k,X){const j=b;null===X?j.matrix.copy(k.matrixWorld):(j.matrix.copy(X.matrixWorld),j.matrix.invert(),j.matrix.multiply(k.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0);const Q=j.children;for(let te=0,K=Q.length;te<K;te++)Q[te].updateMatrixWorld(!0);j.projectionMatrix.copy(k.projectionMatrix),j.projectionMatrixInverse.copy(k.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=2*Xl*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}(S,X),S},this.getFoveation=function(){if(null!==h||null!==f)return l},this.setFoveation=function(k){l=k,null!==h&&(h.fixedFoveation=k),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=k)};let V=null;const B=new lR;B.setAnimationLoop(function q(k,X){if(u=X.getViewerPose(c||o),p=X,null!==u){const j=u.views;null!==f&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let Q=!1;j.length!==S.cameras.length&&(S.cameras.length=0,Q=!0);for(let te=0;te<j.length;te++){const K=j[te];let ae=null;if(null!==f)ae=f.getViewport(K);else{const Ce=d.getViewSubImage(h,K);ae=Ce.viewport,0===te&&(e.setRenderTargetTextures(g,Ce.colorTexture,h.ignoreDepthValues?void 0:Ce.depthStencilTexture),e.setRenderTarget(g))}let ue=w[te];void 0===ue&&(ue=new Un,ue.layers.enable(te),ue.viewport=new Lt,w[te]=ue),ue.matrix.fromArray(K.transform.matrix),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale),ue.projectionMatrix.fromArray(K.projectionMatrix),ue.projectionMatrixInverse.copy(ue.projectionMatrix).invert(),ue.viewport.set(ae.x,ae.y,ae.width,ae.height),0===te&&(S.matrix.copy(ue.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),!0===Q&&S.cameras.push(ue)}}for(let j=0;j<v.length;j++){const Q=y[j],te=v[j];null!==Q&&void 0!==te&&te.update(Q,X,c||o)}V&&V(k,X),X.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:X}),p=null}),this.setAnimationLoop=function(k){V=k},this.dispose=function(){}}}function LX(n,e){function t(m,g){!0===m.matrixAutoUpdate&&m.updateMatrix(),g.value.copy(m.matrix)}function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map,t(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.bumpMap&&(m.bumpMap.value=g.bumpMap,t(g.bumpMap,m.bumpMapTransform),m.bumpScale.value=g.bumpScale,g.side===ti&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,t(g.normalMap,m.normalMapTransform),m.normalScale.value.copy(g.normalScale),g.side===ti&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,t(g.displacementMap,m.displacementMapTransform),m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,m.emissiveMapTransform)),g.specularMap&&(m.specularMap.value=g.specularMap,t(g.specularMap,m.specularMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const y=!0===n.useLegacyLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*y,t(g.lightMap,m.lightMapTransform)}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,m.aoMapTransform))}return{refreshFogUniforms:function i(m,g){g.color.getRGB(m.fogColor.value,oR(n)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function r(m,g,v,y,b){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),function d(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(s(m,g),function u(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(s(m,g),function h(m,g){m.metalness.value=g.metalness,g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,m.metalnessMapTransform)),m.roughness.value=g.roughness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,m.roughnessMapTransform)),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function f(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===ti&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,m.specularIntensityMapTransform))}(m,g,b)):g.isMeshMatcapMaterial?(s(m,g),function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),function _(m,g){const v=e.get(g).light;m.referencePosition.value.setFromMatrixPosition(v.matrixWorld),m.nearDistance.value=v.shadow.camera.near,m.farDistance.value=v.shadow.camera.far}(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(function o(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,g.map&&(m.map.value=g.map,t(g.map,m.mapTransform))}(m,g),g.isLineDashedMaterial&&function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function l(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=.5*y,g.map&&(m.map.value=g.map,t(g.map,m.uvTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}(m,g,v,y):g.isSpriteMaterial?function c(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map,t(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function OX(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function f(v,y,b){const x=v.value;if(void 0===b[y]){if("number"==typeof x)b[y]=x;else{const M=Array.isArray(x)?x:[x],w=[];for(let S=0;S<M.length;S++)w.push(M[S].clone());b[y]=w}return!0}if("number"==typeof x){if(b[y]!==x)return b[y]=x,!0}else{const M=Array.isArray(b[y])?b[y]:[b[y]],w=Array.isArray(x)?x:[x];for(let S=0;S<M.length;S++){const E=M[S];if(!1===E.equals(w[S]))return E.copy(w[S]),!0}}return!1}function _(v){const y={boundary:0,storage:0};return"number"==typeof v?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function m(v){const y=v.target;y.removeEventListener("dispose",m);const b=o.indexOf(y.__bindingPointIndex);o.splice(b,1),n.deleteBuffer(r[y.id]),delete r[y.id],delete s[y.id]}return{bind:function l(v,y){i.uniformBlockBinding(v,y.program)},update:function c(v,y){let b=r[v.id];void 0===b&&(function p(v){const y=v.uniforms;let b=0;let M=0;for(let w=0,S=y.length;w<S;w++){const E=y[w],C={boundary:0,storage:0},W=Array.isArray(E.value)?E.value:[E.value];for(let N=0,L=W.length;N<L;N++){const z=_(W[N]);C.boundary+=z.boundary,C.storage+=z.storage}E.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=b,w>0&&(M=b%16,0!==M&&16-M-C.boundary<0&&(b+=16-M,E.__offset=b)),b+=C.storage}M=b%16,M>0&&(b+=16-M),v.__size=b,v.__cache={}}(v),b=function u(v){const y=function d(){for(let v=0;v<a;v++)if(-1===o.indexOf(v))return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();v.__bindingPointIndex=y;const b=n.createBuffer(),x=v.__size,M=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,b),n.bufferData(n.UNIFORM_BUFFER,x,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,b),b}(v),r[v.id]=b,v.addEventListener("dispose",m)),i.updateUBOMapping(v,y.program);const M=e.render.frame;s[v.id]!==M&&(function h(v){const b=v.uniforms,x=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[v.id]);for(let M=0,w=b.length;M<w;M++){const S=b[M];if(!0===f(S,M,x)){const E=S.__offset,C=Array.isArray(S.value)?S.value:[S.value];let W=0;for(let N=0;N<C.length;N++){const L=C[N],O=_(L);"number"==typeof L?(S.__data[0]=L,n.bufferSubData(n.UNIFORM_BUFFER,E+W,S.__data)):L.isMatrix3?(S.__data[0]=L.elements[0],S.__data[1]=L.elements[1],S.__data[2]=L.elements[2],S.__data[3]=L.elements[0],S.__data[4]=L.elements[3],S.__data[5]=L.elements[4],S.__data[6]=L.elements[5],S.__data[7]=L.elements[0],S.__data[8]=L.elements[6],S.__data[9]=L.elements[7],S.__data[10]=L.elements[8],S.__data[11]=L.elements[0]):(L.toArray(S.__data,W),W+=O.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,E,S.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(v),s[v.id]=M)},dispose:function g(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}}}function NX(){const n=_d("canvas");return n.style.display="block",n}class OR{constructor(e={}){const{canvas:t=NX(),context:i=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==i?i.getContextAttributes().alpha:o;const f=new Uint32Array(4),p=new Int32Array(4);let _=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=rt,this.useLegacyLights=!0,this.toneMapping=Os,this.toneMappingExposure=1;const y=this;let b=!1,x=0,M=0,w=null,S=-1,E=null;const C=new Lt,W=new Lt;let N=null;const L=new Ne(0);let O=0,z=t.width,U=t.height,G=1,$=null,V=null;const q=new Lt(0,0,z,U),B=new Lt(0,0,z,U);let k=!1;const X=new eb;let j=!1,Q=!1,te=null;const K=new tt,ae=new ve,ue=new R,Ce={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function he(){return null===w?G:1}let re,ie,J,Ae,se,be,Me,de,Ve,I,T,Y,xe,_e,P,ce,fe,ne,Te,Le,Re,Ee,Pe,Ue,D=i;function ye(F,le){for(let pe=0;pe<F.length;pe++){const ge=t.getContext(F[pe],le);if(null!==ge)return ge}return null}try{const F={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r153"),t.addEventListener("webglcontextlost",Ie,!1),t.addEventListener("webglcontextrestored",oe,!1),t.addEventListener("webglcontextcreationerror",Fe,!1),null===D){const le=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&le.shift(),D=ye(le,F),null===D)throw ye(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}D instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===D.getShaderPrecisionFormat&&(D.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}function qe(){re=new Y7(D),ie=new G7(D,re,e),re.init(ie),Ee=new DX(D,re,ie),J=new AX(D,re,ie),Ae=new Q7(D),se=new mX,be=new CX(D,re,J,se,ie,Ee,Ae),Me=new j7(y),de=new X7(y),Ve=new W9(D,ie),Pe=new z7(D,re,Ve,ie),I=new K7(D,Ve,Ae,Pe),T=new nq(D,I,Ve,Ae),Te=new tq(D,ie,be),ce=new W7(se),Y=new pX(y,Me,de,re,ie,Pe,ce),xe=new LX(y,se),_e=new _X,P=new EX(re,ie),ne=new V7(y,Me,de,J,T,h,l),fe=new TX(y,T,ie),Ue=new OX(D,Ae,ie,J),Le=new H7(D,re,Ae,ie),Re=new Z7(D,re,Ae,ie),Ae.programs=Y.programs,y.capabilities=ie,y.extensions=re,y.properties=se,y.renderLists=_e,y.shadowMap=fe,y.state=J,y.info=Ae}qe();const H=new FX(y,D);function Ie(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function oe(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const F=Ae.autoReset,le=fe.enabled,pe=fe.autoUpdate,ee=fe.needsUpdate,ge=fe.type;qe(),Ae.autoReset=F,fe.enabled=le,fe.autoUpdate=pe,fe.needsUpdate=ee,fe.type=ge}function Fe(F){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",F.statusMessage)}function Oe(F){const le=F.target;le.removeEventListener("dispose",Oe),function ft(F){(function Tt(F){const le=se.get(F).programs;void 0!==le&&(le.forEach(function(pe){Y.releaseProgram(pe)}),F.isShaderMaterial&&Y.releaseShaderCache(F))})(F),se.remove(F)}(le)}this.xr=H,this.getContext=function(){return D},this.getContextAttributes=function(){return D.getContextAttributes()},this.forceContextLoss=function(){const F=re.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){const F=re.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(F){void 0!==F&&(G=F,this.setSize(z,U,!1))},this.getSize=function(F){return F.set(z,U)},this.setSize=function(F,le,pe=!0){H.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(z=F,U=le,t.width=Math.floor(F*G),t.height=Math.floor(le*G),!0===pe&&(t.style.width=F+"px",t.style.height=le+"px"),this.setViewport(0,0,F,le))},this.getDrawingBufferSize=function(F){return F.set(z*G,U*G).floor()},this.setDrawingBufferSize=function(F,le,pe){z=F,U=le,G=pe,t.width=Math.floor(F*pe),t.height=Math.floor(le*pe),this.setViewport(0,0,F,le)},this.getCurrentViewport=function(F){return F.copy(C)},this.getViewport=function(F){return F.copy(q)},this.setViewport=function(F,le,pe,ee){F.isVector4?q.set(F.x,F.y,F.z,F.w):q.set(F,le,pe,ee),J.viewport(C.copy(q).multiplyScalar(G).floor())},this.getScissor=function(F){return F.copy(B)},this.setScissor=function(F,le,pe,ee){F.isVector4?B.set(F.x,F.y,F.z,F.w):B.set(F,le,pe,ee),J.scissor(W.copy(B).multiplyScalar(G).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(F){J.setScissorTest(k=F)},this.setOpaqueSort=function(F){$=F},this.setTransparentSort=function(F){V=F},this.getClearColor=function(F){return F.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(F=!0,le=!0,pe=!0){let ee=0;if(F){let ge=!1;if(null!==w){const We=w.texture.format;ge=We===aI||We===oI||We===sI}if(ge){const We=w.texture.type,Xe=We===uo||We===ho||We===x0||We===ea||We===iI||We===rI,Je=ne.getClearColor(),nt=ne.getClearAlpha(),pt=Je.r,De=Je.g,st=Je.b,Vt=se.get(w).__webglFramebuffer;Xe?(f[0]=pt,f[1]=De,f[2]=st,f[3]=nt,D.clearBufferuiv(D.COLOR,Vt,f)):(p[0]=pt,p[1]=De,p[2]=st,p[3]=nt,D.clearBufferiv(D.COLOR,Vt,p))}else ee|=D.COLOR_BUFFER_BIT}le&&(ee|=D.DEPTH_BUFFER_BIT),pe&&(ee|=D.STENCIL_BUFFER_BIT),D.clear(ee)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ie,!1),t.removeEventListener("webglcontextrestored",oe,!1),t.removeEventListener("webglcontextcreationerror",Fe,!1),_e.dispose(),P.dispose(),se.dispose(),Me.dispose(),de.dispose(),T.dispose(),Pe.dispose(),Ue.dispose(),Y.dispose(),H.dispose(),H.removeEventListener("sessionstart",Ut),H.removeEventListener("sessionend",Dt),te&&(te.dispose(),te=null),Et.stop()},this.renderBufferDirect=function(F,le,pe,ee,ge,We){null===le&&(le=Ce);const Xe=ge.isMesh&&ge.matrixWorld.determinant()<0,Je=function qn(F,le,pe,ee,ge){!0!==le.isScene&&(le=Ce),be.resetTextureUnits();const We=le.fog,Je=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:is,nt=(ee.isMeshStandardMaterial?de:Me).get(ee.envMap||(ee.isMeshStandardMaterial?le.environment:null)),pt=!0===ee.vertexColors&&!!pe.attributes.color&&4===pe.attributes.color.itemSize,De=!!pe.attributes.tangent&&(!!ee.normalMap||ee.anisotropy>0),st=!!pe.morphAttributes.position,Vt=!!pe.morphAttributes.normal,qt=!!pe.morphAttributes.color,Ii=ee.toneMapped?y.toneMapping:Os,Qi=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,Kt=void 0!==Qi?Qi.length:0,xt=se.get(ee),zc=m.state.lights;!0!==j||!0!==Q&&F===E||ce.setState(ee,F,F===E&&ee.id===S);let rn=!1;ee.version===xt.__version?(xt.needsLights&&xt.lightsStateVersion!==zc.state.version||xt.outputColorSpace!==Je||ge.isInstancedMesh&&!1===xt.instancing||!ge.isInstancedMesh&&!0===xt.instancing||ge.isSkinnedMesh&&!1===xt.skinning||!ge.isSkinnedMesh&&!0===xt.skinning||xt.envMap!==nt||!0===ee.fog&&xt.fog!==We||void 0!==xt.numClippingPlanes&&(xt.numClippingPlanes!==ce.numPlanes||xt.numIntersection!==ce.numIntersection)||xt.vertexAlphas!==pt||xt.vertexTangents!==De||xt.morphTargets!==st||xt.morphNormals!==Vt||xt.morphColors!==qt||xt.toneMapping!==Ii||!0===ie.isWebGL2&&xt.morphTargetsCount!==Kt)&&(rn=!0):(rn=!0,xt.__version=ee.version);let fs=xt.currentProgram;!0===rn&&(fs=bn(ee,le,ge));let Hc=!1,Ao=!1,Ks=!1;const Ln=fs.getUniforms(),Ri=xt.uniforms;if(J.useProgram(fs.program)&&(Hc=!0,Ao=!0,Ks=!0),ee.id!==S&&(S=ee.id,Ao=!0),Hc||E!==F){if(Ln.setValue(D,"projectionMatrix",F.projectionMatrix),ie.logarithmicDepthBuffer&&Ln.setValue(D,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),E!==F&&(E=F,Ao=!0,Ks=!0),ee.isShaderMaterial||ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshStandardMaterial||ee.envMap){const Xn=Ln.map.cameraPosition;void 0!==Xn&&Xn.setValue(D,ue.setFromMatrixPosition(F.matrixWorld))}(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial)&&Ln.setValue(D,"isOrthographic",!0===F.isOrthographicCamera),(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial||ee.isShadowMaterial||ge.isSkinnedMesh)&&Ln.setValue(D,"viewMatrix",F.matrixWorldInverse)}if(ge.isSkinnedMesh){Ln.setOptional(D,ge,"bindMatrix"),Ln.setOptional(D,ge,"bindMatrixInverse");const Xn=ge.skeleton;Xn&&(ie.floatVertexTextures?(null===Xn.boneTexture&&Xn.computeBoneTexture(),Ln.setValue(D,"boneTexture",Xn.boneTexture,be),Ln.setValue(D,"boneTextureSize",Xn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ka=pe.morphAttributes;if((void 0!==ka.position||void 0!==ka.normal||void 0!==ka.color&&!0===ie.isWebGL2)&&Te.update(ge,pe,fs),(Ao||xt.receiveShadow!==ge.receiveShadow)&&(xt.receiveShadow=ge.receiveShadow,Ln.setValue(D,"receiveShadow",ge.receiveShadow)),ee.isMeshGouraudMaterial&&null!==ee.envMap&&(Ri.envMap.value=nt,Ri.flipEnvMap.value=nt.isCubeTexture&&!1===nt.isRenderTargetTexture?-1:1),Ao&&(Ln.setValue(D,"toneMappingExposure",y.toneMappingExposure),xt.needsLights&&function hs(F,le){F.ambientLightColor.needsUpdate=le,F.lightProbe.needsUpdate=le,F.directionalLights.needsUpdate=le,F.directionalLightShadows.needsUpdate=le,F.pointLights.needsUpdate=le,F.pointLightShadows.needsUpdate=le,F.spotLights.needsUpdate=le,F.spotLightShadows.needsUpdate=le,F.rectAreaLights.needsUpdate=le,F.hemisphereLights.needsUpdate=le}(Ri,Ks),We&&!0===ee.fog&&xe.refreshFogUniforms(Ri,We),xe.refreshMaterialUniforms(Ri,ee,G,U,te),nm.upload(D,xt.uniformsList,Ri,be)),ee.isShaderMaterial&&!0===ee.uniformsNeedUpdate&&(nm.upload(D,xt.uniformsList,Ri,be),ee.uniformsNeedUpdate=!1),ee.isSpriteMaterial&&Ln.setValue(D,"center",ge.center),Ln.setValue(D,"modelViewMatrix",ge.modelViewMatrix),Ln.setValue(D,"normalMatrix",ge.normalMatrix),Ln.setValue(D,"modelMatrix",ge.matrixWorld),ee.isShaderMaterial||ee.isRawShaderMaterial){const Xn=ee.uniformsGroups;for(let Ua=0,Ba=Xn.length;Ua<Ba;Ua++)if(ie.isWebGL2){const gg=Xn[Ua];Ue.update(gg,fs),Ue.bind(gg,fs)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return fs}(F,le,pe,ee,ge);J.setMaterial(ee,Xe);let nt=pe.index,pt=1;!0===ee.wireframe&&(nt=I.getWireframeAttribute(pe),pt=2);const De=pe.drawRange,st=pe.attributes.position;let Vt=De.start*pt,qt=(De.start+De.count)*pt;null!==We&&(Vt=Math.max(Vt,We.start*pt),qt=Math.min(qt,(We.start+We.count)*pt)),null!==nt?(Vt=Math.max(Vt,0),qt=Math.min(qt,nt.count)):null!=st&&(Vt=Math.max(Vt,0),qt=Math.min(qt,st.count));const Ii=qt-Vt;if(Ii<0||Ii===1/0)return;Pe.setup(ge,ee,Je,pe,nt);let Qi,Kt=Le;if(null!==nt&&(Qi=Ve.get(nt),Kt=Re,Kt.setIndex(Qi)),ge.isMesh)!0===ee.wireframe?(J.setLineWidth(ee.wireframeLinewidth*he()),Kt.setMode(D.LINES)):Kt.setMode(D.TRIANGLES);else if(ge.isLine){let xt=ee.linewidth;void 0===xt&&(xt=1),J.setLineWidth(xt*he()),Kt.setMode(ge.isLineSegments?D.LINES:ge.isLineLoop?D.LINE_LOOP:D.LINE_STRIP)}else ge.isPoints?Kt.setMode(D.POINTS):ge.isSprite&&Kt.setMode(D.TRIANGLES);if(ge.isInstancedMesh)Kt.renderInstances(Vt,Ii,ge.count);else if(pe.isInstancedBufferGeometry){const zc=Math.min(pe.instanceCount,void 0!==pe._maxInstanceCount?pe._maxInstanceCount:1/0);Kt.renderInstances(Vt,Ii,zc)}else Kt.render(Vt,Ii)},this.compile=function(F,le){function pe(ee,ge,We){!0===ee.transparent&&ee.side===Gi&&!1===ee.forceSinglePass?(ee.side=ti,ee.needsUpdate=!0,bn(ee,ge,We),ee.side=ns,ee.needsUpdate=!0,bn(ee,ge,We),ee.side=Gi):bn(ee,ge,We)}m=P.get(F),m.init(),v.push(m),F.traverseVisible(function(ee){ee.isLight&&ee.layers.test(le.layers)&&(m.pushLight(ee),ee.castShadow&&m.pushShadow(ee))}),m.setupLights(y.useLegacyLights),F.traverse(function(ee){const ge=ee.material;if(ge)if(Array.isArray(ge))for(let We=0;We<ge.length;We++)pe(ge[We],F,ee);else pe(ge,F,ee)}),v.pop(),m=null};let Ct=null;function Ut(){Et.stop()}function Dt(){Et.start()}const Et=new lR;function Di(F,le,pe,ee){if(!1===F.visible)return;if(F.layers.test(le.layers))if(F.isGroup)pe=F.renderOrder;else if(F.isLOD)!0===F.autoUpdate&&F.update(le);else if(F.isLight)m.pushLight(F),F.castShadow&&m.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||X.intersectsSprite(F)){ee&&ue.setFromMatrixPosition(F.matrixWorld).applyMatrix4(K);const Xe=T.update(F),Je=F.material;Je.visible&&_.push(F,Xe,Je,pe,ue.z,null)}}else if((F.isMesh||F.isLine||F.isPoints)&&(!F.frustumCulled||X.intersectsObject(F))){F.isSkinnedMesh&&F.skeleton.frame!==Ae.render.frame&&(F.skeleton.update(),F.skeleton.frame=Ae.render.frame);const Xe=T.update(F),Je=F.material;if(ee&&(void 0!==F.boundingSphere?(null===F.boundingSphere&&F.computeBoundingSphere(),ue.copy(F.boundingSphere.center)):(null===Xe.boundingSphere&&Xe.computeBoundingSphere(),ue.copy(Xe.boundingSphere.center)),ue.applyMatrix4(F.matrixWorld).applyMatrix4(K)),Array.isArray(Je)){const nt=Xe.groups;for(let pt=0,De=nt.length;pt<De;pt++){const st=nt[pt],Vt=Je[st.materialIndex];Vt&&Vt.visible&&_.push(F,Xe,Vt,pe,ue.z,st)}}else Je.visible&&_.push(F,Xe,Je,pe,ue.z,null)}const We=F.children;for(let Xe=0,Je=We.length;Xe<Je;Xe++)Di(We[Xe],le,pe,ee)}function ai(F,le,pe,ee){const ge=F.opaque,We=F.transmissive,Xe=F.transparent;m.setupLightsView(pe),!0===j&&ce.setGlobalState(y.clippingPlanes,pe),We.length>0&&function kt(F,le,pe,ee){const ge=ie.isWebGL2;null===te&&(te=new aa(1,1,{generateMipmaps:!0,type:re.has("EXT_color_buffer_half_float")?pd:uo,minFilter:Ns,samples:ge&&!0===a?4:0})),y.getDrawingBufferSize(ae),ge?te.setSize(ae.x,ae.y):te.setSize(Pp(ae.x),Pp(ae.y));const We=y.getRenderTarget();y.setRenderTarget(te),y.getClearColor(L),O=y.getClearAlpha(),O<1&&y.setClearColor(16777215,.5),y.clear();const Xe=y.toneMapping;y.toneMapping=Os,dn(F,pe,ee),be.updateMultisampleRenderTarget(te),be.updateRenderTargetMipmap(te);let Je=!1;for(let nt=0,pt=le.length;nt<pt;nt++){const De=le[nt],st=De.object,Vt=De.geometry,qt=De.material,Ii=De.group;if(qt.side===Gi&&st.layers.test(ee.layers)){const Qi=qt.side;qt.side=ti,qt.needsUpdate=!0,vi(st,pe,ee,Vt,qt,Ii),qt.side=Qi,qt.needsUpdate=!0,Je=!0}}!0===Je&&(be.updateMultisampleRenderTarget(te),be.updateRenderTargetMipmap(te)),y.setRenderTarget(We),y.setClearColor(L,O),y.toneMapping=Xe}(ge,We,le,pe),ee&&J.viewport(C.copy(ee)),ge.length>0&&dn(ge,le,pe),We.length>0&&dn(We,le,pe),Xe.length>0&&dn(Xe,le,pe),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function dn(F,le,pe){const ee=!0===le.isScene?le.overrideMaterial:null;for(let ge=0,We=F.length;ge<We;ge++){const Xe=F[ge],Je=Xe.object,nt=Xe.geometry,pt=null===ee?Xe.material:ee,De=Xe.group;Je.layers.test(pe.layers)&&vi(Je,le,pe,nt,pt,De)}}function vi(F,le,pe,ee,ge,We){F.onBeforeRender(y,le,pe,ee,ge,We),F.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),ge.onBeforeRender(y,le,pe,ee,F,We),!0===ge.transparent&&ge.side===Gi&&!1===ge.forceSinglePass?(ge.side=ti,ge.needsUpdate=!0,y.renderBufferDirect(pe,le,ee,ge,F,We),ge.side=ns,ge.needsUpdate=!0,y.renderBufferDirect(pe,le,ee,ge,F,We),ge.side=Gi):y.renderBufferDirect(pe,le,ee,ge,F,We),F.onAfterRender(y,le,pe,ee,ge,We)}function bn(F,le,pe){!0!==le.isScene&&(le=Ce);const ee=se.get(F),ge=m.state.lights,Xe=ge.state.version,Je=Y.getParameters(F,ge.state,m.state.shadowsArray,le,pe),nt=Y.getProgramCacheKey(Je);let pt=ee.programs;ee.environment=F.isMeshStandardMaterial?le.environment:null,ee.fog=le.fog,ee.envMap=(F.isMeshStandardMaterial?de:Me).get(F.envMap||ee.environment),void 0===pt&&(F.addEventListener("dispose",Oe),pt=new Map,ee.programs=pt);let De=pt.get(nt);if(void 0!==De){if(ee.currentProgram===De&&ee.lightsStateVersion===Xe)return xn(F,Je),De}else Je.uniforms=Y.getUniforms(F),F.onBuild(pe,Je,y),F.onBeforeCompile(Je,y),De=Y.acquireProgram(Je,nt),pt.set(nt,De),ee.uniforms=Je.uniforms;const st=ee.uniforms;(!F.isShaderMaterial&&!F.isRawShaderMaterial||!0===F.clipping)&&(st.clippingPlanes=ce.uniform),xn(F,Je),ee.needsLights=function Zi(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&!0===F.lights}(F),ee.lightsStateVersion=Xe,ee.needsLights&&(st.ambientLightColor.value=ge.state.ambient,st.lightProbe.value=ge.state.probe,st.directionalLights.value=ge.state.directional,st.directionalLightShadows.value=ge.state.directionalShadow,st.spotLights.value=ge.state.spot,st.spotLightShadows.value=ge.state.spotShadow,st.rectAreaLights.value=ge.state.rectArea,st.ltc_1.value=ge.state.rectAreaLTC1,st.ltc_2.value=ge.state.rectAreaLTC2,st.pointLights.value=ge.state.point,st.pointLightShadows.value=ge.state.pointShadow,st.hemisphereLights.value=ge.state.hemi,st.directionalShadowMap.value=ge.state.directionalShadowMap,st.directionalShadowMatrix.value=ge.state.directionalShadowMatrix,st.spotShadowMap.value=ge.state.spotShadowMap,st.spotLightMatrix.value=ge.state.spotLightMatrix,st.spotLightMap.value=ge.state.spotLightMap,st.pointShadowMap.value=ge.state.pointShadowMap,st.pointShadowMatrix.value=ge.state.pointShadowMatrix);const Vt=De.getUniforms(),qt=nm.seqWithValue(Vt.seq,st);return ee.currentProgram=De,ee.uniformsList=qt,De}function xn(F,le){const pe=se.get(F);pe.outputColorSpace=le.outputColorSpace,pe.instancing=le.instancing,pe.skinning=le.skinning,pe.morphTargets=le.morphTargets,pe.morphNormals=le.morphNormals,pe.morphColors=le.morphColors,pe.morphTargetsCount=le.morphTargetsCount,pe.numClippingPlanes=le.numClippingPlanes,pe.numIntersection=le.numClipIntersection,pe.vertexAlphas=le.vertexAlphas,pe.vertexTangents=le.vertexTangents,pe.toneMapping=le.toneMapping}Et.setAnimationLoop(function Ot(F){Ct&&Ct(F)}),typeof self<"u"&&Et.setContext(self),this.setAnimationLoop=function(F){Ct=F,H.setAnimationLoop(F),null===F?Et.stop():Et.start()},H.addEventListener("sessionstart",Ut),H.addEventListener("sessionend",Dt),this.render=function(F,le){if(void 0===le||!0===le.isCamera){if(!0!==b){if(!0===F.matrixWorldAutoUpdate&&F.updateMatrixWorld(),null===le.parent&&!0===le.matrixWorldAutoUpdate&&le.updateMatrixWorld(),!0===H.enabled&&!0===H.isPresenting&&(le=H.updateCameraXR(le)),!0===F.isScene&&F.onBeforeRender(y,F,le,w),m=P.get(F,v.length),m.init(),v.push(m),K.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),X.setFromProjectionMatrix(K),Q=this.localClippingEnabled,j=ce.init(this.clippingPlanes,Q),_=_e.get(F,g.length),_.init(),g.push(_),Di(F,le,0,y.sortObjects),_.finish(),!0===y.sortObjects&&_.sort($,V),!0===j&&ce.beginShadows(),fe.render(m.state.shadowsArray,F,le),!0===j&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset(),this.info.render.frame++,ne.render(_,F),m.setupLights(y.useLegacyLights),le.isArrayCamera){const ee=le.cameras;for(let ge=0,We=ee.length;ge<We;ge++){const Xe=ee[ge];ai(_,F,Xe,Xe.viewport)}}else ai(_,F,le);null!==w&&(be.updateMultisampleRenderTarget(w),be.updateRenderTargetMipmap(w)),!0===F.isScene&&F.onAfterRender(y,F,le),Pe.resetDefaultState(),S=-1,E=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),_=g.length>0?g[g.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(F,le,pe){se.get(F.texture).__webglTexture=le,se.get(F.depthTexture).__webglTexture=pe;const ee=se.get(F);ee.__hasExternalTextures=!0,ee.__hasExternalTextures&&(ee.__autoAllocateDepthBuffer=void 0===pe,ee.__autoAllocateDepthBuffer||!0===re.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ee.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(F,le){const pe=se.get(F);pe.__webglFramebuffer=le,pe.__useDefaultFramebuffer=void 0===le},this.setRenderTarget=function(F,le=0,pe=0){w=F,x=le,M=pe;let ee=!0,ge=null,We=!1,Xe=!1;if(F){const nt=se.get(F);void 0!==nt.__useDefaultFramebuffer?(J.bindFramebuffer(D.FRAMEBUFFER,null),ee=!1):void 0===nt.__webglFramebuffer?be.setupRenderTarget(F):nt.__hasExternalTextures&&be.rebindTextures(F,se.get(F.texture).__webglTexture,se.get(F.depthTexture).__webglTexture);const pt=F.texture;(pt.isData3DTexture||pt.isDataArrayTexture||pt.isCompressedArrayTexture)&&(Xe=!0);const De=se.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(ge=De[le],We=!0):ge=ie.isWebGL2&&F.samples>0&&!1===be.useMultisampledRTT(F)?se.get(F).__webglMultisampledFramebuffer:De,C.copy(F.viewport),W.copy(F.scissor),N=F.scissorTest}else C.copy(q).multiplyScalar(G).floor(),W.copy(B).multiplyScalar(G).floor(),N=k;if(J.bindFramebuffer(D.FRAMEBUFFER,ge)&&ie.drawBuffers&&ee&&J.drawBuffers(F,ge),J.viewport(C),J.scissor(W),J.setScissorTest(N),We){const nt=se.get(F.texture);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+le,nt.__webglTexture,pe)}else if(Xe){const nt=se.get(F.texture);D.framebufferTextureLayer(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,nt.__webglTexture,pe||0,le||0)}S=-1},this.readRenderTargetPixels=function(F,le,pe,ee,ge,We,Xe){if(!F||!F.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Je=se.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&void 0!==Xe&&(Je=Je[Xe]),Je){J.bindFramebuffer(D.FRAMEBUFFER,Je);try{const nt=F.texture,pt=nt.format,De=nt.type;if(pt!==cr&&Ee.convert(pt)!==D.getParameter(D.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const st=De===pd&&(re.has("EXT_color_buffer_half_float")||ie.isWebGL2&&re.has("EXT_color_buffer_float"));if(!(De===uo||Ee.convert(De)===D.getParameter(D.IMPLEMENTATION_COLOR_READ_TYPE)||De===ks&&(ie.isWebGL2||re.has("OES_texture_float")||re.has("WEBGL_color_buffer_float"))||st))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");le>=0&&le<=F.width-ee&&pe>=0&&pe<=F.height-ge&&D.readPixels(le,pe,ee,ge,Ee.convert(pt),Ee.convert(De),We)}finally{const nt=null!==w?se.get(w).__webglFramebuffer:null;J.bindFramebuffer(D.FRAMEBUFFER,nt)}}},this.copyFramebufferToTexture=function(F,le,pe=0){const ee=Math.pow(2,-pe),ge=Math.floor(le.image.width*ee),We=Math.floor(le.image.height*ee);be.setTexture2D(le,0),D.copyTexSubImage2D(D.TEXTURE_2D,pe,0,0,F.x,F.y,ge,We),J.unbindTexture()},this.copyTextureToTexture=function(F,le,pe,ee=0){const ge=le.image.width,We=le.image.height,Xe=Ee.convert(pe.format),Je=Ee.convert(pe.type);be.setTexture2D(pe,0),D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,pe.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,pe.unpackAlignment),le.isDataTexture?D.texSubImage2D(D.TEXTURE_2D,ee,F.x,F.y,ge,We,Xe,Je,le.image.data):le.isCompressedTexture?D.compressedTexSubImage2D(D.TEXTURE_2D,ee,F.x,F.y,le.mipmaps[0].width,le.mipmaps[0].height,Xe,le.mipmaps[0].data):D.texSubImage2D(D.TEXTURE_2D,ee,F.x,F.y,Xe,Je,le.image),0===ee&&pe.generateMipmaps&&D.generateMipmap(D.TEXTURE_2D),J.unbindTexture()},this.copyTextureToTexture3D=function(F,le,pe,ee,ge=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const We=F.max.x-F.min.x+1,Xe=F.max.y-F.min.y+1,Je=F.max.z-F.min.z+1,nt=Ee.convert(ee.format),pt=Ee.convert(ee.type);let De;if(ee.isData3DTexture)be.setTexture3D(ee,0),De=D.TEXTURE_3D;else{if(!ee.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");be.setTexture2DArray(ee,0),De=D.TEXTURE_2D_ARRAY}D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,ee.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,ee.unpackAlignment);const st=D.getParameter(D.UNPACK_ROW_LENGTH),Vt=D.getParameter(D.UNPACK_IMAGE_HEIGHT),qt=D.getParameter(D.UNPACK_SKIP_PIXELS),Ii=D.getParameter(D.UNPACK_SKIP_ROWS),Qi=D.getParameter(D.UNPACK_SKIP_IMAGES),Kt=pe.isCompressedTexture?pe.mipmaps[0]:pe.image;D.pixelStorei(D.UNPACK_ROW_LENGTH,Kt.width),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,Kt.height),D.pixelStorei(D.UNPACK_SKIP_PIXELS,F.min.x),D.pixelStorei(D.UNPACK_SKIP_ROWS,F.min.y),D.pixelStorei(D.UNPACK_SKIP_IMAGES,F.min.z),pe.isDataTexture||pe.isData3DTexture?D.texSubImage3D(De,ge,le.x,le.y,le.z,We,Xe,Je,nt,pt,Kt.data):pe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),D.compressedTexSubImage3D(De,ge,le.x,le.y,le.z,We,Xe,Je,nt,Kt.data)):D.texSubImage3D(De,ge,le.x,le.y,le.z,We,Xe,Je,nt,pt,Kt),D.pixelStorei(D.UNPACK_ROW_LENGTH,st),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,Vt),D.pixelStorei(D.UNPACK_SKIP_PIXELS,qt),D.pixelStorei(D.UNPACK_SKIP_ROWS,Ii),D.pixelStorei(D.UNPACK_SKIP_IMAGES,Qi),0===ge&&ee.generateMipmaps&&D.generateMipmap(De),J.unbindTexture()},this.initTexture=function(F){F.isCubeTexture?be.setTextureCube(F,0):F.isData3DTexture?be.setTexture3D(F,0):F.isDataArrayTexture||F.isCompressedArrayTexture?be.setTexture2DArray(F,0):be.setTexture2D(F,0),J.unbindTexture()},this.resetState=function(){x=0,M=0,w=null,J.reset(),Pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Us}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===rt?na:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===na?rt:is}}(class kX extends OR{}).prototype.isWebGL1Renderer=!0;class NR extends Nn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class db{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Wi()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Wi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Wi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const gi=new R;class ga{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)gi.fromBufferAttribute(this,t),gi.applyMatrix4(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)gi.fromBufferAttribute(this,t),gi.applyNormalMatrix(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)gi.fromBufferAttribute(this,t),gi.transformDirection(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}setX(e,t){return this.normalized&&(t=gt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=gt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ji(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ji(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ji(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ji(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array),r=gt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=gt(t,this.array),i=gt(i,this.array),r=gt(r,this.array),s=gt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new cn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ga(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const HR=new R,GR=new Lt,WR=new Lt,VX=new R,jR=new tt,Mc=new R,fb=new dr,$R=new tt,pb=new xd;class qR extends yn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tt,this.bindMatrixInverse=new tt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Rr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Mc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Mc),this.boundingBox.expandByPoint(Mc)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new dr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Mc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Mc),this.boundingSphere.expandByPoint(Mc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),fb.copy(this.boundingSphere),fb.applyMatrix4(r),!1!==e.ray.intersectsSphere(fb)&&($R.copy(r).invert(),pb.copy(e.ray).applyMatrix4($R),(null===this.boundingBox||!1!==pb.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,pb)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Lt,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;GR.fromBufferAttribute(r.attributes.skinIndex,e),WR.fromBufferAttribute(r.attributes.skinWeight,e),HR.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=WR.getComponent(s);if(0!==o){const a=GR.getComponent(s);jR.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(VX.copy(HR).applyMatrix4(jR),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class mb extends Nn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Dd extends ur{constructor(e=null,t=1,i=1,r,s,o,a,l,c=_n,u=_n,d,h){super(null,o,a,l,c,u,r,s,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const XR=new tt,zX=new tt;class am{constructor(e=[],t=[]){this.uuid=Wi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new tt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new tt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++)XR.multiplyMatrices(e[s]?e[s].matrixWorld:zX,t[s]),XR.toArray(i,16*s);null!==r&&(r.needsUpdate=!0)}clone(){return new am(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=UI(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Dd(t,e,e,cr,ks);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new mb),this.bones.push(o),this.boneInverses.push((new tt).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++)e.bones.push(t[r].uuid),e.boneInverses.push(i[r].toArray());return e}}class Ec extends cn{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const wc=new tt,YR=new tt,lm=[],KR=new Rr,HX=new tt,Id=new yn,Rd=new dr;class ZR extends yn{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ec(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,HX)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Rr),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wc),KR.copy(e.boundingBox).applyMatrix4(wc),this.boundingBox.union(KR)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new dr),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wc),Rd.copy(e.boundingSphere).applyMatrix4(wc),this.boundingSphere.union(Rd)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Id.geometry=this.geometry,Id.material=this.material,void 0!==Id.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Rd.copy(this.boundingSphere),Rd.applyMatrix4(i),!1!==e.ray.intersectsSphere(Rd)))for(let s=0;s<r;s++){this.getMatrixAt(s,wc),YR.multiplyMatrices(i,wc),Id.matrixWorld=YR,Id.raycast(e,lm);for(let o=0,a=lm.length;o<a;o++){const l=lm[o];l.instanceId=s,l.object=this,t.push(l)}lm.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ec(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class _i extends Lr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ne(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const QR=new R,JR=new R,eP=new tt,gb=new xd,cm=new dr;class yo extends Nn{constructor(e=new ut,t=new _i){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)QR.fromBufferAttribute(t,r-1),JR.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=QR.distanceTo(JR);e.setAttribute("lineDistance",new je(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),cm.copy(i.boundingSphere),cm.applyMatrix4(r),cm.radius+=s,!1===e.ray.intersectsSphere(cm))return;eP.copy(r).invert(),gb.copy(e.ray).applyMatrix4(eP);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new R,u=new R,d=new R,h=new R,f=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(null!==p)for(let y=Math.max(0,o.start),b=Math.min(p.count,o.start+o.count)-1;y<b;y+=f){const x=p.getX(y),M=p.getX(y+1);if(c.fromBufferAttribute(m,x),u.fromBufferAttribute(m,M),gb.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(let y=Math.max(0,o.start),b=Math.min(m.count,o.start+o.count)-1;y<b;y+=f){if(c.fromBufferAttribute(m,y),u.fromBufferAttribute(m,y+1),gb.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const tP=new R,nP=new R;class Pd extends yo{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)tP.fromBufferAttribute(t,r),nP.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+tP.distanceTo(nP);e.setAttribute("lineDistance",new je(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class iP extends yo{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class _b extends Lr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ne(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rP=new tt,yb=new xd,um=new dr,dm=new R;class sP extends Nn{constructor(e=new ut,t=new _b){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),um.copy(i.boundingSphere),um.applyMatrix4(r),um.radius+=s,!1===e.ray.intersectsSphere(um))return;rP.copy(r).invert(),yb.copy(e.ray).applyMatrix4(rP);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(null!==c)for(let p=Math.max(0,o.start),_=Math.min(c.count,o.start+o.count);p<_;p++){const m=c.getX(p);dm.fromBufferAttribute(d,m),oP(dm,m,l,r,e,t,this)}else for(let p=Math.max(0,o.start),_=Math.min(d.count,o.start+o.count);p<_;p++)dm.fromBufferAttribute(d,p),oP(dm,p,l,r,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function oP(n,e,t,i,r,s,o){const a=yb.distanceSqToPoint(n);if(a<t){const l=new R;yb.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Bd extends ut{constructor(e=1,t=32,i=16,r=0,s=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],d=new R,h=new R,f=[],p=[],_=[],m=[];for(let g=0;g<=i;g++){const v=[],y=g/i;let b=0;0===g&&0===o?b=.5/t:g===i&&l===Math.PI&&(b=-.5/t);for(let x=0;x<=t;x++){const M=x/t;d.x=-e*Math.cos(r+M*s)*Math.sin(o+y*a),d.y=e*Math.cos(o+y*a),d.z=e*Math.sin(r+M*s)*Math.sin(o+y*a),p.push(d.x,d.y,d.z),h.copy(d).normalize(),_.push(h.x,h.y,h.z),m.push(M+b,1-y),v.push(c++)}u.push(v)}for(let g=0;g<i;g++)for(let v=0;v<t;v++){const b=u[g][v],x=u[g+1][v],M=u[g+1][v+1];(0!==g||o>0)&&f.push(u[g][v+1],b,M),(g!==i-1||l<Math.PI)&&f.push(b,x,M)}this.setIndex(f),this.setAttribute("position",new je(p,3)),this.setAttribute("normal",new je(_,3)),this.setAttribute("uv",new je(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Vd extends Lr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ne(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ne(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Nr extends Vd{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ve(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ln(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ne(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ne(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ne(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function fr(n,e,t){return zb(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function va(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function zb(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function bP(n){const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(function e(r,s){return n[r]-n[s]}),i}function Hb(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function Gb(n,e,t,i){let r=1,s=n[0];for(;void 0!==s&&void 0===s[i];)s=n[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),t.push(o)),s=n[r++]}while(void 0!==s)}class zd{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class LY extends zd{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:o=e,l=2*i-t;break;case 2402:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=.5*(i-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(i-t)/(r-t),_=p*p,m=_*p,g=-h*m+2*h*_-h*p,v=(1+h)*m+(-1.5-2*h)*_+(-.5+h)*p+1,y=(-1-f)*m+(1.5+f)*_+.5*p,b=f*m-f*_;for(let x=0;x!==a;++x)s[x]=g*o[u+x]+v*o[c+x]+y*o[l+x]+b*o[d+x];return s}}class xP extends zd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[c+h]*d+o[l+h]*u;return s}}class OY extends zd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class as{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=va(t,this.TimeBufferType),this.values=va(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:va(e.times,Array),values:va(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new OY(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new xP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new LY(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case md:t=this.InterpolantFactoryMethodDiscrete;break;case jl:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return md;case this.InterpolantFactoryMethodLinear:return jl;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=fr(i,s,o),this.values=fr(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(void 0!==r&&zb(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=fr(this.times),t=fr(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a];if(c!==e[a+1]&&(1!==a||c!==e[0]))if(r)l=!0;else{const d=a*i,h=d-i,f=d+i;for(let p=0;p!==i;++p){const _=t[d+p];if(_!==t[h+p]||_!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=fr(e,0,o),this.values=fr(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=fr(this.times,0),t=fr(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}as.prototype.TimeBufferType=Float32Array,as.prototype.ValueBufferType=Float32Array,as.prototype.DefaultInterpolation=jl;class Ac extends as{}Ac.prototype.ValueTypeName="bool",Ac.prototype.ValueBufferType=Array,Ac.prototype.DefaultInterpolation=md,Ac.prototype.InterpolantFactoryMethodLinear=void 0,Ac.prototype.InterpolantFactoryMethodSmooth=void 0;class MP extends as{}MP.prototype.ValueTypeName="color";class Hd extends as{}Hd.prototype.ValueTypeName="number";class NY extends zd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)jn.slerpFlat(s,0,o,c-a,o,c,l);return s}}class ba extends as{InterpolantFactoryMethodLinear(e){return new NY(this.times,this.values,this.getValueSize(),e)}}ba.prototype.ValueTypeName="quaternion",ba.prototype.DefaultInterpolation=jl,ba.prototype.InterpolantFactoryMethodSmooth=void 0;class Cc extends as{}Cc.prototype.ValueTypeName="string",Cc.prototype.ValueBufferType=Array,Cc.prototype.DefaultInterpolation=md,Cc.prototype.InterpolantFactoryMethodLinear=void 0,Cc.prototype.InterpolantFactoryMethodSmooth=void 0;class Gd extends as{}Gd.prototype.ValueTypeName="vector";class Wd{constructor(e,t=-1,i,r=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Wi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(UY(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(as.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=bP(l);l=Hb(l,1,u),c=Hb(c,1,u),!r&&0===l[0]&&(l.push(s),c.push(c[0])),o.push(new Hd(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const d=u[1];let h=r[d];h||(r[d]=h=[]),h.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,h,f,p,_){if(0!==f.length){const m=[],g=[];Gb(f,m,g,p),0!==m.length&&_.push(new d(h,m,g))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const h=c[d].keys;if(h&&0!==h.length)if(h[0].morphTargets){const f={};let p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let _=0;_<h[p].morphTargets.length;_++)f[h[p].morphTargets[_]]=-1;for(const _ in f){const m=[],g=[];for(let v=0;v!==h[p].morphTargets.length;++v){const y=h[p];m.push(y.time),g.push(y.morphTarget===_?1:0)}r.push(new Hd(".morphTargetInfluence["+_+"]",m,g))}l=f.length*o}else{const f=".bones["+t[d].name+"]";i(Gd,f+".position",h,"pos",r),i(ba,f+".quaternion",h,"rot",r),i(Gd,f+".scale",h,"scl",r)}}return 0===r.length?null:new this(s,l,r,a)}resetDuration(){let t=0;for(let i=0,r=this.tracks.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function UY(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function kY(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hd;case"vector":case"vector2":case"vector3":case"vector4":return Gd;case"color":return MP;case"quaternion":return ba;case"bool":case"boolean":return Ac;case"string":return Cc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];Gb(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Dc={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class EP{constructor(e,t,i){const r=this;let l,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,!1===s&&void 0!==r.onStart&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==r.onProgress&&r.onProgress(u,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(u){void 0!==r.onError&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return-1!==d&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const BY=new EP;class jd{constructor(e){this.manager=void 0!==e?e:BY,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const qs={};class VY extends Error{constructor(e,t){super(e),this.response=t}}class ls extends jd{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Dc.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==qs[e])return void qs[e].push({onLoad:t,onProgress:i,onError:r});qs[e]=[],qs[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(200===c.status||0===c.status){if(0===c.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===c.body||void 0===c.body.getReader)return c;const u=qs[e],d=c.body.getReader(),h=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=h?parseInt(h):0,p=0!==f;let _=0;const m=new ReadableStream({start(g){!function v(){d.read().then(({done:y,value:b})=>{if(y)g.close();else{_+=b.byteLength;const x=new ProgressEvent("progress",{lengthComputable:p,loaded:_,total:f});for(let M=0,w=u.length;M<w;M++){const S=u[M];S.onProgress&&S.onProgress(x)}g.enqueue(b),v()}})}()}});return new Response(m)}throw new VY(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>(new DOMParser).parseFromString(u,a));case"json":return c.json();default:if(void 0===a)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Dc.add(e,c);const u=qs[e];delete qs[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=qs[e];if(void 0===u)throw this.manager.itemError(e),c;delete qs[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Mm extends jd{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Dc.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=_d("img");function l(){u(),Dc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){u(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class zY extends jd{constructor(e){super(e)}load(e,t,i,r){const s=new ur,o=new Mm(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},i,r),s}}class Ic extends Nn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ne(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class wP extends Ic{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ne(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Wb=new tt,SP=new R,TP=new R;class jb{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ve(512,512),this.map=null,this.mapPass=null,this.matrix=new tt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new eb,this._frameExtents=new ve(1,1),this._viewportCount=1,this._viewports=[new Lt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;SP.setFromMatrixPosition(e.matrixWorld),t.position.copy(SP),TP.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(TP),t.updateMatrixWorld(),Wb.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wb),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Wb)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class HY extends jb{constructor(){super(new Un(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*Xl*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class AP extends Ic{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.target=new Nn,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new HY}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const CP=new tt,$d=new R,$b=new R;class GY extends jb{constructor(){super(new Un(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ve(4,2),this._viewportCount=6,this._viewports=[new Lt(2,1,1,1),new Lt(0,1,1,1),new Lt(3,1,1,1),new Lt(1,1,1,1),new Lt(3,0,1,1),new Lt(1,0,1,1)],this._cubeDirections=[new R(1,0,0),new R(-1,0,0),new R(0,0,1),new R(0,0,-1),new R(0,1,0),new R(0,-1,0)],this._cubeUps=[new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,0,1),new R(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),$d.setFromMatrixPosition(e.matrixWorld),i.position.copy($d),$b.copy(i.position),$b.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt($b),i.updateMatrixWorld(),r.makeTranslation(-$d.x,-$d.y,-$d.z),CP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CP)}}class DP extends Ic{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new GY}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class WY extends jb{constructor(){super(new Jp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class qb extends Ic{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Nn.DEFAULT_UP),this.updateMatrix(),this.target=new Nn,this.shadow=new WY}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class IP extends Ic{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class RP extends Ic{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class qd{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class PP extends ut{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class YY extends jd{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Dc.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Dc.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}class Yb{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=UP(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=UP();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function UP(){return(typeof performance>"u"?Date:performance).now()}const Kb="\\[\\]\\.:\\/",JY=new RegExp("["+Kb+"]","g"),Zb="[^"+Kb+"]",eK="[^"+Kb.replace("\\.","")+"]",sK=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Zb)+/(WCOD+)?/.source.replace("WCOD",eK)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Zb)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Zb)+"$"),oK=["material","materials","bones","map"];class aK{constructor(e,t,i){const r=i||$t.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let $t=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(JY,"")}static parseTrackName(t){const i=sK.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==oK.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=r(l.children);if(c)return c}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=aK,n})();$t.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$t.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$t.prototype.GetterByBindingType=[$t.prototype._getValue_direct,$t.prototype._getValue_array,$t.prototype._getValue_arrayElement,$t.prototype._getValue_toArray],$t.prototype.SetterByBindingTypeAndVersioning=[[$t.prototype._setValue_direct,$t.prototype._setValue_direct_setNeedsUpdate,$t.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_array,$t.prototype._setValue_array_setNeedsUpdate,$t.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_arrayElement,$t.prototype._setValue_arrayElement_setNeedsUpdate,$t.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_fromArray,$t.prototype._setValue_fromArray_setNeedsUpdate,$t.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class GP{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ln(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class hK extends Pd{constructor(e=10,t=10,i=4473924,r=8947848){i=new Ne(i),r=new Ne(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const _=h===s?i:r;_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3}const u=new ut;u.setAttribute("position",new je(l,3)),u.setAttribute("color",new je(c,3)),super(u,new _i({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class fK extends Pd{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new ut;r.setAttribute("position",new je(t,3)),r.setAttribute("color",new je([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new _i({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){const r=new Ne,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"153"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="153");const Rc=new R,JP=new tt,eF=new tt,tF=new R,nF=new R;class pK{constructor(e={}){const t=this;let i,r,s,o;const a={objects:new WeakMap},l=void 0!==e.element?e.element:document.createElement("div");function c(f,p,_){if(f.isCSS2DObject){Rc.setFromMatrixPosition(f.matrixWorld),Rc.applyMatrix4(eF);const m=!0===f.visible&&Rc.z>=-1&&Rc.z<=1&&!0===f.layers.test(_.layers);if(f.element.style.display=!0===m?"":"none",!0===m){f.onBeforeRender(t,p,_);const v=f.element;v.style.transform="translate("+-100*f.center.x+"%,"+-100*f.center.y+"%)translate("+(Rc.x*s+s)+"px,"+(-Rc.y*o+o)+"px)",v.parentNode!==l&&l.appendChild(v),f.onAfterRender(t,p,_)}const g={distanceToCameraSquared:u(_,f)};a.objects.set(f,g)}for(let m=0,g=f.children.length;m<g;m++)c(f.children[m],p,_)}function u(f,p){return tF.setFromMatrixPosition(f.matrixWorld),nF.setFromMatrixPosition(p.matrixWorld),tF.distanceToSquared(nF)}l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:i,height:r}},this.render=function(f,p){!0===f.matrixWorldAutoUpdate&&f.updateMatrixWorld(),null===p.parent&&!0===p.matrixWorldAutoUpdate&&p.updateMatrixWorld(),JP.copy(p.matrixWorldInverse),eF.multiplyMatrices(p.projectionMatrix,JP),c(f,f,p),function h(f){const p=function d(f){const p=[];return f.traverse(function(_){_.isCSS2DObject&&p.push(_)}),p}(f).sort(function(m,g){return m.renderOrder!==g.renderOrder?g.renderOrder-m.renderOrder:a.objects.get(m).distanceToCameraSquared-a.objects.get(g).distanceToCameraSquared}),_=p.length;for(let m=0,g=p.length;m<g;m++)p[m].element.style.zIndex=_-m}(f)},this.setSize=function(f,p){i=f,r=p,s=i/2,o=r/2,l.style.width=f+"px",l.style.height=p+"px"}}}class mK{constructor(e,t,i,r){this.webGLRenderer=this.createWebGLRenderer(),this.css2DRenderer=this.createCSS2DRenderer(),this._sceneGraph=i,this._viewportDiv=void 0,this._cameraSet=r,this._eventHandler=new Bl(e),this._eventHandler.set(jt.OnWindowResize,this.onWindowResize.bind(this)),this._notifyHandler=new Fs(t,this.onNotify.bind(this))}initialize(e){this._viewportDiv=e,this._viewportDiv.appendChild(this.webGLRenderer.domElement),this._viewportDiv.appendChild(this.css2DRenderer.domElement),this.onWindowResize()}onRender(){this.webGLRenderer.clear(),this.webGLRenderer.render(this._sceneGraph.scene,this._cameraSet.camera),this.webGLRenderer.clearDepth(),this.css2DRenderer.render(this._sceneGraph.scene,this._cameraSet.camera)}onNotify(e,t,i){}onWindowResize(){this.webGLRenderer.setSize(this._viewportDiv.clientWidth,this._viewportDiv.clientHeight),this.css2DRenderer.setSize(this._viewportDiv.clientWidth,this._viewportDiv.clientHeight)}createWebGLRenderer(){const e=new OR({antialias:!0});return e.autoClear=!1,e.domElement.style.touchAction="none",e}createCSS2DRenderer(){const e=new pK;return e.domElement.style.touchAction="none",e.domElement.style.position="absolute",e.domElement.style.top="0px",e}}const iF={type:"change"},tx={type:"start"},rF={type:"end"};class gK extends sa{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new R,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Vl.ROTATE,MIDDLE:Vl.DOLLY,RIGHT:Vl.PAN},this.touches={ONE:zl.ROTATE,TWO:zl.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(P){P.addEventListener("keydown",Me),this._domElementKeyEvents=P},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Me),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(iF),i.update(),s=r.NONE},this.update=function(){const P=new R,ce=(new jn).setFromUnitVectors(e.up,new R(0,1,0)),fe=ce.clone().invert(),ne=new R,Te=new jn,Le=new R,Re=2*Math.PI;return function(){const Pe=i.object.position;P.copy(Pe).sub(i.target),P.applyQuaternion(ce),a.setFromVector3(P),i.autoRotate&&s===r.NONE&&E(function w(){return 2*Math.PI/60/60*i.autoRotateSpeed}()),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let Ue=i.minAzimuthAngle,qe=i.maxAzimuthAngle;return isFinite(Ue)&&isFinite(qe)&&(Ue<-Math.PI?Ue+=Re:Ue>Math.PI&&(Ue-=Re),qe<-Math.PI?qe+=Re:qe>Math.PI&&(qe-=Re),a.theta=Ue<=qe?Math.max(Ue,Math.min(qe,a.theta)):a.theta>(Ue+qe)/2?Math.max(Ue,a.theta):Math.min(qe,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),P.setFromSpherical(a),P.applyQuaternion(fe),Pe.copy(i.target).add(P),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(d||ne.distanceToSquared(i.object.position)>o||8*(1-Te.dot(i.object.quaternion))>o||Le.distanceToSquared(i.target)>0)&&(i.dispatchEvent(iF),ne.copy(i.object.position),Te.copy(i.object.quaternion),Le.copy(i.target),d=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",I),i.domElement.removeEventListener("pointerdown",re),i.domElement.removeEventListener("pointercancel",J),i.domElement.removeEventListener("wheel",be),i.domElement.removeEventListener("pointermove",ie),i.domElement.removeEventListener("pointerup",J),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",Me),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new GP,l=new GP;let c=1;const u=new R;let d=!1;const h=new ve,f=new ve,p=new ve,_=new ve,m=new ve,g=new ve,v=new ve,y=new ve,b=new ve,x=[],M={};function S(){return Math.pow(.95,i.zoomSpeed)}function E(P){l.theta-=P}function C(P){l.phi-=P}const W=function(){const P=new R;return function(fe,ne){P.setFromMatrixColumn(ne,0),P.multiplyScalar(-fe),u.add(P)}}(),N=function(){const P=new R;return function(fe,ne){!0===i.screenSpacePanning?P.setFromMatrixColumn(ne,1):(P.setFromMatrixColumn(ne,0),P.crossVectors(i.object.up,P)),P.multiplyScalar(fe),u.add(P)}}(),L=function(){const P=new R;return function(fe,ne){const Te=i.domElement;if(i.object.isPerspectiveCamera){P.copy(i.object.position).sub(i.target);let Re=P.length();Re*=Math.tan(i.object.fov/2*Math.PI/180),W(2*fe*Re/Te.clientHeight,i.object.matrix),N(2*ne*Re/Te.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(W(fe*(i.object.right-i.object.left)/i.object.zoom/Te.clientWidth,i.object.matrix),N(ne*(i.object.top-i.object.bottom)/i.object.zoom/Te.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function O(P){i.object.isPerspectiveCamera?c/=P:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*P)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function z(P){i.object.isPerspectiveCamera?c*=P:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/P)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function U(P){h.set(P.clientX,P.clientY)}function $(P){_.set(P.clientX,P.clientY)}function j(){1===x.length?h.set(x[0].pageX,x[0].pageY):h.set(.5*(x[0].pageX+x[1].pageX),.5*(x[0].pageY+x[1].pageY))}function Q(){1===x.length?_.set(x[0].pageX,x[0].pageY):_.set(.5*(x[0].pageX+x[1].pageX),.5*(x[0].pageY+x[1].pageY))}function te(){const P=x[0].pageX-x[1].pageX,ce=x[0].pageY-x[1].pageY,fe=Math.sqrt(P*P+ce*ce);v.set(0,fe)}function ue(P){if(1==x.length)f.set(P.pageX,P.pageY);else{const fe=_e(P);f.set(.5*(P.pageX+fe.x),.5*(P.pageY+fe.y))}p.subVectors(f,h).multiplyScalar(i.rotateSpeed);const ce=i.domElement;E(2*Math.PI*p.x/ce.clientHeight),C(2*Math.PI*p.y/ce.clientHeight),h.copy(f)}function Ce(P){if(1===x.length)m.set(P.pageX,P.pageY);else{const ce=_e(P);m.set(.5*(P.pageX+ce.x),.5*(P.pageY+ce.y))}g.subVectors(m,_).multiplyScalar(i.panSpeed),L(g.x,g.y),_.copy(m)}function he(P){const ce=_e(P),fe=P.pageX-ce.x,ne=P.pageY-ce.y,Te=Math.sqrt(fe*fe+ne*ne);y.set(0,Te),b.set(0,Math.pow(y.y/v.y,i.zoomSpeed)),O(b.y),v.copy(y)}function re(P){!1!==i.enabled&&(0===x.length&&(i.domElement.setPointerCapture(P.pointerId),i.domElement.addEventListener("pointermove",ie),i.domElement.addEventListener("pointerup",J)),function T(P){x.push(P)}(P),"touch"===P.pointerType?function de(P){switch(xe(P),x.length){case 1:switch(i.touches.ONE){case zl.ROTATE:if(!1===i.enableRotate)return;j(),s=r.TOUCH_ROTATE;break;case zl.PAN:if(!1===i.enablePan)return;Q(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case zl.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function K(){i.enableZoom&&te(),i.enablePan&&Q()})(),s=r.TOUCH_DOLLY_PAN;break;case zl.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function ae(){i.enableZoom&&te(),i.enableRotate&&j()})(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(tx)}(P):function Ae(P){let ce;switch(P.button){case 0:ce=i.mouseButtons.LEFT;break;case 1:ce=i.mouseButtons.MIDDLE;break;case 2:ce=i.mouseButtons.RIGHT;break;default:ce=-1}switch(ce){case Vl.DOLLY:if(!1===i.enableZoom)return;(function G(P){v.set(P.clientX,P.clientY)})(P),s=r.DOLLY;break;case Vl.ROTATE:if(P.ctrlKey||P.metaKey||P.shiftKey){if(!1===i.enablePan)return;$(P),s=r.PAN}else{if(!1===i.enableRotate)return;U(P),s=r.ROTATE}break;case Vl.PAN:if(P.ctrlKey||P.metaKey||P.shiftKey){if(!1===i.enableRotate)return;U(P),s=r.ROTATE}else{if(!1===i.enablePan)return;$(P),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(tx)}(P))}function ie(P){!1!==i.enabled&&("touch"===P.pointerType?function Ve(P){switch(xe(P),s){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;ue(P),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;Ce(P),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function D(P){i.enableZoom&&he(P),i.enablePan&&Ce(P)})(P),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function ye(P){i.enableZoom&&he(P),i.enableRotate&&ue(P)})(P),i.update();break;default:s=r.NONE}}(P):function se(P){switch(s){case r.ROTATE:if(!1===i.enableRotate)return;!function V(P){f.set(P.clientX,P.clientY),p.subVectors(f,h).multiplyScalar(i.rotateSpeed);const ce=i.domElement;E(2*Math.PI*p.x/ce.clientHeight),C(2*Math.PI*p.y/ce.clientHeight),h.copy(f),i.update()}(P);break;case r.DOLLY:if(!1===i.enableZoom)return;!function q(P){y.set(P.clientX,P.clientY),b.subVectors(y,v),b.y>0?O(S()):b.y<0&&z(S()),v.copy(y),i.update()}(P);break;case r.PAN:if(!1===i.enablePan)return;!function B(P){m.set(P.clientX,P.clientY),g.subVectors(m,_).multiplyScalar(i.panSpeed),L(g.x,g.y),_.copy(m),i.update()}(P)}}(P))}function J(P){(function Y(P){delete M[P.pointerId];for(let ce=0;ce<x.length;ce++)if(x[ce].pointerId==P.pointerId)return void x.splice(ce,1)})(P),0===x.length&&(i.domElement.releasePointerCapture(P.pointerId),i.domElement.removeEventListener("pointermove",ie),i.domElement.removeEventListener("pointerup",J)),i.dispatchEvent(rF),s=r.NONE}function be(P){!1===i.enabled||!1===i.enableZoom||s!==r.NONE||(P.preventDefault(),i.dispatchEvent(tx),function k(P){P.deltaY<0?z(S()):P.deltaY>0&&O(S()),i.update()}(P),i.dispatchEvent(rF))}function Me(P){!1===i.enabled||!1===i.enablePan||function X(P){let ce=!1;switch(P.code){case i.keys.UP:P.ctrlKey||P.metaKey||P.shiftKey?C(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(0,i.keyPanSpeed),ce=!0;break;case i.keys.BOTTOM:P.ctrlKey||P.metaKey||P.shiftKey?C(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(0,-i.keyPanSpeed),ce=!0;break;case i.keys.LEFT:P.ctrlKey||P.metaKey||P.shiftKey?E(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(i.keyPanSpeed,0),ce=!0;break;case i.keys.RIGHT:P.ctrlKey||P.metaKey||P.shiftKey?E(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(-i.keyPanSpeed,0),ce=!0}ce&&(P.preventDefault(),i.update())}(P)}function I(P){!1!==i.enabled&&P.preventDefault()}function xe(P){let ce=M[P.pointerId];void 0===ce&&(ce=new ve,M[P.pointerId]=ce),ce.set(P.pageX,P.pageY)}function _e(P){return M[(P.pointerId===x[0].pointerId?x[1]:x[0]).pointerId]}i.domElement.addEventListener("contextmenu",I),i.domElement.addEventListener("pointerdown",re),i.domElement.addEventListener("pointercancel",J),i.domElement.addEventListener("wheel",be,{passive:!1}),this.update()}}class _K{constructor(e,t){this.camera=this.createPerspectiveCamera("camera",new R(0,20,20)),this.orbitControls=void 0,this._viewportDiv=void 0,this._notifyHandler=new Fs(t,this.onNotify.bind(this)),this._eventHandler=new Bl(e),this._eventHandler.set(jt.OnWindowResize,this.onWindowResize.bind(this)),this._eventHandler.set(jt.OnMouseWheel,this.onMouseWheel.bind(this)),this._eventHandler.set(jt.OnMouseDown,this.onMouseDown.bind(this)),this._eventHandler.set(jt.OnMouseUp,this.onMouseUp.bind(this)),this._eventHandler.set(jt.OnKeyDown,this.onKeyDown.bind(this)),this._eventHandler.set(jt.OnKeyUp,this.onKeyUp.bind(this))}initialize(e,t){this._viewportDiv=e,this.onWindowResize(),this.orbitControls=new gK(this.camera,t.domElement),this.orbitControls.object=this.camera,this.orbitControls.enabled=!0}onWindowResize(){this.camera.aspect=this._viewportDiv.clientWidth/this._viewportDiv.clientHeight,this.camera.updateProjectionMatrix(),this.orbitControls?.update()}onNotify(e,t,i){}onMouseWheel(e){}onMouseDown(e){}onMouseUp(e){}onKeyDown(e){}onKeyUp(e){}createPerspectiveCamera(e,t){const i=new Un(60,1,.1,1e3);return i.name=e,i.up.set(0,0,1),i.position.copy(t),i}}class yK extends yo{constructor(e,t){const r=new ut;r.setAttribute("position",new je([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new _i({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const a=new ut;a.setAttribute("position",new je([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new yn(a,new pi({side:ti,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}class vK{constructor(e,t){this._ambientLight=this.createAmbientLight("AmbientLight"),this._directionalLight=this.createDirectionalLight("DirectionalLight",new R(5e4,5e4,5e4)),this._pointLight=this.createPointLight("DirectionalLight",new R(0,0,50)),this._rectLight=this.createRectLight(new R(0,0,40),new R(0,0,0)),this._rectLight2=this.createRectLight(new R(0,-15,5),new R(0,0,15)),t.scene.add(this._ambientLight),t.scene.add(this._rectLight)}rotateRectLight(){this._rectLight.rotateOnWorldAxis(new R(0,0,1),.01)}createAmbientLight(e){const t=new IP(16777215,.1);return t.name=e,t}createDirectionalLight(e,t){const i=new qb(16777215);return i.position.copy(t),i.name=e,i}createPointLight(e,t){const i=new wP(16777147,526368,1);return i.position.copy(t),i.name=e,i}createRectLight(e,t){const o=new RP(16777200,10,50,15);o.position.copy(e),o.lookAt(t.x,t.y,t.z);const a=new yK(o);return o.add(a),o}}class bK{constructor(e){this._grid=this.createGrid("Grid")}createGrid(e){const t=new hK(50,50);return t.name=e,t.lookAt(new R(0,1,0)),t}}class xK{constructor(e){this._axes=this.createAxis("Axes")}createAxis(e){const t=new fK(1e3);return t.name=e,t.material.depthTest=!1,t}}function sF(n,e){if(e===Wj)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===D0||e===PI){let t=n.getIndex();if(null===t){const o=[],a=n.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}const i=t.count-2,r=[];if(e===D0)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class EK extends jd{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new CK(t)}),this.register(function(t){return new NK(t)}),this.register(function(t){return new kK(t)}),this.register(function(t){return new UK(t)}),this.register(function(t){return new IK(t)}),this.register(function(t){return new RK(t)}),this.register(function(t){return new PK(t)}),this.register(function(t){return new FK(t)}),this.register(function(t){return new AK(t)}),this.register(function(t){return new LK(t)}),this.register(function(t){return new DK(t)}),this.register(function(t){return new OK(t)}),this.register(function(t){return new SK(t)}),this.register(function(t){return new BK(t)}),this.register(function(t){return new VK(t)})}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:qd.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new ls(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={},l=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===oF){try{o[St.KHR_BINARY_GLTF]=new zK(e)}catch(d){return void(r&&r(d))}s=JSON.parse(o[St.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new eZ(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);a[d.name]=d,o[d.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const d=s.extensionsUsed[u],h=s.extensionsRequired||[];switch(d){case St.KHR_MATERIALS_UNLIT:o[d]=new TK;break;case St.KHR_DRACO_MESH_COMPRESSION:o[d]=new HK(s,this.dracoLoader);break;case St.KHR_TEXTURE_TRANSFORM:o[d]=new GK;break;case St.KHR_MESH_QUANTIZATION:o[d]=new WK;break;default:h.indexOf(d)>=0&&void 0===a[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function wK(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const St={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class SK{constructor(e){this.parser=e,this.name=St.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new Ne(16777215);void 0!==l.color&&u.fromArray(l.color);const d=void 0!==l.range?l.range:0;switch(l.type){case"directional":c=new qb(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new DP(u),c.distance=d;break;case"spot":c=new AP(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,xo(c,l),void 0!==l.intensity&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(i,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class TK{constructor(){this.name=St.KHR_MATERIALS_UNLIT}getMaterialType(){return pi}extendParams(e,t,i){const r=[];e.color=new Ne(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,rt))}return Promise.all(r)}}class AK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class CK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ve(a,a)}return Promise.all(s)}}class DK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class IK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Ne(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,rt)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class RK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class PK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Ne(a[0],a[1],a[2]),Promise.all(s)}}class FK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class LK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Ne(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,rt)),Promise.all(s)}}class OK{constructor(e){this.parser=e,this.name=St.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Nr:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class NK{constructor(e){this.parser=e,this.name=St.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class kK{constructor(e){this.parser=e,this.name=St.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);null!==c&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class UK{constructor(e){this.parser=e,this.name=St.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);null!==c&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class BK{constructor(e){this.name=St.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const u=r.count,d=r.byteStride,h=new Uint8Array(a,r.byteOffset||0,r.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,h,r.mode,r.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(f),u,d,h,r.mode,r.filter),f})})}return null}}class VK{constructor(e){this.name=St.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const c of r.primitives)if(c.mode!==pr.TRIANGLES&&c.mode!==pr.TRIANGLE_STRIP&&c.mode!==pr.TRIANGLE_FAN&&void 0!==c.mode)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,f=[];for(const p of d){const _=new tt,m=new R,g=new jn,v=new R(1,1,1),y=new ZR(p.geometry,p.material,h);for(let b=0;b<h;b++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,b),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,b),l.SCALE&&v.fromBufferAttribute(l.SCALE,b),y.setMatrixAt(b,_.compose(m,g,v));for(const b in l)"TRANSLATION"!==b&&"ROTATION"!==b&&"SCALE"!==b&&p.geometry.setAttribute(b,l[b]);Nn.prototype.copy.call(y,p),this.parser.assignFinalMaterial(y),f.push(y)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const oF="glTF";class zK{constructor(e){this.name=St.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==oF)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,1313821514===l){const c=new Uint8Array(e,12+o,a);this.content=i.decode(c)}else if(5130562===l){const c=12+o;this.body=e.slice(c,c+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class HK{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=St.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=sx[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=sx[u]||u.toLowerCase();if(void 0!==o[u]){const h=i.accessors[e.attributes[u]];c[d]=Pc[h.componentType].name,l[d]=!0===h.normalized}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d){r.decodeDracoFile(u,function(h){for(const f in h.attributes){const _=l[f];void 0!==_&&(h.attributes[f].normalized=_)}d(h)},a,c)})})}}class GK{constructor(){this.name=St.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class WK{constructor(){this.name=St.KHR_MESH_QUANTIZATION}}class lF extends zd{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=2*a,c=3*a,u=r-t,d=(i-t)/u,h=d*d,f=h*d,p=e*c,_=p-c,m=-2*f+3*h,g=f-h,v=1-m,y=g-h+d;for(let b=0;b!==a;b++)s[b]=v*o[_+b+a]+y*(o[_+b+l]*u)+m*o[p+b+a]+g*(o[p+b]*u);return s}}const jK=new jn;class $K extends lF{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return jK.fromArray(s).normalize().toArray(s),s}}const pr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Pc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cF={9728:_n,9729:Jt,9984:Cp,9985:b0,9986:fd,9987:Ns},uF={33071:ni,33648:hd,10497:Jo},rx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sx={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},bo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},qK={CUBICSPLINE:void 0,LINEAR:jl,STEP:md};function Ta(n,e,t){for(const i in t.extensions)void 0===n[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function xo(n,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function KK(n,e){if(n.updateMorphTargets(),void 0!==e.weights)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ZK(n){let e;const t=n.extensions&&n.extensions[St.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+ax(t.attributes):n.indices+":"+ax(n.attributes)+":"+n.mode,void 0!==n.targets)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+ax(n.targets[i]);return e}function ax(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function lx(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const JK=new tt;class eZ{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new wK,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||i||r&&s<98?new zY(this.options.manager):new YY(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ls(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};Ta(s,a,r),xo(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(i[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);null!=l&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[St.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(qd.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteOffset||0;return i.slice(s,s+(t.byteLength||0))})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const o=rx[r.type],l=!0===r.normalized,c=new(0,Pc[r.componentType])(r.count*o);return Promise.resolve(new cn(c,o,l))}const s=[];return s.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=rx[r.type],c=Pc[r.componentType],u=c.BYTES_PER_ELEMENT,h=r.byteOffset||0,f=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;let _,m;if(f&&f!==u*l){const g=Math.floor(h/f),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count;let y=t.cache.get(v);y||(_=new c(a,g*f,r.count*f/u),y=new db(_,f/u),t.cache.add(v,y)),m=new ga(y,l,h%f/u,p)}else _=null===a?new c(r.count*l):new c(a,h,r.count*l),m=new cn(_,l,p);if(void 0!==r.sparse){const b=r.sparse.values.byteOffset||0,x=new(0,Pc[r.sparse.indices.componentType])(o[1],r.sparse.indices.byteOffset||0,r.sparse.count*rx.SCALAR),M=new c(o[2],b,r.sparse.count*l);null!==a&&(m=new cn(m.array.slice(),m.itemSize,m.normalized));for(let w=0,S=x.length;w<S;w++){const E=x[w];if(m.setX(E,M[w*l]),l>=2&&m.setY(E,M[w*l+1]),l>=3&&m.setZ(E,M[w*l+2]),l>=4&&m.setW(E,M[w*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=this.options.manager.getHandler(o.uri);null!==l&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",""===u.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(u.name=a.uri);const h=(s.samplers||{})[o.sampler]||{};return u.magFilter=cF[h.magFilter]||Jt,u.minFilter=cF[h.minFilter]||Ns,u.wrapS=uF[h.wrapS]||Jo,u.wrapT=uF[h.wrapT]||Jo,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(d=>d.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(void 0!==o.bufferView)l=this.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(h),l});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,f){let p=h;!0===t.isImageBitmapLoader&&(p=function(_){const m=new ur(_);m.needsUpdate=!0,h(m)}),t.load(qd.resolveURL(d,s.path),p,void 0,f)})}).then(function(d){return!0===c&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||function QK(n){return n.search(/\.jpe?g($|\?)/i)>0||0===n.search(/^data\:image\/jpeg/)?"image/jpeg":n.search(/\.webp($|\?)/i)>0||0===n.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((o=o.clone()).channel=i.texCoord),s.extensions[St.KHR_TEXTURE_TRANSFORM]){const a=void 0!==i.extensions?i.extensions[St.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[St.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return void 0!==r&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new _b,Lr.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new _i,Lr.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return Vd}loadMaterial(e){const t=this,r=this.extensions,s=this.json.materials[e];let o;const a={},c=[];if((s.extensions||{})[St.KHR_MATERIALS_UNLIT]){const d=r[St.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new Ne(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}void 0!==d.baseColorTexture&&c.push(t.assignTexture(a,"map",d.baseColorTexture,rt)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=Gi);const u=s.alphaMode||"OPAQUE";if("BLEND"===u?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===u&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==pi&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new ve(1,1),void 0!==s.normalTexture.scale)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}return void 0!==s.occlusionTexture&&o!==pi&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==pi&&(a.emissive=(new Ne).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==pi&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,rt)),Promise.all(c).then(function(){const d=new o(a);return s.name&&(d.name=s.name),xo(d,s),t.associations.set(d,{materials:e}),s.extensions&&Ta(r,d,s),d})}createUniqueName(e){const t=$t.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[St.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return dF(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=ZK(c),d=r[u];if(d)o.push(d.promise);else{let h;h=c.extensions&&c.extensions[St.KHR_DRACO_MESH_COMPRESSION]?s(c):dF(new ut,c,t),r[u]={primitive:c,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=void 0===o[l].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new Vd({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ns})),n.DefaultMaterial):this.getDependency("material",o[l].material);a.push(u)}var n;return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,p=u.length;f<p;f++){const _=u[f],m=o[f];let g;const v=c[f];if(m.mode===pr.TRIANGLES||m.mode===pr.TRIANGLE_STRIP||m.mode===pr.TRIANGLE_FAN||void 0===m.mode)g=!0===s.isSkinnedMesh?new qR(_,v):new yn(_,v),!0===g.isSkinnedMesh&&g.normalizeSkinWeights(),m.mode===pr.TRIANGLE_STRIP?g.geometry=sF(g.geometry,PI):m.mode===pr.TRIANGLE_FAN&&(g.geometry=sF(g.geometry,D0));else if(m.mode===pr.LINES)g=new Pd(_,v);else if(m.mode===pr.LINE_STRIP)g=new yo(_,v);else if(m.mode===pr.LINE_LOOP)g=new iP(_,v);else{if(m.mode!==pr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);g=new sP(_,v)}Object.keys(g.geometry.morphAttributes).length>0&&KK(g,s),g.name=t.createUniqueName(s.name||"mesh_"+e),xo(g,s),m.extensions&&Ta(r,g,m),t.assignFinalMaterial(g),d.push(g)}for(let f=0,p=d.length;f<p;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(1===d.length)return s.extensions&&Ta(r,d[0],s),d[0];const h=new ss;s.extensions&&Ta(r,h,s),t.associations.set(h,{meshes:e});for(let f=0,p=d.length;f<p;f++)h.add(d[f]);return h})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new Un(m9_radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new Jp(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),xo(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return i.push(void 0!==t.inverseBindMatrices?this.getDependency("accessor",t.inverseBindMatrices):null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d){a.push(d);const h=new tt;null!==s&&h.fromArray(s.array,16*c),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new am(a,l)})}loadAnimation(e){const i=this.json.animations[e],r=i.name?i.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,d=i.channels.length;u<d;u++){const h=i.channels[u],f=i.samplers[h.sampler],p=h.target,m=void 0!==i.parameters?i.parameters[f.input]:f.input,g=void 0!==i.parameters?i.parameters[f.output]:f.output;void 0!==p.node&&(s.push(this.getDependency("node",p.node)),o.push(this.getDependency("accessor",m)),a.push(this.getDependency("accessor",g)),l.push(f),c.push(p))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const d=u[0],h=u[1],f=u[2],p=u[3],_=u[4],m=[];for(let g=0,v=d.length;g<v;g++){const y=d[g],b=h[g],x=f[g],M=p[g],w=_[g];if(void 0===y)continue;let S;switch(y.updateMatrix(),bo[w.path]){case bo.weights:S=Hd;break;case bo.rotation:S=ba;break;default:S=Gd}const E=y.name?y.name:y.uuid,C=void 0!==M.interpolation?qK[M.interpolation]:jl,W=[];bo[w.path]===bo.weights?y.traverse(function(L){L.morphTargetInfluences&&W.push(L.name?L.name:L.uuid)}):W.push(E);let N=x.array;if(x.normalized){const L=lx(N.constructor),O=new Float32Array(N.length);for(let z=0,U=N.length;z<U;z++)O[z]=N[z]*L;N=O}for(let L=0,O=W.length;L<O;L++){const z=new S(W[L]+"."+bo[w.path],b.array,N,C);"CUBICSPLINE"===M.interpolation&&(z.createInterpolant=function(G){return new(this instanceof ba?$K:lF)(this.times,this.values,this.getValueSize()/3,G)},z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(z)}}return new Wd(r,void 0,m)})}createNodeMesh(e){const i=this,r=this.json.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return void 0!==r.weights&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const i=this,r=this.json.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=void 0===r.skin?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],d=c[1],h=c[2];null!==h&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(h,JK)});for(let f=0,p=d.length;f<p;f++)u.add(d[f]);return u})}_loadNodeShallow(e){const i=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=this.json.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(u=!0===s.isBone?new mb:c.length>1?new ss:1===c.length?c[0]:new Nn,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(s.name&&(u.userData.name=s.name,u.name=o),xo(u,s),s.extensions&&Ta(i,u,s),void 0!==s.matrix){const d=new tt;d.fromArray(s.matrix),u.applyMatrix4(d)}else void 0!==s.translation&&u.position.fromArray(s.translation),void 0!==s.rotation&&u.quaternion.fromArray(s.rotation),void 0!==s.scale&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new ss;i.name&&(s.name=r.createUniqueName(i.name)),xo(s,i),i.extensions&&Ta(t,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)s.add(l[u]);return r.associations=(u=>{const d=new Map;for(const[h,f]of r.associations)(h instanceof Lr||h instanceof ur)&&d.set(h,f);return u.traverse(h=>{const f=r.associations.get(h);null!=f&&d.set(h,f)}),d})(s),s})}}function dF(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=sx[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(void 0!==e.indices&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return xo(n,e),function tZ(n,e,t){const i=e.attributes,r=new Rr;if(void 0===i.POSITION)return;{const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(void 0===l||void 0===c)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new R(l[0],l[1],l[2]),new R(c[0],c[1],c[2])),a.normalized){const u=lx(Pc[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}const s=e.targets;if(void 0!==s){const a=new R,l=new R;for(let c=0,u=s.length;c<u;c++){const d=s[c];if(void 0!==d.POSITION){const h=t.json.accessors[d.POSITION],f=h.min,p=h.max;if(void 0!==f&&void 0!==p){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),h.normalized){const _=lx(Pc[h.componentType]);l.multiplyScalar(_)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new dr;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}(n,e,t),Promise.all(r).then(function(){return void 0!==e.targets?function YK(n,e,t){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(void 0!==d.POSITION&&(i=!0),void 0!==d.NORMAL&&(r=!0),void 0!==d.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const h=void 0!==d.POSITION?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(h)}if(r){const h=void 0!==d.NORMAL?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(h)}if(s){const h=void 0!==d.COLOR_0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(h)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const d=c[1],h=c[2];return i&&(n.morphAttributes.position=c[0]),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}(n,e.targets,t):n})}const Im=Math.PI/180;function MZ(){var n=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;void 0===l&&(l=[]);var c=r.init;void 0===c&&(c=function(){});var u=r.getTransferables;if(void 0===u&&(u=null),!n[o])try{l=l.map(function(h){return h&&h.isWorkerModule&&(e(h,function(f){if(f instanceof Error)throw f}),h=n[h.id].value),h}),c=i("<"+a+">.init",c),u&&(u=i("<"+a+">.getTransferables",u));var d=null;"function"==typeof c?d=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),n[o]={id:o,value:d,getTransferables:u},s(d)}catch(h){h&&h.noLog||console.error(h),s(h)}}function i(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+s+"\n)"],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{"registerModule"===a&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof c}})}),"callModule"===a&&function t(r,s){var o,a=r.id,l=r.args;(!n[a]||"function"!=typeof n[a].value)&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=n[a]).value.apply(o,l);c&&"function"==typeof c.then?c.then(u,function(d){return s(d instanceof Error?d:new Error(""+d))}):u(c)}catch(d){s(d)}function u(d){try{var h=n[a].getTransferables&&n[a].getTransferables(d);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),s(d,h)}catch(f){console.error(f),s(f)}}}(l,function(c,u){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}Math;var gF=function(){var n=!1;if(typeof window<"u"&&typeof window.document<"u")try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),n=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return gF=function(){return n},n},wZ=0,SZ=0,cx=!1,Yd=Object.create(null),Kd=Object.create(null),ux=Object.create(null);function Zd(n){if(!(n&&"function"==typeof n.init||cx))throw new Error("requires `options.init` function");var e=n.dependencies,t=n.init,i=n.getTransferables,r=n.workerId;if(!gF())return function EZ(n){var e=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return e._getInitResult().then(function(r){if("function"==typeof r)return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=n.dependencies,i=n.init;t=Array.isArray(t)?t.map(function(s){return s&&s._getInitResult?s._getInitResult():s}):[];var r=Promise.all(t).then(function(s){return i.apply(null,s)});return e._getInitResult=function(){return r},r},e}(n);null==r&&(r="#default");var s="workerModule"+ ++wZ,o=n.name||s,a=null;function l(){for(var c=[],u=arguments.length;u--;)c[u]=arguments[u];if(!a){a=_F(r,"registerModule",l.workerModuleData);var d=function(){a=null,Kd[r].delete(d)};(Kd[r]||(Kd[r]=new Set)).add(d)}return a.then(function(h){if(h.isCallable)return _F(r,"callModule",{id:s,args:c});throw new Error("Worker module function was called but `init` did not return a callable function")})}return e=e&&e.map(function(c){return"function"==typeof c&&!c.workerModuleData&&(cx=!0,c=Zd({workerId:r,name:"<"+o+"> function dependency: "+c.name,init:"function(){return (\n"+Rm(c)+"\n)}"}),cx=!1),c&&c.workerModuleData&&(c=c.workerModuleData),c}),l.workerModuleData={isWorkerModule:!0,id:s,name:o,dependencies:e,init:Rm(t),getTransferables:i&&Rm(i)},l}function Rm(n){var e=n.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function _F(n,e,t){return new Promise(function(i,r){var s=++SZ;ux[s]=function(o){o.success?i(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},function AZ(n){var e=Yd[n];if(!e){var t=Rm(MZ);(e=Yd[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+" **/\n\n;("+t+")()"],{type:"application/javascript"})))).onmessage=function(i){var r=i.data,s=r.messageId,o=ux[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete ux[s],o(r)}}return e}(n).postMessage({messageId:s,action:e,data:t})})}function yF(){var n=function(e){function t(V,q,B,k,X,j,Q,te){var K=1-Q;te.x=K*K*V+2*K*Q*B+Q*Q*X,te.y=K*K*q+2*K*Q*k+Q*Q*j}function i(V,q,B,k,X,j,Q,te,K,ae){var ue=1-K;ae.x=ue*ue*ue*V+3*ue*ue*K*B+3*ue*K*K*X+K*K*K*Q,ae.y=ue*ue*ue*q+3*ue*ue*K*k+3*ue*K*K*j+K*K*K*te}function r(V,q){for(var k,X,j,Q,te,B=/([MLQCZ])([^MLQCZ]*)/g;k=B.exec(V);){var K=k[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ae){return parseFloat(ae)});switch(k[1]){case"M":Q=X=K[0],te=j=K[1];break;case"L":(K[0]!==Q||K[1]!==te)&&q("L",Q,te,Q=K[0],te=K[1]);break;case"Q":q("Q",Q,te,Q=K[2],te=K[3],K[0],K[1]);break;case"C":q("C",Q,te,Q=K[4],te=K[5],K[0],K[1],K[2],K[3]);break;case"Z":(Q!==X||te!==j)&&q("L",Q,te,X,j)}}}function s(V,q,B){void 0===B&&(B=16);var k={x:0,y:0};r(V,function(X,j,Q,te,K,ae,ue,Ce,he){switch(X){case"L":q(j,Q,te,K);break;case"Q":for(var D=j,ye=Q,re=1;re<B;re++)t(j,Q,ae,ue,te,K,re/(B-1),k),q(D,ye,k.x,k.y),D=k.x,ye=k.y;break;case"C":for(var ie=j,J=Q,Ae=1;Ae<B;Ae++)i(j,Q,ae,ue,Ce,he,te,K,Ae/(B-1),k),q(ie,J,k.x,k.y),ie=k.x,J=k.y}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(V,q){var B=V.getContext?V.getContext("webgl",c):V,k=l.get(B);if(!k){let ue=function(ie){var J=j[ie];if(!J&&!(J=j[ie]=B.getExtension(ie)))throw new Error(ie+" not supported");return J},Ce=function(ie,J){var Ae=B.createShader(J);return B.shaderSource(Ae,ie),B.compileShader(Ae),Ae},he=function(ie,J,Ae,se){if(!Q[ie]){var be={},Me={},de=B.createProgram();B.attachShader(de,Ce(J,B.VERTEX_SHADER)),B.attachShader(de,Ce(Ae,B.FRAGMENT_SHADER)),B.linkProgram(de),Q[ie]={program:de,transaction:function(I){B.useProgram(de),I({setUniform:function(Y,xe){for(var _e=[],P=arguments.length-2;P-- >0;)_e[P]=arguments[P+2];var ce=Me[xe]||(Me[xe]=B.getUniformLocation(de,xe));B["uniform"+Y].apply(B,[ce].concat(_e))},setAttribute:function(Y,xe,_e,P,ce){var fe=be[Y];fe||(fe=be[Y]={buf:B.createBuffer(),loc:B.getAttribLocation(de,Y),data:null}),B.bindBuffer(B.ARRAY_BUFFER,fe.buf),B.vertexAttribPointer(fe.loc,xe,B.FLOAT,!1,0,0),B.enableVertexAttribArray(fe.loc),X?B.vertexAttribDivisor(fe.loc,P):ue("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(fe.loc,P),ce!==fe.data&&(B.bufferData(B.ARRAY_BUFFER,ce,_e),fe.data=ce)}})}}}Q[ie].transaction(se)},D=function(ie,J){K++;try{B.activeTexture(B.TEXTURE0+K);var Ae=te[ie];Ae||(Ae=te[ie]=B.createTexture(),B.bindTexture(B.TEXTURE_2D,Ae),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.NEAREST),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.NEAREST)),B.bindTexture(B.TEXTURE_2D,Ae),J(Ae,K)}finally{K--}},ye=function(ie,J,Ae){var se=B.createFramebuffer();ae.push(se),B.bindFramebuffer(B.FRAMEBUFFER,se),B.activeTexture(B.TEXTURE0+J),B.bindTexture(B.TEXTURE_2D,ie),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,ie,0);try{Ae(se)}finally{B.deleteFramebuffer(se),B.bindFramebuffer(B.FRAMEBUFFER,ae[--ae.length-1]||null)}},re=function(){j={},Q={},te={},K=-1,ae.length=0};var X=typeof WebGL2RenderingContext<"u"&&B instanceof WebGL2RenderingContext,j={},Q={},te={},K=-1,ae=[];B.canvas.addEventListener("webglcontextlost",function(ie){re(),ie.preventDefault()},!1),l.set(B,k={gl:B,isWebGL2:X,getExtension:ue,withProgram:he,withTexture:D,withTextureFramebuffer:ye,handleContextLoss:re})}q(k)}function d(V,q,B,k,X,j,Q,te){void 0===Q&&(Q=15),void 0===te&&(te=null),u(V,function(K){var ae=K.gl,ue=K.withProgram;(0,K.withTexture)("copy",function(he,D){ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,X,j,0,ae.RGBA,ae.UNSIGNED_BYTE,q),ue("copy",o,a,function(ye){var re=ye.setUniform;(0,ye.setAttribute)("aUV",2,ae.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),re("1i","image",D),ae.bindFramebuffer(ae.FRAMEBUFFER,te||null),ae.disable(ae.BLEND),ae.colorMask(8&Q,4&Q,2&Q,1&Q),ae.viewport(B,k,X,j),ae.scissor(B,k,X,j),ae.drawArrays(ae.TRIANGLES,0,3)})})})}var f=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:d,resizeWebGLCanvasWithoutClearing:function h(V,q,B){var k=V.width,X=V.height;u(V,function(j){var Q=j.gl,te=new Uint8Array(k*X*4);Q.readPixels(0,0,k,X,Q.RGBA,Q.UNSIGNED_BYTE,te),V.width=q,V.height=B,d(Q,te,0,0,k,X)})}});function p(V,q,B,k,X,j){void 0===j&&(j=1);var Q=new Uint8Array(V*q),te=k[2]-k[0],K=k[3]-k[1],ae=[];s(B,function(ie,J,Ae,se){ae.push({x1:ie,y1:J,x2:Ae,y2:se,minX:Math.min(ie,Ae),minY:Math.min(J,se),maxX:Math.max(ie,Ae),maxY:Math.max(J,se)})}),ae.sort(function(ie,J){return ie.maxX-J.maxX});for(var ue=0;ue<V;ue++)for(var Ce=0;Ce<q;Ce++){var he=ye(k[0]+te*(ue+.5)/V,k[1]+K*(Ce+.5)/q),D=Math.pow(1-Math.abs(he)/X,j)/2;he<0&&(D=1-D),D=Math.max(0,Math.min(255,Math.round(255*D))),Q[Ce*V+ue]=D}return Q;function ye(ie,J){for(var Ae=1/0,se=1/0,be=ae.length;be--;){var Me=ae[be];if(Me.maxX+se<=ie)break;if(ie+se>Me.minX&&J-se<Me.maxY&&J+se>Me.minY){var de=g(ie,J,Me.x1,Me.y1,Me.x2,Me.y2);de<Ae&&(Ae=de,se=Math.sqrt(Ae))}}return function re(ie,J){for(var Ae=0,se=ae.length;se--;){var be=ae[se];if(be.maxX<=ie)break;be.y1>J!=be.y2>J&&ie<(be.x2-be.x1)*(J-be.y1)/(be.y2-be.y1)+be.x1&&(Ae+=be.y1<be.y2?1:-1)}return 0!==Ae}(ie,J)&&(se=-se),se}}function _(V,q,B,k,X,j,Q,te,K,ae){void 0===j&&(j=1),void 0===te&&(te=0),void 0===K&&(K=0),void 0===ae&&(ae=0),m(V,q,B,k,X,j,Q,null,te,K,ae)}function m(V,q,B,k,X,j,Q,te,K,ae,ue){void 0===j&&(j=1),void 0===K&&(K=0),void 0===ae&&(ae=0),void 0===ue&&(ue=0);for(var Ce=p(V,q,B,k,X,j),he=new Uint8Array(4*Ce.length),D=0;D<Ce.length;D++)he[4*D+ue]=Ce[D];d(Q,he,K,ae,V,q,1<<3-ue,te)}function g(V,q,B,k,X,j){var Q=X-B,te=j-k,K=Q*Q+te*te,ae=K?Math.max(0,Math.min(1,((V-B)*Q+(q-k)*te)/K)):0,ue=V-(B+ae*Q),Ce=q-(k+ae*te);return ue*ue+Ce*Ce}var v=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:_,generateIntoFramebuffer:m}),y="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),w=null,S=!1,E={},C=new WeakMap;function W(V){if(!S&&!z(V))throw new Error("WebGL generation not supported")}function N(V,q,B,k,X,j,Q){if(void 0===j&&(j=1),void 0===Q&&(Q=null),!Q&&!(Q=w)){var te="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!te)throw new Error("OffscreenCanvas or DOM canvas not supported");Q=w=te.getContext("webgl",{depth:!1})}W(Q);var K=new Uint8Array(V*q*4);u(Q,function(he){var D=he.gl,re=he.withTextureFramebuffer;(0,he.withTexture)("readable",function(ie,J){D.texImage2D(D.TEXTURE_2D,0,D.RGBA,V,q,0,D.RGBA,D.UNSIGNED_BYTE,null),re(ie,J,function(Ae){O(V,q,B,k,X,j,D,Ae,0,0,0),D.readPixels(0,0,V,q,D.RGBA,D.UNSIGNED_BYTE,K)})})});for(var ae=new Uint8Array(V*q),ue=0,Ce=0;ue<K.length;ue+=4)ae[Ce++]=K[ue];return ae}function L(V,q,B,k,X,j,Q,te,K,ae){void 0===j&&(j=1),void 0===te&&(te=0),void 0===K&&(K=0),void 0===ae&&(ae=0),O(V,q,B,k,X,j,Q,null,te,K,ae)}function O(V,q,B,k,X,j,Q,te,K,ae,ue){void 0===j&&(j=1),void 0===K&&(K=0),void 0===ae&&(ae=0),void 0===ue&&(ue=0),W(Q);var Ce=[];s(B,function(he,D,ye,re){Ce.push(he,D,ye,re)}),Ce=new Float32Array(Ce),u(Q,function(he){var D=he.gl,ye=he.isWebGL2,re=he.getExtension,ie=he.withProgram,Ae=he.withTextureFramebuffer,se=he.handleContextLoss;if((0,he.withTexture)("rawDistances",function(be,Me){(V!==be._lastWidth||q!==be._lastHeight)&&D.texImage2D(D.TEXTURE_2D,0,D.RGBA,be._lastWidth=V,be._lastHeight=q,0,D.RGBA,D.UNSIGNED_BYTE,null),ie("main",y,b,function(de){var Ve=de.setAttribute,I=de.setUniform,T=!ye&&re("ANGLE_instanced_arrays"),Y=!ye&&re("EXT_blend_minmax");Ve("aUV",2,D.STATIC_DRAW,0,M),Ve("aLineSegment",4,D.DYNAMIC_DRAW,1,Ce),I.apply(void 0,["4f","uGlyphBounds"].concat(k)),I("1f","uMaxDistance",X),I("1f","uExponent",j),Ae(be,Me,function(xe){D.enable(D.BLEND),D.colorMask(!0,!0,!0,!0),D.viewport(0,0,V,q),D.scissor(0,0,V,q),D.blendFunc(D.ONE,D.ONE),D.blendEquationSeparate(D.FUNC_ADD,ye?D.MAX:Y.MAX_EXT),D.clear(D.COLOR_BUFFER_BIT),ye?D.drawArraysInstanced(D.TRIANGLES,0,3,Ce.length/4):T.drawArraysInstancedANGLE(D.TRIANGLES,0,3,Ce.length/4)})}),ie("post",o,x,function(de){de.setAttribute("aUV",2,D.STATIC_DRAW,0,M),de.setUniform("1i","tex",Me),D.bindFramebuffer(D.FRAMEBUFFER,te),D.disable(D.BLEND),D.colorMask(0===ue,1===ue,2===ue,3===ue),D.viewport(K,ae,V,q),D.scissor(K,ae,V,q),D.drawArrays(D.TRIANGLES,0,3)})}),D.isContextLost())throw se(),new Error("webgl context lost")})}function z(V){var q=V&&V!==w?V.canvas||V:E,B=C.get(q);if(void 0===B){S=!0;var k=null;try{var X=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],j=N(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,V);(B=j&&X.length===j.length&&j.every(function(Q,te){return Q===X[te]}))||(k="bad trial run results",console.info(X,j))}catch(Q){B=!1,k=Q.message}k&&console.warn("WebGL SDF generation not supported:",k),S=!1,C.set(q,B)}return B}var U=Object.freeze({__proto__:null,generate:N,generateIntoCanvas:L,generateIntoFramebuffer:O,isSupported:z});return e.forEachPathCommand=r,e.generate=function G(V,q,B,k,X,j){void 0===X&&(X=Math.max(k[2]-k[0],k[3]-k[1])/2),void 0===j&&(j=1);try{return N.apply(U,arguments)}catch(Q){return console.info("WebGL SDF generation failed, falling back to JS",Q),p.apply(v,arguments)}},e.generateIntoCanvas=function $(V,q,B,k,X,j,Q,te,K,ae){void 0===X&&(X=Math.max(k[2]-k[0],k[3]-k[1])/2),void 0===j&&(j=1),void 0===te&&(te=0),void 0===K&&(K=0),void 0===ae&&(ae=0);try{return L.apply(U,arguments)}catch(ue){return console.info("WebGL SDF generation failed, falling back to JS",ue),_.apply(v,arguments)}},e.javascript=v,e.pathToLineSegments=s,e.webgl=U,e.webglUtils=f,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return n}const vF=/\bvoid\s+main\s*\(\s*\)\s*{/g;function dx(n){return n.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function t(i,r){let s=yt[r];return s?dx(s):i})}const $n=[];for(let n=0;n<256;n++)$n[n]=(n<16?"0":"")+n.toString(16);const Aa=Object.assign||function(){let n=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let i=arguments[e];if(i)for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},RZ=Date.now(),bF=new WeakMap,xF=new Map;let PZ=1e10;function Pm(n,e){const t=function NZ(n){const e=JSON.stringify(n,LZ);let t=EF.get(e);return null==t&&EF.set(e,t=++OZ),t}(e);let i=bF.get(n);if(i||bF.set(n,i=Object.create(null)),i[t])return new i[t];const r=`_onBeforeCompile${t}`,s=function(c,u){n.onBeforeCompile.call(this,c,u);const d=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let h=xF[d];if(!h){const f=function FZ(n,{vertexShader:e,fragmentShader:t},i,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:d,fragmentColorTransform:h,customRewriter:f,timeUniform:p}=i;if(s=s||"",o=o||"",a=a||"",c=c||"",u=u||"",d=d||"",(l||f)&&(e=dx(e)),(h||f)&&(t=dx(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),f){let _=f({vertexShader:e,fragmentShader:t});e=_.vertexShader,t=_.fragmentShader}if(h){let _=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(_.push(m),"")),d=`${h}\n${_.join("\n")}\n${d}`}if(p){const _=`\nuniform float ${p};\n`;s=_+s,c=_+c}return l&&(s=`${s}\nvoid troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,o=`\ntroika_position_${r} = vec3(position);\ntroika_normal_${r} = vec3(normal);\ntroika_uv_${r} = vec2(uv);\ntroikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});\n${o}\n`,e=(e=`vec3 troika_position_${r};\nvec3 troika_normal_${r};\nvec2 troika_uv_${r};\n${e}\n`).replace(/\b(position|normal|uv)\b/g,(_,m,g,v)=>/\battribute\s+vec[23]\s+$/.test(v.substr(0,g))?m:`troika_${m}_${r}`),n.map&&n.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),{vertexShader:e=MF(e,r,s,o,a),fragmentShader:t=MF(t,r,c,u,d)}}(this,c,e,t);h=xF[d]=f}c.vertexShader=h.vertexShader,c.fragmentShader=h.fragmentShader,Aa(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-RZ}}),this[r]&&this[r](c)},o=function(){return a(e.chained?n:n.clone())},a=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:n}),Object.defineProperty(u,"id",{value:PZ++}),u.uuid=function IZ(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return($n[255&n]+$n[n>>8&255]+$n[n>>16&255]+$n[n>>24&255]+"-"+$n[255&e]+$n[e>>8&255]+"-"+$n[e>>16&15|64]+$n[e>>24&255]+"-"+$n[63&t|128]+$n[t>>8&255]+"-"+$n[t>>16&255]+$n[t>>24&255]+$n[255&i]+$n[i>>8&255]+$n[i>>16&255]+$n[i>>24&255]).toUpperCase()}(),u.uniforms=Aa({},c.uniforms,e.uniforms),u.defines=Aa({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",u.extensions=Aa({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get:()=>s,set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return n.copy.call(this,c),!n.isShaderMaterial&&!n.isDerivedMaterial&&(Aa(this.extensions,c.extensions),Aa(this.defines,c.defines),Aa(this.uniforms,aR.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new n.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=Pm(n.isDerivedMaterial?n.getDepthMaterial():new ob({depthPacking:LI}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=Pm(n.isDerivedMaterial?n.getDistanceMaterial():new ab,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),n.dispose.call(this)}}};return i[t]=o,new o}function MF(n,e,t,i,r){return(i||r||t)&&(n=n.replace(vF,`\n${t}\nvoid troikaOrigMain${e}() {`),n+=`\nvoid main() {\n  ${i}\n  troikaOrigMain${e}();\n  ${r}\n}`),n}function LZ(n,e){return"uniforms"===n?void 0:"function"==typeof e?e.toString():e}let OZ=0;const EF=new Map,Ca=()=>(self.performance||Date).now(),Fm=yF();let AF;const Lm=[],jZ=5;let hx=0;function CF(){const n=Ca();for(;Lm.length&&Ca()-n<jZ;)Lm.shift()();hx=Lm.length?setTimeout(CF,0):0}const $Z=(...n)=>new Promise((e,t)=>{Lm.push(()=>{const i=Ca();try{Fm.webgl.generateIntoCanvas(...n),e({timing:Ca()-i})}catch(r){t(r)}}),hx||(hx=setTimeout(CF,0))}),qZ=4,XZ=2e3,DF={};let YZ=0;function IF(n,e,t,i,r,s,o,a,l,c){const u="TroikaTextSDFGenerator_JS_"+YZ++%qZ;let d=DF[u];return d||(d=DF[u]={workerModule:Zd({name:u,workerId:u,dependencies:[yF,Ca],init(h,f){const p=h().javascript.generate;return function(..._){const m=f();return{textureData:p(..._),timing:f()-m}}},getTransferables:h=>[h.textureData.buffer]}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(n,e,t,i,r,s).then(({textureData:h,timing:f})=>{const p=Ca(),_=new Uint8Array(4*h.length);for(let m=0;m<h.length;m++)_[4*m+c]=h[m];return Fm.webglUtils.renderImageData(o,_,a,l,n,e,1<<3-c),f+=Ca()-p,0==--d.requests&&(d.idleTimer=setTimeout(()=>{!function TZ(n){Kd[n]&&Kd[n].forEach(function(e){e()}),Yd[n]&&(Yd[n].terminate(),delete Yd[n])}(u)},XZ)),{timing:f}})}const ZZ=Fm.webglUtils.resizeWebGLCanvasWithoutClearing,tQ=Zd({name:"Typr Font Parser",dependencies:[function QZ(){return typeof window>"u"&&(self.window=self),function(n){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if("ttcf"==s.readASCII(o,0,4)){var a=4;s.readUshort(o,a),s.readUshort(o,a+=2);var l=s.readUint(o,a+=2);a+=4;for(var c=[],u=0;u<l;u++){var d=s.readUint(o,a);a+=4,c.push(e._readFont(o,d))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s);var l=o.readUshort(r,s+=4);o.readUshort(r,s+=2),o.readUshort(r,s+=2),o.readUshort(r,s+=2),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],u={_data:r,_offset:a},d={},h=0;h<l;h++){var f=o.readASCII(r,s,4);o.readUint(r,s+=4);var p=o.readUint(r,s+=4),_=o.readUint(r,s+=4);s+=4,d[f]={offset:p,length:_}}for(h=0;h<c.length;h++){var m=c[h];d[m]&&(u[m.trim()]=e[m.trim()].parse(r,d[m].offset,d[m].length,u))}return u},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,u=0;u<l;u++){var d=a.readASCII(r,c,4);a.readUint(r,c+=4);var h=a.readUint(r,c+=4);if(a.readUint(r,c+=4),c+=4,d==s)return h}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&0==s&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,u={},d=s;c.readFixed(r,s);var h=c.readUshort(r,s+=4),f=c.readUshort(r,s+=2),p=c.readUshort(r,s+=2);return s+=2,u.scriptList=e._lctf.readScriptList(r,d+h),u.featureList=e._lctf.readFeatureList(r,d+f),u.lookupList=e._lctf.readLookupList(r,d+p,l),u},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],u=a.readUshort(r,s);s+=2;for(var d=0;d<u;d++){var h=a.readUshort(r,s);s+=2;var f=e._lctf.readLookupTable(r,l+h,o);c.push(f)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),c.flag=a.readUshort(r,s+=2);var u=a.readUshort(r,s+=2);s+=2;for(var d=c.ltype,h=0;h<u;h++){var f=a.readUshort(r,s);s+=2;var p=o(r,d,l+f,c);c.tabs.push(p)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)r>>>o&1&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,1==l){var c=o.readUshort(r,s),u=o.readUshort(r,s+=2);s+=2;for(var d=0;d<u;d++)a.push(c+d),a.push(c+d),a.push(o.readUshort(r,s)),s+=2}if(2==l){var h=o.readUshort(r,s);for(s+=2,d=0;d<h;d++)a.push(o.readUshort(r,s)),a.push(o.readUshort(r,s+=2)),a.push(o.readUshort(r,s+=2)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3)if(r[o]<=s&&s<=r[o+1])return o;return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s);var l=o.readUshort(r,s+=2);return s+=2,1==a.fmt&&(a.tab=o.readUshorts(r,s,l)),2==a.fmt&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(1==r.fmt)return o.indexOf(s);if(2==r.fmt){var a=e._lctf.getInterval(o,s);if(-1!=a)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var d=o.readASCII(r,s,4),h=o.readUshort(r,s+=4);s+=2;var f=e._lctf.readFeatureTable(r,a+h);f.tag=d.trim(),l.push(f)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var u=o.readUshort(r,s);s+=2,l.tab=[];for(var d=0;d<u;d++)l.tab.push(o.readUshort(r,s+2*d));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var d=o.readASCII(r,s,4),h=o.readUshort(r,s+=4);s+=2,l[d.trim()]=e._lctf.readScriptTable(r,a+h)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,l.default=e._lctf.readLangSysTable(r,a+c);var u=o.readUshort(r,s);s+=2;for(var d=0;d<u;d++){var h=o.readASCII(r,s,4),f=o.readUshort(r,s+=4);s+=2,l[h.trim()]=e._lctf.readLangSysTable(r,a+f)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),a.reqFeature=o.readUshort(r,s+=2);var l=o.readUshort(r,s+=2);return a.features=o.readUshorts(r,s+=2,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;r=new Uint8Array(r.buffer,s,o),s=0,++s,++s,++s,s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(a.readASCII(r,s+l[u],l[u+1]-l[u]));var d=[];s=e.CFF.readIndex(r,s+=l[l.length-1],d);var h=[];for(u=0;u<d.length-1;u++)h.push(e.CFF.readDict(r,s+d[u],s+d[u+1]));var f=h[0],p=[];s=e.CFF.readIndex(r,s+=d[d.length-1],p);var _=[];for(u=0;u<p.length-1;u++)_.push(a.readASCII(r,s+p[u],p[u+1]-p[u]));if(e.CFF.readSubrs(r,s+=p[p.length-1],f),f.CharStrings){s=e.CFF.readIndex(r,s=f.CharStrings,p=[]);var m=[];for(u=0;u<p.length-1;u++)m.push(a.readBytes(r,s+p[u],p[u+1]-p[u]));f.CharStrings=m}if(f.ROS){var g=[];for(s=e.CFF.readIndex(r,s=f.FDArray,g),f.FDArray=[],u=0;u<g.length-1;u++){var v=e.CFF.readDict(r,s+g[u],s+g[u+1]);e.CFF._readFDict(r,v,_),f.FDArray.push(v)}s+=g[g.length-1],s=f.FDSelect,f.FDSelect=[];var y=r[s];if(s++,3!=y)throw y;var b=a.readUshort(r,s);for(s+=2,u=0;u<b+1;u++)f.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(r,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(r,f.charset,f.CharStrings.length)),e.CFF._readFDict(r,f,_),f},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(s.Private=e.CFF.readDict(r,a=s.Private[1],a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var u=l.length;o.Bias=u<1240?107:u<33900?1131:32768,o.Subrs=[];for(var d=0;d<l.length-1;d++)o.Subrs.push(a.readBytes(r,s+l[d],l[d+1]-l[d]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){var a=[".notdef"],l=r[s];if(s++,0!=l)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var u=0;u<c;u++)a.push(r[s+u]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,0==c)for(var u=0;u<o;u++){var d=a.readUshort(r,s);s+=2,l.push(d)}else{if(1!=c&&2!=c)throw"error: format: "+c;for(;l.length<o;){d=a.readUshort(r,s),s+=2;var h=0;for(1==c?(h=r[s],s++):(h=a.readUshort(r,s),s+=2),u=0;u<=h;u++)l.push(d),d++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,1==c)for(var u=0;u<l;u++)o.push(r[s+u]);else if(2==c)for(u=0;u<l;u++)o.push(a.readUshort(r,s+2*u));else if(3==c)for(u=0;u<l;u++)o.push(16777215&a.readUint(r,s+3*u-1));else if(1!=l)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1],u=1,d=null,h=null;l<=20&&(d=l,u=1),12==l&&(d=100*l+c,u=2),21<=l&&l<=27&&(d=l,u=1),28==l&&(h=a.readShort(r,s+1),u=3),29<=l&&l<=31&&(d=l,u=1),32<=l&&l<=246&&(h=l-139,u=1),247<=l&&l<=250&&(h=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(h=256*-(l-251)-c-108,u=2),255==l&&(h=a.readInt(r,s+1)/65535,u=5),o.val=h??"o"+d,o.size=u},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var u=r[s],d=r[s+1],h=1,f=null,p=null;u<=20&&(f=u,h=1),12==u&&(f=100*u+d,h=2),19!=u&&20!=u||(f=u,h=2),21<=u&&u<=27&&(f=u,h=1),28==u&&(p=l.readShort(r,s+1),h=3),29<=u&&u<=31&&(f=u,h=1),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+d+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-d-108,h=2),255==u&&(p=l.readInt(r,s+1)/65535,h=5),c.push(p??"o"+f),s+=h}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var u=r[s],d=r[s+1],h=1,f=null,p=null;if(28==u&&(p=a.readShort(r,s+1),h=3),29==u&&(p=a.readInt(r,s+1),h=5),32<=u&&u<=246&&(p=u-139,h=1),247<=u&&u<=250&&(p=256*(u-247)+d+108,h=2),251<=u&&u<=254&&(p=256*-(u-251)-d-108,h=2),255==u)throw p=a.readInt(r,s+1)/65535,h=5,"unknown number";if(30==u){var _=[];for(h=1;;){var m=r[s+h];h++;var g=m>>4,v=15&m;if(15!=g&&_.push(g),15!=v&&_.push(v),15==v)break}for(var y="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],x=0;x<_.length;x++)y+=b[_[x]];p=parseFloat(y)}u<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],h=1,12==u&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][d],h=2)),null!=f?(l[f]=1==c.length?c[0]:c,c=[]):c.push(p),s+=h}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o);var a=e._bin,l={};a.readUshort(r,s=0);var c=a.readUshort(r,s+=2);s+=2;var u=[];l.tables=[];for(var d=0;d<c;d++){var h=a.readUshort(r,s),f=a.readUshort(r,s+=2),p=a.readUint(r,s+=2);s+=4;var _="p"+h+"e"+f,m=u.indexOf(p);if(-1==m){var g;m=l.tables.length,u.push(p);var v=a.readUshort(r,p);0==v?g=e.cmap.parse0(r,p):4==v?g=e.cmap.parse4(r,p):6==v?g=e.cmap.parse6(r,p):12==v?g=e.cmap.parse12(r,p):console.debug("unknown format: "+v,h,f,p),l.tables.push(g)}if(null!=l[_])throw"multiple tables for one platform+encoding";l[_]=m}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s);var l=o.readUshort(r,s+=2);o.readUshort(r,s+=2),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s);var c=o.readUshort(r,s+=2);o.readUshort(r,s+=2);var d=o.readUshort(r,s+=2)/2;l.searchRange=o.readUshort(r,s+=2),l.entrySelector=o.readUshort(r,s+=2),l.rangeShift=o.readUshort(r,s+=2),l.endCount=o.readUshorts(r,s+=2,d),s+=2*d,l.startCount=o.readUshorts(r,s+=2,d),s+=2*d,l.idDelta=[];for(var h=0;h<d;h++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,d),s+=2*d,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),o.readUshort(r,s+=2),o.readUshort(r,s+=2),a.firstCode=o.readUshort(r,s+=2);var l=o.readUshort(r,s+=2);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUint(r,s+=2),o.readUint(r,s+=4);var l=o.readUint(r,s+=4);s+=4,a.groups=[];for(var c=0;c<l;c++){var u=s+12*c,d=o.readUint(r,u+0),h=o.readUint(r,u+4),f=o.readUint(r,u+8);a.groups.push([d,h,f])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),c.xMin=o.readShort(a,l+=2),c.yMin=o.readShort(a,l+=2),c.xMax=o.readShort(a,l+=2),c.yMax=o.readShort(a,l+=2),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(o.readUshort(a,l)),l+=2;var d=o.readUshort(a,l);if(a.length-(l+=2)<d)return null;c.instructions=o.readBytes(a,l,d),l+=d;var h=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<h;u++){var f=a[l];if(l++,c.flags.push(f),0!=(8&f)){var p=a[l];l++;for(var _=0;_<p;_++)c.flags.push(f),u++}}for(c.xs=[],u=0;u<h;u++){var m=0!=(2&c.flags[u]),g=0!=(16&c.flags[u]);m?(c.xs.push(g?a[l]:-a[l]),l++):g?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],u=0;u<h;u++)g=0!=(32&c.flags[u]),(m=0!=(4&c.flags[u]))?(c.ys.push(g?a[l]:-a[l]),l++):g?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var v=0,y=0;for(u=0;u<h;u++)y+=c.ys[u],c.xs[u]=v+=c.xs[u],c.ys[u]=y}else{var b;c.parts=[];do{b=o.readUshort(a,l),l+=2;var x={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(x),x.glyphIndex=o.readUshort(a,l),l+=2,1&b){var M=o.readShort(a,l),w=o.readShort(a,l+=2);l+=2}else M=o.readInt8(a,l),l++,w=o.readInt8(a,l),l++;2&b?(x.m.tx=M,x.m.ty=w):(x.p1=M,x.p2=w),8&b?(x.m.a=x.m.d=o.readF2dot14(a,l),l+=2):64&b?(x.m.a=o.readF2dot14(a,l),x.m.d=o.readF2dot14(a,l+=2),l+=2):128&b&&(x.m.a=o.readF2dot14(a,l),x.m.b=o.readF2dot14(a,l+=2),x.m.c=o.readF2dot14(a,l+=2),x.m.d=o.readF2dot14(a,l+=2),l+=2)}while(32&b);if(256&b){var S=o.readUshort(a,l);for(l+=2,c.instr=[],u=0;u<S;u++)c.instr.push(a[l]),l++}}return c},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,1==s||2==s||3==s||7==s||8==s&&u.fmt<=2){var d=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,d+c)}if(1==s&&1==u.fmt){var h=l.readUshort(r,o);o+=2;var f=e._lctf.numOfOnes(h);0!=h&&(u.pos=e.GPOS.readValueRecord(r,o,h))}else if(2==s&&u.fmt>=1&&u.fmt<=2){h=l.readUshort(r,o);var p=l.readUshort(r,o+=2);o+=2,f=e._lctf.numOfOnes(h);var _=e._lctf.numOfOnes(p);if(1==u.fmt){u.pairsets=[];var m=l.readUshort(r,o);o+=2;for(var g=0;g<m;g++){var v=c+l.readUshort(r,o);o+=2;var y=l.readUshort(r,v);v+=2;for(var b=[],x=0;x<y;x++){var M=l.readUshort(r,v);v+=2,0!=h&&(N=e.GPOS.readValueRecord(r,v,h),v+=2*f),0!=p&&(L=e.GPOS.readValueRecord(r,v,p),v+=2*_),b.push({gid2:M,val1:N,val2:L})}u.pairsets.push(b)}}if(2==u.fmt){var w=l.readUshort(r,o),S=l.readUshort(r,o+=2),E=l.readUshort(r,o+=2),C=l.readUshort(r,o+=2);for(o+=2,u.classDef1=e._lctf.readClassDef(r,c+w),u.classDef2=e._lctf.readClassDef(r,c+S),u.matrix=[],g=0;g<E;g++){var W=[];for(x=0;x<C;x++){var N=null,L=null;0!=h&&(N=e.GPOS.readValueRecord(r,o,h),o+=2*f),0!=p&&(L=e.GPOS.readValueRecord(r,o,p),o+=2*_),W.push({val1:N,val2:L})}u.matrix.push(W)}}}else{if(9==s&&1==u.fmt){var O=l.readUshort(r,o),z=l.readUint(r,o+=2);if(o+=4,9==a.ltype)a.ltype=O;else if(a.ltype!=O)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+z)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,1!=s&&4!=s&&5!=s&&6!=s)return null;if(1==s||4==s||5==s&&u.fmt<=2||6==s&&u.fmt<=2){var d=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,c+d)}if(1==s&&u.fmt>=1&&u.fmt<=2){if(1==u.fmt)u.delta=l.readShort(r,o),o+=2;else if(2==u.fmt){var h=l.readUshort(r,o);u.newg=l.readUshorts(r,o+=2,h),o+=2*u.newg.length}}else if(4==s){u.vals=[],h=l.readUshort(r,o),o+=2;for(var f=0;f<h;f++){var p=l.readUshort(r,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(r,c+p))}}else if(5==s&&2==u.fmt){if(2==u.fmt){var _=l.readUshort(r,o);o+=2,u.cDef=e._lctf.readClassDef(r,c+_),u.scset=[];var m=l.readUshort(r,o);for(o+=2,f=0;f<m;f++){var g=l.readUshort(r,o);o+=2,u.scset.push(0==g?null:e.GSUB.readSubClassSet(r,c+g))}}}else if(6==s&&3==u.fmt){if(3==u.fmt){for(f=0;f<3;f++){h=l.readUshort(r,o),o+=2;for(var v=[],y=0;y<h;y++)v.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*y)));o+=2*h,0==f&&(u.backCvg=v),1==f&&(u.inptCvg=v),2==f&&(u.ahedCvg=v)}h=l.readUshort(r,o),u.lookupRec=e.GSUB.readSubstLookupRecords(r,o+=2,h)}}else{if(7==s&&1==u.fmt){var b=l.readUshort(r,o),x=l.readUint(r,o+=2);if(o+=4,9==a.ltype)a.ltype=b;else if(a.ltype!=b)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+x)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var u=0;u<c;u++){var d=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+d))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var u=0;u<l-1;u++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var d=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+d))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=o.readUshort(r,s);1==c&&u--,a[l[c]]=o.readUshorts(r,s+=2,u),s+=2*a[l[c]].length}return u=o.readUshort(r,s),a.subst=o.readUshorts(r,s+=2,2*u),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var d=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+d))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s);var l=o.readUshort(r,s+=2);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),l.fontRevision=a.readFixed(r,s+=4),a.readUint(r,s+=4),a.readUint(r,s+=4),l.flags=a.readUshort(r,s+=4),l.unitsPerEm=a.readUshort(r,s+=2),l.created=a.readUint64(r,s+=2),l.modified=a.readUint64(r,s+=8),l.xMin=a.readShort(r,s+=8),l.yMin=a.readShort(r,s+=2),l.xMax=a.readShort(r,s+=2),l.yMax=a.readShort(r,s+=2),l.macStyle=a.readUshort(r,s+=2),l.lowestRecPPEM=a.readUshort(r,s+=2),l.fontDirectionHint=a.readShort(r,s+=2),l.indexToLocFormat=a.readShort(r,s+=2),l.glyphDataFormat=a.readShort(r,s+=2),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),l.ascender=a.readShort(r,s+=4),l.descender=a.readShort(r,s+=2),l.lineGap=a.readShort(r,s+=2),l.advanceWidthMax=a.readUshort(r,s+=2),l.minLeftSideBearing=a.readShort(r,s+=2),l.minRightSideBearing=a.readShort(r,s+=2),l.xMaxExtent=a.readShort(r,s+=2),l.caretSlopeRise=a.readShort(r,s+=2),l.caretSlopeRun=a.readShort(r,s+=2),l.caretOffset=a.readShort(r,s+=2),s+=2,l.metricDataFormat=a.readShort(r,s+=8),l.numberOfHMetrics=a.readUshort(r,s+=2),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,d=0,h=0;h<a.maxp.numGlyphs;h++)h<a.hhea.numberOfHMetrics&&(u=l.readUshort(r,s),d=l.readShort(r,s+=2),s+=2),c.aWidth.push(u),c.lsBearing.push(d);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,1==c)return e.kern.parseV1(r,s-2,o,a);var u=l.readUshort(r,s);s+=2;for(var d={glyph1:[],rval:[]},h=0;h<u;h++){o=l.readUshort(r,s+=2);var p=l.readUshort(r,s+=2)>>>8;if(0!=(p&=15))throw"unknown kern table format: "+p;s=e.kern.readFormat0(r,s+=2,d)}return d},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s);var c=l.readUint(r,s+=4);s+=4;for(var u={glyph1:[],rval:[]},d=0;d<c;d++){l.readUint(r,s);var h=l.readUshort(r,s+=4);l.readUshort(r,s+=2);var f=h>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;s=e.kern.readFormat0(r,s+=2,u)}return u},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);a.readUshort(r,s+=2),a.readUshort(r,s+=2),a.readUshort(r,s+=2),s+=2;for(var u=0;u<c;u++){var d=a.readUshort(r,s),h=a.readUshort(r,s+=2),f=a.readShort(r,s+=2);s+=2,d!=l&&(o.glyph1.push(d),o.rval.push({glyph2:[],vals:[]}));var p=o.rval[o.rval.length-1];p.glyph2.push(h),p.vals.push(f),l=d}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],u=a.head.indexToLocFormat,d=a.maxp.numGlyphs+1;if(0==u)for(var h=0;h<d;h++)c.push(l.readUshort(r,s+(h<<1))<<1);if(1==u)for(h=0;h<d;h++)c.push(l.readUint(r,s+(h<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return l.numGlyphs=a.readUshort(r,s+=4),s+=2,65536==c&&(l.maxPoints=a.readUshort(r,s),l.maxContours=a.readUshort(r,s+=2),l.maxCompositePoints=a.readUshort(r,s+=2),l.maxCompositeContours=a.readUshort(r,s+=2),l.maxZones=a.readUshort(r,s+=2),l.maxTwilightPoints=a.readUshort(r,s+=2),l.maxStorage=a.readUshort(r,s+=2),l.maxFunctionDefs=a.readUshort(r,s+=2),l.maxInstructionDefs=a.readUshort(r,s+=2),l.maxStackElements=a.readUshort(r,s+=2),l.maxSizeOfInstructions=a.readUshort(r,s+=2),l.maxComponentElements=a.readUshort(r,s+=2),l.maxComponentDepth=a.readUshort(r,s+=2),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s);var c=a.readUshort(r,s+=2);a.readUshort(r,s+=2);for(var u,d=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=s+=2,f=0;f<c;f++){var p=a.readUshort(r,s),_=a.readUshort(r,s+=2),m=a.readUshort(r,s+=2),g=a.readUshort(r,s+=2),v=a.readUshort(r,s+=2),y=a.readUshort(r,s+=2);s+=2;var b,x=d[g],M=h+12*c+y;if(0==p)b=a.readUnicode(r,M,v/2);else if(3==p&&0==_)b=a.readUnicode(r,M,v/2);else if(0==_)b=a.readASCII(r,M,v);else if(1==_)b=a.readUnicode(r,M,v/2);else if(3==_)b=a.readUnicode(r,M,v/2);else{if(1!=p)throw"unknown encoding "+_+", platformID: "+p;b=a.readASCII(r,M,v),console.debug("reading unknown MAC encoding "+_+" as ASCII")}var w="p"+p+","+m.toString(16);null==l[w]&&(l[w]={}),l[w][void 0!==x?x:g]=b,l[w]._lang=m}for(var S in l)if(null!=l[S].postScriptName&&1033==l[S]._lang)return l[S];for(var S in l)if(null!=l[S].postScriptName&&0==l[S]._lang)return l[S];for(var S in l)if(null!=l[S].postScriptName&&3084==l[S]._lang)return l[S];for(var S in l)if(null!=l[S].postScriptName)return l[S];for(var S in l){u=S;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(0==a)e["OS/2"].version0(r,s,l);else if(1==a)e["OS/2"].version1(r,s,l);else if(2==a||3==a||4==a)e["OS/2"].version2(r,s,l);else{if(5!=a)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),o.usWeightClass=a.readUshort(r,s+=2),o.usWidthClass=a.readUshort(r,s+=2),o.fsType=a.readUshort(r,s+=2),o.ySubscriptXSize=a.readShort(r,s+=2),o.ySubscriptYSize=a.readShort(r,s+=2),o.ySubscriptXOffset=a.readShort(r,s+=2),o.ySubscriptYOffset=a.readShort(r,s+=2),o.ySuperscriptXSize=a.readShort(r,s+=2),o.ySuperscriptYSize=a.readShort(r,s+=2),o.ySuperscriptXOffset=a.readShort(r,s+=2),o.ySuperscriptYOffset=a.readShort(r,s+=2),o.yStrikeoutSize=a.readShort(r,s+=2),o.yStrikeoutPosition=a.readShort(r,s+=2),o.sFamilyClass=a.readShort(r,s+=2),o.panose=a.readBytes(r,s+=2,10),o.ulUnicodeRange1=a.readUint(r,s+=10),o.ulUnicodeRange2=a.readUint(r,s+=4),o.ulUnicodeRange3=a.readUint(r,s+=4),o.ulUnicodeRange4=a.readUint(r,s+=4),o.achVendID=[a.readInt8(r,s+=4),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],o.fsSelection=a.readUshort(r,s+=4),o.usFirstCharIndex=a.readUshort(r,s+=2),o.usLastCharIndex=a.readUshort(r,s+=2),o.sTypoAscender=a.readShort(r,s+=2),o.sTypoDescender=a.readShort(r,s+=2),o.sTypoLineGap=a.readShort(r,s+=2),o.usWinAscent=a.readUshort(r,s+=2),o.usWinDescent=a.readUshort(r,s+=2),s+2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),o.ulCodePageRange2=a.readUint(r,s+=4),s+4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),o.sCapHeight=a.readShort(r,s+=2),o.usDefault=a.readUshort(r,s+=2),o.usBreak=a.readUshort(r,s+=2),o.usMaxContext=a.readUshort(r,s+=2),s+2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),o.usUpperOpticalPointSize=a.readUshort(r,s+=2),s+2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),l.italicAngle=a.readFixed(r,s+=4),l.underlinePosition=a.readShort(r,s+=4),l.underlineThickness=a.readShort(r,s+=2),s+=2,l},null==e&&(e={}),null==e.U&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(null!=o.p0e4?a=o.p0e4:null!=o.p3e1?a=o.p3e1:null!=o.p1e0?a=o.p1e0:null!=o.p0e3&&(a=o.p0e3),-1==a)throw"no familiar platform and encoding!";var l=o.tables[a];if(0==l.format)return s>=l.map.length?0:l.map[s];if(4==l.format){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return-1==c||l.startCount[c]>s?0:65535&(0!=l.idRangeOffset[c]?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(12==l.format){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var d=l.groups[u];if(d[0]<=s&&s<=d[1])return d[2]+(s-d[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return null==a?o:("string"==typeof a&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,u=r.CFF.Private;if(c.ROS){for(var d=0;c.FDSelect[d+2]<=s;)d+=2;u=c.FDArray[c.FDSelect[d+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,u,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];null==a&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),null!=a&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=0==o?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var u=c==a?l:c-1,d=c==l?a:c+1,h=1&r.flags[c],f=1&r.flags[u],p=1&r.flags[d],_=r.xs[c],m=r.ys[c];if(c==a)if(h){if(!f){e.U.P.moveTo(s,_,m);continue}e.U.P.moveTo(s,r.xs[u],r.ys[u])}else f?e.U.P.moveTo(s,r.xs[u],r.ys[u]):e.U.P.moveTo(s,(r.xs[u]+_)/2,(r.ys[u]+m)/2);h?f&&e.U.P.lineTo(s,_,m):p?e.U.P.qcurveTo(s,_,m,r.xs[d],r.ys[d]):e.U.P.qcurveTo(s,_,m,(_+r.xs[d])/2,(m+r.ys[d])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,d=0;d<l.crds.length;d+=2){var h=l.crds[d],f=l.crds[d+1];o.crds.push(h*u.a+f*u.b+u.tx),o.crds.push(h*u.c+f*u.d+u.ty)}for(d=0;d<l.cmds.length;d++)o.cmds.push(l.cmds[d])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return-1==o?0:s[o+2]},e.U.getPairAdjustment=function(r,s,o){var a=!1;if(r.GPOS)for(var l=r.GPOS,c=l.lookupList,u=l.featureList,d=[],h=0;h<u.length;h++){var f=u[h];if("kern"==f.tag){a=!0;for(var p=0;p<f.tab.length;p++)if(!d[f.tab[p]]){d[f.tab[p]]=!0;for(var _=c[f.tab[p]],m=0;m<_.tabs.length;m++)if(null!=_.tabs[m]){var g,v=_.tabs[m];if((!v.coverage||-1!=(g=e._lctf.coverageIndex(v.coverage,s)))&&1!=_.ltype&&2==_.ltype){var y=null;if(1==v.fmt){var b=v.pairsets[g];for(h=0;h<b.length;h++)b[h].gid2==o&&(y=b[h])}else if(2==v.fmt){var x=e.U._getGlyphClass(s,v.classDef1),M=e.U._getGlyphClass(o,v.classDef2);y=v.matrix[x][M]}if(y){var w=0;return y.val1&&y.val1[2]&&(w+=y.val1[2]),y.val2&&y.val2[0]&&(w+=y.val2[0]),w}}}}}}if(r.kern&&!a){var S=r.kern.glyph1.indexOf(s);if(-1!=S){var E=r.kern.rval[S].glyph2.indexOf(o);if(-1!=E)return r.kern.rval[S].vals[E]}}return 0},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(null!=o.tabs[c]){var u,d=o.tabs[c];if(!d.coverage||-1!=(u=e._lctf.coverageIndex(d.coverage,r[s])))if(1==o.ltype)r[s]=1==d.fmt?r[s]+d.delta:d.newg[u];else if(4==o.ltype)for(var h=d.vals[u],f=0;f<h.length;f++){var p=h[f],_=p.chain.length;if(!(_>l)){for(var m=!0,g=0,v=0;v<_;v++){for(;-1==r[s+g+(1+v)];)g++;p.chain[v]!=r[s+g+(1+v)]&&(m=!1)}if(m){for(r[s]=p.nglyph,v=0;v<_+g;v++)r[s+v+1]=-1;break}}}else if(5==o.ltype&&2==d.fmt)for(var y=e._lctf.getInterval(d.cDef,r[s]),x=d.scset[d.cDef[y+2]],M=0;M<x.length;M++){var w=x[M],S=w.input;if(!(S.length>l)){for(m=!0,v=0;v<S.length;v++){var E=e._lctf.getInterval(d.cDef,r[s+1+v]);if(-1==y&&d.cDef[E+2]!=S[v]){m=!1;break}}if(m){var C=w.substLookupRecords;for(f=0;f<C.length;f+=2);}}}else if(6==o.ltype&&3==d.fmt){if(!e.U._glsCovered(r,d.backCvg,s-d.backCvg.length)||!e.U._glsCovered(r,d.inptCvg,s)||!e.U._glsCovered(r,d.ahedCvg,s+d.inptCvg.length))continue;var W=d.lookupRec;for(M=0;M<W.length;M+=2)e.U._applySubs(r,s+(y=W[M]),a[W[M+1]],a)}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(-1==e._lctf.coverageIndex(s[a],r[o+a]))return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(-1!=u){for(var d=c<s.length-1&&-1!=s[c+1]?s[c+1]:0,h=e.U.glyphToPath(r,u),f=0;f<h.crds.length;f+=2)a.crds.push(h.crds[f]+l),a.crds.push(h.crds[f+1]);for(o&&a.cmds.push(o),f=0;f<h.cmds.length;f++)a.cmds.push(h.cmds[f]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(r,u,d))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,u){r.cmds.push("C"),r.crds.push(s,o,a,l,c,u)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,u=s.nStems,d=s.haveWidth,h=s.width,f=s.open,p=0,_=s.x,m=s.y,g=0,v=0,y=0,b=0,x=0,M=0,w=0,S=0,E=0,C=0,W={val:0,size:0};p<r.length;){e.CFF.getCharString(r,p,W);var N=W.val;if(p+=W.size,"o1"==N||"o18"==N)c.length%2!=0&&!d&&(h=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,d=!0;else if("o3"==N||"o23"==N)c.length%2!=0&&!d&&(h=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,d=!0;else if("o4"==N)c.length>1&&!d&&(h=c.shift()+a.nominalWidthX,d=!0),f&&e.U.P.closePath(l),m+=c.pop(),e.U.P.moveTo(l,_,m),f=!0;else if("o5"==N)for(;c.length>0;)_+=c.shift(),m+=c.shift(),e.U.P.lineTo(l,_,m);else if("o6"==N||"o7"==N)for(var L=c.length,O="o6"==N,z=0;z<L;z++){var U=c.shift();O?_+=U:m+=U,O=!O,e.U.P.lineTo(l,_,m)}else if("o8"==N||"o24"==N){L=c.length;for(var G=0;G+6<=L;)g=_+c.shift(),v=m+c.shift(),y=g+c.shift(),b=v+c.shift(),_=y+c.shift(),m=b+c.shift(),e.U.P.curveTo(l,g,v,y,b,_,m),G+=6;"o24"==N&&(_+=c.shift(),m+=c.shift(),e.U.P.lineTo(l,_,m))}else{if("o11"==N)break;if("o1234"==N||"o1235"==N||"o1236"==N||"o1237"==N)"o1234"==N&&(v=m,y=(g=_+c.shift())+c.shift(),C=b=v+c.shift(),M=b,S=m,_=(w=(x=(E=y+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,g,v,y,b,E,C),e.U.P.curveTo(l,x,M,w,S,_,m)),"o1235"==N&&(g=_+c.shift(),v=m+c.shift(),y=g+c.shift(),b=v+c.shift(),E=y+c.shift(),C=b+c.shift(),x=E+c.shift(),M=C+c.shift(),w=x+c.shift(),S=M+c.shift(),_=w+c.shift(),m=S+c.shift(),c.shift(),e.U.P.curveTo(l,g,v,y,b,E,C),e.U.P.curveTo(l,x,M,w,S,_,m)),"o1236"==N&&(g=_+c.shift(),v=m+c.shift(),y=g+c.shift(),C=b=v+c.shift(),M=b,w=(x=(E=y+c.shift())+c.shift())+c.shift(),S=M+c.shift(),_=w+c.shift(),e.U.P.curveTo(l,g,v,y,b,E,C),e.U.P.curveTo(l,x,M,w,S,_,m)),"o1237"==N&&(g=_+c.shift(),v=m+c.shift(),y=g+c.shift(),b=v+c.shift(),E=y+c.shift(),C=b+c.shift(),x=E+c.shift(),M=C+c.shift(),w=x+c.shift(),S=M+c.shift(),Math.abs(w-_)>Math.abs(S-m)?_=w+c.shift():m=S+c.shift(),e.U.P.curveTo(l,g,v,y,b,E,C),e.U.P.curveTo(l,x,M,w,S,_,m));else if("o14"==N){if(c.length>0&&!d&&(h=c.shift()+o.nominalWidthX,d=!0),4==c.length){var $=c.shift(),V=c.shift(),q=c.shift(),B=c.shift(),k=e.CFF.glyphBySE(o,q),X=e.CFF.glyphBySE(o,B);e.U._drawCFF(o.CharStrings[k],s,o,a,l),s.x=$,s.y=V,e.U._drawCFF(o.CharStrings[X],s,o,a,l)}f&&(e.U.P.closePath(l),f=!1)}else if("o19"==N||"o20"==N)c.length%2!=0&&!d&&(h=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,d=!0,p+=u+7>>3;else if("o21"==N)c.length>2&&!d&&(h=c.shift()+a.nominalWidthX,d=!0),m+=c.pop(),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,m),f=!0;else if("o22"==N)c.length>1&&!d&&(h=c.shift()+a.nominalWidthX,d=!0),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,m),f=!0;else if("o25"==N){for(;c.length>6;)_+=c.shift(),m+=c.shift(),e.U.P.lineTo(l,_,m);g=_+c.shift(),v=m+c.shift(),y=g+c.shift(),b=v+c.shift(),_=y+c.shift(),m=b+c.shift(),e.U.P.curveTo(l,g,v,y,b,_,m)}else if("o26"==N)for(c.length%2&&(_+=c.shift());c.length>0;)g=_,v=m+c.shift(),_=y=g+c.shift(),m=(b=v+c.shift())+c.shift(),e.U.P.curveTo(l,g,v,y,b,_,m);else if("o27"==N)for(c.length%2&&(m+=c.shift());c.length>0;)v=m,y=(g=_+c.shift())+c.shift(),b=v+c.shift(),_=y+c.shift(),e.U.P.curveTo(l,g,v,y,b,_,m=b);else if("o10"==N||"o29"==N){var j="o10"==N?a:o;if(0==c.length)console.debug("error: empty stack");else{var Q=c.pop(),te=j.Subrs[Q+j.Bias];s.x=_,s.y=m,s.nStems=u,s.haveWidth=d,s.width=h,s.open=f,e.U._drawCFF(te,s,o,a,l),_=s.x,m=s.y,u=s.nStems,d=s.haveWidth,h=s.width,f=s.open}}else if("o30"==N||"o31"==N){var K=c.length,ae=(G=0,"o31"==N);for(G+=K-(L=-3&K);G<L;)ae?(v=m,y=(g=_+c.shift())+c.shift(),m=(b=v+c.shift())+c.shift(),L-G==5?(_=y+c.shift(),G++):_=y,ae=!1):(g=_,v=m+c.shift(),y=g+c.shift(),b=v+c.shift(),_=y+c.shift(),L-G==5?(m=b+c.shift(),G++):m=b,ae=!0),e.U.P.curveTo(l,g,v,y,b,_,m),G+=4}else{if("o"==(N+"").charAt(0))throw console.debug("Unknown operation: "+N,r),N;c.push(N)}}}s.x=_,s.y=m,s.nStems=u,s.haveWidth=d,s.width=h,s.open=f};var i={Typr:e};return n.Typr=e,n.default=i,Object.defineProperty(n,"__esModule",{value:!0}),n}({}).Typr},function JZ(){return function(n){var e=Uint8Array,t=Uint16Array,i=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(N,L){for(var O=new t(31),z=0;z<31;++z)O[z]=L+=1<<N[z-1];var U=new i(O[30]);for(z=1;z<30;++z)for(var G=O[z];G<O[z+1];++G)U[G]=G-O[z]<<5|z;return[O,U]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var d=a(s,0)[0],h=new t(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,h[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var _=function(N,L,O){for(var z=N.length,U=0,G=new t(L);U<z;++U)++G[N[U]-1];var $,V=new t(L);for(U=0;U<L;++U)V[U]=V[U-1]+G[U-1]<<1;if(O){$=new t(1<<L);var q=15-L;for(U=0;U<z;++U)if(N[U])for(var B=U<<4|N[U],k=L-N[U],X=V[N[U]-1]++<<k,j=X|(1<<k)-1;X<=j;++X)$[h[X]>>>q]=B}else for($=new t(z),U=0;U<z;++U)N[U]&&($[U]=h[V[N[U]-1]++]>>>15-N[U]);return $},m=new e(288);for(f=0;f<144;++f)m[f]=8;for(f=144;f<256;++f)m[f]=9;for(f=256;f<280;++f)m[f]=7;for(f=280;f<288;++f)m[f]=8;var g=new e(32);for(f=0;f<32;++f)g[f]=5;var v=_(m,9,1),y=_(g,5,1),b=function(N){for(var L=N[0],O=1;O<N.length;++O)N[O]>L&&(L=N[O]);return L},x=function(N,L,O){var z=L/8|0;return(N[z]|N[z+1]<<8)>>(7&L)&O},M=function(N,L){var O=L/8|0;return(N[O]|N[O+1]<<8|N[O+2]<<16)>>(7&L)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(N,L,O){var z=new Error(L||w[N]);if(z.code=N,Error.captureStackTrace&&Error.captureStackTrace(z,S),!O)throw z;return z},C=new e(0),W=typeof TextDecoder<"u"&&new TextDecoder;try{W.decode(C,{stream:!0})}catch{}return n.convert_streams=function(N){var L=new DataView(N),O=0;function z(){var he=L.getUint16(O);return O+=2,he}function U(){var he=L.getUint32(O);return O+=4,he}function G(he){ue.setUint16(Ce,he),Ce+=2}function $(he){ue.setUint32(Ce,he),Ce+=4}for(var V={signature:U(),flavor:U(),length:U(),numTables:z(),reserved:z(),totalSfntSize:U(),majorVersion:z(),minorVersion:z(),metaOffset:U(),metaLength:U(),metaOrigLength:U(),privOffset:U(),privLength:U()},q=0;Math.pow(2,q)<=V.numTables;)q++;q--;for(var B=16*Math.pow(2,q),k=16*V.numTables-B,X=12,j=[],Q=0;Q<V.numTables;Q++)j.push({tag:U(),offset:U(),compLength:U(),origLength:U(),origChecksum:U()}),X+=16;var te,K=new Uint8Array(12+16*j.length+j.reduce(function(he,D){return he+D.origLength+4},0)),ae=K.buffer,ue=new DataView(ae),Ce=0;return $(V.flavor),G(V.numTables),G(B),G(q),G(k),j.forEach(function(he){$(he.tag),$(he.origChecksum),$(X),$(he.origLength),he.outOffset=X,(X+=he.origLength)%4!=0&&(X+=4-X%4)}),j.forEach(function(he){var ye=N.slice(he.offset,he.offset+he.compLength);if(he.compLength!=he.origLength){var re=new Uint8Array(he.origLength);!function(N,L,O){var z=N.length;if(!z||O&&!O.l&&z<5)return L||new e(0);var U=!L||O,G=!O||O.i;O||(O={}),L||(L=new e(3*z));var $,Ee,Pe,Ue,V=function(Ee){var Pe=L.length;if(Ee>Pe){var Ue=new e(Math.max(2*Pe,Ee));Ue.set(L),L=Ue}},q=O.f||0,B=O.p||0,k=O.b||0,X=O.l,j=O.d,Q=O.m,te=O.n,K=8*z;do{if(!X){O.f=q=x(N,B,1);var ae=x(N,B+1,3);if(B+=3,!ae){var ue=N[(Me=(($=B)/8|0)+(7&$&&1)+4)-4]|N[Me-3]<<8,Ce=Me+ue;if(Ce>z){G&&S(0);break}U&&V(k+ue),L.set(N.subarray(Me,Ce),k),O.b=k+=ue,O.p=B=8*Ce;continue}if(1==ae)X=v,j=y,Q=9,te=5;else if(2==ae){var he=x(N,B,31)+257,D=x(N,B+10,15)+4,ye=he+x(N,B+5,31)+1;B+=14;for(var re=new e(ye),ie=new e(19),J=0;J<D;++J)ie[o[J]]=x(N,B+3*J,7);B+=3*D;var Ae=b(ie),se=(1<<Ae)-1,be=_(ie,Ae,1);for(J=0;J<ye;){var Me,de=be[x(N,B,se)];if(B+=15&de,(Me=de>>>4)<16)re[J++]=Me;else{var Ve=0,I=0;for(16==Me?(I=3+x(N,B,3),B+=2,Ve=re[J-1]):17==Me?(I=3+x(N,B,7),B+=3):18==Me&&(I=11+x(N,B,127),B+=7);I--;)re[J++]=Ve}}var T=re.subarray(0,he),Y=re.subarray(he);Q=b(T),te=b(Y),X=_(T,Q,1),j=_(Y,te,1)}else S(1);if(B>K){G&&S(0);break}}U&&V(k+131072);for(var xe=(1<<Q)-1,_e=(1<<te)-1,P=B;;P=B){var ce=(Ve=X[M(N,B)&xe])>>>4;if((B+=15&Ve)>K){G&&S(0);break}if(Ve||S(2),ce<256)L[k++]=ce;else{if(256==ce){P=B,X=null;break}var fe=ce-254;if(ce>264){var ne=r[J=ce-257];fe=x(N,B,(1<<ne)-1)+c[J],B+=ne}var Te=j[M(N,B)&_e],Le=Te>>>4;if(Te||S(3),B+=15&Te,Y=d[Le],Le>3&&(ne=s[Le],Y+=M(N,B)&(1<<ne)-1,B+=ne),B>K){G&&S(0);break}U&&V(k+131072);for(var Re=k+fe;k<Re;k+=4)L[k]=L[k-Y],L[k+1]=L[k+1-Y],L[k+2]=L[k+2-Y],L[k+3]=L[k+3-Y];k=Re}}O.l=X,O.p=P,O.b=k,X&&(q=1,O.m=Q,O.d=j,O.n=te)}while(!q);k==L.length||(Ee=L,(null==(Pe=0)||Pe<0)&&(Pe=0),(null==(Ue=k)||Ue>Ee.length)&&(Ue=Ee.length),new(Ee instanceof t?t:Ee instanceof i?i:e)(Ue-Pe).set(Ee.subarray(Pe,Ue)))}(new Uint8Array(ye,2),re)}else re=new Uint8Array(ye);K.set(re,he.outOffset);var ie=0;(X=he.outOffset+he.origLength)%4!=0&&(ie=4-X%4),K.set(new Uint8Array(ie).buffer,he.outOffset+he.origLength),te=X+ie}),ae.slice(0,te)},Object.defineProperty(n,"__esModule",{value:!0}),n}({}).convert_streams},function eQ(n,e){const t={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let u;function d(x){if(!u){const M={R:s,L:r,D:o,C:l,U:c,T:a};u=new Map;for(let w in i){let S=0;i[w].split(",").forEach(E=>{let[C,W]=E.split("+");C=parseInt(C,36),W=W?parseInt(W,36):0,u.set(S+=C,M[w]);for(let N=W;N--;)u.set(++S,M[w])})}}return u.get(x)||c}const h=1,f=2,p=3,_=4,m=[null,"isol","init","fina","medi"];function g(x){const M=new Uint8Array(x.length);let w=c,S=h,E=-1;for(let C=0;C<x.length;C++){const W=x.codePointAt(C);let N=0|d(W),L=h;N&a||(w&(r|o|l)?N&(s|o|l)?(L=p,(S===h||S===p)&&M[E]++):N&(r|c)&&(S===f||S===_)&&M[E]--:w&(s|c)&&(S===f||S===_)&&M[E]--,S=M[C]=L,w=N,E=C,W>65535&&C++)}return M}function y(...x){for(let M=0;M<x.length;M++)if("number"==typeof x[M])return x[M]}return function(M){const w=new Uint8Array(M,0,4),S=n._bin.readASCII(w,0,4);if("wOFF"===S)M=e(M);else if("wOF2"===S)throw new Error("woff2 fonts not supported");return function b(x){const M=Object.create(null),w=x["OS/2"],S=x.hhea,E=x.head.unitsPerEm,C=y(w&&w.sTypoAscender,S&&S.ascender,E),W={unitsPerEm:E,ascender:C,descender:y(w&&w.sTypoDescender,S&&S.descender,0),capHeight:y(w&&w.sCapHeight,C),xHeight:y(w&&w.sxHeight,C),lineGap:y(w&&w.sTypoLineGap,S&&S.lineGap),forEachGlyph(N,L,O,z){let U=0;const G=1/W.unitsPerEm*L,$=function v(x,M){const w=[];for(let E=0;E<M.length;E++){const C=M.codePointAt(E);C>65535&&E++,w.push(n.U.codeToGlyph(x,C))}const S=x.GSUB;if(S){const{lookupList:E,featureList:C}=S;let W;const N=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,L=[];C.forEach(O=>{if(N.test(O.tag))for(let z=0;z<O.tab.length;z++){if(L[O.tab[z]])continue;L[O.tab[z]]=!0;const U=E[O.tab[z]],G=/^(isol|init|fina|medi)$/.test(O.tag);G&&!W&&(W=g(M));for(let $=0;$<w.length;$++)(!W||!G||m[W[$]]===O.tag)&&n.U._applySubs(w,$,U,E)}})}return w}(x,N);let V=0,q=-1;return $.forEach((B,k)=>{if(-1!==B){let X=M[B];if(!X){const{cmds:j,crds:Q}=n.U.glyphToPath(x,B);let ae,ue,Ce,he,te="",K=0;for(let D=0,ye=j.length;D<ye;D++){const re=t[j[D]];te+=j[D];for(let ie=1;ie<=re;ie++)te+=(ie>1?",":"")+Q[K++]}if(Q.length){ae=ue=1/0,Ce=he=-1/0;for(let D=0,ye=Q.length;D<ye;D+=2){let re=Q[D],ie=Q[D+1];re<ae&&(ae=re),ie<ue&&(ue=ie),re>Ce&&(Ce=re),ie>he&&(he=ie)}}else ae=Ce=ue=he=0;X=M[B]={index:B,advanceWidth:x.hmtx.aWidth[B],xMin:ae,yMin:ue,xMax:Ce,yMax:he,path:te,pathCommandCount:j.length}}-1!==q&&(U+=n.U.getPairAdjustment(x,q,B)*G),z.call(null,X,U,V),X.advanceWidth&&(U+=X.advanceWidth*G),O&&(U+=O*L),q=B}V+=N.codePointAt(V)>65535?2:1}),U}};return W}(n.parse(M)[0])}}],init:(n,e,t)=>t(n(),e())}),Da={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},nQ=new Ne;let RF=!1;function Fc(){return(self.performance||Date).now()}const Om=Object.create(null);function FF({path:n,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:i,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=Da,c=Math.max(t[2]-t[0],t[3]-t[1]),u=Math.floor(e/4);return function WZ(n,e,t,i,r,s,o,a,l,c,u=!0){return u?$Z(n,e,t,i,r,s,o,a,l,c).then(null,d=>(AF||(console.warn("WebGL SDF generation failed, falling back to JS",d),AF=!0),IF(n,e,t,i,r,s,o,a,l,c))):IF(n,e,t,i,r,s,o,a,l,c)}(i,i,n,t,c,l,r,u%(a/i)*i,Math.floor(u/(a/i))*i,e%4,o)}let Nm;function OF(n){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=n,{width:i,height:r}=e,s=n.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==i*r*4)&&(o=new Uint8Array(i*r*4),t.image={width:i,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const sQ=Zd({name:"Typesetter",dependencies:[Zd({name:"Typesetter",dependencies:[Da,tQ,function GZ(n,e,t){const{defaultFontURL:i}=t,r=Object.create(null),s=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",l=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function u(v,y){v||(v=i);let b=r[v];b?b.pending?b.pending.push(y):y(b):(r[v]={pending:[y]},function c(v,y){!function b(){const x=M=>{console.error(`Failure loading font ${v}${v===i?"":"; trying fallback"}`,M),v!==i&&(v=i,b())};try{const M=new XMLHttpRequest;M.open("get",v,!0),M.responseType="arraybuffer",M.onload=function(){if(M.status>=400)x(new Error(M.statusText));else if(M.status>0)try{const w=n(M.response);y(w)}catch(w){x(w)}},M.onerror=x,M.send()}catch(M){x(M)}}()}(v,x=>{let M=r[v].pending;r[v]=x,M.forEach(w=>w(x))}))}function d({text:v="",font:y=i,sdfGlyphSize:b=64,fontSize:x=1,letterSpacing:M=0,lineHeight:w="normal",maxWidth:S=s,direction:E,textAlign:C="left",textIndent:W=0,whiteSpace:N="normal",overflowWrap:L="normal",anchorX:O=0,anchorY:z=0,includeCaretPositions:U=!1,chunkedBoundsSize:G=8192,colorRanges:$=null},V,q=!1){const B=_(),k={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),x=+x,M=+M,S=+S,w=w||"normal",W=+W,u(y,X=>{const j=isFinite(S);let Q=null,te=null,K=null,ae=null,ue=null,Ce=null,he=null,D=0,ye=0,re="nowrap"!==N;const{ascender:ie,descender:J,unitsPerEm:Ae,lineGap:se,capHeight:be,xHeight:Me}=X;k.fontLoad=_()-B;const de=_(),Ve=x/Ae;"normal"===w&&(w=(ie-J+se)/Ae);const I=((w*=x)-(ie-J)*Ve)/2,T=-(ie*Ve+I),Y=Math.min(w,(ie-J)*Ve),xe=(ie+J)/2*Ve-Y/2;let _e=W,P=new m;const ce=[P];X.forEachGlyph(v,x,M,(Te,Le,Re)=>{const Ee=v.charAt(Re),Pe=Te.advanceWidth*Ve,Ue=P.count;let qe;if("isEmpty"in Te||(Te.isWhitespace=!!Ee&&new RegExp(a).test(Ee),Te.canBreakAfter=!!Ee&&l.test(Ee),Te.isEmpty=Te.xMin===Te.xMax||Te.yMin===Te.yMax||o.test(Ee)),!Te.isWhitespace&&!Te.isEmpty&&ye++,re&&j&&!Te.isWhitespace&&Le+Pe+_e>S&&Ue){if(P.glyphAt(Ue-1).glyphObj.canBreakAfter)qe=new m,_e=-Le;else for(let Ie=Ue;Ie--;){if(0===Ie&&"break-word"===L){qe=new m,_e=-Le;break}if(P.glyphAt(Ie).glyphObj.canBreakAfter){qe=P.splitAt(Ie+1);const oe=qe.glyphAt(0).x;_e-=oe;for(let Fe=qe.count;Fe--;)qe.glyphAt(Fe).x-=oe;break}}qe&&(P.isSoftWrapped=!0,P=qe,ce.push(P),D=S)}let H=P.glyphAt(P.count);H.glyphObj=Te,H.x=Le+_e,H.width=Pe,H.charIndex=Re,"\n"===Ee&&(P=new m,ce.push(P),_e=-(Le+Pe+M*x)+W)}),ce.forEach(Te=>{for(let Le=Te.count;Le--;){let{glyphObj:Re,x:Ee,width:Pe}=Te.glyphAt(Le);if(!Re.isWhitespace)return Te.width=Ee+Pe,void(Te.width>D&&(D=Te.width))}});let fe=0,ne=0;if(O&&("number"==typeof O?fe=-O:"string"==typeof O&&(fe=-D*("left"===O?0:"center"===O?.5:"right"===O?1:f(O)))),z)if("number"==typeof z)ne=-z;else if("string"==typeof z){let Te=ce.length*w;ne="top"===z?0:"top-baseline"===z?-T:"top-cap"===z?-T-be*Ve:"top-ex"===z?-T-Me*Ve:"middle"===z?Te/2:"bottom"===z?Te:"bottom-baseline"===z?Te-I+J*Ve:f(z)*Te}if(!q){const Te=e.getEmbeddingLevels(v,E);Q=new Uint16Array(ye),te=new Float32Array(2*ye),K={},Ce=[s,s,-s,-s],he=[];let Le=T;U&&(ue=new Float32Array(3*v.length)),$&&(ae=new Uint8Array(3*ye));let Ue,qe,Re=0,Ee=-1,Pe=-1;if(ce.forEach((H,Ie)=>{let{count:oe,width:Fe}=H;if(oe>0){let Oe=0;for(let Dt=oe;Dt--&&H.glyphAt(Dt).glyphObj.isWhitespace;)Oe++;let ft=0,Tt=0;if("center"===C)ft=(D-Fe)/2;else if("right"===C)ft=D-Fe;else if("justify"===C&&H.isSoftWrapped){let Dt=0;for(let Et=oe-Oe;Et--;)H.glyphAt(Et).glyphObj.isWhitespace&&Dt++;Tt=(D-Fe)/Dt}if(Tt||ft){let Dt=0;for(let Et=0;Et<oe;Et++){let Di=H.glyphAt(Et);const ai=Di.glyphObj;Di.x+=ft+Dt,0!==Tt&&ai.isWhitespace&&Et<oe-Oe&&(Dt+=Tt,Di.width+=Tt)}}const Ct=e.getReorderSegments(v,Te,H.glyphAt(0).charIndex,H.glyphAt(H.count-1).charIndex);for(let Dt=0;Dt<Ct.length;Dt++){const[Et,Di]=Ct[Dt];let ai=1/0,kt=-1/0;for(let dn=0;dn<oe;dn++)if(H.glyphAt(dn).charIndex>=Et){let vi=dn,bn=dn;for(;bn<oe;bn++){let xn=H.glyphAt(bn);if(xn.charIndex>Di)break;bn<oe-Oe&&(ai=Math.min(ai,xn.x),kt=Math.max(kt,xn.x+xn.width))}for(let xn=vi;xn<bn;xn++){const qn=H.glyphAt(xn);qn.x=kt-(qn.x+qn.width-ai)}break}}let Ot;const Ut=Dt=>Ot=Dt;for(let Dt=0;Dt<oe;Dt++){let Et=H.glyphAt(Dt);Ot=Et.glyphObj;const Di=Ot.index,ai=1&Te.levels[Et.charIndex];if(ai){const kt=e.getMirroredCharacter(v[Et.charIndex]);kt&&X.forEachGlyph(kt,0,0,Ut)}if(U){const{charIndex:kt}=Et,dn=Et.x+fe,vi=Et.x+Et.width+fe;ue[3*kt]=ai?vi:dn,ue[3*kt+1]=ai?dn:vi,ue[3*kt+2]=Le+xe+ne;const bn=kt-Ee;bn>1&&p(ue,Ee,bn),Ee=kt}if($){const{charIndex:kt}=Et;for(;kt>Pe;)Pe++,$.hasOwnProperty(Pe)&&(qe=$[Pe])}if(!Ot.isWhitespace&&!Ot.isEmpty){const kt=Re++;K[Di]||(K[Di]={path:Ot.path,pathBounds:[Ot.xMin,Ot.yMin,Ot.xMax,Ot.yMax]});const dn=Et.x+fe,vi=Le+ne;te[2*kt]=dn,te[2*kt+1]=vi;const bn=dn+Ot.xMin*Ve,xn=vi+Ot.yMin*Ve,qn=dn+Ot.xMax*Ve,hs=vi+Ot.yMax*Ve;bn<Ce[0]&&(Ce[0]=bn),xn<Ce[1]&&(Ce[1]=xn),qn>Ce[2]&&(Ce[2]=qn),hs>Ce[3]&&(Ce[3]=hs),kt%G==0&&(Ue={start:kt,end:kt,rect:[s,s,-s,-s]},he.push(Ue)),Ue.end++;const Zi=Ue.rect;if(bn<Zi[0]&&(Zi[0]=bn),xn<Zi[1]&&(Zi[1]=xn),qn>Zi[2]&&(Zi[2]=qn),hs>Zi[3]&&(Zi[3]=hs),Q[kt]=Di,$){const F=3*kt;ae[F]=qe>>16&255,ae[F+1]=qe>>8&255,ae[F+2]=255&qe}}}}Le-=w}),ue){const H=v.length-Ee;H>1&&p(ue,Ee,H)}}k.typesetting=_()-de,V({glyphIds:Q,glyphPositions:te,glyphData:K,caretPositions:ue,caretHeight:Y,glyphColors:ae,chunkedBounds:he,fontSize:x,unitsPerEm:Ae,ascender:ie*Ve,descender:J*Ve,capHeight:be*Ve,xHeight:Me*Ve,lineHeight:w,topBaseline:T,blockBounds:[fe,ne-ce.length*w,fe+D,ne],visibleBounds:Ce,timings:k})})}function f(v){let y=v.match(/^([\d.]+)%$/),b=y?parseFloat(y[1]):NaN;return isNaN(b)?0:b/100}function p(v,y,b){const x=v[3*y],w=v[3*y+2],S=(v[3*y+1]-x)/b;for(let E=0;E<b;E++){const C=3*(y+E);v[C]=x+S*E,v[C+1]=x+S*(E+1),v[C+2]=w}}function _(){return(self.performance||Date).now()}function m(){this.data=[]}const g=["glyphObj","x","width","charIndex"];return m.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/g.length)},glyphAt(v){let y=m.flyweight;return y.data=this.data,y.index=v,y},splitAt(v){let y=new m;return y.data=this.data.splice(v*g.length),y}},m.flyweight=g.reduce((v,y,b,x)=>(Object.defineProperty(v,y,{get(){return this.data[this.index*g.length+b]},set(M){this.data[this.index*g.length+b]=M}}),v),{data:null,index:0}),{typeset:d,measure:function h(v,y){d(v,b=>{const[x,M,w,S]=b.blockBounds;y({width:w-x,height:S-M})},{metricsOnly:!0})},loadFont:u}},function CZ(){return function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},i={},r={};i.L=1,r[1]="L",Object.keys(t).forEach(function(se,be){i[se]=1<<be+1,r[i[se]]=se}),Object.freeze(i);var s=i.LRI|i.RLI|i.FSI,o=i.L|i.R|i.AL,a=i.B|i.S|i.WS|i.ON|i.FSI|i.LRI|i.RLI|i.PDI,l=i.BN|i.RLE|i.LRE|i.RLO|i.LRO|i.PDF,c=i.S|i.WS|i.B|s|i.PDI|l,u=null;function h(se){return function d(){if(!u){u=new Map;var se=function(Me){if(t.hasOwnProperty(Me)){var de=0;t[Me].split(",").forEach(function(Ve){var I=Ve.split("+"),T=I[0],Y=I[1];T=parseInt(T,36),Y=Y?parseInt(Y,36):0,u.set(de+=T,i[Me]);for(var xe=0;xe<Y;xe++)u.set(++de,i[Me])})}};for(var be in t)se(be)}}(),u.get(se.codePointAt(0))||i.L}var m,g,v,p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function _(se,be){var T,de=0,Ve=new Map,I=be&&new Map;return se.split(",").forEach(function Y(xe){if(-1!==xe.indexOf("+"))for(var _e=+xe;_e--;)Y(T);else{T=xe;var P=xe.split(">"),ce=P[0],fe=P[1];ce=String.fromCodePoint(de+=parseInt(ce,36)),fe=String.fromCodePoint(de+=parseInt(fe,36)),Ve.set(ce,fe),be&&I.set(fe,ce)}}),{map:Ve,reverseMap:I}}function y(){if(!m){var se=_(p.pairs,!0);m=se.map,g=se.reverseMap,v=_(p.canonical,!1).map}}function b(se){return y(),m.get(se)||null}function x(se){return y(),g.get(se)||null}function M(se){return y(),v.get(se)||null}var he,w=i.L,S=i.R,E=i.EN,C=i.ES,W=i.ET,N=i.AN,L=i.CS,O=i.B,z=i.S,U=i.ON,G=i.BN,$=i.NSM,V=i.AL,q=i.LRO,B=i.RLO,k=i.LRE,X=i.RLE,j=i.PDF,Q=i.LRI,te=i.RLI,K=i.FSI,ae=i.PDI,Ce="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1";function ye(se){return function D(){if(!he){var se=_(Ce,!0),be=se.map;se.reverseMap.forEach(function(de,Ve){be.set(Ve,de)}),he=be}}(),he.get(se)||null}function ie(se,be,Me,de){var Ve=se.length;Me=Math.max(0,null==Me?0:+Me),de=Math.min(Ve-1,null==de?Ve-1:+de);var I=[];return be.paragraphs.forEach(function(T){var Y=Math.max(Me,T.start),xe=Math.min(de,T.end);if(Y<xe){for(var _e=be.levels.slice(Y,xe+1),P=xe;P>=Y&&h(se[P])&c;P--)_e[P]=T.level;for(var ce=T.level,fe=1/0,ne=0;ne<_e.length;ne++){var Te=_e[ne];Te>ce&&(ce=Te),Te<fe&&(fe=1|Te)}for(var Le=ce;Le>=fe;Le--)for(var Re=0;Re<_e.length;Re++)if(_e[Re]>=Le){for(var Ee=Re;Re+1<_e.length&&_e[Re+1]>=Le;)Re++;Re>Ee&&I.push([Ee+Me,Re+Me])}}}),I}function Ae(se,be,Me,de){for(var Ve=ie(se,be,Me,de),I=[],T=0;T<se.length;T++)I[T]=T;return Ve.forEach(function(Y){for(var _e=Y[1],P=I.slice(Y[0],_e+1),ce=P.length;ce--;)I[_e-ce]=P[ce]}),I}return e.closingToOpeningBracket=x,e.getBidiCharType=h,e.getBidiCharTypeName=function f(se){return r[h(se)]},e.getCanonicalBracket=M,e.getEmbeddingLevels=function ue(se,be){for(var de=new Uint32Array(se.length),Ve=0;Ve<se.length;Ve++)de[Ve]=h(se[Ve]);var I=new Map;function T(li,Ur){var Pi=de[li];de[li]=Ur,I.set(Pi,I.get(Pi)-1),Pi&a&&I.set(a,I.get(a)-1),I.set(Ur,(I.get(Ur)||0)+1),Ur&a&&I.set(a,(I.get(a)||0)+1)}for(var Y=new Uint8Array(se.length),xe=new Map,_e=[],P=null,ce=0;ce<se.length;ce++)P||_e.push(P={start:ce,end:se.length-1,level:"rtl"===be?1:"ltr"===be?0:vO(ce,!1)}),de[ce]&O&&(P.end=ce,P=null);for(var fe=X|k|B|q|s|ae|j|O,ne=function(li){return li+(1&li?1:2)},Te=function(li){return li+(1&li?2:1)},Le=0;Le<_e.length;Le++){var Re=[{_level:(P=_e[Le]).level,_override:0,_isolate:0}],Ee=void 0,Pe=0,Ue=0,qe=0;I.clear();for(var H=P.start;H<=P.end;H++){var Ie=de[H];if(Ee=Re[Re.length-1],I.set(Ie,(I.get(Ie)||0)+1),Ie&a&&I.set(a,(I.get(a)||0)+1),Ie&fe)if(Ie&(X|k)){Y[H]=Ee._level;var oe=(Ie===X?Te:ne)(Ee._level);oe<=125&&!Pe&&!Ue?Re.push({_level:oe,_override:0,_isolate:0}):Pe||Ue++}else if(Ie&(B|q)){Y[H]=Ee._level;var Fe=(Ie===B?Te:ne)(Ee._level);Fe<=125&&!Pe&&!Ue?Re.push({_level:Fe,_override:Ie&B?S:w,_isolate:0}):Pe||Ue++}else if(Ie&s){Ie&K&&(Ie=1===vO(H+1,!0)?te:Q),Y[H]=Ee._level,Ee._override&&T(H,Ee._override);var Oe=(Ie===te?Te:ne)(Ee._level);Oe<=125&&0===Pe&&0===Ue?(qe++,Re.push({_level:Oe,_override:0,_isolate:1,_isolInitIndex:H})):Pe++}else if(Ie&ae){if(Pe>0)Pe--;else if(qe>0){for(Ue=0;!Re[Re.length-1]._isolate;)Re.pop();var ft=Re[Re.length-1]._isolInitIndex;null!=ft&&(xe.set(ft,H),xe.set(H,ft)),Re.pop(),qe--}Y[H]=(Ee=Re[Re.length-1])._level,Ee._override&&T(H,Ee._override)}else Ie&j?(0===Pe&&(Ue>0?Ue--:!Ee._isolate&&Re.length>1&&(Re.pop(),Ee=Re[Re.length-1])),Y[H]=Ee._level):Ie&O&&(Y[H]=P.level);else Y[H]=Ee._level,Ee._override&&Ie!==G&&T(H,Ee._override)}for(var Tt=[],Ct=null,Ot=P.start;Ot<=P.end;Ot++){var Ut=de[Ot];if(!(Ut&l)){var Dt=Y[Ot],Et=Ut&s,Di=Ut===ae;Ct&&Dt===Ct._level?(Ct._end=Ot,Ct._endsWithIsolInit=Et):Tt.push(Ct={_start:Ot,_end:Ot,_level:Dt,_startsWithPDI:Di,_endsWithIsolInit:Et})}}for(var ai=[],kt=0;kt<Tt.length;kt++){var dn=Tt[kt];if(!dn._startsWithPDI||dn._startsWithPDI&&!xe.has(dn._start)){for(var vi=[Ct=dn],bn=void 0;Ct&&Ct._endsWithIsolInit&&null!=(bn=xe.get(Ct._end));)for(var xn=kt+1;xn<Tt.length;xn++)if(Tt[xn]._start===bn){vi.push(Ct=Tt[xn]);break}for(var qn=[],hs=0;hs<vi.length;hs++)for(var Zi=vi[hs],F=Zi._start;F<=Zi._end;F++)qn.push(F);for(var le=Y[qn[0]],pe=P.level,ee=qn[0]-1;ee>=0;ee--)if(!(de[ee]&l)){pe=Y[ee];break}var ge=qn[qn.length-1],We=Y[ge],Xe=P.level;if(!(de[ge]&s))for(var Je=ge+1;Je<=P.end;Je++)if(!(de[Je]&l)){Xe=Y[Je];break}ai.push({_seqIndices:qn,_sosType:Math.max(pe,le)%2?S:w,_eosType:Math.max(Xe,We)%2?S:w})}}for(var nt=0;nt<ai.length;nt++){var pt=ai[nt],De=pt._seqIndices,st=pt._sosType,Vt=pt._eosType;if(I.get($))for(var qt=0;qt<De.length;qt++){var Ii=De[qt];if(de[Ii]&$){for(var Qi=st,Kt=qt-1;Kt>=0;Kt--)if(!(de[De[Kt]]&l)){Qi=de[De[Kt]];break}T(Ii,Qi&(s|ae)?U:Qi)}}if(I.get(E))for(var xt=0;xt<De.length;xt++){var zc=De[xt];if(de[zc]&E)for(var rn=xt-1;rn>=-1;rn--){var fs=-1===rn?st:de[De[rn]];if(fs&o){fs===V&&T(zc,N);break}}}if(I.get(V))for(var Hc=0;Hc<De.length;Hc++){var Ao=De[Hc];de[Ao]&V&&T(Ao,S)}if(I.get(C)||I.get(L))for(var Ks=1;Ks<De.length-1;Ks++){var Ln=De[Ks];if(de[Ln]&(C|L)){for(var Ri=0,ka=0,Xn=Ks-1;Xn>=0&&(Ri=de[De[Xn]])&l;Xn--);for(var Ua=Ks+1;Ua<De.length&&(ka=de[De[Ua]])&l;Ua++);Ri===ka&&(de[Ln]===C?Ri===E:Ri&(E|N))&&T(Ln,Ri)}}if(I.get(E))for(var Ba=0;Ba<De.length;Ba++)if(de[De[Ba]]&E){for(var _g=Ba-1;_g>=0&&de[De[_g]]&(W|l);_g--)T(De[_g],E);for(var yg=Ba+1;yg<De.length&&de[De[yg]]&(W|l);yg++)T(De[yg],E)}if(I.get(W)||I.get(C)||I.get(L))for(var hh=0;hh<De.length;hh++){var lO=De[hh];if(de[lO]&(W|C|L)){T(lO,U);for(var vg=hh-1;vg>=0&&de[De[vg]]&l;vg--)T(De[vg],U);for(var bg=hh+1;bg<De.length&&de[De[bg]]&l;bg++)T(De[bg],U)}}if(I.get(E))for(var _M=0,cO=st;_M<De.length;_M++){var uO=De[_M],yM=de[uO];yM&E?cO===w&&T(uO,w):yM&o&&(cO=yM)}if(I.get(a)){for(var fh=S|E|N,dO=fh|w,xg=[],Gc=[],Wc=0;Wc<De.length;Wc++)if(de[De[Wc]]&a){var ph=se[De[Wc]],hO=void 0;if(null!==b(ph)){if(!(Gc.length<63))break;Gc.push({char:ph,seqIndex:Wc})}else if(null!==(hO=x(ph)))for(var mh=Gc.length-1;mh>=0;mh--){var vM=Gc[mh].char;if(vM===hO||vM===x(M(ph))||b(M(vM))===ph){xg.push([Gc[mh].seqIndex,Wc]),Gc.length=mh;break}}}xg.sort(function(li,Ur){return li[0]-Ur[0]});for(var bM=0;bM<xg.length;bM++){for(var fO=xg[bM],gh=fO[0],Mg=fO[1],pO=!1,kr=0,xM=gh+1;xM<Mg;xM++){var MM=De[xM];if(de[MM]&dO){pO=!0;var mO=de[MM]&fh?S:w;if(mO===jc(MM)){kr=mO;break}}}if(pO&&!kr){kr=st;for(var EM=gh-1;EM>=0;EM--){var Eg=De[EM];if(de[Eg]&dO){var gO=de[Eg]&fh?S:w;kr=gO!==jc(Eg)?gO:jc(Eg);break}}}if(kr){if(de[De[gh]]=de[De[Mg]]=kr,kr!==jc(De[gh]))for(var _h=gh+1;_h<De.length;_h++)if(!(de[De[_h]]&l)){h(se[De[_h]])&$&&(de[De[_h]]=kr);break}if(kr!==jc(De[Mg]))for(var yh=Mg+1;yh<De.length;yh++)if(!(de[De[yh]]&l)){h(se[De[yh]])&$&&(de[De[yh]]=kr);break}}}for(var Co=0;Co<De.length;Co++)if(de[De[Co]]&a){for(var _O=Co,wM=Co,SM=st,vh=Co-1;vh>=0;vh--){if(!(de[De[vh]]&l)){SM=de[De[vh]]&fh?S:w;break}_O=vh}for(var yO=Vt,bh=Co+1;bh<De.length;bh++){if(!(de[De[bh]]&(a|l))){yO=de[De[bh]]&fh?S:w;break}wM=bh}for(var wg=_O;wg<=wM;wg++)de[De[wg]]=SM===yO?SM:jc(De[wg]);Co=wM}}}for(var Ji=P.start;Ji<=P.end;Ji++){var Sg=de[Ji];if(1&Y[Ji]?Sg&(w|E|N)&&Y[Ji]++:Sg&S?Y[Ji]++:Sg&(N|E)&&(Y[Ji]+=2),Sg&l&&(Y[Ji]=0===Ji?P.level:Y[Ji-1]),Ji===P.end||h(se[Ji])&(z|O))for(var Tg=Ji;Tg>=0&&h(se[Tg])&c;Tg--)Y[Tg]=P.level}}return{levels:Y,paragraphs:_e};function vO(li,Ur){for(var Pi=li;Pi<se.length;Pi++){var Do=de[Pi];if(Do&(S|V))return 1;if(Do&(O|w)||Ur&&Do===ae)return 0;if(Do&s){var bO=Hne(Pi);Pi=-1===bO?se.length:bO}}return 0}function Hne(li){for(var Ur=1,Pi=li+1;Pi<se.length;Pi++){var Do=de[Pi];if(Do&O)break;if(Do&ae){if(0==--Ur)return Pi}else Do&s&&Ur++}return-1}function jc(li){return 1&Y[li]?S:w}},e.getMirroredCharacter=ye,e.getMirroredCharactersMap=function re(se,be,Me,de){var Ve=se.length;Me=Math.max(0,null==Me?0:+Me),de=Math.min(Ve-1,null==de?Ve-1:+de);for(var I=new Map,T=Me;T<=de;T++)if(1&be[T]){var Y=ye(se[T]);null!==Y&&I.set(T,Y)}return I},e.getReorderSegments=ie,e.getReorderedIndices=Ae,e.getReorderedString=function J(se,be,Me,de){var Ve=Ae(se,be,Me,de),I=[].concat(se);return Ve.forEach(function(T,Y){I[Y]=(1&be.levels[T]?ye(se[T]):null)||se[T]}),I.join("")},e.openingToClosingBracket=b,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init(n,e,t,i){const{defaultFontURL:r}=n;return t(e,i(),{defaultFontURL:r})}})],init:n=>function(e){return new Promise(t=>{n.typeset(e,t)})},getTransferables(n){const e=[n.glyphPositions.buffer,n.glyphIds.buffer];return n.caretPositions&&e.push(n.caretPositions.buffer),n.glyphColors&&e.push(n.glyphColors.buffer),e}}),NF={},kF="aTroikaGlyphIndex";class cQ extends PP{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new dr,this.boundingBox=new Rr}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const t=this.getIndex().count;this.setDrawRange(e===ti?t/2:0,e===Gi?t:t/2)}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function oQ(n){let e=NF[n];if(!e){const t=new fa(1,1,n,n),i=t.clone(),r=t.attributes,s=i.attributes,o=new ut,a=r.uv.count;for(let l=0;l<a;l++)s.position.array[3*l]*=-1,s.normal.array[3*l+2]*=-1;["position","normal","uv"].forEach(l=>{o.setAttribute(l,new je([...r[l].array,...s[l].array],r[l].itemSize))}),o.setIndex([...t.index.array,...i.index.array.map(l=>l+a)]),o.translate(.5,.5,0),e=NF[n]=o}return e}(e);["position","normal","uv"].forEach(i=>{this.attributes[i]=t.attributes[i].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,i,r,s){fx(this,"aTroikaGlyphBounds",e,4),fx(this,kF,t,1),fx(this,"aTroikaGlyphColor",s,3),this._blockBounds=i,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:i}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,u=r/2,d=2*r,h=Math.abs(t),f=e[0]/h,p=e[2]/h,_=s((f+u)/d)!==s((p+u)/d)?-h:o(l(f)*h,l(p)*h),m=s((f-u)/d)!==s((p-u)/d)?h:a(l(f)*h,l(p)*h),g=s((f+r)/d)!==s((p+r)/d)?2*h:a(h-c(f)*h,h-c(p)*h);i.min.set(_,e[1],t<0?-g:0),i.max.set(m,e[3],t<0?0:g)}else i.min.set(e[0],e[1],0),i.max.set(e[2],e[3],0);i.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(kF).count,i=this._chunkedBounds;if(i)for(let r=i.length;r--;){t=i[r].end;let s=i[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}}function fx(n,e,t,i){const r=n.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(n.setAttribute(e,new Ec(t,i)),delete n._maxInstanceCount,n.dispose()):r&&n.deleteAttribute(e)}const px=new pi({color:16777215,side:Gi,transparent:!0}),BF=new tt,km=new R,mx=new R,Qd=[],mQ=new R,gx="+x+y";function VF(n){return Array.isArray(n)?n[0]:n}let zF=()=>{const n=new yn(new fa(1,1),px);return zF=()=>n,n},HF=()=>{const n=new yn(new fa(1,1,32,1),px);return HF=()=>n,n};const gQ={type:"syncstart"},_Q={type:"synccomplete"},GF=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],yQ=GF.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class WF extends yn{constructor(){super(new cQ,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=gx,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(gQ),function PF(n,e){RF=!0,n=function LF(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}({},n);const t=Fc();if(n.font=function rQ(n){return Nm||(Nm=typeof document>"u"?{}:document.createElement("a")),Nm.href=n,Nm.href}(n.font||Da.defaultFontURL),n.text=""+n.text,n.sdfGlyphSize=n.sdfGlyphSize||Da.sdfGlyphSize,null!=n.colorRanges){let d={};for(let h in n.colorRanges)if(n.colorRanges.hasOwnProperty(h)){let f=n.colorRanges[h];"number"!=typeof f&&(f=nQ.set(f).getHex()),d[h]=f}n.colorRanges=d}Object.freeze(n);const{textureWidth:i,sdfExponent:r}=Da,{sdfGlyphSize:s}=n,o=i/s*4;let a=Om[s];if(!a){const d=document.createElement("canvas");d.width=i,d.height=256*s/o,a=Om[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:d,sdfTexture:new ur(d,void 0,void 0,void 0,Jt,Jt),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,function iQ(n){const e=n.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),n.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),n.contextLost=!1;const i=[];n.glyphsByFont.forEach(r=>{r.forEach(s=>{i.push(FF(s,n,!0))})}),Promise.all(i).then(()=>{OF(n),n.sdfTexture.needsUpdate=!0})})}(a)}const{sdfTexture:l,sdfCanvas:c}=a;let u=a.glyphsByFont.get(n.font);u||a.glyphsByFont.set(n.font,u=new Map),sQ(n).then(d=>{const{glyphIds:h,glyphPositions:f,fontSize:p,unitsPerEm:_,timings:m}=d,g=[],v=new Float32Array(4*h.length),y=p/_;let b=0,x=0;const M=Fc();h.forEach((W,N)=>{let L=u.get(W);if(!L){const{path:G,pathBounds:$}=d.glyphData[W],V=Math.max($[2]-$[0],$[3]-$[1])/s*(Da.sdfMargin*s+.5),q=a.glyphCount++;u.set(W,L={path:G,atlasIndex:q,sdfViewBox:[$[0]-V,$[1]-V,$[2]+V,$[3]+V]}),g.push(L)}const{sdfViewBox:O}=L,z=f[x++],U=f[x++];v[b++]=z+O[0]*y,v[b++]=U+O[1]*y,v[b++]=z+O[2]*y,v[b++]=U+O[3]*y,h[N]=L.atlasIndex}),m.quads=(m.quads||0)+(Fc()-M);const w=Fc();m.sdf={};const S=c.height,E=Math.ceil(a.glyphCount/o),C=Math.pow(2,Math.ceil(Math.log2(E*s)));C>S&&(console.info(`Increasing SDF texture size ${S}->${C}`),ZZ(c,i,C),l.dispose()),Promise.all(g.map(W=>FF(W,a,n.gpuAccelerateSDF).then(({timing:N})=>{m.sdf[W.atlasIndex]=N}))).then(()=>{g.length&&!a.contextLost&&(OF(a),l.needsUpdate=!0),m.sdfTotal=Fc()-w,m.total=Fc()-t,e(Object.freeze({parameters:n,sdfTexture:l,sdfGlyphSize:s,sdfExponent:r,glyphBounds:v,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,caretHeight:d.caretHeight,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{a.contextLost||function KZ(n){n._warm||(Fm.webgl.isSupported(n),n._warm=!0)}(c)})}({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const i=this._queuedSyncs;i&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{i.forEach(r=>r&&r())})),this.dispatchEvent(_Q),e&&e()})))}onBeforeRender(e,t,i,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s),s._hadOwnSide=s.hasOwnProperty("side"),this.geometry.setSide(s._actualSide=s.side),s.side=ns}onAfterRender(e,t,i,r,s,o){s._hadOwnSide?s.side=s._actualSide:delete s.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=px.clone());if((!e||e.baseMaterial!==t)&&(e=this._derivedMaterial=function pQ(n){const e=Pm(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ve},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Lt(0,0,0,0)},uTroikaClipRect:{value:new Lt(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ve},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ne},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new _t},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:t,fragmentShader:i}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(i)&&(i=i.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(vF,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:i}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}(t),t.addEventListener("dispose",function i(){t.removeEventListener("dispose",i),e.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let i=e._outlineMtl;return i||(i=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),i.isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),i.dispose()})),[i,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return VF(this.material).getDepthMaterial()}get customDistanceMaterial(){return VF(this.material).getDistanceMaterial()}_prepareForRender(e){const t=e.isTextOutlineMaterial,i=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;i.uTroikaSDFTexture.value=a,i.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),i.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,i.uTroikaSDFExponent.value=r.sdfExponent,i.uTroikaTotalBounds.value.fromArray(l),i.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let h,f,p,c=0,u=0,d=0,_=0,m=0;if(t){let{outlineWidth:v,outlineOffsetX:y,outlineOffsetY:b,outlineBlur:x,outlineOpacity:M}=this;c=this._parsePercent(v)||0,u=Math.max(0,this._parsePercent(x)||0),h=M,_=this._parsePercent(y)||0,m=this._parsePercent(b)||0}else d=Math.max(0,this._parsePercent(this.strokeWidth)||0),d&&(p=this.strokeColor,i.uTroikaStrokeColor.value.set(p??8421504),f=this.strokeOpacity,null==f&&(f=1)),h=this.fillOpacity;i.uTroikaDistanceOffset.value=c,i.uTroikaPositionOffset.value.set(_,m),i.uTroikaBlurRadius.value=u,i.uTroikaStrokeWidth.value=d,i.uTroikaStrokeOpacity.value=f,i.uTroikaFillOpacity.value=h??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let g=this.clipRect;if(g&&Array.isArray(g)&&4===g.length)i.uTroikaClipRect.value.fromArray(g);else{const v=100*(this.fontSize||.1);i.uTroikaClipRect.value.set(l[0]-v,l[1]-v,l[2]+v,l[3]+v)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}i.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(null==s)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new Ne;(s!==a._input||"object"==typeof s)&&a.set(a._input=s)}let o=this.orientation||gx;if(o!==e._orientation){let a=i.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==gx&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,d,h]=l;km.set(0,0,0)[u]="-"===c?1:-1,mx.set(0,0,0)[h]="-"===d?-1:1,BF.lookAt(mQ,km.cross(mx),mx),a.setFromMatrix4(BF)}else a.identity();e._orientation=o}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),i=t?parseFloat(t[1]):NaN;e=(isNaN(i)?0:i/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new ve){t.copy(e);const i=this.curveRadius;return i&&(t.x=Math.atan2(e.x,Math.abs(i)-Math.abs(e.z))*Math.abs(i)),t}worldPositionToTextCoords(e,t=new ve){return km.copy(e),this.localPositionToTextCoords(this.worldToLocal(km),t)}raycast(e,t){const{textRenderInfo:i,curveRadius:r}=this;if(i){const s=i.blockBounds,o=r?HF():zF(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let u=0;u<c.count;u++){let d=s[0]+c.getX(u)*(s[2]-s[0]);const h=s[1]+c.getY(u)*(s[3]-s[1]);let f=0;r&&(f=r-Math.cos(d/r)*r,d=Math.sin(d/r)*r),l.setXYZ(u,d,h,f)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Qd.length=0,o.raycast(e,Qd);for(let u=0;u<Qd.length;u++)Qd[u].object=this,t.push(Qd[u])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,yQ.forEach(i=>{this[i]=e[i]}),this}clone(){return(new this.constructor).copy(this)}}GF.forEach(n=>{const e="_private_"+n;Object.defineProperty(WF.prototype,n,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});var n,Lc=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return this.None(n)},Out:function(n){return this.None(n)},InOut:function(n){return this.None(n)}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return 0===n?0:Math.pow(1024,n-1)},Out:function(n){return 1===n?1:1-Math.pow(2,-10*n)},InOut:function(n){return 0===n?0:1===n?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(2-Math.pow(2,-10*(n-1)))}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return 0===n?0:1===n?1:-Math.pow(2,10*(n-1))*Math.sin(5*(n-1.1)*Math.PI)},Out:function(n){return 0===n?0:1===n?1:Math.pow(2,-10*n)*Math.sin(5*(n-.1)*Math.PI)+1},InOut:function(n){return 0===n?0:1===n?1:(n*=2)<1?-.5*Math.pow(2,10*(n-1))*Math.sin(5*(n-1.1)*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin(5*(n-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(n){var e=1.70158;return 1===n?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return 0===n?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?n*n*((e+1)*n-e)*.5:.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Lc.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?.5*Lc.Bounce.In(2*n):.5*Lc.Bounce.Out(2*n-1)+.5}}),generatePow:function(n){return void 0===n&&(n=4),n=(n=n<Number.EPSILON?Number.EPSILON:n)>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(2*e,n)/2:(1-Math.pow(2-2*e,n))/2+.5}}}}),Oc=function(){return performance.now()},qF=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){void 0===e&&(e=Oc()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]];s&&!1===s.update(e,!t)&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),Ia={Linear:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=Ia.Utils.Linear;return e<0?s(n[0],n[1],i):e>1?s(n[t],n[t-1],t-i):s(n[r],n[r+1>t?t:r+1],i-r)},Bezier:function(n,e){for(var t=0,i=n.length-1,r=Math.pow,s=Ia.Utils.Bernstein,o=0;o<=i;o++)t+=r(1-e,i-o)*r(e,o)*n[o]*s(i,o);return t},CatmullRom:function(n,e){var t=n.length-1,i=t*e,r=Math.floor(i),s=Ia.Utils.CatmullRom;return n[0]===n[t]?(e<0&&(r=Math.floor(i=t*(1+e))),s(n[(r-1+t)%t],n[r],n[(r+1)%t],n[(r+2)%t],i-r)):e<0?n[0]-(s(n[0],n[0],n[1],n[1],-i)-n[0]):e>1?n[t]-(s(n[t],n[t],n[t-1],n[t-1],i-t)-n[t]):s(n[r?r-1:0],n[r],n[t<r+1?t:r+1],n[t<r+2?t:r+2],i-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n},Bernstein:function(n,e){var t=Ia.Utils.Factorial;return t(n)/t(e)/t(n-e)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var i=e;i>1;i--)t*=i;return n[e]=t,t}),CatmullRom:function(n,e,t,i,r){var s=.5*(t-n),o=.5*(i-e),a=r*r;return(2*e-2*t+s+o)*(r*a)+(-3*e+3*t-2*s-o)*a+s*r+e}}},_x=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),yx=new qF,vx=function(){function n(e,t){void 0===t&&(t=yx),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Lc.Linear.None,this._interpolationFunction=Ia.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=_x.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t,this},n.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e,this},n.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(void 0===e&&(e=Oc()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var i in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,i,r,s){for(var o in i){var a=e[o],l=Array.isArray(a),c=l?"array":typeof a,u=!l&&Array.isArray(i[o]);if("undefined"!==c&&"function"!==c){if(u){if(0===(d=i[o]).length)continue;for(var h=[a],f=0,p=d.length;f<p;f+=1){var _=this._handleRelativeValue(a,d[f]);if(isNaN(_)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(_)}u&&(i[o]=h)}if("object"!==c&&!l||!a||u)(typeof t[o]>"u"||s)&&(t[o]=a),l||(t[o]*=1),r[o]=u?i[o].slice().reverse():t[o]||0;else{t[o]=l?[]:{};var m=a;for(var g in m)t[o][g]=m[g];r[o]=l?[]:{};var d=i[o];if(!this._isDynamic){var v={};for(var g in d)v[g]=d[g];i[o]=d=v}this._setupProperties(m,t[o],d,r[o],s)}}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return void 0===e&&(e=Oc()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},n.prototype.resume=function(e){return void 0===e&&(e=Oc()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return void 0===e&&(e=yx),this._group=e,this},n.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return void 0===e&&(e=Lc.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return void 0===e&&(e=Ia.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){if(void 0===e&&(e=Oc()),void 0===t&&(t=!0),this._isPaused)return!0;var i,r;if(!this._goToEnd&&!this._isPlaying){if(e>this._startTime+this._duration)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(e-this._startTime)/this._duration;var o=this._easingFunction(r=0===this._duration||r>1?1:r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)!this._yoyo&&"string"==typeof this._valuesEnd[i]&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?e+this._repeatDelayTime:e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,i,r){for(var s in i)if(void 0!==t[s]){var o=t[s]||0,a=i[s],l=Array.isArray(e[s]),c=Array.isArray(a);!l&&c?e[s]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(e[s],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(e[s]=o+(a-o)*r)}},n.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof i?this._valuesStartRepeat[e]+parseFloat(i):this._valuesEnd[e],this._valuesEnd[e]=t},n}(),cs=yx,XF=(cs.getAll.bind(cs),cs.removeAll.bind(cs),cs.add.bind(cs),cs.remove.bind(cs),cs.update.bind(cs));class TQ{constructor(e,t,i){this._event=e,this._notification=t,this._sceneGraph=i,this.offset=.5,this._eventHandler=new Bl(this._event),this._eventHandler.set(jt.OnKeyDown,this.onKeyDown.bind(this)),this._eventHandler.set(jt.OnKeyUp,this.onKeyUp.bind(this)),this._eventHandler.set(jt.OnInput,this.onInput.bind(this)),this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this)),this._keyBoard=null,this._isKeyCapDown={},this._clock=new Yb,this.paragraph=new WF,this._tweens={}}createWindow(){this.paragraph.font="assets/NotoSansKR-Regular.otf",this.paragraph.text="",this.paragraph.fontSize=1,this.paragraph.color=0,this.paragraph.anchorX="center",this.paragraph.anchorY="middle",this.paragraph.overflowWrap="break-word",this.paragraph.maxWidth=32,this.paragraph.position.set(0,-7,10),this.paragraph.rotation.set(90*Im,180*Im,0),this.paragraph.sync(),this._sceneGraph.group.add(this.paragraph)}update(e){}createKeyboard(){(new EK).setPath("assets/").load("new_keyboard.gltf",e=>{this._keyBoard=e.scene,this._sceneGraph.group.add(e.scene),this._keyBoard.children.forEach((t,i)=>{t.material=new Nr("board"===t.name?{color:1908259}:{color:14474460}),this._isKeyCapDown[t.name]=!1;let r=new vx(t.position).to({z:t.position.z-.5},100),s=new vx(t.position).to({z:t.position.z},100);this._tweens[t.name]=[r,s]})})}findKeyCap(e){return this._keyBoard.children.findIndex(t=>t.name===e)}onKeyDown(e){this._isKeyCapDown[e.code]||(this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][1].isPlaying()&&this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][1].stop(),this._isKeyCapDown[e.code]=!0,this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][0].start())}onKeyUp(e){this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][0].isPlaying()&&this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][0].stop(),this._isKeyCapDown[e.code]=!1,this._tweens[this._keyBoard.children[this.findKeyCap(e.code)].name][1].start()}onInput(e){this.paragraph.sync()}onNotify(e,t,i){e===Dr.createdViewportDiv&&(this.createKeyboard(),this.createWindow())}}class AQ extends yn{constructor(e,t){super(new Bd(.5,32,32),new pi({color:0})),this._event=e,this._notification=t,this.velocity=new R(0),this.accumulator=new R(0),this.mass=1,this._eventHandler=new Bl(this._event),this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this))}onNotify(e,t,i){}}class CQ{constructor(e,t,i){this._event=e,this._notification=t,this._sceneGraph=i,this.gravityAccel=new R(0,0,-9.8),this._eventHandler=new Bl(this._event),this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this)),this._particles=[],this._particles.push(new AQ(this._event,this._notification)),this._sceneGraph.group.add(this._particles[0]),this._particles[0].position.set(20,0,20)}startSimulation(e){let t=this._particles[0].velocity.add(this.gravityAccel.multiplyScalar(e)),i=this._particles[0].position.add(this._particles[0].velocity.multiplyScalar(e));this._particles[0].velocity.copy(t),this._particles[0].position.copy(i),console.log(e)}onNotify(e,t,i){}}let YF=(()=>{class n{constructor(t,i){this._event=t,this._notification=i,this.scene=new NR,this.scene.background=new Ne(6908265),this.group=new ss,this.misc=new ss,this.cameraSet=new _K(this._event,this._notification),this.renderer=new mK(this._event,this._notification,this,this.cameraSet),this.light=new vK(this._notification,this),this.grid=new bK(this),this.axes=new xK(this),this.keyboard=new TQ(this._event,this._notification,this),this.simulation=new CQ(this._event,this._notification,this),this.scene.add(this.group),this.scene.add(this.misc),this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this))}onNotify(t,i,r){t===Dr.createdViewportDiv&&this.onCreatedViewportDiv(i)}onCreatedViewportDiv(t){this.cameraSet.initialize(t,this.renderer.css2DRenderer),this.renderer.initialize(t),this.cameraSet.orbitControls.update(),DQ(this)}}return n.\u0275fac=function(t){return new(t||n)(He(g0),He(ud))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const DQ=function(n){new Yb;const t=function(){n.renderer.onRender(),XF(),requestAnimationFrame(t)};t()};let KF=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(Se(Es),Se(Si))},n.\u0275dir=it({type:n}),n})(),Ra=(()=>{class n extends KF{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=Gn(n)))(i||n)}}(),n.\u0275dir=it({type:n,features:[Nt]}),n})();const us=new Be("NgValueAccessor"),PQ={provide:us,useExisting:Gt(()=>Um),multi:!0},LQ=new Be("CompositionEventMode");let Um=(()=>{class n extends KF{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function FQ(){const n=Cs()?Cs().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(Se(Es),Se(Si),Se(LQ,8))},n.\u0275dir=it({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,i){1&t&&Ti("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Zt([PQ]),Nt]}),n})();const OQ=!1,oi=new Be("NgValidators"),Eo=new Be("NgAsyncValidators");function aL(n){return null!=n}function lL(n){const e=Cu(n)?En(n):n;if(OQ&&!My(e)){let t="Expected async validator to return Promise or Observable.";throw"object"==typeof n&&(t+=" Are you using a synchronous validator where an async validator is expected?"),new me(-1101,t)}return e}function cL(n){let e={};return n.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function uL(n,e){return e.map(t=>t(n))}function dL(n){return n.map(e=>function kQ(n){return!n.validate}(e)?e:t=>e.validate(t))}function bx(n){return null!=n?function hL(n){if(!n)return null;const e=n.filter(aL);return 0==e.length?null:function(t){return cL(uL(t,e))}}(dL(n)):null}function xx(n){return null!=n?function fL(n){if(!n)return null;const e=n.filter(aL);return 0==e.length?null:function(t){return function IQ(...n){const e=XM(n),{args:t,keys:i}=R1(n),r=new hn(s=>{const{length:o}=t;if(!o)return void s.complete();const a=new Array(o);let l=o,c=o;for(let u=0;u<o;u++){let d=!1;Li(t[u]).subscribe(fn(s,h=>{d||(d=!0,c--),a[u]=h},()=>l--,void 0,()=>{(!l||!d)&&(c||s.next(i?F1(i,a):a),s.complete())}))}});return e?r.pipe(P1(e)):r}(uL(t,e).map(lL)).pipe(Mt(cL))}}(dL(n)):null}function pL(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Mx(n){return n?Array.isArray(n)?n:[n]:[]}function Vm(n,e){return Array.isArray(n)?n.includes(e):n===e}function _L(n,e){const t=Mx(e);return Mx(n).forEach(r=>{Vm(t,r)||t.push(r)}),t}function yL(n,e){return Mx(e).filter(t=>!Vm(n,t))}class vL{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=bx(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xx(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class yi extends vL{get formDirective(){return null}get path(){return null}}class wo extends vL{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class bL{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let xL=(()=>{class n extends bL{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Se(wo,2))},n.\u0275dir=it({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,i){2&t&&Mf("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Nt]}),n})();const Jd="VALID",Hm="INVALID",Nc="PENDING",eh="DISABLED";function Gm(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class SL{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Jd}get invalid(){return this.status===Hm}get pending(){return this.status==Nc}get disabled(){return this.status===eh}get enabled(){return this.status!==eh}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(_L(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(_L(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(yL(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(yL(e,this._rawAsyncValidators))}hasValidator(e){return Vm(this._rawValidators,e)}hasAsyncValidator(e){return Vm(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Nc,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=eh,this.errors=null,this._forEachChild(i=>{i.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Jd,this._forEachChild(i=>{i.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Jd||this.status===Nc)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?eh:Jd}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Nc,this._hasOwnPendingAsyncValidator=!0;const t=lL(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){const i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new an,this.statusChanges=new an}_calculateStatus(){return this._allControlsDisabled()?eh:this.errors?Hm:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Nc)?Nc:this._anyControlsHaveStatus(Hm)?Hm:Jd}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Gm(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function jQ(n){return Array.isArray(n)?bx(n):n||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function $Q(n){return Array.isArray(n)?xx(n):n||null}(this._rawAsyncValidators)}}const kc=new Be("CallSetDisabledState",{providedIn:"root",factory:()=>Wm}),Wm="always";function th(n,e,t=Wm){(function Dx(n,e){const t=function mL(n){return n._rawValidators}(n);null!==e.validator?n.setValidators(pL(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const i=function gL(n){return n._rawAsyncValidators}(n);null!==e.asyncValidator?n.setAsyncValidators(pL(i,e.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();qm(e._rawValidators,r),qm(e._rawAsyncValidators,r)})(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||"always"===t)&&e.valueAccessor.setDisabledState?.(n.disabled),function YQ(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&TL(n,e)})}(n,e),function ZQ(n,e){const t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function KQ(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&TL(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function XQ(n,e){if(e.valueAccessor.setDisabledState){const t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function qm(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function TL(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function DL(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}function IL(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const RL=class extends SL{constructor(e=null,t,i){super(function Tx(n){return(Gm(n)?n.validators:n)||null}(t),function Ax(n,e){return(Gm(e)?e.asyncValidators:n)||null}(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Gm(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=IL(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){DL(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){DL(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){IL(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}},sJ={provide:wo,useExisting:Gt(()=>Lx)},LL=(()=>Promise.resolve())();let Lx=(()=>{class n extends wo{constructor(t,i,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new RL,this._registered=!1,this.update=new an,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=function Px(n,e){if(!e)return null;let t,i,r;return Array.isArray(e),e.forEach(s=>{s.constructor===Um?t=s:function eJ(n){return Object.getPrototypeOf(n.constructor)===Ra}(s)?i=s:r=s}),r||i||t||null}(0,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function Rx(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){th(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){LL.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const i=t.isDisabled.currentValue,r=0!==i&&function Cl(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}(i);LL.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?function jm(n,e){return[...e.path,n]}(t,this._parent):[t]}}return n.\u0275fac=function(t){return new(t||n)(Se(yi,9),Se(oi,10),Se(Eo,10),Se(us,10),Se(kf,8),Se(kc,8))},n.\u0275dir=it({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Zt([sJ]),Nt,nr]}),n})(),NL=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({}),n})(),IJ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[NL]}),n})(),PJ=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:kc,useValue:t.callSetDisabledState??Wm}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[IJ]}),n})();const FJ=["viewport"],LJ=["paragraph"];let OJ=(()=>{class n{constructor(t,i,r){this._event=t,this._notification=i,this.sceneGraph=r,this.viewport=void 0,this.paragraph=void 0,this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this)),this._eventHandler=new Bl(this._event),this._eventHandler.set(jt.OnKeyDown,this.onKeyDown.bind(this)),this._eventHandler.set(jt.OnKeyUp,this.onKeyUp.bind(this)),this._eventHandler.set(jt.OnInput,this.onInput.bind(this))}ngAfterViewInit(){this._event.isEnabled=!0,this._notification.isEnabled=!0,this._notification.notify(Dr.createdViewportDiv,this.viewport.nativeElement)}onKeyDown(t){this.paragraph.nativeElement.focus()}onKeyUp(t){}onInput(t){}onNotify(t,i,r){}}return n.\u0275fac=function(t){return new(t||n)(Se(g0),Se(ud),Se(YF))},n.\u0275cmp=Jc({type:n,selectors:[["app-viewport"]],viewQuery:function(t,i){if(1&t&&(If(FJ,7),If(LJ,7)),2&t){let r;ku(r=Uu())&&(i.viewport=r.first),ku(r=Uu())&&(i.paragraph=r.first)}},decls:4,vars:1,consts:[[1,"hidden",3,"ngModel","ngModelChange"],["paragraph",""],["id","viewport"],["viewport",""]],template:function(t,i){1&t&&(Tu(0,"input",0,1),Ti("ngModelChange",function(s){return i.sceneGraph.keyboard.paragraph.text=s}),Au(),xl(2,"div",2,3)),2&t&&bf("ngModel",i.sceneGraph.keyboard.paragraph.text)},dependencies:[Um,xL,Lx],styles:["#viewport[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}.hidden[_ngcontent-%COMP%]{position:absolute!important;width:1px;height:1px;overflow:hidden;ime-mode:disabled;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px)}"]}),n})();const NJ=["background"];let kJ=(()=>{class n{constructor(t){this._notification=t,this.background=void 0,this.isVisibleLeftMenu=!0,this.isVisibleRightMenu=!0,this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this))}onChangeMenu(){this._notifyHandler.notify(Dr.resizedClientSize)}onNotify(t,i,r){}}return n.\u0275fac=function(t){return new(t||n)(Se(ud))},n.\u0275cmp=Jc({type:n,selectors:[["app-body"]],viewQuery:function(t,i){if(1&t&&If(NJ,7),2&t){let r;ku(r=Uu())&&(i.background=r.first)}},decls:4,vars:1,consts:[["id","container"],["id","background"],["background",""]],template:function(t,i){1&t&&(Tu(0,"div",0)(1,"div",1,2),xl(3,"app-viewport"),Au()()),2&t&&bf("@.disabled",!0)},dependencies:[OJ],styles:["#background[_ngcontent-%COMP%]{width:100%;height:100%}#container[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;-webkit-user-select:none;user-select:none}"]}),n})(),UJ=(()=>{class n{constructor(t,i){this._event=t,this._notification=i,this._viewportDiv=void 0,this._viewportRect=void 0,this._notifyHandler=new Fs(this._notification,this.onNotify.bind(this))}onWindowResize(){this._viewportRect=this._viewportDiv.getBoundingClientRect(),this._event.emit(jt.OnWindowResize,void 0)}onMouseWheel(t){this.isMouseInViewport(t)&&this._event.emit(jt.OnMouseWheel,t)}onMouseMove(t){this.isMouseInViewport(t)&&this._event.emit(jt.OnMouseMove,t)}onMouseDown(t){this._event.emit(jt.OnMouseDown,t)}onMouseUp(t){this._event.emit(jt.OnMouseUp,t)}onKeyDown(t){this._event.emit(jt.OnKeyDown,t)}onKeyUp(t){this._event.emit(jt.OnKeyUp,t)}onContextMenu(t){}onInput(t){this._event.emit(jt.OnInput,t)}onNotify(t,i,r){switch(t){case Dr.createdViewportDiv:this._viewportDiv=i,this._viewportRect=this._viewportDiv.getBoundingClientRect();break;case Dr.resizedClientSize:console.log("hello"),this._viewportRect=this._viewportDiv.getBoundingClientRect(),this.onWindowResize()}}isMouseInViewport(t){return this._viewportRect.left<=t.clientX&&t.clientX<=this._viewportRect.right&&this._viewportRect.top<=t.clientY&&t.clientY<=this._viewportRect.bottom}}return n.\u0275fac=function(t){return new(t||n)(Se(g0),Se(ud))},n.\u0275cmp=Jc({type:n,selectors:[["app-root"]],hostBindings:function(t,i){1&t&&Ti("resize",function(){return i.onWindowResize()},0,jr)("mousewheel",function(s){return i.onMouseWheel(s)},!1,jr)("mousemove",function(s){return i.onMouseMove(s)},!1,jr)("mousedown",function(s){return i.onMouseDown(s)},!1,jr)("mouseup",function(s){return i.onMouseUp(s)},!1,jr)("keydown",function(s){return i.onKeyDown(s)},!1,jr)("keyup",function(s){return i.onKeyUp(s)},!1,jr)("contextmenu",function(s){return i.onContextMenu(s)},!1,jr)("input",function(s){return i.onInput(s)},!1,jr)},decls:2,vars:0,template:function(t,i){1&t&&xl(0,"app-body")(1,"router-outlet")},dependencies:[t0,kJ],styles:["app-root[_ngcontent-%COMP%]{overflow:hidden;width:100%;height:100%}"]}),n})();class e2{}class BJ{}const Xs="*";function t2(n,e=null){return{type:2,steps:n,options:e}}function Ym(n){return{type:6,styles:n,offset:null}}function n2(n){Promise.resolve().then(n)}class ih{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){n2(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class r2{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?n2(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}const zx="!";function s2(n){return new me(3e3,!1)}function wee(){return typeof window<"u"&&typeof window.document<"u"}function Hx(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function So(n){switch(n.length){case 0:return new ih;case 1:return n[0];default:return new r2(n)}}function o2(n,e,t,i,r=new Map,s=new Map){const o=[],a=[];let l=-1,c=null;if(i.forEach(u=>{const d=u.get("offset"),h=d==l,f=h&&c||new Map;u.forEach((p,_)=>{let m=_,g=p;if("offset"!==_)switch(m=e.normalizePropertyName(m,o),g){case zx:g=r.get(_);break;case Xs:g=s.get(_);break;default:g=e.normalizeStyleValue(_,m,g,o)}f.set(m,g)}),h||a.push(f),c=f,l=d}),o.length)throw function hee(n){return new me(3502,!1)}();return a}function Gx(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&Wx(t,"start",n)));break;case"done":n.onDone(()=>i(t&&Wx(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&Wx(t,"destroy",n)))}}function Wx(n,e,t){const s=jx(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function jx(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function Yi(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function a2(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let $x=(n,e)=>!1,l2=(n,e,t)=>[],c2=null;function qx(n){const e=n.parentNode||n.host;return e===c2?null:e}(Hx()||typeof Element<"u")&&(wee()?(c2=(()=>document.documentElement)(),$x=(n,e)=>{for(;e;){if(e===n)return!0;e=qx(e)}return!1}):$x=(n,e)=>n.contains(e),l2=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]});let Fa=null,u2=!1;const d2=$x,h2=l2;let f2=(()=>{class n{validateStyleProperty(t){return function Tee(n){Fa||(Fa=function Aee(){return typeof document<"u"?document.body:null}()||{},u2=!!Fa.style&&"WebkitAppearance"in Fa.style);let e=!0;return Fa.style&&!function See(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in Fa.style,!e&&u2&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Fa.style)),e}(t)}matchesElement(t,i){return!1}containsElement(t,i){return d2(t,i)}getParentElement(t){return qx(t)}query(t,i,r){return h2(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],l){return new ih(r,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})(),Xx=(()=>{class n{}return n.NOOP=new f2,n})();const Cee=1e3,Yx="ng-enter",Km="ng-leave",Zm="ng-trigger",Qm=".ng-trigger",m2="ng-animating",Kx=".ng-animating";function Ys(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Zx(parseFloat(e[1]),e[2])}function Zx(n,e){return"s"===e?n*Cee:n}function Jm(n,e,t){return n.hasOwnProperty("duration")?n:function Iee(n,e,t){let r,s=0,o="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return e.push(s2()),{duration:0,delay:0,easing:""};r=Zx(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(s=Zx(parseFloat(l),a[4]));const c=a[5];c&&(o=c)}else r=n;if(!t){let a=!1,l=e.length;r<0&&(e.push(function WJ(){return new me(3100,!1)}()),a=!0),s<0&&(e.push(function jJ(){return new me(3101,!1)}()),a=!0),a&&e.splice(l,0,s2())}return{duration:r,delay:s,easing:o}}(n,e,t)}function rh(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function g2(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function To(n,e=new Map,t){if(t)for(let[i,r]of t)e.set(i,r);for(let[i,r]of n)e.set(i,r);return e}function y2(n,e,t){return t?e+":"+t+";":""}function v2(n){let e="";for(let t=0;t<n.style.length;t++){const i=n.style.item(t);e+=y2(0,i,n.style.getPropertyValue(i))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=y2(0,Lee(t),n.style[t]));n.setAttribute("style",e)}function ds(n,e,t){n.style&&(e.forEach((i,r)=>{const s=Jx(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i}),Hx()&&v2(n))}function La(n,e){n.style&&(e.forEach((t,i)=>{const r=Jx(i);n.style[r]=""}),Hx()&&v2(n))}function sh(n){return Array.isArray(n)?1==n.length?n[0]:t2(n):n}const Qx=new RegExp("{{\\s*(.+?)\\s*}}","g");function b2(n){let e=[];if("string"==typeof n){let t;for(;t=Qx.exec(n);)e.push(t[1]);Qx.lastIndex=0}return e}function oh(n,e,t){const i=n.toString(),r=i.replace(Qx,(s,o)=>{let a=e[o];return null==a&&(t.push(function qJ(n){return new me(3003,!1)}()),a=""),a.toString()});return r==i?n:r}function eg(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const Fee=/-+([a-z0-9])/g;function Jx(n){return n.replace(Fee,(...e)=>e[1].toUpperCase())}function Lee(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Ki(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function XJ(n){return new me(3004,!1)}()}}function x2(n,e){return window.getComputedStyle(n)[e]}const ig="*";function Vee(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function zee(n,e,t){if(":"==n[0]){const l=function Hee(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function lee(n){return new me(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof l)return void e.push(l);n=l}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function aee(n){return new me(3015,!1)}()),e;const r=i[1],s=i[2],o=i[3];e.push(M2(r,o));"<"==s[0]&&!(r==ig&&o==ig)&&e.push(M2(o,r))}(i,t,e)):t.push(n),t}const rg=new Set(["true","1"]),sg=new Set(["false","0"]);function M2(n,e){const t=rg.has(n)||sg.has(n),i=rg.has(e)||sg.has(e);return(r,s)=>{let o=n==ig||n==r,a=e==ig||e==s;return!o&&t&&"boolean"==typeof r&&(o=r?rg.has(n):sg.has(n)),!a&&i&&"boolean"==typeof s&&(a=s?rg.has(e):sg.has(e)),o&&a}}const Gee=new RegExp("s*:selfs*,?","g");function eM(n,e,t,i){return new Wee(n).build(e,t,i)}class Wee{constructor(e){this._driver=e}build(e,t,i){const r=new qee(t);return this._resetContextStyleTimingState(r),Ki(this,sh(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function KJ(){return new me(3006,!1)}()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),0==a.type){const l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,s.push(this.visitState(l,t))}),l.name=c}else if(1==a.type){const l=this.visitTransition(a,t);i+=l.queryCount,r+=l.depCount,o.push(l)}else t.errors.push(function ZJ(){return new me(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{b2(l).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&(eg(s.values()),t.errors.push(function QJ(n,e){return new me(3008,!1)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=Ki(this,sh(e.animation),t);return{type:1,matchers:Vee(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:Oa(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>Ki(this,i,t)),options:Oa(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(o=>{t.currentTime=i;const a=Ki(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:3,steps:s,options:Oa(e.options)}}visitAnimate(e,t){const i=function Yee(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return tM(Jm(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=tM(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=Jm(t,e);return tM(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Ym({});if(5==s.type)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;const c={};i.easing&&(c.easing=i.easing),o=Ym(c)}t.currentTime+=i.duration+i.delay;const l=this.visitStyle(o,t);l.isEmptyStep=a,r=l}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)"string"==typeof a?a===Xs?i.push(a):t.errors.push(new me(3002,!1)):i.push(g2(a));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s))for(let l of a.values())if(l.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((a,l)=>{const c=t.collectedStyles.get(t.currentQuerySelector),u=c.get(l);let d=!0;u&&(s!=r&&s>=u.startTime&&r<=u.endTime&&(t.errors.push(function eee(n,e,t,i,r){return new me(3010,!1)}()),d=!1),s=u.startTime),d&&c.set(l,{startTime:s,endTime:r}),t.options&&function Pee(n,e,t){const i=e.params||{},r=b2(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function $J(n){return new me(3001,!1)}())})}(a,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function tee(){return new me(3011,!1)}()),i;let s=0;const o=[];let a=!1,l=!1,c=0;const u=e.steps.map(g=>{const v=this._makeStyleAst(g,t);let y=null!=v.offset?v.offset:function Xee(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(v.styles),b=0;return null!=y&&(s++,b=v.offset=y),l=l||b<0||b>1,a=a||b<c,c=b,o.push(b),v});l&&t.errors.push(function nee(){return new me(3012,!1)}()),a&&t.errors.push(function iee(){return new me(3200,!1)}());const d=e.steps.length;let h=0;s>0&&s<d?t.errors.push(function ree(){return new me(3202,!1)}()):0==s&&(h=1/(d-1));const f=d-1,p=t.currentTime,_=t.currentAnimateTimings,m=_.duration;return u.forEach((g,v)=>{const y=h>0?v==f?1:h*v:o[v],b=y*m;t.currentTime=p+_.delay+b,_.duration=b,this._validateStyleAst(g,t),g.offset=y,i.styles.push(g)}),i}visitReference(e,t){return{type:8,animation:Ki(this,sh(e.animation),t),options:Oa(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Oa(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Oa(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function jee(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(Gee,"")),n=n.replace(/@\*/g,Qm).replace(/@\w+/g,t=>Qm+"-"+t.slice(1)).replace(/:animating/g,Kx),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,Yi(t.collectedStyles,t.currentQuerySelector,new Map);const a=Ki(this,sh(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:Oa(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function see(){return new me(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:Jm(e.timings,t.errors,!0);return{type:12,animation:Ki(this,sh(e.animation),t),timings:i,options:null}}}class qee{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Oa(n){return n?(n=rh(n)).params&&(n.params=function $ee(n){return n?rh(n):null}(n.params)):n={},n}function tM(n,e,t){return{duration:n,delay:e,easing:t}}function nM(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}class og{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const Qee=new RegExp(":enter","g"),ete=new RegExp(":leave","g");function iM(n,e,t,i,r,s=new Map,o=new Map,a,l,c=[]){return(new tte).buildKeyframes(n,e,t,i,r,s,o,a,l,c)}class tte{buildKeyframes(e,t,i,r,s,o,a,l,c,u=[]){c=c||new og;const d=new rM(e,t,c,r,s,u,[]);d.options=l;const h=l.delay?Ys(l.delay):0;d.currentTimeline.delayNextStep(h),d.currentTimeline.setStyles([o],null,d.errors,l),Ki(this,i,d);const f=d.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let _=f.length-1;_>=0;_--){const m=f[_];if(m.element===t){p=m;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,d.errors,l)}return f.length?f.map(p=>p.buildKeyframes()):[nM(t,[],[],[],0,h,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const o="number"==typeof s?s:Ys(oh(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const o=null!=i.duration?Ys(i.duration):null,a=null!=i.delay?Ys(i.delay):null;return 0!==o&&e.forEach(l=>{const c=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),Ki(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=ag);const o=Ys(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>Ki(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Ys(e.options.delay):0;e.steps.forEach(o=>{const a=t.createSubContext(e.options);s&&a.delayNextStep(s),Ki(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return Jm(t.params?oh(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(l=>{a.forwardTime((l.offset||0)*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?Ys(r.delay):0;s&&(6===t.previousNode.type||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=ag);let o=i;const a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{t.currentQueryIndex=u;const d=t.createSubContext(e.options,c);s&&d.delayNextStep(s),c===t.element&&(l=d.currentTimeline),Ki(this,e.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1);let l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=i.currentStaggerTime}const u=t.currentTimeline;l&&u.delayNextStep(l);const d=u.currentTime;Ki(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-d+(r.startTime-i.currentTimeline.startTime)}}const ag={};class rM{constructor(e,t,i,r,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=ag,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new lg(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=Ys(i.duration)),null!=i.delay&&(r.delay=Ys(i.delay));const s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=oh(s[a],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new rM(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=ag,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new nte(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=(e=e.replace(Qee,"."+this._enterClassName)).replace(ete,"."+this._leaveClassName);let c=this._driver.query(this.element,e,1!=i);0!==i&&(c=i<0?c.slice(c.length+i,c.length):c.slice(0,i)),a.push(...c)}return!s&&0==a.length&&o.push(function oee(n){return new me(3014,!1)}()),a}}class lg{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new lg(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||Xs),this._currentKeyframe.set(t,Xs);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},o=function ite(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||e.keys();for(let s of i)t.set(s,Xs)}else To(r,t)}),t}(e,this._globalTimelineStyles);for(let[a,l]of o){const c=oh(l,s,i);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Xs),this._updateStyle(a,c)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,l)=>{const c=To(a,new Map,this._backFill);c.forEach((u,d)=>{u===zx?e.add(d):u===Xs&&t.add(d)}),i||c.set("offset",l/this.duration),r.push(c)});const s=e.size?eg(e.values()):[],o=t.size?eg(t.values()):[];if(i){const a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return nM(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}}class nte extends lg{constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=i+t,a=t/o,l=To(e[0]);l.set("offset",0),s.push(l);const c=To(e[0]);c.set("offset",S2(a)),s.push(c);const u=e.length-1;for(let d=1;d<=u;d++){let h=To(e[d]);const f=h.get("offset");h.set("offset",S2((t+f*i)/o)),s.push(h)}i=o,t=0,r="",e=s}return nM(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function S2(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class sM{}const rte=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class ste extends sM{normalizePropertyName(e,t){return Jx(e)}normalizeStyleValue(e,t,i,r){let s="";const o=i.toString().trim();if(rte.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function YJ(n,e){return new me(3005,!1)}())}return o+s}}function T2(n,e,t,i,r,s,o,a,l,c,u,d,h){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:d,errors:h}}const oM={};class A2{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function ote(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,l,c,u){const d=[],h=this.ast.options&&this.ast.options.params||oM,p=this.buildStyles(i,a&&a.params||oM,d),_=l&&l.params||oM,m=this.buildStyles(r,_,d),g=new Set,v=new Map,y=new Map,b="void"===r,x={params:ate(_,h),delay:this.ast.options?.delay},M=u?[]:iM(e,t,this.ast.animation,s,o,p,m,x,c,d);let w=0;if(M.forEach(E=>{w=Math.max(E.duration+E.delay,w)}),d.length)return T2(t,this._triggerName,i,r,b,p,m,[],[],v,y,w,d);M.forEach(E=>{const C=E.element,W=Yi(v,C,new Set);E.preStyleProps.forEach(L=>W.add(L));const N=Yi(y,C,new Set);E.postStyleProps.forEach(L=>N.add(L)),C!==t&&g.add(C)});const S=eg(g.values());return T2(t,this._triggerName,i,r,b,p,m,M,S,v,y,w)}}function ate(n,e){const t=rh(e);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(t[i]=n[i]);return t}class lte{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=rh(this.defaultParams);return Object.keys(e).forEach(s=>{const o=e[s];null!==o&&(r[s]=o)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,a)=>{o&&(o=oh(o,r,t));const l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),i.set(a,o)})}),i}}class ute{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{this.states.set(r.name,new lte(r.style,r.options&&r.options.params||{},i))}),C2(this.states,"true","1"),C2(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new A2(e,r,this.states))}),this.fallbackTransition=function dte(n,e,t){return new A2(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function C2(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const hte=new og;class fte{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const i=[],r=[],s=eM(this._driver,t,i,r);if(i.length)throw function fee(n){return new me(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=o2(0,this._normalizer,0,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let o;const a=new Map;if(s?(o=iM(this._driver,t,s,Yx,Km,new Map,new Map,i,hte,r),o.forEach(u=>{const d=Yi(a,u.element,new Map);u.postStyleProps.forEach(h=>d.set(h,null))})):(r.push(function pee(){return new me(3300,!1)}()),o=[]),r.length)throw function mee(n){return new me(3504,!1)}();a.forEach((u,d)=>{u.forEach((h,f)=>{u.set(f,this._driver.computeStyle(d,f,Xs))})});const c=So(o.map(u=>{const d=a.get(u.element);return this._buildPlayer(u,new Map,d)}));return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function gee(n){return new me(3301,!1)}();return t}listen(e,t,i,r){const s=jx(t,"","","");return Gx(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const D2="ng-animate-queued",aM="ng-animate-disabled",yte=[],I2={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},vte={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},mr="__ng_removed";class lM{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function Ete(n){return n??null}(i?e.value:e),i){const s=rh(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const ah="void",cM=new lM(ah);class bte{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,gr(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function _ee(n,e){return new me(3302,!1)}();if(null==i||0==i.length)throw function yee(n){return new me(3303,!1)}();if(!function wte(n){return"start"==n||"done"==n}(i))throw function vee(n,e){return new me(3400,!1)}();const s=Yi(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);const a=Yi(this._engine.statesByElement,e,new Map);return a.has(t)||(gr(e,Zm),gr(e,Zm+"-"+t),a.set(t,cM)),()=>{this._engine.afterFlush(()=>{const l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function bee(n){return new me(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),o=new uM(this.id,t,e);let a=this._engine.statesByElement.get(e);a||(gr(e,Zm),gr(e,Zm+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t);const c=new lM(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=cM),c.value!==ah&&l.value===c.value){if(!function Ate(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(l.params,c.params)){const _=[],m=s.matchStyles(l.value,l.params,_),g=s.matchStyles(c.value,c.params,_);_.length?this._engine.reportError(_):this._engine.afterFlush(()=>{La(e,m),ds(e,g)})}return}const h=Yi(this._engine.playersByElement,e,[]);h.forEach(_=>{_.namespaceId==this.id&&_.triggerName==t&&_.queued&&_.destroy()});let f=s.matchTransition(l.value,c.value,e,c.params),p=!1;if(!f){if(!r)return;f=s.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:l,toState:c,player:o,isFallbackTransition:p}),p||(gr(e,D2),o.onStart(()=>{Uc(e,D2)})),o.onDone(()=>{let _=this.players.indexOf(o);_>=0&&this.players.splice(_,1);const m=this._engine.playersByElement.get(e);if(m){let g=m.indexOf(o);g>=0&&m.splice(g,1)}}),this.players.push(o),h.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,Qm,!0);i.forEach(r=>{if(r[mr])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const a=[];if(s.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){const u=this.trigger(e,c,ah,r);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&So(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const o=s.name;if(r.has(o))return;r.add(o);const l=this._triggers.get(o).fallbackTransition,c=i.get(o)||cM,u=new lM(ah),d=new uM(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:d,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[mr];(!s||s===I2)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){gr(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){const l=jx(s,i.triggerName,i.fromState.value,i.toState.value);l._data=e,Gx(i.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,o=r.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class xte{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new bte(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){const l=r.get(a);if(l){const c=i.indexOf(l);i.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(cg(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!cg(t))return;const s=t[mr];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),gr(e,aM)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Uc(e,aM))}removeNode(e,t,i,r){if(cg(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),i){const o=this.namespacesByHostElement.get(t);o&&o.id!==e&&o.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[mr]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return cg(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,Qm,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,Kx,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return So(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[mr];if(t&&t.setForRemoval){if(e[mr]=I2,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(aM)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)gr(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?So(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function xee(n){return new me(3402,!1)}()}_flushAnimations(e,t){const i=new og,r=[],s=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(U=>{u.add(U);const G=this.driver.query(U,".ng-animate-queued",!0);for(let $=0;$<G.length;$++)u.add(G[$])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=F2(h,this.collectedEnterElements),p=new Map;let _=0;f.forEach((U,G)=>{const $=Yx+_++;p.set(G,$),U.forEach(V=>gr(V,$))});const m=[],g=new Set,v=new Set;for(let U=0;U<this.collectedLeaveElements.length;U++){const G=this.collectedLeaveElements[U],$=G[mr];$&&$.setForRemoval&&(m.push(G),g.add(G),$.hasAnimation?this.driver.query(G,".ng-star-inserted",!0).forEach(V=>g.add(V)):v.add(G))}const y=new Map,b=F2(h,Array.from(g));b.forEach((U,G)=>{const $=Km+_++;y.set(G,$),U.forEach(V=>gr(V,$))}),e.push(()=>{f.forEach((U,G)=>{const $=p.get(G);U.forEach(V=>Uc(V,$))}),b.forEach((U,G)=>{const $=y.get(G);U.forEach(V=>Uc(V,$))}),m.forEach(U=>{this.processLeaveNode(U)})});const x=[],M=[];for(let U=this._namespaceList.length-1;U>=0;U--)this._namespaceList[U].drainQueuedTransitions(t).forEach($=>{const V=$.player,q=$.element;if(x.push(V),this.collectedEnterElements.length){const K=q[mr];if(K&&K.setForMove){if(K.previousTriggersValues&&K.previousTriggersValues.has($.triggerName)){const ae=K.previousTriggersValues.get($.triggerName),ue=this.statesByElement.get($.element);if(ue&&ue.has($.triggerName)){const Ce=ue.get($.triggerName);Ce.value=ae,ue.set($.triggerName,Ce)}}return void V.destroy()}}const B=!d||!this.driver.containsElement(d,q),k=y.get(q),X=p.get(q),j=this._buildInstruction($,i,X,k,B);if(j.errors&&j.errors.length)return void M.push(j);if(B)return V.onStart(()=>La(q,j.fromStyles)),V.onDestroy(()=>ds(q,j.toStyles)),void r.push(V);if($.isFallbackTransition)return V.onStart(()=>La(q,j.fromStyles)),V.onDestroy(()=>ds(q,j.toStyles)),void r.push(V);const Q=[];j.timelines.forEach(K=>{K.stretchStartingKeyframe=!0,this.disabledNodes.has(K.element)||Q.push(K)}),j.timelines=Q,i.append(q,j.timelines),o.push({instruction:j,player:V,element:q}),j.queriedElements.forEach(K=>Yi(a,K,[]).push(V)),j.preStyleProps.forEach((K,ae)=>{if(K.size){let ue=l.get(ae);ue||l.set(ae,ue=new Set),K.forEach((Ce,he)=>ue.add(he))}}),j.postStyleProps.forEach((K,ae)=>{let ue=c.get(ae);ue||c.set(ae,ue=new Set),K.forEach((Ce,he)=>ue.add(he))})});if(M.length){const U=[];M.forEach(G=>{U.push(function Mee(n,e){return new me(3505,!1)}())}),x.forEach(G=>G.destroy()),this.reportError(U)}const w=new Map,S=new Map;o.forEach(U=>{const G=U.element;i.has(G)&&(S.set(G,G),this._beforeAnimationBuild(U.player.namespaceId,U.instruction,w))}),r.forEach(U=>{const G=U.element;this._getPreviousPlayers(G,!1,U.namespaceId,U.triggerName,null).forEach(V=>{Yi(w,G,[]).push(V),V.destroy()})});const E=m.filter(U=>O2(U,l,c)),C=new Map;P2(C,this.driver,v,c,Xs).forEach(U=>{O2(U,l,c)&&E.push(U)});const N=new Map;f.forEach((U,G)=>{P2(N,this.driver,new Set(U),l,zx)}),E.forEach(U=>{const G=C.get(U),$=N.get(U);C.set(U,new Map([...Array.from(G?.entries()??[]),...Array.from($?.entries()??[])]))});const L=[],O=[],z={};o.forEach(U=>{const{element:G,player:$,instruction:V}=U;if(i.has(G)){if(u.has(G))return $.onDestroy(()=>ds(G,V.toStyles)),$.disabled=!0,$.overrideTotalTime(V.totalTime),void r.push($);let q=z;if(S.size>1){let k=G;const X=[];for(;k=k.parentNode;){const j=S.get(k);if(j){q=j;break}X.push(k)}X.forEach(j=>S.set(j,q))}const B=this._buildAnimation($.namespaceId,V,w,s,N,C);if($.setRealPlayer(B),q===z)L.push($);else{const k=this.playersByElement.get(q);k&&k.length&&($.parentPlayer=So(k)),r.push($)}}else La(G,V.fromStyles),$.onDestroy(()=>ds(G,V.toStyles)),O.push($),u.has(G)&&r.push($)}),O.forEach(U=>{const G=s.get(U.element);if(G&&G.length){const $=So(G);U.setRealPlayer($)}}),r.forEach(U=>{U.parentPlayer?U.syncPlayerEvents(U.parentPlayer):U.destroy()});for(let U=0;U<m.length;U++){const G=m[U],$=G[mr];if(Uc(G,Km),$&&$.hasAnimation)continue;let V=[];if(a.size){let B=a.get(G);B&&B.length&&V.push(...B);let k=this.driver.query(G,Kx,!0);for(let X=0;X<k.length;X++){let j=a.get(k[X]);j&&j.length&&V.push(...j)}}const q=V.filter(B=>!B.destroyed);q.length?Ste(this,G,q):this.processLeaveNode(G)}return m.length=0,L.forEach(U=>{this.players.push(U),U.onDone(()=>{U.destroy();const G=this.players.indexOf(U);this.players.splice(G,1)}),U.play()}),L}elementContainsData(e,t){let i=!1;const r=t[mr];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){const a=this.playersByQueriedElement.get(e);a&&(o=a)}else{const a=this.playersByElement.get(e);if(a){const l=!s||s==ah;a.forEach(c=>{c.queued||!l&&c.triggerName!=r||o.push(c)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){const s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:t.triggerName;for(const l of t.timelines){const c=l.element,u=c!==s,d=Yi(i,c,[]);this._getPreviousPlayers(c,u,o,a,t.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}La(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){const a=t.triggerName,l=t.element,c=[],u=new Set,d=new Set,h=t.timelines.map(p=>{const _=p.element;u.add(_);const m=_[mr];if(m&&m.removedBeforeQueried)return new ih(p.duration,p.delay);const g=_!==l,v=function Tte(n){const e=[];return L2(n,e),e}((i.get(_)||yte).map(w=>w.getRealPlayer())).filter(w=>!!w.element&&w.element===_),y=s.get(_),b=o.get(_),x=o2(0,this._normalizer,0,p.keyframes,y,b),M=this._buildPlayer(p,x,v);if(p.subTimeline&&r&&d.add(_),g){const w=new uM(e,a,_);w.setRealPlayer(M),c.push(w)}return M});c.forEach(p=>{Yi(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function Mte(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>gr(p,m2));const f=So(h);return f.onDestroy(()=>{u.forEach(p=>Uc(p,m2)),ds(l,t.toStyles)}),d.forEach(p=>{Yi(r,p,[]).push(f)}),f}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new ih(e.duration,e.delay)}}class uM{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new ih,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>Gx(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Yi(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function cg(n){return n&&1===n.nodeType}function R2(n,e){const t=n.style.display;return n.style.display=e??"none",t}function P2(n,e,t,i,r){const s=[];t.forEach(l=>s.push(R2(l)));const o=[];i.forEach((l,c)=>{const u=new Map;l.forEach(d=>{const h=e.computeStyle(c,d,r);u.set(d,h),(!h||0==h.length)&&(c[mr]=vte,o.push(c))}),n.set(c,u)});let a=0;return t.forEach(l=>R2(l,s[a++])),o}function F2(n,e){const t=new Map;if(n.forEach(a=>t.set(a,[])),0==e.length)return t;const i=1,r=new Set(e),s=new Map;function o(a){if(!a)return i;let l=s.get(a);if(l)return l;const c=a.parentNode;return l=t.has(c)?c:r.has(c)?i:o(c),s.set(a,l),l}return e.forEach(a=>{const l=o(a);l!==i&&t.get(l).push(a)}),t}function gr(n,e){n.classList?.add(e)}function Uc(n,e){n.classList?.remove(e)}function Ste(n,e,t){So(t).onDone(()=>n.processLeaveNode(e))}function L2(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof r2?L2(i.players,e):e.push(i)}}function O2(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class ug{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new xte(e,t,i),this._timelineEngine=new fte(e,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const o=e+"-"+r;let a=this._triggerCache[o];if(!a){const l=[],c=[],u=eM(this._driver,s,l,c);if(l.length)throw function dee(n,e){return new me(3404,!1)}();a=function cte(n,e,t){return new ute(n,e,t)}(r,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i,r){this._transitionEngine.removeNode(e,t,r||!1,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,o]=a2(i);this._timelineEngine.command(s,t,o,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[o,a]=a2(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Dte=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ds(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ds(this._element,this._initialStyles),this._endStyles&&(ds(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(La(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(La(this._element,this._endStyles),this._endStyles=null),ds(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function dM(n){let e=null;return n.forEach((t,i)=>{(function Ite(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class N2{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:x2(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class Rte{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return d2(e,t)}getParentElement(e){return qx(e)}query(e,t,i){return h2(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,s,o=[]){const l={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(l.easing=s);const c=new Map,u=o.filter(f=>f instanceof N2);(function Oee(n,e){return 0===n||0===e})(i,r)&&u.forEach(f=>{f.currentSnapshot.forEach((p,_)=>c.set(_,p))});let d=function Ree(n){return n.length?n[0]instanceof Map?n:n.map(e=>g2(e)):[]}(t).map(f=>To(f));d=function Nee(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,x2(n,a)))}}return e}(e,d,c);const h=function Cte(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=dM(e[0]),e.length>1&&(i=dM(e[e.length-1]))):e instanceof Map&&(t=dM(e)),t||i?new Dte(n,t,i):null}(e,d);return new N2(e,d,l,h)}}let Pte=(()=>{class n extends e2{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:_r.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?t2(t):t;return k2(this._renderer,null,i,"register",[r]),new Fte(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(He(xu),He(In))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();class Fte extends BJ{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new Lte(this._id,e,t||{},this._renderer)}}class Lte{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return k2(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function k2(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const U2="@.disabled";let Ote=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,o)=>{const a=o?.parentNode(s);a&&o.removeChild(a,s)}}createRenderer(t,i){const s=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let u=this._rendererCache.get(s);return u||(u=new B2("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,u)),u}const o=i.id,a=i.id+"-"+this._currentId;this._currentId++,this.engine.register(a,t);const l=u=>{Array.isArray(u)?u.forEach(l):this.engine.registerTrigger(o,a,t,u.name,u)};return i.data.animation.forEach(l),new Nte(this,a,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(He(xu),He(ug),He(Qt))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();class B2{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==U2?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class Nte extends B2{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==U2?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function kte(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),o="";return"@"!=s.charAt(0)&&([s,o]=function Ute(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,r,s,o,a=>{this.factory.scheduleListenerCallback(a._data||-1,i,a)})}return this.delegate.listen(e,t,i)}}let Bte=(()=>{class n extends ug{constructor(t,i,r,s){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(He(In),He(Xx),He(sM),He(zu))},n.\u0275prov=$e({token:n,factory:n.\u0275fac}),n})();const V2=[{provide:e2,useClass:Pte},{provide:sM,useFactory:function Vte(){return new ste}},{provide:ug,useClass:Bte},{provide:xu,useFactory:function zte(n,e,t){return new Ote(n,e,t)},deps:[tp,ug,Qt]}],hM=[{provide:Xx,useFactory:()=>new Rte},{provide:aC,useValue:"BrowserAnimations"},...V2],z2=[{provide:Xx,useClass:f2},{provide:aC,useValue:"NoopAnimations"},...V2];let fM,Hte=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?z2:hM}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({providers:hM,imports:[A1]}),n})();try{fM=typeof Intl<"u"&&Intl.v8BreakIterator}catch{fM=!1}let lh,H2=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function m5(n){return n===r1}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!fM)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(He(Zy))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ch(n){return function Gte(){if(null==lh&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>lh=!0}))}finally{lh=lh||!1}return lh}()?n:!!n.capture}let qte=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({}),n})();function W2(n){return Array.isArray(n)?n:[n]}function j2(n){return n instanceof Si?n.nativeElement:n}class tne extends Fi{constructor(e,t){super()}schedule(e,t=0){return this}}const fg={setInterval(n,e,...t){const{delegate:i}=fg;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=fg;return(e?.clearInterval||clearInterval)(n)},delegate:void 0},$2={now:()=>($2.delegate||Date).now(),delegate:void 0};class uh{constructor(e,t=uh.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}uh.now=$2.now;const rne=new class ine extends uh{constructor(e,t=uh.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}(class nne extends tne{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return fg.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&fg.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Va(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});function one(n){return Mn((e,t)=>{Li(n).subscribe(fn(t,()=>t.complete(),Ag)),!t.closed&&e.subscribe(t)})}const q2=new Set;let Vc,ane=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):cne}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function lne(n){if(!q2.has(n))try{Vc||(Vc=document.createElement("style"),Vc.setAttribute("type","text/css"),document.head.appendChild(Vc)),Vc.sheet&&(Vc.sheet.insertRule(`@media ${n} {body{ }}`,0),q2.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(He(H2))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function cne(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let une=(()=>{class n{constructor(t,i){this._mediaMatcher=t,this._zone=i,this._queries=new Map,this._destroySubject=new Br}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return X2(W2(t)).some(r=>this._registerQuery(r).mql.matches)}observe(t){let s=kv(X2(W2(t)).map(o=>this._registerQuery(o).observable));return s=ip(s.pipe($o(1)),s.pipe(function ene(n){return Rs((e,t)=>n<=t)}(1),function sne(n,e=rne){return Mn((t,i)=>{let r=null,s=null,o=null;const a=()=>{if(r){r.unsubscribe(),r=null;const c=s;s=null,i.next(c)}};function l(){const c=o+n,u=e.now();if(u<c)return r=this.schedule(void 0,c-u),void i.add(r);a()}t.subscribe(fn(i,c=>{s=c,o=e.now(),r||(r=e.schedule(l,n),i.add(r))},()=>{a(),i.complete()},void 0,()=>{s=r=null}))})}(0))),s.pipe(Mt(o=>{const a={matches:!1,breakpoints:{}};return o.forEach(({matches:l,query:c})=>{a.matches=a.matches||l,a.breakpoints[c]=l}),a}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const i=this._mediaMatcher.matchMedia(t),s={observable:new hn(o=>{const a=l=>this._zone.run(()=>o.next(l));return i.addListener(a),()=>{i.removeListener(a)}}).pipe(k1(i),Mt(({matches:o})=>({query:t,matches:o})),one(this._destroySubject)),mql:i};return this._queries.set(t,s),s}}return n.\u0275fac=function(t){return new(t||n)(He(ane),He(Qt))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function X2(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}const Q2="cdk-high-contrast-black-on-white",J2="cdk-high-contrast-white-on-black",mM="cdk-high-contrast-active";let xne=(()=>{class n{constructor(t,i){this._platform=t,this._document=i,this._breakpointSubscription=vt(une).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(t):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(mM,Q2,J2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?t.add(mM,Q2):2===i&&t.add(mM,J2)}}}return n.\u0275fac=function(t){return new(t||n)(He(H2),He(In))},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),eO=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({}),n})();const Sne=new Be("mat-sanity-checks",{providedIn:"root",factory:function wne(){return!0}});let pg=(()=>{class n{constructor(t,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!function $te(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(He(xne),He(Sne,8),He(In))},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[eO,eO]}),n})();class Ane{constructor(e,t,i,r=!1){this._renderer=e,this.element=t,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const iO=ch({passive:!0,capture:!0});class Cne{constructor(){this._events=new Map,this._delegateEventHandler=e=>{const t=function jte(n){return n.composedPath?n.composedPath()[0]:n.target}(e);t&&this._events.get(e.type)?.forEach((i,r)=>{(r===t||r.contains(t))&&i.forEach(s=>s.handleEvent(e))})}}addHandler(e,t,i,r){const s=this._events.get(t);if(s){const o=s.get(i);o?o.add(r):s.set(i,new Set([r]))}else this._events.set(t,new Map([[i,new Set([r])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,iO)})}removeHandler(e,t,i){const r=this._events.get(e);if(!r)return;const s=r.get(t);s&&(s.delete(i),0===s.size&&r.delete(t),0===r.size&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,iO)))}}const rO={enterDuration:225,exitDuration:150},sO=ch({passive:!0,capture:!0}),oO=["mousedown","touchstart"],aO=["mouseup","mouseleave","touchend","touchcancel"];class mg{constructor(e,t,i,r){this._target=e,this._ngZone=t,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=j2(i))}fadeInRipple(e,t,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...rO,...i.animation};i.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);const o=i.radius||function Ine(n,e,t){const i=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),r=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(i*i+r*r)}(e,t,r),a=e-r.left,l=t-r.top,c=s.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=a-o+"px",u.style.top=l-o+"px",u.style.height=2*o+"px",u.style.width=2*o+"px",null!=i.color&&(u.style.backgroundColor=i.color),u.style.transitionDuration=`${c}ms`,this._containerElement.appendChild(u);const d=window.getComputedStyle(u),f=d.transitionDuration,p="none"===d.transitionProperty||"0s"===f||"0s, 0s"===f||0===r.width&&0===r.height,_=new Ane(this,u,i,p);u.style.transform="scale3d(1, 1, 1)",_.state=0,i.persistent||(this._mostRecentTransientRipple=_);let m=null;return!p&&(c||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const g=()=>this._finishRippleTransition(_),v=()=>this._destroyRipple(_);u.addEventListener("transitionend",g),u.addEventListener("transitioncancel",v),m={onTransitionEnd:g,onTransitionCancel:v}}),this._activeRipples.set(_,m),(p||!c)&&this._finishRippleTransition(_),_}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,i={...rO,...e.config.animation};t.style.transitionDuration=`${i.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=j2(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,oO.forEach(i=>{mg._eventManager.addHandler(this._ngZone,i,t,this)}))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{aO.forEach(t=>{this._triggerElement.addEventListener(t,this,sO)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:i}=e.config;e.state=1,!i&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=function yne(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(e),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!i&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!function vne(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let i=0;i<t.length;i++)this.fadeInRipple(t[i].clientX,t[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const e=this._triggerElement;e&&(oO.forEach(t=>mg._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&aO.forEach(t=>e.removeEventListener(t,this,sO)))}}mg._eventManager=new Cne;let Rne=(()=>{class n{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$e({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Pne=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({providers:[Rne]}),n})(),gM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[pg,n1,Pne,pg]}),n})(),Bne=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n}),n.\u0275inj=On({imports:[pg,gM,gM,qte,pg]}),n})(),Vne=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Vn({type:n,bootstrap:[UJ]}),n.\u0275inj=On({providers:[ud,YF],imports:[A1,tj,Hte,PJ,Bne,gM]}),n})();fW().bootstrapModule(Vne).catch(n=>console.error(n))}},zt=>{zt(zt.s=913)}]);